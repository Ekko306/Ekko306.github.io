<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: black; /*è¿›åº¦æ¡é¢œè‰²*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*é˜´å½±é¢œè‰²*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*ä¸Šè¾¹æ¡†é¢œè‰²*/
        border-left-color: #1E92FB;    /*å·¦è¾¹æ¡†é¢œè‰²*/
    }
</style>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="You are my JavaSript in my HTML.">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="You are my JavaSript in my HTML.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="You are my JavaSript in my HTML.">
  <link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Hexo</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="æœ›æ˜Ÿçš„å¤ªé˜³èŠ±">
      <meta itemprop="description" content="You are my JavaSript in my HTML.">
      <meta itemprop="image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570163730249&di=dcd36b04d1066a90ddb1f132ae3a6bcc&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Ffe60497fd762440686b6d5702c2c9f19df71fb9911009-LVWEJj_fw658">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2020/02/05/Summary-of-Pytorch-and-OpenCV/" class="post-title-link" itemprop="url">Summary of Pytorch and OpenCV</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-02-05 12:07:12" itemprop="dateCreated datePublished" datetime="2020-02-05T12:07:12+08:00">2020-02-05</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-02-11 12:07:23" itemprop="dateModified" datetime="2020-02-11T12:07:23+08:00">2020-02-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep-Learning</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="PyTorchæ€»ç»“"><a href="#PyTorchæ€»ç»“" class="headerlink" title="PyTorchæ€»ç»“"></a>PyTorchæ€»ç»“</h1><p>é¦–å…ˆæ˜ç™½Pytorchæ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œåƒã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ä¸­ä½¿ç”¨çš„MXNetä¹Ÿæ˜¯ä¸€ç§æ¡†æ¶ï¼Œæ¡†æ¶ä¸åŒï¼Œä½†æ˜¯æ·±åº¦å­¦ä¹ çš„å†…å®¹ä½“ç³»æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ä¸åŒçš„æ¡†æ¶æœ‰è‡ªå·±å®ç°æŸä¸ªç½‘ç»œæˆ–è€…æ–¹æ³•çš„ä¸åŒæ–¹æ³•ã€‚<br><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/%E6%A1%86%E6%9E%B6.png" alt="æ¡†æ¶"></p>
<p><strong>åº”è¯¥æŒæ¡å¥½æ·±åº¦å­¦ä¹ ç†è®ºçŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œå°½å¯èƒ½å»ç†Ÿæ‚‰å¤šç§æ¡†æ¶çš„ç‰¹ç‚¹</strong><br>å¯¹ã€Šæ·±åº¦å­¦ä¹ å…¥é—¨ä¹‹PyTorchã€‹å¯¹PyTorchä¸»è¦ï¼š</p>
<h2 id="PytorchåŸºç¡€"><a href="#PytorchåŸºç¡€" class="headerlink" title="PytorchåŸºç¡€"></a>PytorchåŸºç¡€</h2><h3 id="Tensorï¼ˆå¼ é‡ï¼‰"><a href="#Tensorï¼ˆå¼ é‡ï¼‰" class="headerlink" title="Tensorï¼ˆå¼ é‡ï¼‰"></a>Tensorï¼ˆå¼ é‡ï¼‰</h3><blockquote>
<p>PyTorché‡Œé¢å¤„ç†çš„æœ€åŸºæœ¬çš„æ“ä½œå¯¹è±¡æ˜¯Tensorï¼ŒTensoræ˜¯å¼ é‡çš„è‹±æ–‡ã€‚</p>
<ul>
<li>å¼ é‡è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå¤šä½çš„æ•°ç»„ï¼Œå’Œnumpyå¯¹åº”ï¼Œè€Œä¸”PyTorchçš„Tensorå¯ä»¥å’Œnumpyçš„ndarrayç›¸äº’è½¬æ¢ï¼ˆMXNetä¹Ÿå¯ä»¥ç›¸äº’è½¬æ¢ï¼‰ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯PyTorchå¯ä»¥åœ¨GPUä¸Šè¿è¡Œï¼Œè€Œnumpyçš„ndarrayåªèƒ½åœ¨CPUä¸Šè¿è¡Œã€‚</li>
<li>Tensorçš„æ•°æ®ç±»å‹ï¼š<br>  -32ä½æµ®ç‚¹å‹torch.FloatTensor<br>  -64ä½æµ®ç‚¹å‹torch.DoubleTensor<br>  -16ä½æ•´å‹torch.ShortTensor<br>  -32ä½æ•´å‹torch.IntTensor<br>  -64ä½æ•´å‹torch.LongTensor</li>
</ul>
</blockquote>
<p>å®šä¹‰ä½¿ç”¨æ–¹æ³•ä¸€çœ‹å°±ä¼šã€‚<br><strong>æŠŠtensoræ”¾åˆ°GPUä¸Š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    a_cuda = a.cuda()</span><br><span class="line">    print(a_cuda)</span><br></pre></td></tr></table></figure>

<h3 id="Variableï¼ˆå˜é‡ï¼‰"><a href="#Variableï¼ˆå˜é‡ï¼‰" class="headerlink" title="Variableï¼ˆå˜é‡ï¼‰"></a>Variableï¼ˆå˜é‡ï¼‰</h3><p>æ¥ç€è¦å°†çš„æ¦‚å¿µæ˜¯Variableï¼Œåœ¨numpyé‡Œé¢æ²¡æœ‰ï¼Œæ˜¯<strong>ç¥ç»ç½‘ç»œè®¡ç®—å›¾ç‰¹æœ‰çš„</strong>æ¦‚å¿µã€‚</p>
<blockquote>
<p>Variableå’ŒTensoræœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œä¸è¿‡Variableä¼šè¢«æ”¾å…¥ä¸€ä¸ªè®¡ç®—å›¾ä¸­ï¼Œç„¶åè¿›è¡Œå‰å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­ï¼Œè‡ªåŠ¨æ±‚å¯¼ã€‚</p>
<ul>
<li>Variabelæ˜¯åœ¨torch.autograd.Variableä¸­</li>
<li>è®²ä¸€ä¸ªtensorå˜æˆVariableï¼Œåªéœ€è¦Variable(a)å°±å¯ä»¥</li>
<li>Variableå…·æœ‰ä¸‰ä¸ªé‡è¦å±æ€§ï¼šdata,grad,grad_fn<ul>
<li>dataå¯ä»¥å–å‡ºVariableé‡Œé¢tensoræ•°å€¼</li>
<li>grad_fnè¡¨ç¤ºå¾—åˆ°è¿™ä¸ªVariableçš„æ“ä½œï¼ˆå‡½æ•°ï¼‰</li>
<li>gradæ˜¯è¿™ä¸ªVariableçš„åå‘ä¼ æ’­æ¢¯åº¦ã€‚<br>ä¾‹å­ï¼š</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºå˜é‡</span></span><br><span class="line">x = Variable(torch.Tensor([<span class="number">1</span>]), requires_grad=<span class="literal">True</span>)</span><br><span class="line">w = Variable(torch.Tensor([<span class="number">2</span>]), requires_grad=<span class="literal">True</span>)</span><br><span class="line">b = Variable(torch.Tensor([<span class="number">3</span>]), requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#å»ºç«‹è®¡ç®—å›¾</span></span><br><span class="line">y = w * x +b</span><br><span class="line"><span class="comment">#è®¡ç®—æ¢¯åº¦</span></span><br><span class="line">y.backward()    <span class="comment">#å’Œy.backward(torch.FloatTensor([1]))ç›¸åŒ</span></span><br><span class="line">print(x.grad)   <span class="comment">#x.grad = 2  </span></span><br><span class="line">print(w.grad)   <span class="comment">#w.grad = 1</span></span><br><span class="line">print(b.grad)   <span class="comment">#b.grad = 1</span></span><br></pre></td></tr></table></figure>

<p><strong><em>æ³¨æ„ä¸¤ç‚¹ï¼š</em></strong></p>
<ol>
<li>æ„å»ºVariableéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°requires_grad=Trueï¼Œè¡¨ç¤ºæ˜¯å¦å¯¹è¿™ä¸ªå˜é‡æ±‚æ¢¯åº¦ï¼Œé»˜è®¤æ˜¯Flase</li>
<li>y.backward()æ˜¯æ‰€è°“çš„è‡ªåŠ¨æ±‚å¯¼ï¼Œæ‰€æœ‰é‡æ˜¯æ ‡é‡å°±ç­‰ä»·äºy.backward(torch.FloatTensor([1]))çœç•¥çš„ä¸ç”¨è°¢ï¼Œè‡ªåŠ¨æ±‚å¯¼å°±ä¸éœ€è¦å»æ˜ç¡®åœ°å†™æ˜æ˜¯å¯¹é‚£ä¸ªå‡½æ•°æ±‚å¯¼ï¼Œç›´æ¥å¯¹æ‰€æœ‰éœ€è¦çš„æ¢¯åº¦æ±‚å¯¼ï¼Œä½†å¯¹çŸ©é˜µæ¯”å¦‚ä¸‰ç»´å‘é‡ï¼Œè¿™æ—¶å€™yæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå¿…é¡»å£°æ˜y.backward(torch.FloatTensor([1, 1, 1])å¾—åˆ°æ¯ä¸ªåˆ†é‡çš„æ¢¯åº¦)<h3 id="Datasetï¼ˆæ•°æ®é›†ï¼‰"><a href="#Datasetï¼ˆæ•°æ®é›†ï¼‰" class="headerlink" title="Datasetï¼ˆæ•°æ®é›†ï¼‰"></a>Datasetï¼ˆæ•°æ®é›†ï¼‰</h3><blockquote>
<p>ä»»ä½•æœºå™¨å­¦ä¹ é—®é¢˜éƒ½éœ€è¦<strong>æ•°æ®é›†</strong>ï¼ŒPyTorchæä¾›å¾ˆå¤š<strong>å·¥å…·</strong>ï¼Œç”¨æ¥é€šè¿‡è¿­ä»£çš„æ–¹å¼è·å–æ¯ä¸€ä¸ªæ•°æ®:</p>
</blockquote>
</li>
</ol>
<table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>torch.utils.data.Dataset</td>
<td>å®šä¹‰è‡ªå·±çš„æ•°æ®ç±»ç»§æ‰¿å’Œé‡å†™è¿™ä¸ªç±»ï¼Œä½†å¾ˆéš¾å®ç°å–batchï¼Œshuffleæˆ–è€…å¤šçº¿ç¨‹å–è¯»å–æ•°æ®</td>
</tr>
<tr>
<td>torch.utils.data.DataLoader</td>
<td>ç®€å•çš„æ–¹æ³•å®ç°ä¸Šè¿°åŠŸèƒ½</td>
</tr>
<tr>
<td>torchvisionåŒ…çš„ImageFolder</td>
<td>é«˜çº§å…³äºè®¡ç®—æœºè§†è§‰çš„æ•°æ®è¯»å–ç±»ï¼Œä¸»è¦å¤„ç†å›¾ç‰‡</td>
</tr>
<tr>
<td><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è‡ªå®šä¹‰ç»§æ‰¿Dataset:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myDataset</span><span class="params">(Dataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, csv_file, txt_file, root_dir, other_file)</span>:</span></span><br><span class="line">    self.csv_data = pd.read_csv(csv_file)</span><br><span class="line">    <span class="keyword">with</span> open(txt_file, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data_list = f.readlines()</span><br><span class="line">    self.txt_data = data_list</span><br><span class="line">    self.root_dir = root_dir</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.sv_data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        data = (self.csv_data[idx], self.txt_data[idx])</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰å¥½çš„è¿­ä»£å™¨</span></span><br><span class="line">dataiter = DataLoader(myDataset, batch_size = <span class="number">32</span>, shuffle=<span class="literal">True</span>, collate_fn=default_collate)</span><br><span class="line"><span class="comment">#collate_fnè¡¨ç¤ºå¦‚ä½•å–æ ·æœ¬ï¼Œå¯ä»¥å®šä¹‰è‡ªå·±æƒ³è¦çš„å†…å®¹</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¯»å–å›¾ç‰‡æ•°æ®é›†</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">è¦æ±‚å›¾ç‰‡å­˜æ”¾æ ¼å¼</span></span><br><span class="line"><span class="string">root/dog/xxx.png</span></span><br><span class="line"><span class="string">root/cat/123.png</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">deset = ImageFolder(root=<span class="string">'root_path'</span>, transform=<span class="literal">None</span>, loader=defalut_loader)</span><br><span class="line"><span class="comment">#rootæ˜¯éœ€è¦æ ¹ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹æœ‰å‡ ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹è¡¨ç¤ºä¸€ä¸ªç±»åˆ«ï¼Œtransformå’Œtarget_transformæ˜¯å›¾ç‰‡å¢å¼ºï¼Œloaderæ˜¯å›¾ç‰‡è¯»å–çš„æ–¹æ³•ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="nn-Moduleï¼ˆæ¨¡ç»„ï¼‰"><a href="#nn-Moduleï¼ˆæ¨¡ç»„ï¼‰" class="headerlink" title="nn.Moduleï¼ˆæ¨¡ç»„ï¼‰"></a>nn.Moduleï¼ˆæ¨¡ç»„ï¼‰</h3><blockquote>
<p>è¦æ„å»ºç¥ç»ç½‘ç»œï¼Œæ‰€æœ‰çš„å±‚ç»“æ„å’ŒæŸå¤±å‡½æ•°éƒ½éœ€è¦æ¨¡ç»„ï¼Œæ¥è‡ªäºtorch.nnï¼Œæ‰€æœ‰çš„æ¨¡ç‰ˆæ„å»ºä»è¿™ä¸ª<strong>åŸºç±»nn.Moduleç»§æ‰¿</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">net_name</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, other_arguments)</span>:</span></span><br><span class="line">        super(net_name, self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(in_channels, out_channels, kernel_size)</span><br><span class="line">        <span class="comment">#other network layer</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å°±å»ºç«‹äº†ä¸€ä¸ªè®¡ç®—å›¾ï¼Œå¯åå¤ç”¨ï¼Œè°ƒç”¨ä¸€æ¬¡å°±ç›¸å½“äºä¸€æ¬¡å‰å‘ä¼ æ’­ï¼Œå› ä¸ºè‡ªåŠ¨æ±‚å¯¼ä¸ç”¨è‡ªå·±å†™åå‘ä¼ æ’­ã€‚æ‰€æœ‰çš„ç½‘ç»œå±‚éƒ½ç”±nnåŒ…å¾—åˆ°ã€‚<br>nnåŒ…è¿˜å¯ä»¥å®šä¹‰<strong>æŸå¤±å‡½æ•°</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">loss = criterion(output, target)</span><br></pre></td></tr></table></figure>

<h3 id="torch-optimï¼ˆä¼˜åŒ–ï¼‰"><a href="#torch-optimï¼ˆä¼˜åŒ–ï¼‰" class="headerlink" title="torch.optimï¼ˆä¼˜åŒ–ï¼‰"></a>torch.optimï¼ˆä¼˜åŒ–ï¼‰</h3><blockquote>
<p>éœ€è¦é€šè¿‡ä¿®æ”¹å‚æ•°ä½¿å¾—æŸå¤±å‡½æ•°æœ€å°åŒ–ï¼Œä¼˜åŒ–ç®—æ³•å°±æ˜¯ä¸€ç§è°ƒæ•´æ¨¡å‹å‚æ•°æ›´æ–°çš„ç­–ç•¥ã€‚</p>
<ol>
<li>ä¸€é˜¶ä¼˜åŒ–ç®—æ³•<br> ä½¿ç”¨å„ä¸ªå‚æ•°çš„æ¢¯åº¦å€¼æ›´æ–°å‚æ•°ï¼Œæœ€å¸¸è§çš„ä¸€é˜¶ä¼˜åŒ–ç®—æ³•æ˜¯æ¢¯åº¦ä¸‹é™ã€‚æ¢¯åº¦ä¸‹é™å¯»æ‰¾æœ€å°å€¼ï¼Œæ§åˆ¶æ–¹å·®ï¼Œæ›´æ–°æ¨¡å‹å‚æ•°ï¼Œæœ€ç»ˆæ¨¡å‹æ”¶æ•›ã€‚</li>
<li>äºŒé˜¶ä¼˜åŒ–ç®—æ³•<br> ä½¿ç”¨äº†<strong>äºŒé˜¶å¯¼æ•°</strong>æ¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸå¤±å‡½æ•°ã€‚</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=<span class="number">0.01</span>, momentum=<span class="number">0.9</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½"><a href="#æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½" class="headerlink" title="æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½"></a>æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½</h3><blockquote>
<p>torch.saveä¿å­˜æ¨¡å‹çš„ç»“æ„å’Œå‚æ•°</p>
</blockquote>
<p>ä¸¤ç§ä¿å­˜ï¼š</p>
<ol>
<li><p>ä¿å­˜æ•´ä¸ªæ¨¡å‹çš„ç»“æ„ç»†è…»å’Œå‚æ•°ä¿¡æ¯ï¼Œä¿å­˜çš„å¯¹è±¡æ˜¯æ¨¡å‹model</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.save(model, <span class="string">'./model.pth'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿å­˜æ¨¡å‹çš„å‚æ•°ï¼Œä¿å­˜çš„å¯¹è±¡æ˜¯æ¨¡å‹çš„çŠ¶æ€model.state_dict()</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.save(model.state_dict, <span class="string">'./model.pth'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ä¸¤ç§è¯»å–ï¼š</p>
<ol>
<li><code>load_model = torch.load(&#39;model.pth&#39;)</code>åŠ è½½å®Œæ•´çš„æ¨¡å‹ç»“æ„å’Œå‚æ•°ä¿¡æ¯ï¼Œç½‘ç»œå¤§åŠ è½½æ…¢</li>
<li><code>model.load_state_dic(torch.load(&#39;model_state,pth&#39;))</code>éœ€è¦å…ˆå¯¼å…¥æ¨¡å‹ç»“æ„<h2 id="PyTorchå®é™…åº”ç”¨"><a href="#PyTorchå®é™…åº”ç”¨" class="headerlink" title="PyTorchå®é™…åº”ç”¨"></a>PyTorchå®é™…åº”ç”¨</h2>å…¶å®PyTorchåªä¸€ç§æ¡†æ¶ï¼Œä¹¦ä¸­å¤§å¤šæ•°å†…å®¹æ˜¯åœ¨ä»‹ç»æ·±åº¦å­¦ä¹ çŸ¥è¯†ç†è®ºï¼Œåº”è¯¥æ›´å¤šå…³æ³¨PyTorchè¿™ä¸ªæ¡†æ¶çš„ç‰¹åˆ«ä¸åŒçš„ï¼Œå…·æœ‰ç‰¹è‰²çš„åœ°æ–¹ï¼Œä¸‹é¢å¯¹æ¯”PyTorchå’ŒMXNetçš„å·ç§¯ç¥ç»ç½‘ç»œçš„æ¨¡å‹è®­ç»ƒç»“æ„ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨Pytorchè®­ç»ƒMNISTæ•°æ®é›†</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> datasets, transforms</span><br><span class="line">torch.__version__</span><br><span class="line"></span><br><span class="line">BATCH_SIZE=<span class="number">512</span> <span class="comment">#å¤§æ¦‚éœ€è¦2Gçš„æ˜¾å­˜</span></span><br><span class="line">EPOCHS=<span class="number">20</span> <span class="comment"># æ€»å…±è®­ç»ƒæ‰¹æ¬¡</span></span><br><span class="line">DEVICE = torch.device(<span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>) <span class="comment"># è®©torchåˆ¤æ–­æ˜¯å¦ä½¿ç”¨GPUï¼Œå»ºè®®ä½¿ç”¨GPUç¯å¢ƒï¼Œå› ä¸ºä¼šå¿«å¾ˆå¤š</span></span><br><span class="line"></span><br><span class="line">train_loader = torch.utils.data.DataLoader(</span><br><span class="line">        datasets.MNIST(<span class="string">'data'</span>, train=<span class="literal">True</span>, download=<span class="literal">True</span>, </span><br><span class="line">                       transform=transforms.Compose([</span><br><span class="line">                           transforms.ToTensor(),</span><br><span class="line">                           transforms.Normalize((<span class="number">0.1307</span>,), (<span class="number">0.3081</span>,))</span><br><span class="line">                       ])),</span><br><span class="line">        batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">test_loader = torch.utils.data.DataLoader(</span><br><span class="line">        datasets.MNIST(<span class="string">'data'</span>, train=<span class="literal">False</span>, transform=transforms.Compose([</span><br><span class="line">                           transforms.ToTensor(),</span><br><span class="line">                           transforms.Normalize((<span class="number">0.1307</span>,), (<span class="number">0.3081</span>,))</span><br><span class="line">                       ])),</span><br><span class="line">        batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConvNet</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        <span class="comment"># 1,28x28</span></span><br><span class="line">        self.conv1=nn.Conv2d(<span class="number">1</span>,<span class="number">10</span>,<span class="number">5</span>) <span class="comment"># 10, 24x24</span></span><br><span class="line">        self.conv2=nn.Conv2d(<span class="number">10</span>,<span class="number">20</span>,<span class="number">3</span>) <span class="comment"># 128, 10x10</span></span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">20</span>*<span class="number">10</span>*<span class="number">10</span>,<span class="number">500</span>)</span><br><span class="line">        self.fc2 = nn.Linear(<span class="number">500</span>,<span class="number">10</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        in_size = x.size(<span class="number">0</span>)</span><br><span class="line">        out = self.conv1(x) <span class="comment">#24</span></span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        out = F.max_pool2d(out, <span class="number">2</span>, <span class="number">2</span>)  <span class="comment">#12</span></span><br><span class="line">        out = self.conv2(out) <span class="comment">#10</span></span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        out = out.view(in_size,<span class="number">-1</span>)</span><br><span class="line">        out = self.fc1(out)</span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        out = self.fc2(out)</span><br><span class="line">        out = F.log_softmax(out,dim=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">model = ConvNet().to(DEVICE)</span><br><span class="line">optimizer = optim.Adam(model.parameters())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(model, device, train_loader, optimizer, epoch)</span>:</span></span><br><span class="line">    model.train()</span><br><span class="line">    <span class="keyword">for</span> batch_idx, (data, target) <span class="keyword">in</span> enumerate(train_loader):</span><br><span class="line">        data, target = data.to(device), target.to(device)</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        output = model(data)</span><br><span class="line">        loss = F.nll_loss(output, target)</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        <span class="keyword">if</span>(batch_idx+<span class="number">1</span>)%<span class="number">30</span> == <span class="number">0</span>: </span><br><span class="line">            print(<span class="string">'Train Epoch: &#123;&#125; [&#123;&#125;/&#123;&#125; (&#123;:.0f&#125;%)]\tLoss: &#123;:.6f&#125;'</span>.format(</span><br><span class="line">                epoch, batch_idx * len(data), len(train_loader.dataset),</span><br><span class="line">                <span class="number">100.</span> * batch_idx / len(train_loader), loss.item()))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(model, device, test_loader)</span>:</span></span><br><span class="line">    model.eval()</span><br><span class="line">    test_loss = <span class="number">0</span></span><br><span class="line">    correct = <span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> data, target <span class="keyword">in</span> test_loader:</span><br><span class="line">            data, target = data.to(device), target.to(device)</span><br><span class="line">            output = model(data)</span><br><span class="line">            test_loss += F.nll_loss(output, target, reduction=<span class="string">'sum'</span>).item() <span class="comment"># å°†ä¸€æ‰¹çš„æŸå¤±ç›¸åŠ </span></span><br><span class="line">            pred = output.max(<span class="number">1</span>, keepdim=<span class="literal">True</span>)[<span class="number">1</span>] <span class="comment"># æ‰¾åˆ°æ¦‚ç‡æœ€å¤§çš„ä¸‹æ ‡</span></span><br><span class="line">            correct += pred.eq(target.view_as(pred)).sum().item()</span><br><span class="line"></span><br><span class="line">    test_loss /= len(test_loader.dataset)</span><br><span class="line">    print(<span class="string">'\nTest set: Average loss: &#123;:.4f&#125;, Accuracy: &#123;&#125;/&#123;&#125; (&#123;:.0f&#125;%)\n'</span>.format(</span><br><span class="line">        test_loss, correct, len(test_loader.dataset),</span><br><span class="line">        <span class="number">100.</span> * correct / len(test_loader.dataset)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">1</span>, EPOCHS + <span class="number">1</span>):</span><br><span class="line">    train(model, DEVICE, train_loader, optimizer, epoch)</span><br><span class="line">    test(model, DEVICE, test_loader)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/PyTorch.jpg" alt="PyTorch"></p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨MXNetè®­ç»ƒFashion-MNISTæ•°æ®é›†</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">".."</span>)</span><br><span class="line"><span class="keyword">import</span> d2lzh <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">import</span> mxnet <span class="keyword">as</span> mx</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> autograd, gluon, init, nd</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> loss <span class="keyword">as</span> gloss, nn</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Conv2D(channels=<span class="number">6</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.MaxPool2D(pool_size=<span class="number">2</span>, strides=<span class="number">2</span>),</span><br><span class="line">        nn.Conv2D(channels=<span class="number">16</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.MaxPool2D(pool_size=<span class="number">2</span>, strides=<span class="number">2</span>),</span><br><span class="line">        <span class="comment"># Denseä¼šé»˜è®¤å°†(æ‰¹é‡å¤§å°, é€šé“, é«˜, å®½)å½¢çŠ¶çš„è¾“å…¥è½¬æ¢æˆ</span></span><br><span class="line">        <span class="comment"># (æ‰¹é‡å¤§å°, é€šé“ * é«˜ * å®½)å½¢çŠ¶çš„è¾“å…¥</span></span><br><span class="line">        nn.Dense(<span class="number">120</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.Dense(<span class="number">84</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.Dense(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">X = nd.random.uniform(shape=(<span class="number">1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>))</span><br><span class="line">net.initialize()</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> net:</span><br><span class="line">    X = layer(X)</span><br><span class="line">    print(layer.name, <span class="string">'output shape:\t'</span>, X.shape)</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">try_gpu</span><span class="params">()</span>:</span>  <span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ctx = mx.gpu()</span><br><span class="line">        _ = nd.zeros((<span class="number">1</span>,), ctx=ctx)</span><br><span class="line">    <span class="keyword">except</span> mx.base.MXNetError:</span><br><span class="line">        ctx = mx.cpu()</span><br><span class="line">    <span class="keyword">return</span> ctx</span><br><span class="line"></span><br><span class="line">ctx = try_gpu()</span><br><span class="line">ctx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨ã€‚è¯¥å‡½æ•°å°†è¢«é€æ­¥æ”¹è¿›ï¼šå®ƒçš„å®Œæ•´å®ç°å°†åœ¨â€œå›¾åƒå¢å¹¿â€ä¸€èŠ‚ä¸­</span></span><br><span class="line"><span class="comment"># æè¿°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_accuracy</span><span class="params">(data_iter, net, ctx)</span>:</span></span><br><span class="line">    acc_sum, n = nd.array([<span class="number">0</span>], ctx=ctx), <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter:</span><br><span class="line">        <span class="comment"># å¦‚æœctxä»£è¡¨GPUåŠç›¸åº”çš„æ˜¾å­˜ï¼Œå°†æ•°æ®å¤åˆ¶åˆ°æ˜¾å­˜ä¸Š</span></span><br><span class="line">        X, y = X.as_in_context(ctx), y.as_in_context(ctx).astype(<span class="string">'float32'</span>)</span><br><span class="line">        acc_sum += (net(X).argmax(axis=<span class="number">1</span>) == y).sum()</span><br><span class="line">        n += y.size</span><br><span class="line">    <span class="keyword">return</span> acc_sum.asscalar() / n</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_ch5</span><span class="params">(net, train_iter, test_iter, batch_size, trainer, ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">              num_epochs)</span>:</span></span><br><span class="line">    print(<span class="string">'training on'</span>, ctx)</span><br><span class="line">    loss = gloss.SoftmaxCrossEntropyLoss()</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> range(num_epochs):</span><br><span class="line">        train_l_sum, train_acc_sum, n, start = <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0</span>, time.time()</span><br><span class="line">        <span class="keyword">for</span> X, y <span class="keyword">in</span> train_iter:</span><br><span class="line">            X, y = X.as_in_context(ctx), y.as_in_context(ctx)</span><br><span class="line">            <span class="keyword">with</span> autograd.record():</span><br><span class="line">                y_hat = net(X)</span><br><span class="line">                l = loss(y_hat, y).sum()</span><br><span class="line">            l.backward()</span><br><span class="line">            trainer.step(batch_size)</span><br><span class="line">            y = y.astype(<span class="string">'float32'</span>)</span><br><span class="line">            train_l_sum += l.asscalar()</span><br><span class="line">            train_acc_sum += (y_hat.argmax(axis=<span class="number">1</span>) == y).sum().asscalar()</span><br><span class="line">            n += y.size</span><br><span class="line">        test_acc = evaluate_accuracy(test_iter, net, ctx)</span><br><span class="line">        print(<span class="string">'epoch %d, loss %.4f, train acc %.3f, test acc %.3f, '</span></span><br><span class="line">              <span class="string">'time %.1f sec'</span></span><br><span class="line">              % (epoch + <span class="number">1</span>, train_l_sum / n, train_acc_sum / n, test_acc,</span><br><span class="line">                 time.time() - start))</span><br><span class="line"></span><br><span class="line">lr, num_epochs = <span class="number">0.9</span>, <span class="number">5</span></span><br><span class="line">net.initialize(force_reinit=<span class="literal">True</span>, ctx=ctx, init=init.Xavier())</span><br><span class="line">trainer = gluon.Trainer(net.collect_params(), <span class="string">'sgd'</span>, &#123;<span class="string">'learning_rate'</span>: lr&#125;)</span><br><span class="line">train_ch5(net, train_iter, test_iter, batch_size, trainer, ctx, num_epochs)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/MXNet.jpg" alt="MXNet"></p>
<p><strong>å¯ä»¥å¯¹æ¯”å‘ç°ï¼Œä¸¤ç§æ¡†æ¶å…¶å®å¯¹æ·±åº¦å­¦ä¹ æ•´ä¸ªæµç¨‹éƒ½æ˜¯å¤§åŒå°å¼‚ï¼ŒåŒæ—¶æ¡†æ¶ä¹Ÿæœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œå¤šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å°±èƒ½ä½¿ç”¨ç†Ÿç»ƒï¼Œæ›´é‡è¦æ˜¯æŒæ¡æ·±åº¦å­¦ä¹ æ•´ä¸ªæµç¨‹ï¼Œå„ç§æ¨¡å‹ç‰¹ç‚¹ï¼Œè°ƒå‚ç­‰æ–¹æ³•ï¼Œå„ç§ä¼˜åŒ–ç®—æ³•ã€æŸå¤±ç®—æ³•çš„æœ¬è´¨æŒæ¡æ¸…æ¥šæ‰èƒ½æ›´å¥½è®­ç»ƒå‡ºæ¨¡å‹</strong></p>
<h1 id="OpenCVæ€»ç»“"><a href="#OpenCVæ€»ç»“" class="headerlink" title="OpenCVæ€»ç»“"></a>OpenCVæ€»ç»“</h1><h2 id="å…¨ä¹¦ç»“æ„ï¼š"><a href="#å…¨ä¹¦ç»“æ„ï¼š" class="headerlink" title="å…¨ä¹¦ç»“æ„ï¼š"></a>å…¨ä¹¦ç»“æ„ï¼š</h2><p><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/book.png" alt="book"></p>
<blockquote>
<p>OpenCVä¸ºOpen Source Computer Visionçš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªå…è´¹çš„è®¡ç®—æœºè§†è§‰åº“ï¼Œå¯é€šè¿‡å¤„ç†å›¾åƒå’Œè§†é¢‘å®Œæˆå„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ‘„åƒå¤´è¾“å…¥çš„ä¿¡å·ä»¥åŠä½¿æœºå™¨äººè¯†åˆ«ç°å®ç”Ÿæ´»ä¸­çš„ç‰©ä½“ã€‚</p>
</blockquote>
<p>å…¶å®OpenCVé‡ç‚¹æ˜¯æŒæ¡æ€ä¹ˆä½¿ç”¨ï¼Œè¿™æœ¬ä¹¦æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»äº†OpenCVä¸­çš„ä¸€äº›æ¥å£çš„åŸç†å’Œåº”ç”¨ï¼Œä½†é‡ç‚¹åº”è¯¥åœ¨ç†Ÿæ‚‰ç†è§£opeCVçš„ä¸€äº›é‡è¦å›¾åƒå¤„ç†çš„æ€æƒ³å’Œåº”ç”¨ã€‚<br><strong>å¯¹è¿™æœ¬ä¹¦çš„å®Œæˆæƒ…å†µï¼š</strong></p>
<ul>
<li>å‰ä¸‰ç« æ˜¯å®Œå…¨è¯»å®Œäº†å¹¶ä¸”æ•²äº†ä»£ç ï¼Œæœ‰ä¸ªå¤§è‡´çš„äº†è§£</li>
<li>ä¹¦ä¸­ç»™çš„Cameoå®é™…ä¾‹å­ï¼Œæ˜¯Pythonå†™çš„ï¼Œç”±äºc++æœ€åæœ‰ä¸€ä¸ªç»¼åˆå®ä¾‹ï¼Œä¸ºäº†ä¸€ä¸¾ä¸¤å¾—ï¼Œæ—¢å­¦ä¹ äº†c++é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ï¼ŒåŒæ—¶æ›´ç†Ÿæ‚‰OpenCVï¼Œæˆ‘æŠŠä¹¦ä¸­çš„Pythonä»£ç æ”¹æˆäº†c++æ ¼å¼å½“ä½œä¸šäº¤äº†ä¸Šå»ğŸ˜‚ï¼Œæœ€åå®ç°äº†ä¸€ä¸ªèƒ½å¤Ÿäººè„¸æ£€æµ‹çš„æ‘„åƒå¤´ã€‚å¯¹ä¸€äº›æ–¹æ³•åˆæœ‰äº†æ›´å®é™…çš„æŒæ¡ã€‚<h2 id="OpenCVè¦ç‚¹æ€»ç»“"><a href="#OpenCVè¦ç‚¹æ€»ç»“" class="headerlink" title="OpenCVè¦ç‚¹æ€»ç»“"></a>OpenCVè¦ç‚¹æ€»ç»“</h2><h3 id="OpenCVçš„åŸºç¡€"><a href="#OpenCVçš„åŸºç¡€" class="headerlink" title="OpenCVçš„åŸºç¡€"></a>OpenCVçš„åŸºç¡€</h3>ä¸»è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨OpenCVå¯¹è¾“å…¥å’Œè¾“å‡ºæµçš„æ§åˆ¶ï¼Œæ–¹æ³•ä¸€çœ‹å°±ä¼šã€‚<h4 id="è¯»-å†™å›¾åƒæ–‡ä»¶"><a href="#è¯»-å†™å›¾åƒæ–‡ä»¶" class="headerlink" title="è¯»/å†™å›¾åƒæ–‡ä»¶"></a>è¯»/å†™å›¾åƒæ–‡ä»¶</h4>OpenCVçš„imreadå‡½æ•°å’Œimwriteå‡½æ•°éƒ½æ”¯æŒå„ç§é™æ€å›¾åƒæ–‡ä»¶æ ¼å¼ã€‚ä¸åŒç³»ç»Ÿæ”¯æŒå›¾åƒæ ¼å¼ä¸åŒï¼Œä½†éƒ½æ”¯æŒBMPæ ¼å¼ï¼Œé€šå¸¸è¿˜æ”¯æŒPNGã€JPEGå’ŒTIFFæ ¼å¼ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">img = numpy.zeros((<span class="number">3</span>,<span class="number">3</span>), dtype=numpy.uint8) <span class="comment">#numpyå›¾åƒå®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è½¬æ¢å›¾åƒæˆBGRæ ¼å¼</span></span><br><span class="line">img = cv2.cvtColor(img, cv2.COLOR_GRAY2BGR)</span><br><span class="line"><span class="comment">#è¯»æ–‡ä»¶</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">å¯é€‰å‚æ•°ï¼š</span></span><br><span class="line"><span class="string">IMREAD_ANYCOLOR\IMREADANYDEPTH\IMREAD_COLOR\IMREAD_GRAYSCALE..</span></span><br><span class="line"><span class="string">image = cv2.imread('MyPic.png', cv2.IMREAD_GRAYSCALE)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">image = cv2.imread(<span class="string">'MyPic.png'</span>)</span><br><span class="line"><span class="comment">#å†™æ–‡ä»¶</span></span><br><span class="line">cv2.imwrite(<span class="string">'MyPic.jpg'</span>, image)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢"><a href="#å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢"></a>å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢</h4><p>ä¸€å¼ å›¾åƒå¯ä»¥çš„æ¯ä¸ªåƒç´ ç‚¹å¯ä»¥ç”¨æ¯ä¸ªé€šé“çš„ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è‹¥ä¸€å›¾åƒæ¯ä¸ªé€šé“8ä¸ºï¼Œå¯è½¬æ¢æˆpython bytearrayæ ¼å¼</span></span><br><span class="line">byteArray = bytearray(image)</span><br><span class="line"><span class="comment">#è‹¥bytearrayæœ‰æ°å½“çš„é¡ºåºå­—èŠ‚ï¼Œå¯ä»¥è½¬æ¢æˆnumpy.arrayçš„å›¾åƒ</span></span><br><span class="line">grayImage = numpy.array(grayByteArray).reshape(height, width)</span><br><span class="line">bgrImage = numpy.array(bgrByteArray).reshape(height, width, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨numpy-arrayè®¿é—®å›¾åƒæ•°æ®"><a href="#ä½¿ç”¨numpy-arrayè®¿é—®å›¾åƒæ•°æ®" class="headerlink" title="ä½¿ç”¨numpy.arrayè®¿é—®å›¾åƒæ•°æ®"></a>ä½¿ç”¨numpy.arrayè®¿é—®å›¾åƒæ•°æ®</h3><p>numpyçš„arrayå¯ä»¥å¾ˆå¥½çš„å¤„ç†OpenCVçš„æ•°ç»„ï¼Œæé«˜æ•ˆç‡ï¼Œä»£ç ç®€æ´</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">img = cv.imread(<span class="string">'MyPic.png'</span>)</span><br><span class="line">img[<span class="number">0</span>, <span class="number">0</span>] = [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>]  <span class="comment">#ç°åº¦</span></span><br><span class="line">img[:, :, <span class="number">1</span>] = <span class="number">0</span>   <span class="comment">#BGRæ ¼å¼</span></span><br><span class="line">img[<span class="number">300</span>:<span class="number">400</span>, <span class="number">300</span>::<span class="number">400</span>] = img[<span class="number">0</span>:<span class="number">100</span>, <span class="number">0</span>:<span class="number">100</span>] <span class="comment">#ç­‰ç­‰</span></span><br></pre></td></tr></table></figure>

<p>å¼ºçƒˆè¦æ±‚åŒæ—¶æŒæ¡numpy.arrayåº“æ˜¯Pythonå¤„ç†å›¾åƒçš„åŸºç¡€ã€‚</p>
<h3 id="è§†é¢‘æ–‡ä»¶çš„è¯»å†™"><a href="#è§†é¢‘æ–‡ä»¶çš„è¯»å†™" class="headerlink" title="è§†é¢‘æ–‡ä»¶çš„è¯»å†™"></a>è§†é¢‘æ–‡ä»¶çš„è¯»å†™</h3><p>æä¾›äº†VideoCaptureç±»ï¼ˆè¯»ï¼‰å’ŒVideoWriterç±»ï¼ˆå†™ï¼‰</p>
<ul>
<li>VideoCaptureé‡Œå¯é€šè¿‡read()å‡½æ•°æ¥è·å–æ–°çš„å¸§ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯åŸºäºBGRæ ¼å¼çš„å›¾åƒ</li>
<li>å¯å°†ä¸€å¹…å›¾åƒä¼ é€’ç»™VideoWriterç±»çš„write()å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå°†è¿™å¹…å›¾åƒåŠ åˆ°VideoWriterç±»æ‰€æŒ‡åƒçš„æ–‡ä»¶ä¸­ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰è§†é¢‘è·å–ç±»</span></span><br><span class="line">videoCapture = cv2.VideoCapture(<span class="string">'MyInputVid.avi'</span>)</span><br><span class="line">fps = videoCapture.get(cv2.CAP_PROP_FPS)  <span class="comment">#FPS</span></span><br><span class="line">size = (int(videoCapture.get(cv2.CAP_PROP_FRAME_WIDTH)),int(videoCapture.get(cv2.CAP_PROP_FRAME_HEIGHT))) <span class="comment">#size</span></span><br><span class="line"><span class="comment">#å®šä¹‰å†™è§†é¢‘ç±»</span></span><br><span class="line">videoWriter = cv2.VideoWriter (<span class="string">'MyOutputvid.avi'</span>,<span class="string">'cv2.VideoWriter_fourcc('</span>I<span class="string">','</span><span class="number">4</span><span class="string">','</span><span class="number">2</span><span class="string">','</span><span class="number">0</span><span class="string">')'</span>, fps, size) </span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†è¯»å–çš„å¸§å†™åˆ°æ–°æ–‡ä»¶ä¸­</span></span><br><span class="line">success, frame = videoCapture.read()</span><br><span class="line"><span class="keyword">while</span> success:</span><br><span class="line">    videoWriter.write(frame)</span><br><span class="line">    success, frame = videoCapture.read()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>å¸§é€Ÿç‡fpsï¼Œå¸§å¤§å°ï¼Œå¸§çš„ç¼–ç æ–¹å¼éƒ½æœ‰ä¸åŒçš„å‚æ•°</strong></p>
<h3 id="æ•è·æ‘„åƒå¤´çš„å¸§"><a href="#æ•è·æ‘„åƒå¤´çš„å¸§" class="headerlink" title="æ•è·æ‘„åƒå¤´çš„å¸§"></a>æ•è·æ‘„åƒå¤´çš„å¸§</h3><p>ç®€å•ï¼Œéœ€è¦ä¼ é€’æ‘„åƒå¤´çš„è®¾å¤‡ç´¢å¼•<strong>device index</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cameraCapture = cv2.VideoCapture(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>ä½†æ˜¯VideoCaptureç±»çš„get()æ–¹æ³•å¯¹ä¸åŒç³»ç»Ÿæœ‰é™åˆ¶ï¼Œæœ‰çš„ä¸æ”¯æŒæŸ¥è¯¢æ€»ä¼šè¿”å›é›¶ã€‚</li>
<li>å¯¹å¸§çš„fpsè¦ä¹ˆä½œå‡ºå‡è®¾è¦ä¹ˆç”¨è®¡æ—¶å™¨æµ‹é‡ï¼Œæ¥åˆ›å»ºåˆé€‚çš„VideoWriterç±»</li>
<li>æ‘„åƒå¤´çš„æ•°é‡å’Œé¡ºåºç”±ç³»ç»Ÿå®šï¼Œä½†OpenCVæ²¡æœ‰æä¾›æ‘„åƒå¤´æŸ¥è¯¢æ–¹æ³•ï¼Œä½¿ç”¨æ— æ•ˆç´¢å¼•ä¼šå¾—ä¸åˆ°ï¼Œå¯ä»¥ç”¨<code>VideoCapture.isOpened</code>åšä¸€ä¸ªåˆ¤æ–­</li>
<li>éœ€è¦åŒæ­¥ä¸€ç»„æ‘„åƒå¤´æˆ–è€…å¤šå¤´æ‘„åƒå¤´ï¼Œread()æ–¹æ³•ä¸é€‚ç”¨ã€‚åº”ç”¨gran()å’Œretrive()æ–¹æ³•ä»£æ›¿ã€‚  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">success0 = cameraCapture0.grab()</span><br><span class="line">success1 = cameraCapture1.grab()</span><br><span class="line"><span class="keyword">if</span> success0 <span class="keyword">and</span> success1:</span><br><span class="line">    frame = cameraCapture0.retrieve()</span><br><span class="line">    frame = cameraCapture1.retrieve()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ"><a href="#åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ" class="headerlink" title="åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ"></a>åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ</h3><p>ç®€å•çš„imshow()æ¥æ˜¾ç¤ºä¸€å¹…å›¾åƒã€‚ä½†ä¼šä¸€ç¬é—´æ¶ˆå¤±ã€‚ç”¨waitKey()å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(<span class="string">'my-image.png'</span>)</span><br><span class="line">cv2.imshow(<span class="string">'my image'</span>, img)</span><br><span class="line">cv2.waitKey()</span><br><span class="line">cv2.destroyAllwindows()</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§"><a href="#åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§" class="headerlink" title="åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§"></a>åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§</h3><p>OpenCVçš„nameedWindow()ã€imshow()å’ŒDestroyWindow()å‡½æ•°å…è®¸æŒ‡å®šçª—å£ååˆ›å»ºã€æ˜¾ç¤ºå’Œé”€æ¯çª—å£ï¼Œå®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">clicked = <span class="literal">False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">onMouse</span><span class="params">(event, x, y, flags, param)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> clicked</span><br><span class="line">    <span class="keyword">if</span> event == cv2.EVENT_LBUTTONUP:</span><br><span class="line">        clicked = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">cameraCapture = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line">cv2.namedWindow(<span class="string">'MyWindow'</span>)</span><br><span class="line">cv2.setMouseCallback(<span class="string">'MyWindow'</span>, onMouse)</span><br><span class="line"></span><br><span class="line">success, frame = cameraCapture.read()</span><br><span class="line"><span class="keyword">while</span> success <span class="keyword">and</span> cv2.waitKey(<span class="number">1</span>) == <span class="number">-1</span> <span class="keyword">and</span> <span class="keyword">not</span> clicked:</span><br><span class="line">    cv2.imshow(<span class="string">'MyWindow'</span>, frame)</span><br><span class="line">    success, frame = cameraCapture.read()</span><br><span class="line"></span><br><span class="line">cv2.destroyWindow(<span class="string">'MyWindow'</span>)</span><br><span class="line">cameraCapture.release()</span><br></pre></td></tr></table></figure>

<h2 id="Cameoé¡¹ç›®"><a href="#Cameoé¡¹ç›®" class="headerlink" title="Cameoé¡¹ç›®"></a>Cameoé¡¹ç›®</h2><p>å¯ä»¥ç”¨OpenCVå®ç°ä¸€ä¸ªå°çš„æ‘„åƒå¤´åº”ç”¨ï¼Œå…³é”®æ˜¯æƒ³å¥½æ‘„åƒå¤´çš„é€»è¾‘ï¼Œå°è£…ä¸€äº›ç±»ä¸å¯¹è±¡ï¼Œçœ‹ä»£ç æ¯”å†™æ€»ç»“æ•ˆç‡é«˜ã€‚<br>ä¹‹åçš„è®¸å¤šå·ç§¯æ¥åšç›®æ ‡æ£€æµ‹ã€äººè„¸æ£€æµ‹è¯¸å¤šç®—æ³•éƒ½æœ‰OpenCVçš„è‡ªå·±å°è£…çš„æ–¹å¼ï¼Œéœ€è¦ç”¨çš„æ—¶å€™å­¦ä¹ ç†è§£èµ·æ¥ä¹Ÿæ¯”è¾ƒå¿«ï¼ŒåŸºæœ¬çš„å›¾åƒå¤„ç†æ¦‚å¿µæŒæ¡åº”ç”¨åˆ°ä¹‹åçš„é¡¹ç›®å®ä¾‹ä¸­ã€‚</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/22/dive-into-deep-learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="æœ›æ˜Ÿçš„å¤ªé˜³èŠ±">
      <meta itemprop="description" content="You are my JavaSript in my HTML.">
      <meta itemprop="image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570163730249&di=dcd36b04d1066a90ddb1f132ae3a6bcc&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Ffe60497fd762440686b6d5702c2c9f19df71fb9911009-LVWEJj_fw658">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2020/01/22/dive-into-deep-learning/" class="post-title-link" itemprop="url">dive into deep learning</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-01-22 15:02:08" itemprop="dateCreated datePublished" datetime="2020-01-22T15:02:08+08:00">2020-01-22</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-02-11 12:05:58" itemprop="dateModified" datetime="2020-02-11T12:05:58+08:00">2020-02-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep-Learning</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ "><a href="#åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ " class="headerlink" title="åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ "></a>åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ </h1><h2 id="ç¬¬2ç« -é¢„å¤‡çŸ¥è¯†"><a href="#ç¬¬2ç« -é¢„å¤‡çŸ¥è¯†" class="headerlink" title="ç¬¬2ç«  é¢„å¤‡çŸ¥è¯†"></a>ç¬¬2ç«  é¢„å¤‡çŸ¥è¯†</h2><h3 id="2-2-æ•°æ®æ“ä½œ"><a href="#2-2-æ•°æ®æ“ä½œ" class="headerlink" title="2.2 æ•°æ®æ“ä½œ"></a>2.2 æ•°æ®æ“ä½œ</h3><p>ä¸»è¦å­¦ä¹ ç”¨MXNetåŒ…ï¼Œå¥½åƒå’ŒNumpyæœ‰ç›¸ä¼¼çš„åœ°æ–¹ï¼Œä½†å¥½åƒåˆæœ‰åŒºåˆ«ï¼Œä¹‹åæ€»ç»“ã€‚<br>å¾ˆåŸºç¡€</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> nd</span><br><span class="line">x=nd.arrange(<span class="number">12</span>)</span><br><span class="line">x.shape</span><br><span class="line">x.size  <span class="comment">#ä¸shapeä¸åŒ sizeå¾—åˆ°å®ä¾‹ä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">x.reshape((<span class="number">3</span>, <span class="number">4</span>)) <span class="comment">#x.reshape((-1, 4)è‡ªåŠ¨</span></span><br><span class="line">nd.zeros((<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">nd.ones(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">#é€šè¿‡pythonçš„åˆ—è¡¨ç½®é¡¶éœ€è¦åˆ›å»ºçš„NDArrayä¸­æ¯ä¸ªå…ƒç´ çš„å€¼</span></span><br><span class="line">Y = nd.array([[<span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">nd.random.normal(<span class="number">0</span>, <span class="number">1</span>, shape=(<span class="number">3</span>, <span class="number">4</span>)) <span class="comment">#æ­£æ€åˆ†å¸ƒ</span></span><br><span class="line">X + Y</span><br><span class="line">X * Y</span><br><span class="line">X / Y</span><br><span class="line">Y.exp()</span><br><span class="line">nd.dot(X, Y.T)  <span class="comment">#Y.TçŸ©é˜µè½¬ç½®</span></span><br><span class="line"><span class="comment">#å°†å¤šä¸ªçŸ©é˜µè”ç»“ </span></span><br><span class="line">nd.concat(X, Y, dim=<span class="number">0</span>) <span class="comment">#ç»´åº¦0 åœ¨è¡Œä¸Šè¿ç»“</span></span><br><span class="line">nd.concat(X, Y, dim=<span class="number">1</span>) <span class="comment">#ç»´åº¦1 åœ¨åˆ—ä¸Šè¿ç»“</span></span><br><span class="line">x==y <span class="comment">#åˆ¤æ–­å…ƒç´ ä¸­ç›¸åŒçš„éƒ¨åˆ†</span></span><br><span class="line">X.sum()</span><br><span class="line">X.norm().asscalar() <span class="comment">#å°†ç»“æœè½¬æ¢æˆPythonä¸­çš„æ ‡é‡ã€‚.norm()è®¡ç®—çŸ©é˜µèŒƒæ•°</span></span><br><span class="line">Y.exp()=nd.exp(Y)</span><br></pre></td></tr></table></figure>

<p><strong>å¹¿æ’­æœºåˆ¶</strong><br>å‰é¢æ˜¯å½¢çŠ¶ç›¸åŒçš„NDArrayåšæŒ‰å…ƒç´ è¿ç®—ã€‚å½“å¯¹ä¸¤ä¸ªå½¢çŠ¶ä¸åŒçš„NDArrayæŒ‰å…ƒç´ è¿ç®—æ—¶ï¼Œå¯èƒ½å‡ºå‘å¹¿æ’­æœºåˆ¶ï¼šçº¿é€‚å½“å¤åˆ¶å…ƒç´ ä½¿è¿™ä¸¤ä¸ªNDArrayå½¢çŠ¶ç›¸åŒåå†æŒ‰å…ƒç´ è¿ç®—</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = nd.arange(<span class="number">3</span>).reshape((<span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line">B = nd.arange(<span class="number">2</span>).reshape((<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">A + B</span><br></pre></td></tr></table></figure>

<p><strong>ç´¢å¼•</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">x[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">9</span></span><br><span class="line">X[<span class="number">1</span>:<span class="number">2</span>, :] = <span class="number">12</span> <span class="comment">#æˆªå–ä¸€éƒ¨åˆ†é‡æ–°èµ‹å€¼</span></span><br><span class="line"><span class="comment">#[[ 0.  1.  2.  3.]</span></span><br><span class="line"><span class="comment">#[12. 12. 12. 12.]</span></span><br><span class="line"><span class="comment">#[ 8.  9. 10. 11.]]</span></span><br></pre></td></tr></table></figure>

<p><strong>è¿ç®—çš„å†…å­˜å¼€é”€</strong><br>è¿™ä¸ªå¾ˆé…·ï¼Œå¯¹æ•ˆç‡æœ‰å…³<br>å‰é¢çš„ä¾‹å­é‡Œæˆ‘ä»¬å¯¹æ¯ä¸ªæ“ä½œæ–°å¼€å†…å­˜æ¥å­˜å‚¨è¿ç®—ç»“æœã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåƒ<code>Y=X+Y</code>è¿™æ ·çš„è¿ç®—ä¹Ÿä¼šæ–°å¼€å†…å­˜ï¼Œç„¶åå°†YæŒ‡å‘æ–°å†…å­˜ã€‚å¯ä»¥ç”¨pythonè‡ªå¸¦idå‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">before = id(Y)</span><br><span class="line">Y = Y + X</span><br><span class="line">before, id(Y)</span><br><span class="line"><span class="comment">#(112511066600, 112511066400)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡å®šç‰¹å®šå†…å­˜ï¼Œå¯ä»¥ç”¨å‰é¢çš„ç´¢å¼•</span></span><br><span class="line">Z = Y.zeros_like() </span><br><span class="line">before = id(Z)</span><br><span class="line">Z[:] = X + Y</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®é™…ä¸Šä¸Šé¢æˆ‘ä»¬ä¸ºäº†è®¡ç®—X+Yè¿˜æ˜¯å¼€äº†ä¸´æ—¶å†…å­˜æ¥å­˜å‚¨è®¡ç®—ç»“æœï¼Œå†å¤åˆ¶åˆ°zå¯¹åº”çš„å†…å­˜ã€‚ä¸ºäº†é¿å…è¿™ä¸ªä¸´æ—¶å†…å­˜å¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦å…¨åå‡½æ•°æ±‡æ€»çš„outå‚æ•°</span></span><br><span class="line">nd.elemwise_add(X, Y, out=Z)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœXçš„å€¼åœ¨ä¹‹åçš„ç¨‹åºä¸­ä¸ä¼šå¤ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨X[:] = X + Yæˆ–è€… X+=Yæ¥å‡å°‘è¿ç®—çš„å†…å­˜å¼€é”€</span></span><br><span class="line">before = id(X)</span><br><span class="line">X += Y</span><br><span class="line">id(X) == before <span class="comment">#True</span></span><br></pre></td></tr></table></figure>

<p><strong>NDArrayå’ŒNumPyç›¸äº’å˜æ¢</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">P = np.ones((<span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line">D = nd.array(P)  <span class="comment">#numpyè½¬æ¢æˆNDArray</span></span><br><span class="line"></span><br><span class="line">D.asnumpy()  <span class="comment">#NDArrayè½¬æ¢æˆnumpy</span></span><br></pre></td></tr></table></figure>

<p><strong>so easyï¼ å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„å­¦ä¹ ï¼</strong></p>
<h3 id="2-3-è‡ªåŠ¨æ±‚æ¢¯åº¦"><a href="#2-3-è‡ªåŠ¨æ±‚æ¢¯åº¦" class="headerlink" title="2.3 è‡ªåŠ¨æ±‚æ¢¯åº¦"></a>2.3 è‡ªåŠ¨æ±‚æ¢¯åº¦</h3><p>æ·±åº¦å­¦ä¹ ä¸­æˆ‘ä»¬ç»å¸¸æ±‚æ¢¯åº¦ã€‚æœ¬èŠ‚ä»‹ç»å¦‚ä½•ä½¿ç”¨MXNetæä¾›çš„autogradæ¨¡å—è‡ªåŠ¨æ±‚æ¢¯åº¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> autograd, nd <span class="comment">#è‡ªåŠ¨æ±‚æ¢¯åº¦çš„åŒ…  </span></span><br><span class="line">x = nd.arange(<span class="number">4</span>).reshape((<span class="number">4</span>, <span class="number">1</span>))</span><br><span class="line">x.attach_grad() <span class="comment">#ç»‘å®šæ±‚xå€¼</span></span><br><span class="line"><span class="keyword">with</span> autograd.record():</span><br><span class="line">    y = <span class="number">2</span> * nd.dot(x.T, x)</span><br><span class="line">y.backward()</span><br><span class="line"><span class="keyword">assert</span> (x.grad - <span class="number">4</span> * x).norm().asscalar() == <span class="number">0</span></span><br><span class="line">x.grad</span><br></pre></td></tr></table></figure>

<p>ç”¨äº†autogradå°†é¢„æµ‹æ¨¡å¼è½¬æ¢ä¸ºè®­ç»ƒæ¨¡å¼ï¼ˆé¢„æµ‹æ¨¡å¼ä¸éœ€è¦è®°å½•æ¢¯åº¦ï¼Ÿï¼‰æŸäº›æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªæ¨¡å‹åœ¨è®­ç»ƒæ¨¡å¼å’Œé¢„æµ‹æ¨¡å¼ä¸‹çš„è¡Œä¸ºå¹¶ä¸ç›¸åŒã€‚æˆ‘ä»¬åœ¨åé¢çš„ç« èŠ‚è¯¦ç»†ä»‹ç»åŒºåˆ«ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(autograd.is_training()) <span class="comment"># False</span></span><br><span class="line"><span class="keyword">with</span> autograd.record():</span><br><span class="line">    print(autograd.is_training()) <span class="comment">#True</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰é¬¼ä¸œè¥¿ï¼Œå¯¹pythonæ§åˆ¶æµæ±‚æ¢¯åº¦<br>å³ä½¿å‡½æ•°çš„è®¡ç®—å›¾åŒ…å«äº†Pythonçš„æ§åˆ¶æµï¼ˆå¦‚æ¡ä»¶å’Œå¾ªç¯æ§åˆ¶ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½å¯¹å˜é‡æ±‚æ¢¯åº¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a)</span>:</span></span><br><span class="line">    b = a * <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> b.norm().asscalar() &lt; <span class="number">1000</span>:</span><br><span class="line">        b = b * <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> b.sum().asscalar() &gt; <span class="number">0</span>:</span><br><span class="line">        c = b</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c = <span class="number">100</span> * b</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">a = nd.random.normal(shape=<span class="number">1</span>)</span><br><span class="line">a.attach_grad()</span><br><span class="line"><span class="keyword">with</span> autograd.record():</span><br><span class="line">    c = f(a)</span><br><span class="line">c.backward()</span><br><span class="line"></span><br><span class="line">a.grad == c / a</span><br></pre></td></tr></table></figure>

<p>easy!å°±æ˜¯è¯´æ˜äº†å•¥pythonæµçš„æƒ…å†µä¹Ÿé€‚ç”¨</p>
<h2 id="ç¬¬3ç« -æ·±åº¦å­¦ä¹ åŸºç¡€"><a href="#ç¬¬3ç« -æ·±åº¦å­¦ä¹ åŸºç¡€" class="headerlink" title="ç¬¬3ç«  æ·±åº¦å­¦ä¹ åŸºç¡€"></a>ç¬¬3ç«  æ·±åº¦å­¦ä¹ åŸºç¡€</h2><h3 id="3-1-çº¿æ€§å›å½’-ï¼ˆå…¨æ¦‚å¿µï¼‰"><a href="#3-1-çº¿æ€§å›å½’-ï¼ˆå…¨æ¦‚å¿µï¼‰" class="headerlink" title="3.1 çº¿æ€§å›å½’ ï¼ˆå…¨æ¦‚å¿µï¼‰"></a>3.1 çº¿æ€§å›å½’ ï¼ˆå…¨æ¦‚å¿µï¼‰</h3><p>åŒºåˆ†å›å½’ä¸åˆ†ç±»</p>
<h4 id="3-1-1-çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ "><a href="#3-1-1-çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ " class="headerlink" title="3.1.1 çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ "></a>3.1.1 çº¿æ€§å›å½’çš„åŸºæœ¬è¦ç´ </h4><ul>
<li>1.æ¨¡å‹</li>
<li>2.æ¨¡å‹è®­ç»ƒ<ul>
<li>1.è®­ç»ƒæ•°æ®<br>è®­ç»ƒé›†(training set)<br>æ ·æœ¬(sample)<br>æ ‡ç­¾(label)<br>ç‰¹å¾(feature)</li>
<li>2.æŸå¤±å‡½æ•°</li>
<li>3.ä¼˜åŒ–ç®—æ³•</li>
</ul>
</li>
<li>3.æ¨¡å‹é¢„æµ‹<h4 id="3-1-2-çº¿æ€§å›å½’çš„è¡¨ç¤ºæ–¹æ³•"><a href="#3-1-2-çº¿æ€§å›å½’çš„è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="3.1.2 çº¿æ€§å›å½’çš„è¡¨ç¤ºæ–¹æ³•"></a>3.1.2 çº¿æ€§å›å½’çš„è¡¨ç¤ºæ–¹æ³•</h4></li>
</ul>
<p><strong>1.ç¥ç»ç½‘ç»œå›¾</strong><br>æ·±åº¦å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¥ç»ç½‘ç»œå›¾ç›´è§‚åœ°è¡¨ç°æ¨¡å‹ç»“æ„ã€‚<br>çº¿æ€§å›å½’æ˜¯ä¸€ä¸ªå•å±‚çš„ç¥ç»ç½‘ç»œã€‚<br>è¾“å…¥å±‚<br>è¾“å‡ºå±‚ï¼šå…¨è¿æ¥å±‚æˆ–ç¨ å¯†å±‚<br><strong>2.çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼</strong><br>è¯´äº†åŠå¤©å°±æ˜¯ç”¨çŸ¢é‡æ•ˆç‡é«˜ï¼Œè¿ç”¨å¹¿æ’­æœºåˆ¶åŠ ä¸Šbã€‚<br>çŸ¢é‡é‡å†™æŸå¤±å‡½æ•°</p>
<h3 id="3-2-çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°"><a href="#3-2-çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="3.2 çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°"></a>3.2 çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°</h3><p>å°½ç®¡å¼ºå¤§çš„æ·±åº¦å­¦ä¹ æ¡†æ¶å¯ä»¥å‡å°‘å¤§é‡é‡å¤æ€§å·¥ä½œï¼Œä½†è‹¥è¿‡äºä¾èµ–å®ƒæä¾›çš„ä¾¿åˆ©ï¼Œä¼šå¯¼è‡´æˆ‘ä»¬å¾ˆéš¾æ·±å…¥ç†è§£æ·±åº¦å­¦ä¹ æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å› æ­¤ï¼Œæœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•åªåˆ©ç”¨NDArrayå’Œautogradæ¥å®ç°ä¸€ä¸ªçº¿æ€§å›å½’çš„è®­ç»ƒã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> display</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> autograd, nd</span><br><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure>

<h4 id="3-2-1-ç”Ÿæˆæ•°æ®é›†"><a href="#3-2-1-ç”Ÿæˆæ•°æ®é›†" class="headerlink" title="3.2.1 ç”Ÿæˆæ•°æ®é›†"></a>3.2.1 ç”Ÿæˆæ•°æ®é›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">num_inputs = <span class="number">2</span></span><br><span class="line">num_examples = <span class="number">1000</span></span><br><span class="line">true_w = [<span class="number">2</span>, <span class="number">-3.4</span>]</span><br><span class="line">true_b = <span class="number">4.2</span></span><br><span class="line">features = nd.random.normal(scale=<span class="number">1</span>, shape=(num_examples, num_inputs))</span><br><span class="line">labels = true_w[<span class="number">0</span>] * features[:, <span class="number">0</span>] + true_w[<span class="number">1</span>] * features[:, <span class="number">1</span>] + true_b</span><br><span class="line">labels += nd.random.normal(scale=<span class="number">0.01</span>, shape=labels.shape) <span class="comment">#åŠ ä¸Šéšæœºå™ªå£°</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-è¯»å–æ•°æ®é›†"><a href="#3-2-2-è¯»å–æ•°æ®é›†" class="headerlink" title="3.2.2 è¯»å–æ•°æ®é›†"></a>3.2.2 è¯»å–æ•°æ®é›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_iter</span><span class="params">(batch_size, features, labels)</span>:</span></span><br><span class="line">    num_examples = len(features)</span><br><span class="line">    indices = list(range(num_examples))</span><br><span class="line">    random.shuffle(indices)  <span class="comment"># æ ·æœ¬çš„è¯»å–é¡ºåºæ˜¯éšæœºçš„</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, num_examples, batch_size):</span><br><span class="line">        j = nd.array(indices[i: min(i + batch_size, num_examples)])</span><br><span class="line">        <span class="keyword">yield</span> features.take(j), labels.take(j)  <span class="comment"># takeå‡½æ•°æ ¹æ®ç´¢å¼•è¿”å›å¯¹åº”å…ƒç´ </span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#3-2-3-åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="3.2.3 åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>3.2.3 åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w = nd.random.normal(scale=<span class="number">0.01</span>, shape=(num_inputs, <span class="number">1</span>))</span><br><span class="line">b = nd.zeros(shape=(<span class="number">1</span>,))</span><br><span class="line">w.attach_grad() <span class="comment">#ç»‘å®šè¦è‡ªåŠ¨æ±‚å¯¼çš„å˜é‡</span></span><br><span class="line">b.attach_grad() <span class="comment">#ç»‘å®šè¦è‡ªåŠ¨æ±‚å¯¼çš„å˜é‡</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-å®šä¹‰æ¨¡å‹"><a href="#3-2-4-å®šä¹‰æ¨¡å‹" class="headerlink" title="3.2.4 å®šä¹‰æ¨¡å‹"></a>3.2.4 å®šä¹‰æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linreg</span><span class="params">(X, w, b)</span>:</span>  <span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">return</span> nd.dot(X, w) + b</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-å®šä¹‰æŸå¤±å‡½æ•°"><a href="#3-2-5-å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="3.2.5 å®šä¹‰æŸå¤±å‡½æ•°"></a>3.2.5 å®šä¹‰æŸå¤±å‡½æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">squared_loss</span><span class="params">(y_hat, y)</span>:</span>  <span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">return</span> (y_hat - y.reshape(y_hat.shape)) ** <span class="number">2</span> / <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-6-å®šä¹‰ä¼˜åŒ–ç®—æ³•"><a href="#3-2-6-å®šä¹‰ä¼˜åŒ–ç®—æ³•" class="headerlink" title="3.2.6 å®šä¹‰ä¼˜åŒ–ç®—æ³•"></a>3.2.6 å®šä¹‰ä¼˜åŒ–ç®—æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sgd</span><span class="params">(params, lr, batch_size)</span>:</span>  <span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">        param[:] = param - lr * param.grad / batch_size   <span class="comment">#çœ‹è§æ²¡æœ‰ è¿™é‡Œparam.gradå°±æ˜¯åˆ©ç”¨æ¢¯åº¦åšä¼˜åŒ–</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-7-è®­ç»ƒæ¨¡å‹"><a href="#3-2-7-è®­ç»ƒæ¨¡å‹" class="headerlink" title="3.2.7 è®­ç»ƒæ¨¡å‹"></a>3.2.7 è®­ç»ƒæ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lr = <span class="number">0.03</span></span><br><span class="line">num_epochs = <span class="number">3</span></span><br><span class="line">net = linreg</span><br><span class="line">loss = squared_loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(num_epochs):  <span class="comment"># è®­ç»ƒæ¨¡å‹ä¸€å…±éœ€è¦num_epochsä¸ªè¿­ä»£å‘¨æœŸ</span></span><br><span class="line">    <span class="comment"># åœ¨æ¯ä¸€ä¸ªè¿­ä»£å‘¨æœŸä¸­ï¼Œä¼šä½¿ç”¨è®­ç»ƒæ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬ä¸€æ¬¡ï¼ˆå‡è®¾æ ·æœ¬æ•°èƒ½å¤Ÿè¢«æ‰¹é‡å¤§å°æ•´é™¤ï¼‰ã€‚X</span></span><br><span class="line">    <span class="comment"># å’Œyåˆ†åˆ«æ˜¯å°æ‰¹é‡æ ·æœ¬çš„ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter(batch_size, features, labels):</span><br><span class="line">        <span class="keyword">with</span> autograd.record():</span><br><span class="line">            l = loss(net(X, w, b), y)  <span class="comment"># læ˜¯æœ‰å…³å°æ‰¹é‡Xå’Œyçš„æŸå¤±</span></span><br><span class="line">        l.backward()  <span class="comment"># å°æ‰¹é‡çš„æŸå¤±å¯¹æ¨¡å‹å‚æ•°æ±‚æ¢¯åº¦</span></span><br><span class="line">        sgd([w, b], lr, batch_size)  <span class="comment"># ä½¿ç”¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™è¿­ä»£æ¨¡å‹å‚æ•°</span></span><br><span class="line">    train_l = loss(net(features, w, b), labels)</span><br><span class="line">    print(<span class="string">'epoch %d, loss %f'</span> % (epoch + <span class="number">1</span>, train_l.mean().asnumpy()))</span><br></pre></td></tr></table></figure>

<p><strong><em>æ„Ÿè§‰è´¼é…·ï¼</em></strong></p>
<h3 id="3-3-çº¿æ€§å›å½’çš„ç®€æ´å®ç°"><a href="#3-3-çº¿æ€§å›å½’çš„ç®€æ´å®ç°" class="headerlink" title="3.3 çº¿æ€§å›å½’çš„ç®€æ´å®ç°"></a>3.3 çº¿æ€§å›å½’çš„ç®€æ´å®ç°</h3><p>æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨MXNetæä¾›çš„Gluonæ¥å£æ›´æ–¹ä¾¿åœ°å®ç°çº¿æ€§å›å½’çš„è®­ç»ƒ</p>
<h4 id="3-3-1-ç”Ÿæˆæ•°æ®é›†"><a href="#3-3-1-ç”Ÿæˆæ•°æ®é›†" class="headerlink" title="3.3.1 ç”Ÿæˆæ•°æ®é›†"></a>3.3.1 ç”Ÿæˆæ•°æ®é›†</h4><p>å’Œå‰é¢ä¸€æ ·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> autograd, nd</span><br><span class="line"></span><br><span class="line">num_inputs = <span class="number">2</span></span><br><span class="line">num_examples = <span class="number">1000</span></span><br><span class="line">true_w = [<span class="number">2</span>, <span class="number">-3.4</span>]</span><br><span class="line">true_b = <span class="number">4.2</span></span><br><span class="line">features = nd.random.normal(scale=<span class="number">1</span>, shape=(num_examples, num_inputs))</span><br><span class="line">labels = true_w[<span class="number">0</span>] * features[:, <span class="number">0</span>] + true_w[<span class="number">1</span>] * features[:, <span class="number">1</span>] + true_b</span><br><span class="line">labels += nd.random.normal(scale=<span class="number">0.01</span>, shape=labels.shape)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-è¯»å–æ•°æ®é›†"><a href="#3-3-2-è¯»å–æ•°æ®é›†" class="headerlink" title="3.3.2 è¯»å–æ•°æ®é›†"></a>3.3.2 è¯»å–æ•°æ®é›†</h4><p>Gluonæä¾›äº†dataåŒ…æ¥è¯»å–æ•°æ®ã€‚ç”±äºdataå¸¸ä½œä¸ºå˜é‡åï¼Œå°†å€’å…¥çš„dataæ¨¡å—ç”¨æ·»åŠ äº†Gluoné¦–å­—æ¯çš„å‡ågdataä»£æ›¿ã€‚åœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†éšæœºè¯»å–åŒ…å«10ä¸ªæ•°æ®æ ·æœ¬çš„å°æ‰¹é‡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> data <span class="keyword">as</span> gdata</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">10</span></span><br><span class="line"><span class="comment"># å°†è®­ç»ƒæ•°æ®çš„ç‰¹å¾å’Œæ ‡ç­¾ç»„åˆ</span></span><br><span class="line">dataset = gdata.ArrayDataset(features, labels)</span><br><span class="line"><span class="comment"># éšæœºè¯»å–å°æ‰¹é‡</span></span><br><span class="line">data_iter = gdata.DataLoader(dataset, batch_size, shuffle=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-å®šä¹‰æ¨¡å‹"><a href="#3-3-3-å®šä¹‰æ¨¡å‹" class="headerlink" title="3.3.3 å®šä¹‰æ¨¡å‹"></a>3.3.3 å®šä¹‰æ¨¡å‹</h4><p>å¯ä»¥æ–¹ä¾¿åœ°ç”¨nnçš„åŒ…æ¥å®ç°ï¼Œä¹Ÿæœ‰é›†æˆçš„sequentialæ–¹æ³•ï¼Œç°åœ¨æ¨¡å‹æ˜¯ç®€å•çš„å…¨è¿æ¥å±‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> nn</span><br><span class="line">net = nn.Sequential()</span><br><span class="line"></span><br><span class="line">net.add(nn.Dense(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æï¼Œåœ¨Gluonä¸­æˆ‘ä»¬æ— é¡»æŒ‡å®šæ¯ä¸€å±‚çš„è¾“å…¥å½¢çŠ¶ï¼Œä¾‹å¦‚çº¿æ€§å›å½’çš„è¾“å…¥ä¸ªæ•°ï¼Œå½“æ¨¡å‹å¾—åˆ°æ•°æ®æ—¶ï¼Œä¾‹å¦‚åé¢æ‰§è¡Œnet(X)æ—¶ï¼Œæ¨¡å‹å°†è‡ªåŠ¨æ¨æ–­æ¯ä¸€å±‚çš„è¾“å…¥ä¸ªæ•°ã€‚ä¸ºå¼€å‘æä¾›ä¾¿åˆ©ã€‚</p>
<h4 id="3-3-4-åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#3-3-4-åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="3.3.4 åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>3.3.4 åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h4><p>ä½¿ç”¨netå‰åˆå§‹åŒ–æ¨¡å‹å‚æ•°ï¼Œå¦‚çº¿æ€§å›å½’æ¨¡å‹ä¸­çš„æƒé‡å’Œåå·®ã€‚æˆ‘ä»¬åœ¨MXNetå¯¼å…¥initæ¨¡å—ã€‚è¯¥æ¨¡å—æä¾›äº†æ¨¡å‹å‚æ•°åˆå§‹åŒ–çš„å„ç§æ–¹æ³•ã€‚é€šè¿‡init.Normal(sigma=0.01)æŒ‡å®šæƒé‡å‚æ•°æ¯ä¸ªå…ƒç´ å°†åœ¨åˆå§‹åŒ–æ—¶éšæœºé‡‡æ ·äºå‡å€¼ä¸º0ã€æ ‡å‡†å·®ä¸º0.01çš„æ­£æ€åˆ†å¸ƒã€‚åå·®å‚æ•°é»˜è®¤ä¼šåˆå§‹åŒ–ä¸ºé›¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> init</span><br><span class="line">net.initialize(init.Normal(sigma=<span class="number">0.01</span>))</span><br></pre></td></tr></table></figure>

<p>so coolï½ï¼</p>
<h4 id="3-3-5-å®šä¹‰æŸå¤±å‡½æ•°"><a href="#3-3-5-å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="3.3.5 å®šä¹‰æŸå¤±å‡½æ•°"></a>3.3.5 å®šä¹‰æŸå¤±å‡½æ•°</h4><p>åœ¨Gluonä¸­ï¼Œlossæ¨¡å—å®šä¹‰äº†å„ç§æŸå¤±å‡½æ•°ã€‚æˆ‘ä»¬ç”¨å‡åglossä»£æ›¿lossæ¨¡å—ï¼Œå¹¶ä½¿ç”¨å®ƒæä¾›çš„å¹³æ–¹æŸå¤±ä¸ºæ¨¡å‹çš„æŸå¤±å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> loss <span class="keyword">as</span> gloss</span><br><span class="line">loss = gloss.L2Loss()  <span class="comment">#å¹³æ–¹æŸå¤±åˆç§°ä¸ºL2èŒƒæ•°æŸå¤±</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-6-å®šä¹‰ä¼˜åŒ–ç®—æ³•"><a href="#3-3-6-å®šä¹‰ä¼˜åŒ–ç®—æ³•" class="headerlink" title="3.3.6 å®šä¹‰ä¼˜åŒ–ç®—æ³•"></a>3.3.6 å®šä¹‰ä¼˜åŒ–ç®—æ³•</h4><p>å¯¼å…¥Gluonåï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªTrainerå®ä¾‹ï¼Œå¹¶æŒ‡å®šå­¦ä¹ ç‡ä¸º0.03çš„å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™sgdä¸ºä¼˜åŒ–ç®—æ³•ï¼ˆä¸ç”¨è‡ªå·±å†™ï¼‰ã€‚è¯¥ç®—æ³•å°†ç”¨æ¥è¿­ä»£netå®ä¾‹æ‰€æœ‰é€šè¿‡addå‡½æ•°åµŒå¥—çš„å±‚åŒ…å«çš„å…¨éƒ¨å‚æ•°ã€‚è¿™äº›å‚æ•°å¯ä»¥é€šè¿‡collect_paramså‡½æ•°æ¥è·å–</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> gluon</span><br><span class="line">trainer = gluon.Trainer(net.collect_params(), <span class="string">'sgd'</span>, &#123;<span class="string">'learning_rate'</span>: <span class="number">0.03</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-7-è®­ç»ƒæ¨¡å‹"><a href="#3-3-7-è®­ç»ƒæ¨¡å‹" class="headerlink" title="3.3.7 è®­ç»ƒæ¨¡å‹"></a>3.3.7 è®­ç»ƒæ¨¡å‹</h4><p>åœ¨ä½¿ç”¨Gluonè®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨Trainerå®ä¾‹æ¥çš„stepå‡½æ•°æ¥è¿­ä»£æ¨¡å‹å‚æ•°ã€‚3.2èŠ‚æˆ‘ä»¬æåˆ°ï¼Œç”±äºå˜é‡læ˜¯é•¿åº¦ä¸ºbatch_sizeçš„ä¸€ç»´NDArrayï¼Œæ‰§è¡Œl.backward()ç­‰ä»·äºæ‰§è¡Œl.sum().backward()ã€‚æŒ‰ç…§å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™æ³•çš„å®šä¹‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num_epochs = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">1</span>, num_epochs + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter:</span><br><span class="line">        <span class="keyword">with</span> autograd.record():</span><br><span class="line">            l = loss(net(X), y)</span><br><span class="line">        l.backward()</span><br><span class="line">        trainer.step(batch_size)</span><br><span class="line">    l = loss(net(features), labels)</span><br><span class="line">    print(<span class="string">'epoch %d, loss: %f'</span> % (epoch, l.mean().asnumpy()))</span><br></pre></td></tr></table></figure>

<p><strong><em>è¦æ˜ç™½éšæœºæ¢¯åº¦ä¸‹é™æ³•æ˜¯å¯¹æŸå¤±å‡½æ•°è¿›è¡Œï¼Œè¦éšæœºè®©æŸå¤±å‡½æ•°å˜å°çš„åŒæ—¶å­¦ä¹ æ”¹å˜æ¨¡å‹å‚æ•°</em></strong><br>æœ€åæŸ¥çœ‹å­¦ä¹ åˆ°çš„å‚æ•°ï¼ŒåŒå‡»666ï¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dense = net[<span class="number">0</span>]   <span class="comment">#æ³¨æ„æŒ‡å®šç¬¬ä¸€å±‚çš„æƒé‡</span></span><br><span class="line">true_w, dense.weight.data()</span><br><span class="line">true_b, dense.bias.data()</span><br></pre></td></tr></table></figure>

<h3 id="3-4-softmaxå›å½’"><a href="#3-4-softmaxå›å½’" class="headerlink" title="3.4 softmaxå›å½’"></a>3.4 softmaxå›å½’</h3><p>å‰å‡ èŠ‚çš„çº¿æ€§å›å½’æ¨¡å‹é€‚ç”¨äºè¾“å‡ºè¿ç»­å€¼çš„æƒ…æ™¯ã€‚åœ¨å¦ä¸€ç±»æƒ…æ™¯ä¸­ï¼Œæ¨¡å‹è¾“å‡ºå¯ä»¥æ˜¯æƒ³ä¸€ä¸ªå›¾åƒç±»åˆ«çš„ç¦»æ•£åˆ†ç±»é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¸å¦‚softmaxå›å½’åœ¨å†…çš„åˆ†ç±»æ¨¡å‹ï¼Œå’Œçº¿æ€§å›å½’ä¸åŒsofrmaxå›å½’çš„<strong>è¾“å‡ºå•å…ƒ</strong>ä»ä¸€ä¸ªå˜æˆäº†å¤šä¸ªï¼Œä¸”å¼•å…¥äº†softmaxè¿ç®—ä½¿è¾“å‡ºæ›´é€‚åˆç¦»æ•£å€¼çš„é¢„æµ‹å’Œè®­ç»ƒã€‚æœ¬èŠ‚ä»¥softmaxå›å½’æ¨¡å‹ä¸ºä¾‹ï¼Œä»‹ç»ç¥ç»ç½‘ç»œä¸­çš„åˆ†ç±»æ¨¡å‹ã€‚</p>
<h4 id="3-4-1-åˆ†ç±»é—®é¢˜"><a href="#3-4-1-åˆ†ç±»é—®é¢˜" class="headerlink" title="3.4.1 åˆ†ç±»é—®é¢˜"></a>3.4.1 åˆ†ç±»é—®é¢˜</h4><p>ä¹‹å‰ä¹Ÿæ™“å¾—ï¼Œåˆ†ç±»é—®é¢˜å¯ä»¥ç”¨å›å½’æ–¹æ³•è§£å†³ä½†æ˜¯ä¼šå½±å“åˆ°å›å½’è´¨é‡ï¼Œä¸€èˆ¬ä½¿ç”¨æ›´åŠ é€‚åˆç¦»æ•£å€¼è¾“å‡ºçš„æ¨¡å‹æ¥è§£å†³åˆ†ç±»é—®é¢˜ï¼ˆsoftmaxå‡½æ•°ï¼‰ã€‚</p>
<h4 id="3-4-2-softmaxå›å½’æ¨¡å‹"><a href="#3-4-2-softmaxå›å½’æ¨¡å‹" class="headerlink" title="3.4.2 softmaxå›å½’æ¨¡å‹"></a>3.4.2 softmaxå›å½’æ¨¡å‹</h4><p>o1 = x1w11 + x2w21 + x3w31 + x4w41 + b1<br>o2 = x1w12 + x2w22 + x3w32 + x4w42 + b2<br>o3 = x1w13 + x2w23 + x3w33 + x4w43 + b3<br>softmaxå›å½’æ˜¯ä¸€ä¸ªå•å±‚ç¥ç»ç½‘ç»œ<br><strong>softmaxè¿ç®—</strong><br>å°†å€¼çš„å¤§å°å˜æˆæ¦‚ç‡ so cool</p>
<h4 id="3-4-3-å•æ ·æœ¬æ ·æœ¬åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼"><a href="#3-4-3-å•æ ·æœ¬æ ·æœ¬åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼" class="headerlink" title="3.4.3 å•æ ·æœ¬æ ·æœ¬åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼"></a>3.4.3 å•æ ·æœ¬æ ·æœ¬åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼</h4><p>ä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡ï¼Œæˆ‘ä»¬å°†å•æ ·æœ¬åˆ†ç±»é€šè¿‡çŸ¢é‡è®¡ç®—æ¥è¡¨è¾¾ã€‚</p>
<h4 id="3-4-4-å°æ‰¹é‡åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼"><a href="#3-4-4-å°æ‰¹é‡åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼" class="headerlink" title="3.4.4 å°æ‰¹é‡åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼"></a>3.4.4 å°æ‰¹é‡åˆ†ç±»çš„çŸ¢é‡è®¡ç®—è¡¨è¾¾å¼</h4><p>é€šå¸¸æˆ‘ä»¬å¯¹å°æ‰¹é‡æ•°æ®åšçŸ¢é‡è®¡ç®—ã€‚å¹¿ä¹‰ä¸Šæ¥è®²ï¼Œç»™å®šä¸€ä¸ªå°æ‰¹é‡æ ·æœ¬ï¼Œå…¶æ‰¹é‡æ ·æœ¬å¤§å°ä¸ºn,è¾“å…¥ä¸ªæ•°ä¸ºdï¼Œè¾“å‡ºä¸ªæ•°ä¸ºqã€‚å°±æ˜¯æ¯ä¸ªå‘é‡çš„å¤§å°å˜å¤§äº†<br>Onxq=XnxdWdxq + blxq<br>Yhatnxq = softmax(Onxq)o</p>
<h4 id="3-4-5-äº¤å‰ç†µæŸå¤±å‡½æ•°"><a href="#3-4-5-äº¤å‰ç†µæŸå¤±å‡½æ•°" class="headerlink" title="3.4.5 äº¤å‰ç†µæŸå¤±å‡½æ•°"></a>3.4.5 äº¤å‰ç†µæŸå¤±å‡½æ•°</h4><p>æ›´ç§‘å­¦çš„æŸå¤±å‡½æ•°ï¼Œæœ€å°åŒ–äº¤å‰ç†µæŸå¤±å‡½æ•°ç­‰ä»·äºæœ€å¤§åŒ–æ•°æ®é›†æ‰€æœ‰æ ‡ç­¾ç±»åˆ«çš„è”åˆé¢„æµ‹æ¦‚ç‡ã€‚</p>
<h4 id="3-4-6-æ¨¡å‹é¢„æµ‹åŠè¯„ä»·"><a href="#3-4-6-æ¨¡å‹é¢„æµ‹åŠè¯„ä»·" class="headerlink" title="3.4.6 æ¨¡å‹é¢„æµ‹åŠè¯„ä»·"></a>3.4.6 æ¨¡å‹é¢„æµ‹åŠè¯„ä»·</h4><p>å‡†ç¡®ç‡ å•¥å•¥ç‡ æœ‰å¥½å¤šç§ä¸åŒ</p>
<h3 id="3-5-å›¾åƒåˆ†ç±»æ•°æ®é›†ï¼ˆFashion-MNISTï¼‰"><a href="#3-5-å›¾åƒåˆ†ç±»æ•°æ®é›†ï¼ˆFashion-MNISTï¼‰" class="headerlink" title="3.5 å›¾åƒåˆ†ç±»æ•°æ®é›†ï¼ˆFashion-MNISTï¼‰"></a>3.5 å›¾åƒåˆ†ç±»æ•°æ®é›†ï¼ˆFashion-MNISTï¼‰</h3><p>ä¸€ä¸ªæ¯”MNISTæ›´å¤æ‚çš„å›¾åƒåˆ†ç±»æ•°æ®é›†</p>
<h4 id="3-5-1-è·å–æ•°æ®é›†"><a href="#3-5-1-è·å–æ•°æ®é›†" class="headerlink" title="3.5.1 è·å–æ•°æ®é›†"></a>3.5.1 è·å–æ•°æ®é›†</h4><p>easy è¿˜æœ‰è®¸å¤šè¯»å–å•¥çš„å‡½æ•°æ–¹æ³•</p>
<h4 id="3-5-2-è·å–å°æ‰¹é‡"><a href="#3-5-2-è·å–å°æ‰¹é‡" class="headerlink" title="3.5.2 è·å–å°æ‰¹é‡"></a>3.5.2 è·å–å°æ‰¹é‡</h4><ul>
<li>å¯ä»¥è‡ªå·±å®šä¹‰æ¥ç”¨yieldï¼Œè¿™é‡Œç”¨DataLoaderå®ä¾‹ã€‚æ¯æ¬¡è¯»å–ä¸€ä¸ªæ ·æœ¬æ•°ä¸ºbatch_sizeçš„å°æ‰¹é‡æ•°æ®ã€‚è¿™é‡Œçš„pillageå¤§å°batch_szeæ˜¯ä¸€ä¸ªè¶…å‚æ•°</li>
<li>DataLoaderå¯ä»¥ç”¨num_workersæ€§èƒ½åŠ é€Ÿ</li>
<li>ToTensorå®ä¾‹å°†å›¾åƒæ•°æ®ä»uint8æ ¼å¼å˜æ¢æˆ32æµ®ç‚¹æ•°å¹¶é™¤ä»¥255ä½¿å¾—æ‰€æœ‰åƒç´ çš„æ•°å€¼å‡åœ¨0åˆ°1ä¹‹é—´ã€‚ToTensorå®ä¾‹è¿˜å°†å›¾åƒé€šé“ä»æœ€åä¸€ç»´ç§»åˆ°æœ€å‰ä¸€ç»´æ–¹ä¾¿ä¹‹åä»‹ç»çš„å·ç§¯ç¥ç»ç½‘ç»œã€‚é€šè¿‡æ•°æ®é›†çš„transform_firstå‡½æ•°ï¼Œæˆ‘ä»¬å°†ToTensorçš„å˜æ¢åº”ç”¨åœ¨æ¯ä¸ªæ•°æ®æ ·æœ¬ï¼ˆå›¾åƒå’Œæ ‡ç­¾ï¼‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³å›¾åƒä¹‹ä¸Šã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">transformer = gdata.vision.transforms.ToTensor()</span><br><span class="line"><span class="keyword">if</span> sys.platform.startswith(<span class="string">'win'</span>):</span><br><span class="line">    num_workers = <span class="number">0</span>  <span class="comment"># 0è¡¨ç¤ºä¸ç”¨é¢å¤–çš„è¿›ç¨‹æ¥åŠ é€Ÿè¯»å–æ•°æ®</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    num_workers = <span class="number">4</span>  <span class="comment"># ä¼šæ¯”è¾ƒå¿«</span></span><br><span class="line"></span><br><span class="line">train_iter = gdata.DataLoader(mnist_train.transform_first(transformer),</span><br><span class="line">                              batch_size, shuffle=<span class="literal">True</span>,</span><br><span class="line">                              num_workers=num_workers)</span><br><span class="line">test_iter = gdata.DataLoader(mnist_test.transform_first(transformer),</span><br><span class="line">                             batch_size, shuffle=<span class="literal">False</span>,</span><br><span class="line">                             num_workers=num_workers)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-6-softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°"><a href="#3-6-softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="3.6 softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°"></a>3.6 softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°</h3><p>3.6.1 è¯»å–æ•°æ®é›†<br>3.6.2 åˆå§‹åŒ–æ¨¡å‹å‚æ•°<br>3.6.3 å®ç°softmaxè¿ç®—<br>å…ˆè§£å†³å¤šç»´åº¦NDArrayæŒ‰ç»´åº¦æ“ä½œçš„é—®é¢˜ï¼Œä¹‹åå®šä¹‰softè¿ç®—ï¼ˆä¸ç”¨åŒ…çº¯æ‰‹å·¥ï¼‰</p>
<p>3.6.4 å®šä¹‰æ¨¡å‹<br>æˆ‘ä»¬çš„æ¨¡å‹å°±æ˜¯çº¯çš„softmaxå‡½æ•°</p>
<p>3.6.5 å®šä¹‰æŸå¤±å‡½æ•°<br>äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œå…ˆå­¦ä¼špickå‡½æ•°</p>
<p>3.6.6 è®¡ç®—åˆ†ç±»å‡†ç¡®ç‡<br>å…ˆæ˜ç™½å‡†ç¡®ç‡çš„åŸç†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">accuracy</span><span class="params">(y_hat, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (y_hat.argmax(axis=<span class="number">1</span>) == y.astype(<span class="string">'float32'</span>)).mean().asscalar()</span><br></pre></td></tr></table></figure>

<p>å†é¢„æµ‹çœŸä¸ªnetåœ¨æ•°æ®é›†åˆä¸Šçš„å‡†ç¡®ç‡</p>
<p>3.6.7 è®­ç»ƒæ¨¡å‹<br>å’Œä¹‹å‰çº¿æ€§å›å½’å·®ä¸å¤š å¤šäº†å‡†ç¡®ç‡çš„è®¡ç®— ç†Ÿç»ƒæŒæ¡å°±å¥½</p>
<p>3.6.8 é¢„æµ‹<br>å­¦ä¼šæ€ä¹ˆè¿™ä¹ˆä¼˜ç¾åœ°æŠŠé¢„æµ‹ çœŸå® å›¾ç‰‡æ‘†æ”¾åœ¨ä¸€èµ· ä¸­é—´ä¸‰è¡Œæ˜¯å±•ç¤ºå°è£…å‡½æ•°é€»è¾‘çš„ æ³¨é‡Šä¹Ÿèƒ½è¿è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> X, y <span class="keyword">in</span> test_iter:   <span class="comment">#æ³¨æ„è¿™é‡Œè¿­ä»£ æµ‹è¯•é›† åªæœ‰255ä¸ª</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">true_labels = d2l.get_fashion_mnist_labels(y.asnumpy())</span><br><span class="line">pred_labels = d2l.get_fashion_mnist_labels(net(X).argmax(axis=<span class="number">1</span>).asnumpy())</span><br><span class="line">titles = [true + <span class="string">'\n'</span> + pred <span class="keyword">for</span> true, pred <span class="keyword">in</span> zip(true_labels, pred_labels)]  <span class="comment">#æœ‰äº›é€»è¾‘ è‡ªå·±å†™ä¸ä¸€å®šèƒ½å†™å‡ºæ¥</span></span><br><span class="line"></span><br><span class="line">d2l.show_fashion_mnist(X[<span class="number">0</span>:<span class="number">9</span>], titles[<span class="number">0</span>:<span class="number">9</span>])</span><br></pre></td></tr></table></figure>

<h3 id="3-7-softmaxå›å½’çš„ç®€æ´å®ç°"><a href="#3-7-softmaxå›å½’çš„ç®€æ´å®ç°" class="headerlink" title="3.7 softmaxå›å½’çš„ç®€æ´å®ç°"></a>3.7 softmaxå›å½’çš„ç®€æ´å®ç°</h3><p>è´¼ç®€æ´ æ˜ç™½åŸç†ç›´æ¥è°ƒç”¨åŒ…å°±ok</p>
<h3 id="3-8-å¤šå±‚æ„ŸçŸ¥æœº"><a href="#3-8-å¤šå±‚æ„ŸçŸ¥æœº" class="headerlink" title="3.8 å¤šå±‚æ„ŸçŸ¥æœº"></a>3.8 å¤šå±‚æ„ŸçŸ¥æœº</h3><p>å·²ç»å­¦ä¼šäº†çº¿æ€§å›å½’å’Œsoftmaxå›å½’åœ¨å†…çš„å•å±‚ç¥ç»ç½‘ç»œğŸ˜ã€‚ä½†æ˜¯æ·±åº¦å­¦ä¹ æ›´å¤šå…³æ³¨å¤šå±‚æ¨¡å‹ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥å¤šå±‚æ„ŸçŸ¥æœºï¼ˆmultilayer perceptron, MLPï¼‰ä¸ºä¾‹ï¼Œä»‹ç»å¤šå±‚ç¥ç»ç½‘ç»œçš„ç‰¹ç‚¹ã€‚</p>
<h4 id="3-8-1-éšè—å±‚"><a href="#3-8-1-éšè—å±‚" class="headerlink" title="3.8.1 éšè—å±‚"></a>3.8.1 éšè—å±‚</h4><p>å¤šå±‚æ„ŸçŸ¥æœºåœ¨å•å±‚ç¥ç»ç½‘ç»œçš„åŸºç¡€ä¸Šå¼•å…¥äº†ä¸€åˆ°å¤šä¸ªéšè—å±‚ï¼ˆhidden layerï¼‰ã€‚éšè—å±‚ä½äºè¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´ã€‚</p>
<h4 id="3-8-2-æ¿€æ´»å‡½æ•°"><a href="#3-8-2-æ¿€æ´»å‡½æ•°" class="headerlink" title="3.8.2 æ¿€æ´»å‡½æ•°"></a>3.8.2 æ¿€æ´»å‡½æ•°</h4><p>é˜²æ­¢ä»¿å°„å˜æ¢ï¼Œå¼•å…¥éçº¿æ€§å˜æ¢ï¼ˆåŠ å…¥å¤šå°‘éšè—å±‚éƒ½æ˜¯ä»¿å°„å˜æ¢ï¼‰<br>1.ReLUå‡½æ•°<br>ç®€å•çš„çº¿æ€§å˜æ¢</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = x.relu() <span class="comment">#å†…ç½®å‡½æ•°</span></span><br></pre></td></tr></table></figure>

<p>2.sigmoidå‡½æ•°</p>
<ul>
<li>å°†å…ƒç´ çš„å€¼å˜æ¢åˆ°0å’Œ1ä¹‹é—´ï¼Œsigmoidå‡½æ•°åœ¨æ—©æœŸçš„ç¥ç»ç½‘ç»œä¸­è¾ƒä¸ºæ™®éï¼Œä½†å®ƒç›®å‰é€æ¸è¢«ç®€å•çš„ReLUå‡½æ•°å–ä»£ã€‚æ§åˆ¶ä¿¡æ¯åœ¨ç¥ç»ç½‘ç»œä¸­çš„æµåŠ¨ã€‚</li>
<li>sigmoidçš„å¯¼æ•°ï¼šå½“è¾“å…¥ä¸º0æ—¶ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°è¾¾åˆ°æœ€å¤§å€¼0.25ï¼Œå½“è¾“å…¥åç¦»0æ—¶ï¼Œsigmoidå‡½æ•°çš„å¯¼æ•°è¶Šæ¥è¿‘0ã€‚</li>
</ul>
<p>3.tanhå‡½æ•°</p>
<ul>
<li>tanhå‡½æ•°å¯ä»¥å°†å…ƒç´ çš„å€¼å˜æ¢åˆ°-1åˆ°1ä¹‹é—´ã€‚è™½ç„¶è¯¥å‡½æ•°çš„å½¢çŠ¶å’Œsigmoidå‡½æ•°çš„å½¢çŠ¶å¾ˆåƒï¼Œä½†tanhå‡½æ•°åœ¨åæ ‡ç³»çš„åŸç‚¹ä¸Šå¯¹ç§°ã€‚</li>
<li>å¯¼æ•°ï¼šå½“è¾“å…¥ä¸º0æ—¶ï¼Œè¾¾åˆ°æœ€å¤§å€¼1ï¼Œå½“è¾“å…¥è¶Šåç¦»0æ—¶ï¼Œtanhå‡½æ•°çš„å¯¼æ•°è¶Šæ¥è¿‘0ã€‚<h4 id="3-8-3-å¤šå±‚æ„ŸçŸ¥æœº"><a href="#3-8-3-å¤šå±‚æ„ŸçŸ¥æœº" class="headerlink" title="3.8.3 å¤šå±‚æ„ŸçŸ¥æœº"></a>3.8.3 å¤šå±‚æ„ŸçŸ¥æœº</h4>å¤šå±‚æ„ŸçŸ¥æœºå°±æ˜¯å«æœ‰<strong>è‡³å°‘ä¸€ä¸ªéšè—å±‚</strong>çš„å…¨è¿æ¥å±‚ç»„æˆçš„ç¥ç»ç½‘ç»œï¼Œä¸”<strong>æ¯ä¸ªéšè—å±‚çš„è¾“å‡ºé€šè¿‡æ¿€æ´»å‡½æ•°</strong>è¿›è¡Œå˜æ¢ã€‚å¤šå±‚æ„ŸçŸ¥æœºçš„å±‚æ•°å’Œå„éšè—å±‚ä¸­éšè—å•å…ƒä¸ªæ•°éƒ½æ˜¯è¶…å‚æ•°ã€‚ä»¥å•éšè—å±‚ä¸ºä¾‹å¹¶æ²¿ç”¨æœ¬èŠ‚ä¹‹å‰å®šä¹‰çš„ç¬¦å·<br>$$<br>\begin{aligned}<br>\boldsymbol{H} &amp;= \phi(\boldsymbol{X} \boldsymbol{W}_h + \boldsymbol{b}_h),\<br>\boldsymbol{O} &amp;= \boldsymbol{H} \boldsymbol{W}_o + \boldsymbol{b}_o,<br>\end{aligned}<br>$$<br>å…¶ä¸­$\phi$è¡¨ç¤ºæ¿€æ´»å‡½æ•°ã€‚</li>
<li>åˆ†ç±»é—®é¢˜ä¸­ï¼šæˆ‘ä»¬å¯ä»¥å¯¹è¾“å‡ºOåšsoftmaxè¿ç®—ï¼Œå¹¶ä½¿ç”¨softmaxå›å½’ä¸­çš„äº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚ï¼ˆä¹Ÿå°±æ˜¯ä»¥å‰ç›´æ¥è¾“å‡ºï¼Œç°åœ¨åœ¨æ˜¯ç»è¿‡ä¸€ä¸ªéšè—å±‚æ¥ç€æ¿€æ´»ä¹‹åç»™è¾“å‡ºï¼‰</li>
<li>å›å½’é—®é¢˜ä¸­ï¼šæˆ‘ä»¬å°†è¾“å‡ºå±‚çš„è¾“å‡ºä¸ªæ•°è®¾ä¸º1ï¼Œå¹¶å°†è¾“å‡ºoç›´æ¥æä¾›ç»™çº¿æ€§å›å½’ä¸­ä½¿ç”¨çš„å¹³æ–¹æŸå¤±å‡½æ•°ã€‚</li>
</ul>
<p>666 è™½ç„¶æœ‰ç‚¹è¿·è¿·ç³Šç³Šçš„</p>
<h3 id="3-9-å¤šå±‚æ„ŸçŸ¥æœºçš„ä»é›¶å¼€å§‹å®ç°"><a href="#3-9-å¤šå±‚æ„ŸçŸ¥æœºçš„ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="3.9 å¤šå±‚æ„ŸçŸ¥æœºçš„ä»é›¶å¼€å§‹å®ç°"></a>3.9 å¤šå±‚æ„ŸçŸ¥æœºçš„ä»é›¶å¼€å§‹å®ç°</h3><p>3.9.1 è¯»å–æ•°æ®é›†<br>3.9.2 å®šä¹‰æ¨¡å‹å‚æ•°<br>å¤šäº†ä¸€å±‚éšè—å±‚çš„å‚æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">num_inputs, num_outputs, num_hiddens = <span class="number">784</span>, <span class="number">10</span>, <span class="number">256</span></span><br><span class="line"></span><br><span class="line">W1 = nd.random.normal(scale=<span class="number">0.01</span>, shape=(num_inputs, num_hiddens))</span><br><span class="line">b1 = nd.zeros(num_hiddens)</span><br><span class="line">W2 = nd.random.normal(scale=<span class="number">0.01</span>, shape=(num_hiddens, num_outputs))</span><br><span class="line">b2 = nd.zeros(num_outputs)</span><br><span class="line">params = [W1, b1, W2, b2]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">    param.attach_grad()</span><br></pre></td></tr></table></figure>

<p>3.9.3 å®šä¹‰æ¿€æ´»å‡½æ•°<br>ä¸ä½¿ç”¨åŒ…ï¼Œè‡ªå·±å®šä¹‰</p>
<p>3.9.4 å®šä¹‰æ¨¡å‹è¿™é‡Œæœ‰ä¸åŒçš„</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">net</span><span class="params">(X)</span>:</span></span><br><span class="line">    X = X.reshape((<span class="number">-1</span>, num_inputs))</span><br><span class="line">    H = relu(nd.dot(X, W1) + b1)   <span class="comment"># è¿™é‡Œå¤šäº†ä¸€å±‚ï¼ï¼éšè—å±‚ï¼ï¼</span></span><br><span class="line">    <span class="keyword">return</span> nd.dot(H, W2) + b2</span><br></pre></td></tr></table></figure>

<p><strong><em>æˆ‘å»æ²¡æœ‰å®šä¹‰ä¼˜åŒ–ç®—æ³• åº”è¯¥å°è£…åœ¨æœ€åè®­ç»ƒå‡½æ•°é‡Œäº†</em></strong><br>3.9.5 å®šä¹‰æŸå¤±å‡½æ•°<br>ä¸ºäº†ç¨³å®šæ€§ä½¿ç”¨gluonçš„åŒ…</p>
<p>3.9.6 è®­ç»ƒæ¨¡å‹<br>easy</p>
<h3 id="3-10-å¤šå±‚æ„ŸçŸ¥æœºçš„ç®€æ´å®ç°"><a href="#3-10-å¤šå±‚æ„ŸçŸ¥æœºçš„ç®€æ´å®ç°" class="headerlink" title="3.10 å¤šå±‚æ„ŸçŸ¥æœºçš„ç®€æ´å®ç°"></a>3.10 å¤šå±‚æ„ŸçŸ¥æœºçš„ç®€æ´å®ç°</h3><p>so ç®€æ´ï¼ï¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥åŒ…</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">".."</span>)</span><br><span class="line"><span class="keyword">import</span> d2lzh <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> gluon, init</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> loss <span class="keyword">as</span> gloss, nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ¨¡å‹</span></span><br><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Dense(<span class="number">256</span>, activation=<span class="string">'relu'</span>),</span><br><span class="line">        nn.Dense(<span class="number">10</span>))</span><br><span class="line">net.initialize(init.Normal(sigma=<span class="number">0.01</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–æ•°æ®ä¸è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br><span class="line"></span><br><span class="line">loss = gloss.SoftmaxCrossEntropyLoss()</span><br><span class="line">trainer = gluon.Trainer(net.collect_params(), <span class="string">'sgd'</span>, &#123;<span class="string">'learning_rate'</span>: <span class="number">0.5</span>&#125;)</span><br><span class="line">num_epochs = <span class="number">5</span></span><br><span class="line">d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, batch_size, <span class="literal">None</span>,</span><br><span class="line">              <span class="literal">None</span>, trainer)</span><br></pre></td></tr></table></figure>

<h3 id="3-11-æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"><a href="#3-11-æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ" class="headerlink" title="3.11 æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"></a>3.11 æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ</h3><blockquote>
<p>æå‡ºé—®é¢˜ï¼šä¸ºå•¥æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šæ›´å‡†ç¡®æ—¶ï¼Œå®ƒåœ¨æµ‹è¯•æ•°æ®é›†ä¸Šå´ä¸ä¸€å®šå‡†ç¡®</p>
</blockquote>
<h4 id="3-11-1-è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"><a href="#3-11-1-è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®" class="headerlink" title="3.11.1 è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"></a>3.11.1 è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®</h4><ul>
<li>è®­ç»ƒè¯¯å·®ï¼šæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šè¡¨ç°çš„è¯¯å·®</li>
<li>æ³›åŒ–è¯¯å·®ï¼šæ¨¡å‹åœ¨ä»»æ„ä¸€ä¸ªæµ‹è¯•æ•°æ®æ ·æœ¬ä¸Šè¡¨ç°å‡ºçš„è¯¯å·®çš„æœŸæœ›ï¼Œï¼Ÿï¼Ÿå¹¶å¸¸å¸¸é€šè¿‡æµ‹è¯•æ•°æ®é›†ä¸Šçš„è¯¯å·®æ¥è¿‘ä¼¼ï¼Ÿï¼Ÿ</li>
</ul>
<p>è®¡ç®—è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®å¯ä»¥ä½¿ç”¨ä¹‹å‰ä»‹ç»è¿‡çš„æŸå¤±å‡½æ•°ï¼Œä¾‹å¦‚çº¿æ€§å›å½’ç”¨åˆ°çš„å¹³æ–¹æŸå¤±å‡½æ•°å’Œsoftmaxå›å½’ç”¨åˆ°çš„äº¤å‰ç†µæŸå¤±å‡½æ•°<br>æœºå™¨å­¦ä¹ æ¨¡å‹åº”å…³æ³¨é™ä½æ³›åŒ–è¯¯å·®</p>
<h4 id="3-11-2-æ¨¡å‹é€‰æ‹©"><a href="#3-11-2-æ¨¡å‹é€‰æ‹©" class="headerlink" title="3.11.2 æ¨¡å‹é€‰æ‹©"></a>3.11.2 æ¨¡å‹é€‰æ‹©</h4><p>æœºå™¨å­¦ä¹ ä¸­ï¼Œé€šå¸¸éœ€è¦è¯„ä¼°è‹¥å¹²å€™é€‰æ¨¡å‹çš„è¡¨ç°å¹¶ä»ä¸­é€‰æ‹©æ¨¡å‹ã€‚<br>å¯ä¾›é€‰æ‹©çš„å€™é€‰æ¨¡å‹å¯ä»¥æ˜¯æœ‰ä¸åŒè¶…å‚æ•°çš„åŒç±»æ¨¡å‹ã€‚<br>å¯¹å¤šå±‚æ„ŸçŸ¥æœºï¼šå¯ä»¥é€‰æ‹©éšè—å±‚çš„ä¸ªæ•°ï¼Œä»¥åŠæ¯ä¸ªéšè—å±‚ä¸­éšè—å•å…ƒä¸ªæ•°å’Œæ¿€æ´»å‡½æ•°ã€‚<br>é€šå¸¸è¦åœ¨æ¨¡å‹é€‰æ‹©ä¸Šä¸‹ä¸€ç•ªåŠŸå¤«ã€‚ç»å¸¸ä½¿ç”¨éªŒè¯æ•°æ®é›†ã€‚<br><strong>1.éªŒè¯æ•°æ®é›†</strong><br>æµ‹è¯•é›†ï¼šåªèƒ½åœ¨è¶…å‚æ•°å’Œæ¨¡å‹å‚æ•°é€‰å®šåä½¿ç”¨ä¸€æ¬¡ï¼ˆåªèƒ½ç”¨æ¥æµ‹è¯•ï¼‰ï¼Œä¸èƒ½ç”¨æ¥è°ƒå‚å’Œé€‰æ‹©æ¨¡å‹<br>è®­ç»ƒé›†ï¼šæ— æ³•ä»è®­ç»ƒè¯¯å·®é¡¾åŠæ³›åŒ–è¯¯å·®ï¼Œä¸èƒ½ä¾èµ–è®­ç»ƒé›†é€‰æ‹©æ¨¡å‹ã€‚<br>é‰´äºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é¢„ç•™ä¸€éƒ¨åˆ†åœ¨è®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›†ä»¥å¤–çš„æ•°æ®æ¥è¿›è¡Œæ¨¡å‹é€‰æ‹©ã€‚<br>ç§°ä¸ºéªŒè¯æ•°æ®é›†ï¼Œç®€ç§°éªŒè¯é›†ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä»ç»™å®šçš„è®­ç»ƒé›†ä¸­éšæœºé€‰å–ä¸€å°éƒ¨åˆ†ä½œä¸ºéªŒè¯é›†ï¼Œè€Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºçœŸæ­£çš„è®­ç»ƒé›†ã€‚<br>å®é™…åº”ç”¨ä¸­ï¼Œç”±äºæ•°æ®ä¸å®¹æ˜“è·å–ï¼Œæµ‹è¯•æ•°æ®æå°‘ä½¿ç”¨ä¸€æ¬¡å°±ä¸¢å¼ƒã€‚å› æ­¤éªŒè¯æ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›†ç•Œé™æ¯”è¾ƒæ¨¡ç³Šã€‚<br><strong>2.kæŠ˜äº¤å‰éªŒè¯</strong><br>ç”±äºéªŒè¯æ•°æ®é›†ä¸å‚ä¸æ¨¡å‹è®­ç»ƒï¼Œæ‰€ä»¥å½“è®­ç»ƒæ•°æ®ä¸å¤Ÿç”¨æ—¶ï¼Œé¢„ç•™å¤§é‡éªŒè¯æ•°æ®é›†æœ‰ç‚¹å¥¢ä¾ˆã€‚æ‰€ä»¥ç”¨kæŠ˜äº¤å‰éªŒè¯ã€‚</p>
<blockquote>
<p>å³å°†è®­ç»ƒæ•°æ®é›†åˆ†æˆkä¸ªä¸é‡åˆçš„å­æ•°æ®é›†ï¼Œç„¶åæˆ‘ä»¬åškæ¬¡æ¨¡å‹è®­ç»ƒå’ŒéªŒè¯ï¼Œæ¯ä¸€æ¬¡ç”¨ä¸€ä¸ªå­æ•°æ®é›†éªŒè¯ï¼Œå…¶ä»–k-1ä¸ªå­æ•°æ®é›†æ¥åšè®­ç»ƒæ¨¡å‹ã€‚æ¯æ¬¡ç”¨åˆ°çš„å­æ•°æ®é›†ä¸åŒã€‚æœ€åç”¨kæ¬¡è®­ç»ƒè¯¯å·®å’ŒéªŒè¯è¯¯å·®å–å¹³å‡/</p>
</blockquote>
<h4 id="3-11-3-æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"><a href="#3-11-3-æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ" class="headerlink" title="3.11.3 æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"></a>3.11.3 æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ</h4><p>è¦åŒæ—¶é¿å…æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆï¼Œè™½ç„¶å› ç´ å¾ˆå¤šï¼Œé‡ç‚¹è®¨è®ºæ¨¡å‹å¤æ‚åº¦å’Œè®­ç»ƒæ•°æ®é›†å¤§å°ã€‚<br><strong>1.æ¨¡å‹å¤æ‚åº¦</strong><br>å¤šé¡¹å¼æ¨¡å‹å¤æ‚åº¦æ›´é«˜ï¼Œæ›´å®¹æ˜“å‡å°è®­ç»ƒè¯¯å·®ï¼Œä½†å®¹æ˜“é€ æˆè¿‡æ‹Ÿåˆï¼Œå¤ªç®€å•æ¬ æ‹Ÿåˆã€‚<br><strong>2.è®­ç»ƒæ•°æ®é›†å¤§å°</strong><br>æ ·æœ¬æ•°æ®é›†è¿‡å°‘ï¼Œç‰¹åˆ«æ˜¯æ¯”æ¨¡å‹å‚æ•°æ•°é‡ï¼ˆæŒ‰å…ƒç´ è®¡ï¼‰æ›´å°‘æ—¶ï¼Œè¿‡æ‹Ÿåˆæ›´å®¹æ˜“å‘ç”Ÿã€‚æ­¤å¤–ï¼Œæ³›åŒ–è¯¯å·®ä¸ä¼šéšè®­ç»ƒæ•°æ®é›†é‡Œæ ·æœ¬æ•°é‡å¢åŠ è€Œå¢å¤§ã€‚å› æ­¤å¸Œæœ›æ•°æ®é›†æ›´å¤§</p>
<h4 id="3-11-4-å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ"><a href="#3-11-4-å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ" class="headerlink" title="3.11.4 å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ"></a>3.11.4 å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆå®éªŒ</h4><p>æˆ‘å»è¿™ä¸ªè´¼6 è‡ªå·±çœ‹ä¸æ‡‚ï¼<br><strong>1.ç”Ÿæˆæ•°æ®é›†</strong><br><strong>2.å®šä¹‰ã€è®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹</strong><br><strong><em>æˆ‘å»ç‰›çš®ï¼ï¼</em></strong><br>åœ¨Gluonä¸­æˆ‘ä»¬æ— é¡»æŒ‡å®šæ¯ä¸€å±‚è¾“å…¥çš„å½¢çŠ¶ï¼Œä¾‹å¦‚çº¿æ€§å›å½’çš„è¾“å…¥ä¸ªæ•°ï¼Œå½“æ¨¡å‹å¾—åˆ°æ•°æ®æ—¶ï¼Œä¾‹å¦‚åé¢æ‰§è¡Œnet(x)æ—¶ï¼Œæ¨¡å‹å°†è‡ªåŠ¨æ¨æ–­å‡ºæ¯ä¸€å±‚çš„è¾“å…¥ä¸ªæ•°ï¼Œæˆ‘ä»¬æˆ‘ä»¬å°†åœ¨ç¬¬4ç« ä»‹ç»è¿™ç§æœºåˆ¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Dense(<span class="number">1</span>))    <span class="comment">#å¦ˆçš„åªéœ€è¦è¿™æ · 1 æ˜¯è¾“å‡ºä¸ªæ•°çš„æ„æ€</span></span><br><span class="line">net.initialize()</span><br></pre></td></tr></table></figure>

<p><strong>3.ä¸‰é˜¶å¤šé¡¹å¼å‡½æ•°æ‹Ÿåˆï¼ˆæ­£å¸¸ï¼‰</strong><br><strong>4.çº¿æ€§å‡½æ•°æ‹Ÿåˆï¼ˆæ¬ æ‹Ÿåˆï¼‰</strong><br><strong>5.è®­ç»ƒæ ·æœ¬ä¸è¶³ï¼ˆè¿‡æ‹Ÿåˆï¼‰</strong></p>
<h3 id="3-12-æƒé‡è¡°å‡"><a href="#3-12-æƒé‡è¡°å‡" class="headerlink" title="3.12 æƒé‡è¡°å‡"></a>3.12 æƒé‡è¡°å‡</h3><h4 id="3-12-1-æ–¹æ³•"><a href="#3-12-1-æ–¹æ³•" class="headerlink" title="3.12.1 æ–¹æ³•"></a>3.12.1 æ–¹æ³•</h4><p>å¼•å…¥æƒé‡è¡°å‡ï¼ˆç­‰ä»·äºL2èŒƒæ•°æ­£åˆ™åŒ–ï¼‰ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ<br>æŸå¤±å‡½æ•°æ”¹å˜ï¼šå¢åŠ $$\ell(w_1, w_2, b) + \frac{\lambda}{2n} |\boldsymbol{w}|^2,$$<br>è¿­ä»£æ–¹å¼æ”¹å˜ï¼š$$<br>\begin{aligned}<br>w_1 &amp;\leftarrow \left(1- \frac{\eta\lambda}{|\mathcal{B}|} \right)w_1 -   \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_1^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right),\<br>w_2 &amp;\leftarrow \left(1- \frac{\eta\lambda}{|\mathcal{B}|} \right)w_2 -   \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_2^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right).<br>\end{aligned}<br>$$</p>
<h4 id="3-12-2-é«˜ç»´çº¿æ€§å›å½’å®éªŒ"><a href="#3-12-2-é«˜ç»´çº¿æ€§å›å½’å®éªŒ" class="headerlink" title="3.12.2 é«˜ç»´çº¿æ€§å›å½’å®éªŒ"></a>3.12.2 é«˜ç»´çº¿æ€§å›å½’å®éªŒ</h4><p>é€šè¿‡é«˜ç»´çº¿æ€§å›å½’ä¸ºä¾‹å¼•å…¥ä¸€ä¸ªè¿‡æ‹Ÿåˆé—®é¢˜ï¼Œå¹¶ä½¿ç”¨æƒé‡è¡°å‡è§£å†³</p>
<h4 id="3-12-3-ä»é›¶å¼€å§‹å®ç°"><a href="#3-12-3-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="3.12.3 ä»é›¶å¼€å§‹å®ç°"></a>3.12.3 ä»é›¶å¼€å§‹å®ç°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> autograd.record():</span><br><span class="line">                <span class="comment"># æ·»åŠ äº†L2èŒƒæ•°æƒ©ç½šé¡¹</span></span><br><span class="line">                l = loss(net(X, w, b), y) + lambd * l2_penalty(w)</span><br></pre></td></tr></table></figure>

<p>åªæ˜¯åœ¨æŸå¤±å‡½æ•°æ·»åŠ æƒ©ç½š<br>æ²¡æœ‰åœ¨è¿­ä»£å¢åŠ </p>
<h4 id="3-12-4-ç®€æ´å®ç°"><a href="#3-12-4-ç®€æ´å®ç°" class="headerlink" title="3.12.4 ç®€æ´å®ç°"></a>3.12.4 ç®€æ´å®ç°</h4><p>å¯ä»¥åˆ†åˆ«å¯¹wå’Œbéƒ½è¿›è¡Œæƒé‡è¡°å‡ï¼ˆé»˜è®¤å¯¹ä¸¤ä¸ªéƒ½ä¼šè€è´±ï¼‰<br>ä½†å¯ä»¥è‡ªå·±è®¾ç½®åªå¯¹wè¿›è¡Œè¡°å‡ï¼Œæƒé‡è¡°å‡å¯ä»¥é€šè¿‡Gluonçš„wdè¶…å‚æ•°æ¥æŒ‡å®šã€‚</p>
<h3 id="3-13-ä¸¢å¼ƒæ³•"><a href="#3-13-ä¸¢å¼ƒæ³•" class="headerlink" title="3.13 ä¸¢å¼ƒæ³•"></a>3.13 ä¸¢å¼ƒæ³•</h3><p>3.13.1 æ–¹æ³•<br>é™¤äº†æƒé‡æ‹Ÿåˆï¼Œè¿˜å¯ä»¥ç”¨ä¸¢å¼ƒæ³•è§£å†³è¿‡æ‹Ÿåˆçš„é—®é¢˜<br>éšè—å•å…ƒçš„è®¡ç®—è¡¨è¾¾å¼ï¼Œå¯¹éšè—å±‚ä½¿ç”¨ä¸¢å¼ƒæ³•æ—¶ï¼Œè¯¥å±‚çš„éšè—å•å…ƒå°†æœ‰ä¸€å®šæ¦‚ç‡è¢«ä¸¢å¼ƒæ‰ã€‚æœ‰pçš„æ¦‚ç‡è¢«æ¸…é›¶ï¼Œæœ‰1-pçš„æ¦‚ç‡ä¼šè¢«é™¤ä»¥1-påšæ‹‰ä¼¸ã€‚ä¸¢å¼ƒæ¦‚ç‡æ˜¯ä¸¢å¼ƒæ³•çš„è¶…å‚æ•°<br>ç”±äºè®­ç»ƒä¸­éšè—å±‚ç¥ç»å…ƒçš„ä¸¢å¼ƒæ˜¯éšæœºçš„ï¼Œå³h1~h5éƒ½æœ‰å¯èƒ½è¢«æ¸…é›¶ï¼Œè¾“å‡ºå±‚çš„è®¡ç®—æ— æ³•è¿‡åº¦ä¾èµ–h1ï½h5ä¸­çš„ä»»ä¸€ä¸ªï¼Œä»è€Œåœ¨è®­ç»ƒæ¨¡å‹æ—¶èµ·åˆ°æ­£åˆ™åŒ–çš„ä½œç”¨ã€‚<br>3.13.2 ä»é›¶å¼€å§‹å®ç°<br>å…ˆå­¦dropoutå‡½æ•°:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dropout</span><span class="params">(X, drop_prob)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt;= drop_prob &lt;= <span class="number">1</span></span><br><span class="line">    keep_prob = <span class="number">1</span> - drop_prob</span><br><span class="line">    <span class="comment"># è¿™ç§æƒ…å†µä¸‹æŠŠå…¨éƒ¨å…ƒç´ éƒ½ä¸¢å¼ƒ</span></span><br><span class="line">    <span class="keyword">if</span> keep_prob == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> X.zeros_like()</span><br><span class="line">    mask = nd.random.uniform(<span class="number">0</span>, <span class="number">1</span>, X.shape) &lt; keep_prob   <span class="comment">#uniform ä¸çŸ¥é“å¹²å•¥çš„</span></span><br><span class="line">    <span class="keyword">return</span> mask * X / keep_prob</span><br></pre></td></tr></table></figure>

<p>1ã€å®šä¹‰æ¨¡å‹å‚æ•°<br>2ã€å®šä¹‰æ¨¡å‹<br>3ã€è®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹<br>3.13.3 ç®€æ´å®ç°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Dense(<span class="number">256</span>, activation=<span class="string">"relu"</span>),</span><br><span class="line">        nn.Dropout(drop_prob1),  <span class="comment"># åœ¨ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚åæ·»åŠ ä¸¢å¼ƒå±‚</span></span><br><span class="line">        nn.Dense(<span class="number">256</span>, activation=<span class="string">"relu"</span>),</span><br><span class="line">        nn.Dropout(drop_prob2),  <span class="comment"># åœ¨ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚åæ·»åŠ ä¸¢å¼ƒå±‚</span></span><br><span class="line">        nn.Dense(<span class="number">10</span>))</span><br><span class="line">net.initialize(init.Normal(sigma=<span class="number">0.01</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-14-æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾"><a href="#3-14-æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾" class="headerlink" title="3.14 æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾"></a>3.14 æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾</h3><p>ä¹‹å‰æˆ‘ä»¬æ˜¯ä½¿ç”¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–ç®—æ³•æ¥è®­ç»ƒæ¨¡å‹ã€‚é»˜è®¤ä½¿ç”¨äº†åå‘ä¼ æ’­ï¼Œæœ¬èŠ‚ä½¿ç”¨æ•°å­¦æ¥æè¿°æ­£å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†ä»¥å¸¦L2èŒƒæ•°æ­£åˆ™åŒ–çš„å«å•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºä¸ºæ ·ä¾‹æ¨¡å‹è§£é‡Šæ­£å‘ä¼ æ’­å’Œåå‘ä¼ æ’­ã€‚<br>å·´æ‹‰å·´æ‹‰ä¸€å †æ•°å­¦çœ‹ä¸æ‡‚ ä½†åŸç†åº”è¯¥äº†è§£ä¸€äº› å°±æ˜¯ä»åå‘å‰æ±‚å–æ¢¯åº¦ï¼Œå´æ©è¾¾çš„è¯¾å¥½åƒä¹Ÿè®²è¿‡<br>è¿˜æœ‰æ­£å‘ä¼ æ’­ä¾èµ–åå‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­ä¾èµ–æ­£å‘ä¼ æ’­ã€‚</p>
<h3 id="3-15-æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–"><a href="#3-15-æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–" class="headerlink" title="3.15 æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–"></a>3.15 æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–</h3><p>3.15.1 è¡°å‡å’Œçˆ†ç‚¸<br>å½“ç¥ç»ç½‘ç»œå±‚æ•°è¾ƒå¤šï¼Œæ¨¡å‹çš„æ•°å€¼ç¨³å®šæ€§å®¹æ˜“å˜å·®ã€‚å®¹æ˜“å¾ˆå¤šå±‚ä¼šå¾ˆå°æˆ–è€…å¾ˆå¤§<br>3.15.2 éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°<br>1.MXNetçš„é»˜è®¤éšæœºåˆå§‹åŒ–<br>2.Xavieréšæœºåˆå§‹åŒ–</p>
<h3 id="3-16-å®æˆ˜Kaggleæ¯”èµ›ï¼šæˆ¿ä»·é¢„æµ‹"><a href="#3-16-å®æˆ˜Kaggleæ¯”èµ›ï¼šæˆ¿ä»·é¢„æµ‹" class="headerlink" title="3.16 å®æˆ˜Kaggleæ¯”èµ›ï¼šæˆ¿ä»·é¢„æµ‹"></a>3.16 å®æˆ˜Kaggleæ¯”èµ›ï¼šæˆ¿ä»·é¢„æµ‹</h3><p>ç»ˆäºæœ‰å®é™…ä»£ç äº†ï¼Œç†è®ºå¥½å¤æ‚ã€‚<br>æœ¬èŠ‚å°†æä¾›æœªç»è°ƒä¼˜çš„æ•°æ®çš„é¢„å¤„ç†ã€æ¨¡å‹çš„è®¾è®¡å’Œè¶…å‚æ•°çš„é€‰æ‹©ã€‚<br>å¾ˆå¤š æœ‰ç‚¹å¤æ‚ è‡ªå·±çœ‹ä¹¦ å†ç†è§£ä¼šæ¯”è¾ƒå¥½</p>
<h2 id="ç¬¬4ç« -æ·±åº¦å­¦ä¹ è®¡ç®—"><a href="#ç¬¬4ç« -æ·±åº¦å­¦ä¹ è®¡ç®—" class="headerlink" title="ç¬¬4ç«  æ·±åº¦å­¦ä¹ è®¡ç®—"></a>ç¬¬4ç«  æ·±åº¦å­¦ä¹ è®¡ç®—</h2><blockquote>
<p>ç¬¬3ç« ä»‹ç»äº†åŒ…æ‹¬å¤šå±‚æ„ŸçŸ¥æœºåœ¨å†…çš„ç®€å•æ·±åº¦å­¦ä¹ æ¨¡å‹çš„åŸç†ã€‚æœ¬ç« æˆ‘ä»¬å°†ç®€è¦æ¦‚æ‹¬æ·±åº¦å­¦ä¹ çš„å„ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¦‚æ¨¡å‹æ„é€ ã€å‚æ•°çš„è®¿é—®å’Œåˆå§‹åŒ–ç­‰ï¼Œè‡ªå®šä¹‰å±‚ï¼Œè¯»å–ã€å­˜å‚¨å’Œä½¿ç”¨GPUã€‚</p>
</blockquote>
<h3 id="4-1-æ¨¡å‹æ„é€ "><a href="#4-1-æ¨¡å‹æ„é€ " class="headerlink" title="4.1 æ¨¡å‹æ„é€ "></a>4.1 æ¨¡å‹æ„é€ </h3><p>ä¹‹å‰æ˜¯Sequentialç±»æ„é€ æ¨¡å‹ã€‚è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ç§åŸºäºBlockç±»çš„æ¨¡å‹æ„é€ æ–¹æ³•ï¼šå®ƒè®©æ¨¡å‹æ„é€ æ›´åŠ çµæ´»</p>
<h4 id="4-1-1-ç»§æ‰¿Blockç±»æ¥æ„é€ æ¨¡å‹"><a href="#4-1-1-ç»§æ‰¿Blockç±»æ¥æ„é€ æ¨¡å‹" class="headerlink" title="4.1.1 ç»§æ‰¿Blockç±»æ¥æ„é€ æ¨¡å‹"></a>4.1.1 ç»§æ‰¿Blockç±»æ¥æ„é€ æ¨¡å‹</h4><p>Blockç±»æ˜¯nnæ¨¡å—é‡Œæä¾›çš„ä¸€ä¸ªæ¨¡å‹æ„é€ ç±»ã€‚è¿™é‡ŒMLPç±»é‡è½½äº†Blockç±»çš„<strong>init</strong>å‡½æ•°å’Œforwardå‡½æ•°ï¼Œåˆ†åˆ«ç”¨äºåˆ›å»ºæ¨¡å‹å‚æ•°å’Œå®šä¹‰å‘å‰è®¡ç®—<br><strong>æ–°çš„æ¨¡å‹æ„é€ æ–¹æ³•</strong> åªæ˜¯æ„é€ ä¸€ä¸ªæ¨¡å‹ï¼Œæ›´å¤šåƒä¸€ä¸ªæ–¹æ³•<br>æ³¨æ„ï¼šè¿™é‡Œå¹¶æ²¡æœ‰å°†Blockç±»å‘½åä¸ºLayerï¼ˆå±‚ï¼‰æˆ–è€…Modelï¼ˆæ¨¡å‹ï¼‰ä¹‹ç±»çš„åå­—ï¼Œå› ä¸ºBlockç±»æ˜¯ä¸€ä¸ªå¯ä»¥è‡ªç”±ç»„å»ºçš„ä¸è§ã€‚å®ƒçš„å­ç±»æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªå±‚ï¼ˆå¦‚Gluonæä¾›çš„Denseç±»ï¼‰ï¼Œåˆå¯ä»¥æ˜¯ä¸€ä¸ªæ¨¡å‹ï¼ˆå¦‚è¿™é‡Œçš„MLPç±»ï¼‰ï¼Œæˆ–è€…æ˜¯æ¨¡å‹ã€‚ä¸‹é¢é€šè¿‡ä¾‹å­å±•ç¤ºå®ƒçš„çµæ´»æ€§ğŸ˜“</p>
<h4 id="4-1-2-Sequentialç±»ç»§æ‰¿è‡ªBlockç±»"><a href="#4-1-2-Sequentialç±»ç»§æ‰¿è‡ªBlockç±»" class="headerlink" title="4.1.2 Sequentialç±»ç»§æ‰¿è‡ªBlockç±»"></a>4.1.2 Sequentialç±»ç»§æ‰¿è‡ªBlockç±»</h4><p>äº‹å®ä¸ŠSequentialç±»ç»§æ‰¿è‡ªBlockç±»ï¼Œå®ƒæä¾›addå‡½æ•°æ¥é€ä¸€æ·»åŠ ä¸²è”çš„Blockå­ç±»å®ä¾‹ï¼Œè€Œæ¨¡å‹çš„å‰å‘è®¡ç®—å°±æ˜¯å°†è¿™äº›å®ä¾‹æŒ‰æ·»åŠ çš„é¡ºåºé€ä¸€è®¡ç®—ã€‚<br>666 å®Œå…¨å¯ä»¥ç”¨è‡ªå·±æ–¹æ³•å†™ä¸€å¥—Sequential()å‡ºæ¥</p>
<h4 id="4-1-3-æ„é€ å¤æ‚çš„æ¨¡å‹"><a href="#4-1-3-æ„é€ å¤æ‚çš„æ¨¡å‹" class="headerlink" title="4.1.3 æ„é€ å¤æ‚çš„æ¨¡å‹"></a>4.1.3 æ„é€ å¤æ‚çš„æ¨¡å‹</h4><p>è™½ç„¶Sequentialå¯ä»¥è®©æ¨¡å‹æ„é€ æ›´ç®€å•ï¼Œä¸éœ€è¦å®šä¹‰forwardå‡½æ•°ï¼Œä½†ç›´æ¥ç”¨Blockç±»å¯ä»¥æå¤§åœ°æ‹“å±•æ¨¡å‹æ„é€ çš„çµæ´»æ€§ã€‚<br>æ„å»ºç¨å¾®å¤æ‚ç‚¹çš„ç½‘ç»œFancyMLPï¼Œé€šè¿‡get_constantå‡½æ•°åˆ›å»ºè®­ç»ƒä¸­ä¸è¢«è¿­ä»£çš„å‚æ•°ã€‚</p>
<p>å› ä¸ºFancyMLPå’ŒSquentialç±»éƒ½æ˜¯Blockç±»çš„å­ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åµŒå¥—è°ƒç”¨å®ƒä»¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.add(NestMLP(), nn.Dense(<span class="number">20</span>), FancyMLP())</span><br></pre></td></tr></table></figure>

<h3 id="4-2-æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–å’Œå…±äº«"><a href="#4-2-æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–å’Œå…±äº«" class="headerlink" title="4.2 æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–å’Œå…±äº«"></a>4.2 æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–å’Œå…±äº«</h3><p>å‰é¢æˆ‘ä»¬é€šè¿‡initæ¨¡å—æ¥åˆå§‹åŒ–æ¨¡å‹çš„å…¨éƒ¨å‚æ•°ã€‚æˆ‘ä»¬ä¹Ÿä»‹ç»äº†è®¿é—®æ¨¡å‹çš„ç®€å•æ–¹æ³•ã€‚æœ¬èŠ‚æ·±å…¥è®²è§£å¦‚ä½•è®¿é—®å’Œåˆå§‹åŒ–æ¨¡å‹å‚æ•°ï¼Œä»¥åŠå¦‚ä½•åœ¨å¤šä¸ªå±‚ä¹‹é—´å…±äº«åŒä¸€ä»½æ¨¡å‹å‚æ•°ã€‚<br>å…ˆå®šä¹‰ä¸€ä¸ªä¸4.1èŠ‚ä¸­ç›¸åŒçš„å«å•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºã€‚ä¾ç„¶ä½¿ç”¨é»˜è®¤æ–¹å¼åˆå§‹åŒ–å‚æ•°ï¼Œå¹¶åšä¸€æ¬¡å‘å‰è®¡ç®—ã€‚ä¸ä¹‹å‰ä¸åŒï¼ŒåŒ…å«MXNetçš„initæ¨¡å—ï¼ŒåŒ…å«å¤šç§æ¨¡å‹åˆå§‹åŒ–æ–¹æ³•ã€‚</p>
<h4 id="4-2-1-è®¿é—®æ¨¡å‹å‚æ•°"><a href="#4-2-1-è®¿é—®æ¨¡å‹å‚æ•°" class="headerlink" title="4.2.1 è®¿é—®æ¨¡å‹å‚æ•°"></a>4.2.1 è®¿é—®æ¨¡å‹å‚æ•°</h4><p>ç”¨[]ç´¢å¼•è®¿é—®æ‰€æœ‰éšè—å‚æ•°</p>
<ul>
<li><p>ç´¢å¼•æ–¹å¼ï¼šeasy  å°å­¦ç”Ÿéƒ½ä¼š</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net[<span class="number">0</span>].weight</span><br><span class="line">net[<span class="number">0</span>].weight.data()</span><br><span class="line">net[<span class="number">0</span>].weight.grad()</span><br><span class="line">net[<span class="number">1</span>].weight.data()</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯ä»¥ç”¨collect_paramså‡½æ•°æ¥è·å–netå˜é‡çš„æ‰€æœ‰åµŒå¥—</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.collect_params()</span><br><span class="line">net.collect_params(<span class="string">'.*weight'</span>) <span class="comment">#ç»™å‚æ•°ç­›é€‰</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="4-2-2-åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#4-2-2-åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="4.2.2 åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>4.2.2 åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h4><p>ä¹‹å‰æœ‰æ¨¡å‹çš„é»˜è®¤åˆå§‹åŒ–æ–¹æ³•ï¼šæƒé‡å‚æ•°å…ƒç´ ä¸º[-0.07, 0.07]ä¹‹é—´å‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°ï¼Œåå·®å‚æ•°å…¨ä¸ºé›¶ã€‚MXNetä¸­æä¾›äº†å¤šç§é¢„è®¾çš„åˆå§‹åŒ–æ–¹æ³•ã€‚<br>easy ä¸ä¼šç”¨è‡ªå·±çœ‹ è´¼6ï¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net.initialize(init=init.Normal(sigma=<span class="number">0.01</span>), force_reinit=<span class="literal">True</span>) <span class="comment">#å‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®ä¸º0.0æ­£æ€åˆ†å¸ƒ</span></span><br><span class="line">net.initialize(init=init.Constant(<span class="number">1</span>), force_reinit=<span class="literal">True</span>) <span class="comment"># æƒä¸º1çš„åˆå§‹åŒ–</span></span><br><span class="line">net[<span class="number">0</span>].weight.initialize(init=init.Xavier(), force_reinit=<span class="literal">True</span>) <span class="comment"># Xavier()æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•"><a href="#4-2-3-è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•" class="headerlink" title="4.2.3 è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•"></a>4.2.3 è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</h4><p>æœ‰æ—¶å€™éœ€è¦çš„åˆå§‹åŒ–æ–¹æ³•initæ¨¡å—æ²¡æœ‰æä¾›ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªInitializerç±»çš„å­ç±»ï¼Œåƒä½¿ç”¨å…¶ä»–åˆå§‹åŒ–æ–¹æ³•é‚£æ ·ä½¿ç”¨å®ƒã€‚é€šå¸¸ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°_init_weightè¿™ä¸ªå‡½æ•°ï¼Œå¹¶å°†å…¶ä¼ å…¥NDArrayä¿®æ”¹æˆåˆå§‹åŒ–çš„ç»“æœã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInit</span><span class="params">(init.Initializer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_weight</span><span class="params">(self, name, data)</span>:</span></span><br><span class="line">        print(<span class="string">'Init'</span>, name, data.shape)</span><br><span class="line">        data[:] = nd.random.uniform(low=<span class="number">-10</span>, high=<span class="number">10</span>, shape=data.shape)</span><br><span class="line">        data *= data.abs() &gt;= <span class="number">5</span></span><br><span class="line"></span><br><span class="line">net.initialize(MyInit(), force_reinit=<span class="literal">True</span>)</span><br><span class="line">net[<span class="number">0</span>].weight.data()[<span class="number">0</span>]   <span class="comment">#è‡ªå®šä¹‰</span></span><br><span class="line">net[<span class="number">0</span>].weight.initialize(init=init.Xavier(), force_reinit=<span class="literal">True</span>)   <span class="comment">#å®˜æ–¹ init=ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ç”¨Parameterç±»çš„set_dataå‡½æ•°æ¥ç›´æ¥æ”¹å†™æ¨¡å‹å‚æ•°ã€‚ä¾‹å¦‚åœ¨ä¸‹ä¾‹ä¸­æˆ‘ä»¬å°†éšè—å±‚å‚æ•°åœ¨ç°æœ‰çš„åŸºç¡€ä¸ŠåŠ 1.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net[<span class="number">0</span>].weight.set_data(net[<span class="number">0</span>].weight.data() + <span class="number">1</span>)</span><br><span class="line">net[<span class="number">0</span>].weight.data()[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-å…±äº«æ¨¡å‹å‚æ•°"><a href="#4-2-4-å…±äº«æ¨¡å‹å‚æ•°" class="headerlink" title="4.2.4 å…±äº«æ¨¡å‹å‚æ•°"></a>4.2.4 å…±äº«æ¨¡å‹å‚æ•°</h4><p>å…±äº«å‚æ•°ï¼š</p>
<ul>
<li><p>forwardå‡½æ•°é‡Œå¤šæ¬¡è°ƒç”¨åŒä¸ªå±‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FancyMLP</span><span class="params">(nn.Block)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">      super(FancyMLP, self).__init__(**kwargs)</span><br><span class="line">      <span class="comment"># ä½¿ç”¨get_constantåˆ›å»ºçš„éšæœºæƒé‡å‚æ•°ä¸ä¼šåœ¨è®­ç»ƒä¸­è¢«è¿­ä»£ï¼ˆå³å¸¸æ•°å‚æ•°ï¼‰</span></span><br><span class="line">      self.rand_weight = self.params.get_constant(</span><br><span class="line">          <span class="string">'rand_weight'</span>, nd.random.uniform(shape=(<span class="number">20</span>, <span class="number">20</span>)))</span><br><span class="line">      self.dense = nn.Dense(<span class="number">20</span>, activation=<span class="string">'relu'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">      x = self.dense(x)  <span class="comment">#!!</span></span><br><span class="line">      <span class="comment"># ä½¿ç”¨åˆ›å»ºçš„å¸¸æ•°å‚æ•°ï¼Œä»¥åŠNDArrayçš„reluå‡½æ•°å’Œdotå‡½æ•°</span></span><br><span class="line">      x = nd.relu(nd.dot(x, self.rand_weight.data()) + <span class="number">1</span>)  </span><br><span class="line">      <span class="comment"># å¤ç”¨å…¨è¿æ¥å±‚ã€‚ç­‰ä»·äºä¸¤ä¸ªå…¨è¿æ¥å±‚å…±äº«å‚æ•°</span></span><br><span class="line">      x = self.dense(x)   <span class="comment">#!!</span></span><br><span class="line">      <span class="comment"># æ§åˆ¶æµï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦è°ƒç”¨asscalarå‡½æ•°æ¥è¿”å›æ ‡é‡è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">      <span class="keyword">while</span> x.norm().asscalar() &gt; <span class="number">1</span>:</span><br><span class="line">          x /= <span class="number">2</span></span><br><span class="line">      <span class="keyword">if</span> x.norm().asscalar() &lt; <span class="number">0.8</span>:</span><br><span class="line">          x *= <span class="number">10</span></span><br><span class="line">      <span class="keyword">return</span> x.sum()</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œåœ¨æ„é€ å±‚æŒ‡å®šç‰¹å®šçš„å‚æ•°ã€‚å¦‚æœä¸åŒå±‚ä½¿ç”¨åŒä¸€ä»½å‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬åœ¨å‰å‘è®¡ç®—å’Œåå‘ä¼ æ’­æ—¶éƒ½ä¼šå…±äº«ç›¸åŒçš„å‚æ•°ã€‚</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential()</span><br><span class="line">shared = nn.Dense(<span class="number">8</span>, activation=<span class="string">'relu'</span>)</span><br><span class="line">net.add(nn.Dense(<span class="number">8</span>, activation=<span class="string">'relu'</span>),</span><br><span class="line">        shared, <span class="comment"># sharedåœ¨ç¬¬äºŒå±‚å’Œç¬¬ä¸‰å±‚</span></span><br><span class="line">        nn.Dense(<span class="number">8</span>, activation=<span class="string">'relu'</span>, params=shared.params),</span><br><span class="line">        nn.Dense(<span class="number">10</span>))</span><br><span class="line">net.initialize()</span><br><span class="line"></span><br><span class="line">X = nd.random.uniform(shape=(<span class="number">2</span>, <span class="number">20</span>))</span><br><span class="line">net(X)</span><br><span class="line"></span><br><span class="line">net[<span class="number">1</span>].weight.data()[<span class="number">0</span>] == net[<span class="number">2</span>].weight.data()[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>  åœ¨æ„é€ ç¬¬ä¸‰éšè—å±‚æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡paramsæ¥æŒ‡å®šå®ƒä½¿ç”¨ç¬¬äºŒéšè—å±‚çš„å‚æ•°ã€‚å› ä¸ºæ¨¡å‹å‚æ•°åŒ…å«äº†æ¢¯åº¦ï¼Œæ‰€ä»¥åœ¨åå‘ä¼ æ’­è®¡ç®—æ—¶ï¼Œç¬¬äºŒéšè—å±‚å’Œç¬¬ä¸‰éšè—å±‚çš„æ¢¯åº¦éƒ½ä¼šè¢«ç´¯åŠ åœ¨shared.params.grad()é‡Œã€‚</p>
</li>
</ul>
<h3 id="4-3-æ¨¡å‹å‚æ•°çš„å»¶ååˆå§‹åŒ–"><a href="#4-3-æ¨¡å‹å‚æ•°çš„å»¶ååˆå§‹åŒ–" class="headerlink" title="4.3 æ¨¡å‹å‚æ•°çš„å»¶ååˆå§‹åŒ–"></a>4.3 æ¨¡å‹å‚æ•°çš„å»¶ååˆå§‹åŒ–</h3><p>å°±æ˜¯æ¨¡å‹å‚æ•°åˆå§‹åŒ–æœ‰çŒ«è…»<br>ä¹‹å‰netåœ¨è°ƒç”¨åˆå§‹åŒ–å‡½æ•°initializeä¹‹åã€åœ¨åšå‰å‘è®¡ç®—net(X)ä¹‹å‰æ—¶ï¼Œæƒé‡å‚æ•°çš„å½¢çŠ¶æ±‡æ€»å‡ºç°äº†0ã€‚è™½ç„¶ç›´è§‰ä¸Šinitializeå®Œæˆäº†æ‰€æœ‰å‚æ•°åˆå§‹åŒ–è¿‡ç¨‹ï¼Œç„¶è€Œè¿™åœ¨Gluonä¸­å´æ—¶ä¸ä¸€å®šçš„ã€‚è‰ æ²¡äº‹æ‰¾äº‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> init, nd</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInit</span><span class="params">(init.Initializer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_weight</span><span class="params">(self, name, data)</span>:</span></span><br><span class="line">        print(<span class="string">'Init'</span>, name, data.shape)</span><br><span class="line">        <span class="comment"># å®é™…çš„åˆå§‹åŒ–é€»è¾‘åœ¨æ­¤çœç•¥äº†</span></span><br><span class="line"></span><br><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Dense(<span class="number">256</span>, activation=<span class="string">'relu'</span>),</span><br><span class="line">        nn.Dense(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">net.initialize(init=MyInit())   <span class="comment">#é¦–æ¬¡åˆå§‹åŒ–æ²¡æœ‰ åªæœ‰å‰å‘è®¡ç®—ä¸€æ¬¡ æ‰èƒ½æ¨æ–­å‡ºæ¥ å†è¿›è¡Œåˆå§‹åŒ– å¹¶ä¸”è¿™ä¸ªåˆå§‹åŒ–åªä¼šæ‰§è¡Œä¸€æ¬¡ ä¹‹åä¸ä¼š å†åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å»¶ååˆå§‹åŒ–ï¼šç³»ç»Ÿå°†çœŸæ­£çš„å‚æ•°åˆå§‹é˜¿è™å•Šå»¶ååˆ°å¾—åˆ°è¶³å¤Ÿä¿¡æ¯æ—¶æ‰æ‰§è¡Œçš„è¡Œä¸ºã€‚<br>è¿™ä¸ªå»¶ååˆå§‹åŒ–å°±æ˜¯æ–¹ä¾¿ä½  ä¸éœ€è¦æŒ‡å®šè¾“å…¥çš„å¤§å°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­è¾“å…¥çš„å¤§å° åªéœ€è¦ç¡®å®šè¾“å‡ºå³å¯</p>
</blockquote>
<p>é¿å…å»¶ååˆå§‹åŒ–ï¼š</p>
<ol>
<li><p>æˆ‘ä»¬å¯¹å·²åˆå§‹åŒ–çš„æ¨¡å‹é‡æ–°åˆå§‹åŒ–ã€‚å› ä¸ºå‚æ•°å½¢çŠ¶ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥ç³»ç»Ÿèƒ½å¤Ÿç«‹å³è¿›è¡Œé‡æ–°åˆå§‹åŒ–</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.initialize(init=MyInit(), force_reinit=<span class="literal">True</span>) <span class="comment">#å‰é¢å·²ç»åˆå§‹åŒ–è¿‡äº†</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆ‘ä»¬åœ¨åˆ›å»ºå±‚çš„æ—¶å€™åˆ¶å®šäº†å®ƒè¾“å…¥çš„ä¸ªæ•°ï¼Œä½¿ç³»ç»Ÿä¸éœ€è¦é¢å¤–çš„ä¿¡æ¯æ¥æ¨æµ‹å‚æ•°å½¢çŠ¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Dense(<span class="number">256</span>, in_units=<span class="number">20</span>,    activation=<span class="string">'relu'</span>))   <span class="comment">#è¯´æ˜äº† in_units</span></span><br><span class="line">net.add(nn.Dense(<span class="number">10</span>, in_units=<span class="number">256</span>))</span><br><span class="line"></span><br><span class="line">net.initialize(init=MyInit())</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="4-4-è‡ªå®šä¹‰å±‚"><a href="#4-4-è‡ªå®šä¹‰å±‚" class="headerlink" title="4.4 è‡ªå®šä¹‰å±‚"></a>4.4 è‡ªå®šä¹‰å±‚</h3><p>æ·±åº¦å­¦ä¹ çš„é­…åŠ›ä¹‹ä¸€åœ¨äºç¥ç»ç½‘ç»œä¸­å„å¼å„æ ·çš„å±‚ï¼Œä¾‹å¦‚å…¨è¿æ¥å±‚å’Œç¬¬5ç« å’Œç¬¬6ç« ä¸­å°†è¦ä»‹ç»çš„å·ç§¯å±‚ã€æ± åŒ–å±‚ä¸å¾ªç¯å±‚ã€‚è™½ç„¶Gluonæä¾›äº†å¤§é‡ä½¿ç”¨çš„å±‚ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬ä¾ç„¶å¸Œæœ›è‡ªå®šä¹‰å±‚ã€‚æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨NDArrayæ¥è‡ªå®šä¹‰ä¸€ä¸ªGluonçš„å±‚ï¼Œä»è€Œå¯ä»¥è¢«é‡å¤è°ƒç”¨ã€‚</p>
<h4 id="4-4-1-ä¸å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚"><a href="#4-4-1-ä¸å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚" class="headerlink" title="4.4.1 ä¸å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚"></a>4.4.1 ä¸å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚</h4><p>å®ç°ä¸€ä¸ªCenteredLayerç±»é€šè¿‡ç»§æ‰¿Blockç±»è‡ªå®šä¹‰ä¸€ä¸ªå°†è¾“å…¥å‡æ‰å‡å€¼åè¾“å‡ºçš„å±‚ï¼Œå¹¶å°†å±‚çš„è®¡ç®—å®šä¹‰åœ¨forwardå‡½æ•°é‡Œã€‚è¿™ä¸ªå±‚ä¸å«æ¨¡å‹å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> gluon, nd</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CenteredLayer</span><span class="params">(nn.Block)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        super(CenteredLayer, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> x - x.mean()</span><br></pre></td></tr></table></figure>

<h4 id="4-4-2-å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚"><a href="#4-4-2-å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚" class="headerlink" title="4.4.2 å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚"></a>4.4.2 å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚</h4><p>åˆ©ç”¨Parameterç±»å’ŒParameterDictç±»ã€‚åœ¨è‡ªå®šä¹‰å«æ¨¡å‹å‚æ•°çš„å±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Blockç±»è‡ªå¸¦çš„ParameterDictç±»å‹çš„æˆå‘˜å˜é‡paramsã€‚<strong><em>å®ƒæ˜¯ä¸€ä¸ªç”±å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°åå­—æ˜ å°„åˆ°Parameterç±»å‹çš„æ¨¡å‹å‚æ•°çš„å­—å…¸ã€‚</em></strong>ï¼Œé€šè¿‡getå‡½æ•°ä»ParameterDictåˆ›å»ºParameterå®ä¾‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDense</span><span class="params">(nn.Block)</span>:</span></span><br><span class="line">    <span class="comment"># unitsä¸ºè¯¥å±‚çš„è¾“å‡ºä¸ªæ•°ï¼Œin_unitsä¸ºè¯¥å±‚çš„è¾“å…¥ä¸ªæ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, units, in_units, **kwargs)</span>:</span></span><br><span class="line">        super(MyDense, self).__init__(**kwargs)</span><br><span class="line">        self.weight = self.params.get(<span class="string">'weight'</span>, shape=(in_units, units))</span><br><span class="line">        self.bias = self.params.get(<span class="string">'bias'</span>, shape=(units,))  <span class="comment">#self.params.get</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        linear = nd.dot(x, self.weight.data()) + self.bias.data()</span><br><span class="line">        <span class="keyword">return</span> nd.relu(linear)</span><br></pre></td></tr></table></figure>

<h3 id="4-5-è¯»å–å’Œå­˜å‚¨"><a href="#4-5-è¯»å–å’Œå­˜å‚¨" class="headerlink" title="4.5 è¯»å–å’Œå­˜å‚¨"></a>4.5 è¯»å–å’Œå­˜å‚¨</h3><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å¤„ç†æ•°æ®ä»¥åŠå¦‚ä½•æ„å»ºã€è®­ç»ƒå’Œæµ‹è¯•æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚æˆ‘ä»¬æœ‰æ—¶éœ€è¦æŠŠè®­ç»ƒå¥½çš„æ¨¡å‹éƒ¨ç½²åˆ°å¾ˆå¤šä¸åŒçš„è®¾å¤‡ä¸Šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå†…å­˜ä¸­è®­ç»ƒå¥½çš„æ¨¡å‹å‚æ•°å­˜å‚¨åˆ°ç¡¬ç›˜åä¾›åç»­è¯»å–ä½¿ç”¨ã€‚<br>6666 è¿ç§» å®ç”¨</p>
<h4 id="4-5-1-è¯»å†™NDArry"><a href="#4-5-1-è¯»å†™NDArry" class="headerlink" title="4.5.1 è¯»å†™NDArry"></a>4.5.1 è¯»å†™NDArry</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nd.save(<span class="string">'x'</span>, x)   <span class="comment">#çœŸçš„å¤šå‡ºæ¥äº†ğŸ˜‚</span></span><br><span class="line">x2 = nd.load(<span class="string">'x'</span>)</span><br><span class="line"></span><br><span class="line">nd.save(<span class="string">'xy'</span>, [x, y])</span><br><span class="line">x2, y2 = nd.load(<span class="string">'xy'</span>) <span class="comment">#å­˜å‚¨ä¸€åˆ—NDArrayå¹¶è¯»å›å†…å­˜ã€‚</span></span><br><span class="line"></span><br><span class="line">nd.save(<span class="string">'mydict'</span>, mydict)</span><br><span class="line">mydict2 = nd.load(<span class="string">'mydict'</span>) <span class="comment">#å­˜å‚¨å¹¶è¯»å–ä¸€ä¸ªä»å­—ç¬¦ä¸²æ˜ å°„åˆ°NDArrayçš„å­—å…¸ã€‚</span></span><br></pre></td></tr></table></figure>

<p>easy</p>
<h4 id="4-5-2-è¯»å†™Gluonæ¨¡å‹çš„å‚æ•°"><a href="#4-5-2-è¯»å†™Gluonæ¨¡å‹çš„å‚æ•°" class="headerlink" title="4.5.2 è¯»å†™Gluonæ¨¡å‹çš„å‚æ•°"></a>4.5.2 è¯»å†™Gluonæ¨¡å‹çš„å‚æ•°</h4><p>è¿˜å¯ä»¥è¯»å†™Gluonæ¨¡å‹çš„å‚æ•°ã€‚Gluonçš„Blockç±»æä¾›äº†save_parameterså‡½æ•°å’Œload_parameterså‡½æ•°æ¥è¯»å†™æ¨¡å‹å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="string">'mlp.params'</span></span><br><span class="line">net.save_parameters(filename) <span class="comment">#666 ç”¨çš„æ—¶å€™ä¸ä¼šå†æŸ¥</span></span><br></pre></td></tr></table></figure>

<h3 id="4-6-GPUè®¡ç®—"><a href="#4-6-GPUè®¡ç®—" class="headerlink" title="4.6 GPUè®¡ç®—"></a>4.6 GPUè®¡ç®—</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½åœ¨ç”¨CPUä¹ä¸‰ï¼Œè¦é«˜æ•ˆå¿…é¡»ä½¿ç”¨GPUï¼Œæœ¬èŠ‚ä¸­ï¼Œä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨å•å—çš„NVIDIA GPUæ¥è®¡ç®—ã€‚<br>é¦–å…ˆï¼Œç¡®ä¿å·²ç»å®‰è£…äº†è‡³å°‘ä¸€å—NVIDIA GPUã€‚<br>ç„¶åï¼Œä¸‹è½½CUDAå¹¶æŒ‰ç…§æç¤ºè®¾ç½®å¥½ç›¸åº”è·¯å¾„ï¼ˆé™„å½•Cï¼‰<br>ğŸ˜‚æ²¡æœ‰GPU<br>å®‰è‘¬å¥½äº†ç”¨<code>!nvidia-smi</code>æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯<br>ç•¥ ä¹‹åéœ€è¦å†çœ‹ğŸ˜“</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = nd.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], ctx=mx.gpu())   <span class="comment">#æ²¡æœ‰gpuğŸ˜‚ æŒ‡å®šåˆ°gpu</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#copytoå‡½æ•°è®©å˜é‡åœ¨è®¾å¤‡ä¹‹é—´ä¼ é€’ï¼Œä¸‹é¢å°†å†…å­˜ä¸Šçš„NDArrayå˜é‡xå¤åˆ¶åˆ°gpu(0)ä¸Š</span></span><br><span class="line"><span class="comment">#copytoå‡½æ•°æ€»æ˜¯ä¸ºç›®æ ‡å˜é‡å¼€æ–°çš„å†…å­˜æˆ–æ˜¾å­˜</span></span><br><span class="line">y = x.copyto(mx.gpu())</span><br><span class="line">y.copyto(mx.gpu()) <span class="keyword">is</span> y   <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæºå˜é‡å’Œç›®æ ‡å˜é‡çš„contextä¸€è‡´ï¼Œas_in_contextå‡½æ•°ä½¿ç›®æ ‡å˜é‡å’Œæºå˜é‡å…±äº«æºå˜é‡çš„å†…å†…å­˜æˆ–æ˜¾å­˜ã€‚</span></span><br><span class="line">z = x.as_in_context(mx.gpu())</span><br><span class="line">y.as_in_context(mx.gpu()) <span class="keyword">is</span> y <span class="comment"># True</span></span><br></pre></td></tr></table></figure>

<p>MXNetè¦æ±‚è®¡ç®—çš„æ‰€æœ‰è¾“å…¥æ•°æ®éƒ½åœ¨å†…å­˜æˆ–ç»Ÿä¸€æ˜¾å¡çš„æ˜¾å­˜ä¸Šã€‚è¿™æ ·è®¾è®¡çš„åŸå› æ˜¯CPUå’Œä¸åŒçš„GPUä¹‹é—´çš„æ•°æ®äº¤äº’é€šå¸¸æ¯”è¾ƒè€—æ—¶ã€‚</p>
<h2 id="ç¬¬5ç« -å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#ç¬¬5ç« -å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¬¬5ç«  å·ç§¯ç¥ç»ç½‘ç»œ"></a>ç¬¬5ç«  å·ç§¯ç¥ç»ç½‘ç»œ</h2><p><img src="/2020/01/22/dive-into-deep-learning/cnn.png" alt="å·ç§¯ç¥ç»ç½‘ç»œ"><br>å“¦è±ï¼ æˆ‘å­¦è¿‡ğŸ˜‚ ä½ å·²ç»èµ¢è¿‡è¿™åœºæˆ˜æ–—å•¦ï¼Œ å†æ¥ä¸€éæ‰¾ç‚¹ä¹å­å§ï¼<br>æˆ‘å» çœŸçš„å¤šğŸ˜“<br>è¿™å‡ å¹´å–å¾—çªç ´æ€§æˆå°±çš„åŸºçŸ³ï¼Œ</p>
<ol>
<li>å…ˆä»‹ç»å·ç§¯ç¥ç»ç½‘ç»œä¸­å·ç§¯å±‚å’Œæ± åŒ–å±‚çš„å·¥ä½œåŸç†</li>
<li>è§£é‡Šå¡«å……ã€æ­¥å¹…ã€è¾“å…¥é€šé“å’Œè¾“å‡ºé€šé“çš„å«ä¹‰ã€‚</li>
<li>æ¢ç©¶æ•°ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œçš„è®¾è®¡æ€è·¯<ul>
<li>AlexNET</li>
<li>NiN</li>
<li>GoogLeNet</li>
<li>ResNet</li>
<li>DenseNet</li>
</ul>
</li>
<li>è™½ç„¶æ·±åº¦æ¨¡å‹çœ‹ä¸Šå»åªæ˜¯å…·æœ‰å¾ˆå¤šå±‚çš„ç¥ç»ç½‘ç»œï¼Œç„¶è€Œè·å¾—æœ‰æ•ˆçš„æ·±åº¦æ¨¡å‹å¹¶ä¸å®¹æ˜“ã€‚æœ‰å¹¸çš„æ˜¯ï¼Œæœ¬ç« é˜è¿°çš„<strong>æ‰¹é‡å½’ä¸€åŒ–</strong>å’Œ<strong>æ®‹å·®ç½‘ç»œ</strong>ä¸ºè®­ç»ƒå’Œè®¾è®¡æ·±åº¦æ¨¡å‹æä¾›äº†ä¸¤ç±»é‡è¦æ€è·¯ã€‚<h3 id="5-1-äºŒç»´å·ç§¯å±‚"><a href="#5-1-äºŒç»´å·ç§¯å±‚" class="headerlink" title="5.1 äºŒç»´å·ç§¯å±‚"></a>5.1 äºŒç»´å·ç§¯å±‚</h3>å·ç§¯ç¥ç»ç½‘ç»œæ˜¯å«æœ‰å·ç§¯å±‚çš„ç¥ç»ç½‘ç»œã€‚æœ¬ç« ä¸­ä»‹ç»çš„å·ç§¯ç¥ç»ç½‘ç»œå‡ä½¿ç”¨æœ€å¸¸è§çš„äºŒç»´å·ç§¯å±‚ï¼Œå…·æœ‰é«˜å’Œå®½ä¸¤ä¸ªç»´åº¦å¸¸ç”¨æ¥å¤„ç†å›¾åƒæ•°æ®ã€‚<br>æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ç®€å•å½¢å¼çš„äºŒç»´å·ç§¯å±‚çš„å·¥ä½œåŸç†ã€‚<h4 id="5-1-1-äºŒç»´äº’ç›¸å…³è¿ç®—"><a href="#5-1-1-äºŒç»´äº’ç›¸å…³è¿ç®—" class="headerlink" title="5.1.1 äºŒç»´äº’ç›¸å…³è¿ç®—"></a>5.1.1 äºŒç»´äº’ç›¸å…³è¿ç®—</h4>è™½ç„¶å·ç§¯å±‚å¾—åäºå·ç§¯è¿ç®—ï¼Œä½†æˆ‘ä»¬é€šå¸¸åœ¨å·ç§¯å±‚ä¸­ä½¿ç”¨æ›´åŠ ç›´è§‚çš„äº’ç›¸å…³è¿ç®—ã€‚</li>
</ol>
<ul>
<li>å·ç§¯è¿ç®—</li>
<li>äº’ç›¸å…³è¿ç®—ï¼šåœ¨äºŒç»´å·ç§¯å±‚ä¸­ï¼Œä¸€ä¸ªäºŒç»´è¾“å…¥æ•°ç»„å’Œä¸€ä¸ªäºŒç»´æ ¸æ•°ç»„ï¼ˆå·ç§¯æ ¸æˆ–è¿‡æ»¤å™¨ï¼‰é€šè¿‡äº’ç›¸å…³è¿ç®—è¾“å‡ºä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚<br>å·ç§¯æ ¸çª—å£ï¼ˆåˆç§°å·ç§¯çª—å£ï¼‰çš„å½¢çŠ¶å–å†³äºå·ç§¯æ ¸çš„é«˜å’Œå®½ã€‚<br><img src="/2020/01/22/dive-into-deep-learning/conv.png" alt="conv"></li>
</ul>
<p>è‡ªå·±çœ‹å›¾è´¼å¥½ç†è§£ã€‚<br>ä»£ç å®ç°åœ¨corr2då‡½æ•°é‡Œã€‚å®ƒæ¥å—è¾“å…¥æ•°ç»„Xä¸æ ¸æ•°ç»„Kï¼Œå¹¶è¾“å‡ºæ•°ç»„Yã€‚</p>
<h4 id="5-1-2-äºŒç»´å·ç§¯å±‚"><a href="#5-1-2-äºŒç»´å·ç§¯å±‚" class="headerlink" title="5.1.2 äºŒç»´å·ç§¯å±‚"></a>5.1.2 äºŒç»´å·ç§¯å±‚</h4><p>æ˜¯å‰é¢äº’ç›¸å…³è¿ç®—æ·±åŒ–ï¼š<br>äºŒç»´å·ç§¯å±‚å°†è¾“å…¥å’Œå·ç§¯åšäº’ç›¸å…³è¿ç®—ï¼Œå¹¶åŠ ä¸Šä¸€ä¸ªæ ‡é‡åå·®æ¥å¾—åˆ°è¾“å‡ºã€‚å¹¶åœ¨è®­ç»ƒæ¨¡å‹çš„æ—¶å€™ï¼Œå…ˆå¯¹å·ç§¯æ ¸åšéšæœºåˆå§‹åŒ–ã€‚ç„¶åä¸æ–­è¿­ä»£å·ç§¯æ ¸ï¼ˆæƒé‡ï¼‰å’Œåå·®ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Conv2D</span><span class="params">(nn.Block)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, kernel_size, **kwargs)</span>:</span></span><br><span class="line">        super(Conv2D, self).__init__(**kwargs)</span><br><span class="line">        self.weight = self.params.get(<span class="string">'weight'</span>, shape=kernel_size)</span><br><span class="line">        self.bias = self.params.get(<span class="string">'bias'</span>, shape=(<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> corr2d(x, self.weight.data()) + self.bias.data()</span><br></pre></td></tr></table></figure>

<h4 id="5-1-3-å›¾åƒä¸­ç‰©ä½“è¾¹ç¼˜æ£€æµ‹"><a href="#5-1-3-å›¾åƒä¸­ç‰©ä½“è¾¹ç¼˜æ£€æµ‹" class="headerlink" title="5.1.3 å›¾åƒä¸­ç‰©ä½“è¾¹ç¼˜æ£€æµ‹"></a>5.1.3 å›¾åƒä¸­ç‰©ä½“è¾¹ç¼˜æ£€æµ‹</h4><p>è¯´æ˜äº†å·ç§¯å±‚å¯é€šè¿‡é‡å¤ä½¿ç”¨å·ç§¯æ ¸æœ‰æ•ˆåœ°è¡¨å¾å±€éƒ¨ç©ºé—´ easy</p>
<h4 id="5-1-4-é€šè¿‡æ•°æ®å­¦ä¹ æ ¸æ•°ç»„"><a href="#5-1-4-é€šè¿‡æ•°æ®å­¦ä¹ æ ¸æ•°ç»„" class="headerlink" title="5.1.4 é€šè¿‡æ•°æ®å­¦ä¹ æ ¸æ•°ç»„"></a>5.1.4 é€šè¿‡æ•°æ®å­¦ä¹ æ ¸æ•°ç»„</h4><p>å‰é¢çš„å·ç§¯æ ¸æ˜¯æˆ‘ä»¬è‡ªå·±æƒ³çš„ï¼Œä¹Ÿå¯ä»¥æ¥è¿­ä»£è®­ç»ƒæˆ‘ä»¬çš„å·ç§¯æ ¸å‚æ•°ï¼š<br>é¦–å…ˆæ„é€ ä¸€ä¸ªå·ç§¯å±‚ï¼Œå°†å…¶å·ç§¯æ ¸åˆå§‹åŒ–æˆéšæœºæ•°ç»„ã€‚æ¥ä¸‹æ¥åœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¹³æ–¹è¯¯å·®æ¥æ¯”è¾ƒYå’Œå·ç§¯å±‚çš„è¾“å‡ºï¼Œç„¶åè®¡ç®—æ¢¯åº¦æ¥æ›´æ–°æƒé‡ã€‚ç®€å•èµ·è§ï¼Œè¿™é‡Œçš„å·ç§¯å±‚å¿½ç•¥åå·®ã€‚</p>
<h4 id="5-1-5-äº’ç›¸å…³è¿ç®—å’Œå·ç§¯è¿ç®—"><a href="#5-1-5-äº’ç›¸å…³è¿ç®—å’Œå·ç§¯è¿ç®—" class="headerlink" title="5.1.5 äº’ç›¸å…³è¿ç®—å’Œå·ç§¯è¿ç®—"></a>5.1.5 äº’ç›¸å…³è¿ç®—å’Œå·ç§¯è¿ç®—</h4><p>äº’ç›¸å…³è¿ç®—å’Œå·ç§¯è¿ç®—ç±»ä¼¼ã€‚ä¸ºäº†å¾—åˆ°å·ç§¯è¿ç®—çš„è¾“å‡ºï¼Œæˆ‘ä¹ˆåªéœ€è¦å°†æ ¸æ•°ç»„å·¦å³ç¿»è½¬å¹¶ä¸Šä¸‹ç¿»è½¬ï¼Œå†ä¸è¾“å…¥æ•°ç»„åšäº’ç›¸å…³è¿ç®—ã€‚å¯è§ï¼Œå·ç§¯è¿ç®—å’Œäº’ç›¸å…³è¿ç®—è¿ç®—è™½ç„¶ç±»ä¼¼ï¼Œä½†å¦‚æœå®ƒä»¬ä½¿ç”¨ç›¸åŒçš„æ ¸æ•°ç»„ï¼Œå¯¹äºåŒä¸€ä¸ªè¾“å…¥ï¼Œè¾“å‡ºå¹¶ä¸ç›¸åŒã€‚<br>ä½†æ˜¯å·ç§¯å±‚å¯ä»¥ç”¨äº’ç›¸å…³è¿ç®—æ›¿ä»£å·ç§¯è¿ç®—ï¼Œå› ä¸ºæ·±åº¦å­¦ä¹ ä¸­æ ¸æ•°ç»„çš„å‚æ•°éƒ½æ˜¯å­¦ä¹ å‡ºæ¥çš„ï¼Œä¸¤ç§è¿ç®—ä¸å½±å“ã€‚ä¸ºäº†ä¸å¤§å¤šæ•°æ–‡çŒ®ä¸€è‡´ï¼Œå¦‚æ— ç‰¹åˆ«è¯´æ˜ï¼Œæœ¬ä¹¦ä¸­æåˆ°çš„å·ç§¯è¿ç®—å‡æŒ‡äº’ç›¸å…³è¿ç®—ã€‚</p>
<h4 id="5-1-6-ç‰¹å¾å›¾å’Œæ„Ÿå—é‡"><a href="#5-1-6-ç‰¹å¾å›¾å’Œæ„Ÿå—é‡" class="headerlink" title="5.1.6 ç‰¹å¾å›¾å’Œæ„Ÿå—é‡"></a>5.1.6 ç‰¹å¾å›¾å’Œæ„Ÿå—é‡</h4><ul>
<li>ç‰¹å¾å›¾ï¼šå°±æ˜¯äºŒç»´å·ç§¯å±‚è¾“å‡ºçš„äºŒç»´æ•°ç»„ï¼ˆå¯ä»¥çœ‹ä½œè¾“å…¥åœ¨ç©ºé—´ç»´åº¦ï¼ˆå®½å’Œé«˜ï¼‰ä¸ŠæŸä¸€çº§çš„è¡¨å¾ï¼‰</li>
<li>æ„Ÿå—é‡ï¼šå½±å“å…ƒç´ xçš„å‰å‘è®¡ç®—çš„æ‰€æœ‰å¯èƒ½è¾“å…¥åŒºåŸŸï¼ˆå¯èƒ½å¤§äºè¾“å…¥çš„å®é™…å°ºå¯¸ï¼‰<br>å¯ä»¥ä½¿ç”¨æ›´æ·±çš„å·ç§¯ç¥ç»ç½‘ç»œä½¿ç‰¹å¾å›¾ä¸­å•ä¸ªå…ƒç´ çš„æ„Ÿå—é‡å˜å¾—æ›´åŠ å¹¿é˜”ï¼Œä»è€Œæ•æ‰è¾“å…¥ä¸Šæ›´å¤§å°ºå¯¸çš„ç‰¹å¾ã€‚666ï¼</li>
</ul>
<p>æˆ‘ä»¬å¸¸ä½¿ç”¨â€œå…ƒç´ â€ä¸€æ¬¡æ¥æè¿°æ•°ç»„æˆ–çŸ©é˜µä¸­çš„æˆå‘˜ã€‚åœ¨ç¥ç»ç½‘ç»œçš„æœ¯è¯­ä¸­ï¼Œè¿™äº›å…ƒç´ ä¹Ÿå¯ä»¥è¢«ç§°ä¸ºâ€œå•å…ƒâ€ã€‚å½“å«ä¹‰æ˜ç¡®æ—¶ï¼Œæœ¬ä¹¦ä¸å¯¹è¿™ä¸¤ä¸ªæœ¯è¯­åšä¸¥æ ¼åŒºåˆ†ã€‚</p>
<h3 id="5-2-å¡«å……å’Œæ­¥å¹…"><a href="#5-2-å¡«å……å’Œæ­¥å¹…" class="headerlink" title="5.2 å¡«å……å’Œæ­¥å¹…"></a>5.2 å¡«å……å’Œæ­¥å¹…</h3><p>åœ¨å‰é¢çš„ä¾‹å­é‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨å®½é«˜ä¸º3çš„è¾“å…¥ä¸å®½é«˜ä¸º2çš„å·ç§¯æ ¸å¾—åˆ°å®½é«˜ä¸º2çš„è¾“å‡ºã€‚ä¸€èˆ¬è¾“å…¥nhxnw,å·ç§¯æ ¸çª—å£å½¢çŠ¶æ˜¯khxkwï¼Œé‚£ä¹ˆè¾“å‡ºå½¢çŠ¶å°†ä¼šæ˜¯$(n_h-k_h+1) \times (n_w-k_w+1).$ã€‚æ‰€ä»¥å·ç§¯å±‚çš„è¾“å‡ºå½¢çŠ¶ç”±è¾“å…¥å½¢çŠ¶å’Œå·ç§¯æ ¸çª—å£å½¢çŠ¶å†³å®šã€‚æœ¬èŠ‚æˆ‘ä»¬å°†ä»‹ç»å·ç§¯å±‚çš„ä¸¤ä¸ªè¶…å‚æ•°ï¼Œå³å¡«å……å’Œæ­¥å¹…ã€‚ä»–ä»¬å¯ä»¥ç»™å®šå½¢çŠ¶çš„è¾“å…¥å’Œå·ç§¯æ ¸æ”¹å˜è¾“å‡ºå½¢çŠ¶ã€‚</p>
<h4 id="5-2-1-å¡«å……"><a href="#5-2-1-å¡«å……" class="headerlink" title="5.2.1 å¡«å……"></a>5.2.1 å¡«å……</h4><blockquote>
<p><strong>å¡«å……</strong>æ˜¯æŒ‡åœ¨è¾“å…¥é«˜å’Œå®½çš„ä¸¤ä¾§å¡«å……å…ƒç´ ï¼ˆé€šå¸¸æ˜¯0å…ƒç´ ï¼‰ã€‚</p>
</blockquote>
<p>ä¾‹å­åœ¨è¾“å…¥å®½å’Œé«˜çš„ä¸¤ä¾§åˆ†åˆ«æ·»åŠ å€¼ä¸º0çš„å…ƒç´ ï¼Œä½¿è¾“å…¥é«˜å’Œå®½ä»3å˜æˆäº†5ï¼Œå¹¶å¯¼è‡´è¾“å‡ºé«˜å’Œå®½ç”±2å¢åŠ åˆ°4.å›¾ä¸­çš„é˜´å½±éƒ¨åˆ†ä¸ºç¬¬ä¸€ä¸ªè¾“å‡ºå…ƒç´ æœºå™¨è®¡ç®—æ‰€ä½¿ç”¨çš„è¾“å…¥å’Œæ ¸æ•°ç»„å…ƒç´ ã€‚<br>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœé«˜çš„ä¸¤ä¾§ä¸€å…±å¡«å……phè¡Œï¼Œåœ¨å®½çš„ä¸¤ä¾§ä¸€å…±å¡«å……pwåˆ—ï¼Œé‚£ä¹ˆè¾“å‡ºå½¢çŠ¶å°†ä¼šæ˜¯ï¼š(nh-kh+ph+1)x(nw-kw+pw+1)ä¹Ÿå°±æ˜¯è¯´ï¼Œè¾“å‡ºçš„é«˜å’Œå®½ä¼šåˆ†åˆ«å¢åŠ phå’Œpwã€‚<br>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®ph=kh-1å’Œpw=kw-1æ¥ä½¿è¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜å’Œå®½ã€‚è¿™æ ·æ‰æ–¹ä¾¿åœ¨æ„é€ ç½‘ç»œæ—¶æ¨æµ‹æ¯ä¸ªå±‚çš„è¾“å‡ºå½¢çŠ¶ã€‚<br>å·ç§¯ç¥ç»ç½‘ç»œç»å¸¸ä½¿ç”¨å¥‡æ•°é«˜å’Œå®½çš„å·ç§¯æ ¸ï¼Œå¦‚1ã€3ã€5å’Œ7ï¼Œæ‰€ä»¥ä¸¤ç«¯ä¸Šçš„å¡«å……ä¸ªæ•°ç›¸ç­‰ã€‚<br>å½“å·ç§¯æ ¸çš„é«˜å’Œå®½ä¸åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®é«˜å’Œå®½ä¸Šä¸åŒçš„å¡«å……æ•°ä½¿è¾“å‡ºå’Œè¾“å…¥å…·æœ‰ä¸ç›¸åŒçš„é«˜å’Œå®½ã€‚</p>
<h4 id="5-2-2-æ­¥å¹…"><a href="#5-2-2-æ­¥å¹…" class="headerlink" title="5.2.2 æ­¥å¹…"></a>5.2.2 æ­¥å¹…</h4><blockquote>
<p>æˆ‘ä»¬å°†æ¯æ¬¡æ»‘åŠ¨çš„è¡Œæ•°å’Œåˆ—æ•°ç§°ä¸ºæ­¥å¹…ã€‚</p>
</blockquote>
<p>æœ‰äº›æ ¹æ®å•¥æ­¥å¹…æ¥è®¡ç®—çš„å…¬å¼åŠ ä¸Šè¾“å…¥æ¥è®¡ç®—è¾“å‡ºè‡ªå·±çœ‹å§ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢æˆ‘ä»¬ä»¤é«˜å’Œå®½ä¸Šçš„æ­¥å¹…å‡ä¸º2ï¼Œä»è€Œä½¿è¾“å…¥çš„é«˜å’Œå®½å‡åŠã€‚</span></span><br><span class="line">conv2d = nn.Conv2D(<span class="number">1</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, strides=<span class="number">2</span>)</span><br><span class="line">comp_conv2d(conv2d, X).shape</span><br></pre></td></tr></table></figure>

<p>å¤æ‚ä¸€ç‚¹ï¼Œé­”é¬¼çš„æ­¥ä¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conv2d = nn.Conv2D(<span class="number">1</span>, kernel_size=(<span class="number">3</span>, <span class="number">5</span>), padding=(<span class="number">0</span>, <span class="number">1</span>), strides=(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">comp_conv2d(conv2d, X).shape</span><br></pre></td></tr></table></figure>

<p>å¡«å……æ•°ï¼š(ph, pw)ã€‚æ­¥å¹…æ•°ï¼š(sh, sw)<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¡«å……ä¸º0ï¼Œæ­¥å¹…ä¸º1ã€‚</p>
<p>**<br>å¡«å……å¯ä»¥å¢åŠ è¾“å‡ºçš„é«˜å’Œå®½ã€‚å¸¸ç”¨æ¥ä½¿è¾“å‡ºä¸è¾“å…¥å…·æœ‰ç›¸åŒçš„é«˜å’Œå®½ã€‚<br>æ­¥å¹…å¯ä»¥å‡å°‘è¾“å‡ºçš„é«˜å’Œå®½ï¼Œä¾‹å¦‚è¾“å‡ºçš„é«˜å’Œå®½ä»…ä¸ºè¾“å…¥çš„é«˜å’Œå®½çš„1/nã€‚<br>**</p>
<h3 id="5-3-å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“"><a href="#5-3-å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“" class="headerlink" title="5.3 å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“"></a>5.3 å¤šè¾“å…¥é€šé“å’Œå¤šè¾“å‡ºé€šé“</h3><p>ä¹‹å‰ç ”ç©¶éƒ½æ˜¯äºŒç»´æ•°ç»„ï¼Œä½†çœŸå®åˆRGBä¸‰ä¸ªé€šé“ã€‚æœ¬èŠ‚ä»‹ç»å«å¤šä¸ªè¾“å…¥é€šé“å’Œå¤šä¸ªè¾“å‡ºé€šé“çš„å·ç§¯æ ¸ã€‚</p>
<h4 id="5-3-1-å¤šè¾“å…¥é€šé“"><a href="#5-3-1-å¤šè¾“å…¥é€šé“" class="headerlink" title="5.3.1 å¤šè¾“å…¥é€šé“"></a>5.3.1 å¤šè¾“å…¥é€šé“</h4><p>å½“è¾“å…¥æ•°æ®å«å¤šä¸ªé€šé“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªè¾“å…¥é€šé“æ•°ä¸è¾“å…¥æ•°æ®çš„é€šé“æ•°ç›¸åŒçš„å·ç§¯æ ¸ï¼Œä»è€Œèƒ½å¤Ÿä¸å«å¤šé€šé“çš„è¾“å…¥æ•°æ®åšäº’ç›¸å…³è¿ç®—ã€‚<br>ä¾‹å­æ—¶å•è¾“å‡ºé€šé“ï¼Œå¯ä»¥é€šè¿‡add_nå‡½æ•°ï¼Œå¯¹æ¯ä¸ªé€šé“åšäº’ç›¸å…³è¿ç®—ï¼Œç„¶åé€šè¿‡add_nå‡½æ•°æ¥è¿›è¡Œç´¯åŠ ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> d2lzh <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> nd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">corr2d_multi_in</span><span class="params">(X, K)</span>:</span></span><br><span class="line">    <span class="comment"># é¦–å…ˆæ²¿ç€Xå’ŒKçš„ç¬¬0ç»´ï¼ˆé€šé“ç»´ï¼‰éå†ã€‚ç„¶åä½¿ç”¨*å°†ç»“æœåˆ—è¡¨å˜æˆadd_nå‡½æ•°çš„ä½ç½®å‚æ•°</span></span><br><span class="line">    <span class="comment"># ï¼ˆpositional argumentï¼‰æ¥è¿›è¡Œç›¸åŠ </span></span><br><span class="line">    <span class="keyword">return</span> nd.add_n(*[d2l.corr2d(x, k) <span class="keyword">for</span> x, k <span class="keyword">in</span> zip(X, K)])</span><br><span class="line"></span><br><span class="line">X = nd.array([[[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]],</span><br><span class="line">              [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]]])</span><br><span class="line">K = nd.array([[[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>]], [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]]])</span><br><span class="line"></span><br><span class="line">corr2d_multi_in(X, K)</span><br></pre></td></tr></table></figure>

<h4 id="5-3-2-å¤šè¾“å‡ºé€šé“"><a href="#5-3-2-å¤šè¾“å‡ºé€šé“" class="headerlink" title="5.3.2 å¤šè¾“å‡ºé€šé“"></a>5.3.2 å¤šè¾“å‡ºé€šé“</h4><p>ä¿®æ”¹å·ç§¯æ ¸è®©å½¢çŠ¶ä¸ºï¼šc0xcixkhxkwï¼Œåœ¨åšäº’ç›¸å…³è¿ç®—æ—¶ï¼Œæ¯ä¸ªè¾“å‡ºé€šé“ä¸Šçš„ç»“æ„ç”±å·ç§¯æ ¸åœ¨è¯¥è¾“å‡ºé€šé“ä¸Šçš„æ ¸æ•°ç»„ä¸æ•´ä¸ªè¾“å…¥æ•°ç»„è®¡ç®—è€Œæ¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">K = nd.stack(K, K + <span class="number">1</span>, K + <span class="number">2</span>)</span><br><span class="line">K.shape</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">corr2d_multi_in_out</span><span class="params">(X, K)</span>:</span></span><br><span class="line">    <span class="comment"># å¯¹Kçš„ç¬¬0ç»´éå†ï¼Œæ¯æ¬¡åŒè¾“å…¥Xåšäº’ç›¸å…³è®¡ç®—ã€‚æ‰€æœ‰ç»“æœä½¿ç”¨stackå‡½æ•°åˆå¹¶åœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="keyword">return</span> nd.stack(*[corr2d_multi_in(X, k) <span class="keyword">for</span> k <span class="keyword">in</span> K])</span><br></pre></td></tr></table></figure>

<h4 id="5-3-3-1-x-1-å·ç§¯å±‚"><a href="#5-3-3-1-x-1-å·ç§¯å±‚" class="headerlink" title="5.3.3 1 x 1 å·ç§¯å±‚"></a>5.3.3 1 x 1 å·ç§¯å±‚</h4><p>æœ€åè®¨è®ºå·ç§¯çª—å£å½¢çŠ¶ä¸º1x1çš„å¤šé€šé“å·ç§¯å±‚ã€‚å› ä¸ºä½¿ç”¨äº†æœ€å°çª—å£ï¼Œ1x1å·ç§¯å¤±å»äº†å·ç§¯å±‚å¯ä»¥è¯†åˆ«å®½å’Œé«˜ç»´åº¦ä¸Šç›¸é‚»å…ƒç´ ç‹—å±‚çš„æ¨¡å¼çš„åŠŸèƒ½ã€‚å®é™…ä¸Š1x1å·ç§¯æ ¸çš„ä¸»è¦è®¡ç®—å‘ç”Ÿåœ¨é€šé“ç»´ä¸Šã€‚<br>çœ‹ä¸æ‡‚ï¼Œä¸è¯´äººè¯ï¼Œå¤§æ¦‚ï¼š<br>å‡è®¾æˆ‘ä»¬å°†é€šé“ç»´å½“ç‰¹å¾ç»´ï¼Œå°†é«˜å’Œå®½ç»´åº¦ä¸Šçš„å…ƒç´ å½“æˆæ•°æ®æ ·æœ¬ï¼Œé‚£ä¹ˆ1x1å·ç§¯å±‚çš„ä½œç”¨ä¸å…¨é“¾æ¥å±‚ç­‰ä»·ã€‚<br><strong><em>ä½œç”¨ï¼šåœ¨ä¹‹åçš„æ¨¡å‹é‡Œæˆ‘ä»¬å°†çœ‹åˆ°1x1å·ç§¯å±‚è¢«å½“ä½œä¿æŒé«˜å’Œå®½ç»´åº¦å½¢çŠ¶ä¸å˜çš„å…¨è¿æ¥å±‚ä½¿ç”¨ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´ç½‘ç»œå±‚ä¹‹é—´çš„é€šé“æ•°æ¥æ§åˆ¶æ¨¡å‹å¤æ‚åº¦</em></strong></p>
<h3 id="5-4-æ± åŒ–å±‚"><a href="#5-4-æ± åŒ–å±‚" class="headerlink" title="5.4 æ± åŒ–å±‚"></a>5.4 æ± åŒ–å±‚</h3><p>ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨è¾¹ç¼˜æ£€æµ‹çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬æ„é€ å·ç§¯æ ¸ä»è€Œç²¾ç¡®åœ°æ‰¾åˆ°äº†åƒç´ å˜åŒ–çš„ä½ç½®ã€‚<br>ä½†å®é™…é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„ç‰©ä½“ä¸ä¼šæ€»å‡ºç°åœ¨å›ºå®šä½ç½®ï¼šå³ä½¿æˆ‘ä»¬è¿ç»­æ‹æ‘„åŒä¸€ä¸ªç‰©ä½“ä¹Ÿææœ‰å¯èƒ½å‡ºç°åƒç´ ä½ç½®ä¸Šçš„åç§»ã€‚è¿™ä¼šå¯¼è‡´åŒä¸€ä¸ªè¾¹ç¼˜å¯¹åº”çš„è¾“å‡ºå¯èƒ½åœ¨å‡ºç°åœ¨å·ç§¯å±‚è¾“å‡ºYä¸­çš„ä¸åŒä½ç½®ï¼Œè¿›è€Œå¯¹åé¢çš„æ¨¡å¼è¯†åˆ«é€ æˆäº†ä¸ä¾¿ã€‚<br>æœ¬èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»æ± åŒ–å±‚ï¼Œå®ƒçš„æå‡ºæ˜¯ä¸ºäº†ç¼“è§£å·ç§¯å±‚å¯¹ä½ç½®çš„è¿‡åº¦æ•æ„Ÿæ€§ã€‚</p>
<h4 id="5-4-1-äºŒç»´æœ€å¤§æ± åŒ–å±‚å¹³å‡æ± åŒ–å±‚"><a href="#5-4-1-äºŒç»´æœ€å¤§æ± åŒ–å±‚å¹³å‡æ± åŒ–å±‚" class="headerlink" title="5.4.1 äºŒç»´æœ€å¤§æ± åŒ–å±‚å¹³å‡æ± åŒ–å±‚"></a>5.4.1 äºŒç»´æœ€å¤§æ± åŒ–å±‚å¹³å‡æ± åŒ–å±‚</h4><p>çœŸ6666ï¼Œåœ¨å·ç§¯å±‚åé¢æ¥ä¸€ä¸ªæ± åŒ–å±‚ï¼Œå½“å·ç§¯å±‚åƒç´ æœ‰æµ®åŠ¨å˜åŒ–ä¹Ÿèƒ½æ£€æµ‹å‡ºæ¥ï¼Œå¤ª6äº†ã€‚<br>è®¾å·ç§¯å±‚è¾“å…¥æ˜¯Xã€æ± åŒ–å±‚ï¼ˆæœ€å¤§æ± åŒ–å±‚ï¼‰è¾“å‡ºä¸ºYã€‚æ— è®ºæ˜¯X[i, j]å’ŒX[i, j+1]å€¼ä¸åŒè¿˜æ˜¯X[i, j+1]å’ŒX[i, j+2]ä¸åŒï¼Œæ± åŒ–å±‚è¾“å‡ºå‡æœ‰Y[i, j]=1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨2x2æœ€å¤§æ± åŒ–å±‚æ—¶ï¼Œåªè¦å·ç§¯å±‚è¯†åˆ«çš„æ¨¡å¼åœ¨é«˜å’Œå®½ä¸Šç§»åŠ¨ä¸è¶…è¿‡ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥å°†å®ƒæ£€æµ‹å‡ºæ¥ã€‚<br>å®ç°ä¸å·ç§¯å±‚å·®ä¸å¤šï¼Œåªæ˜¯æœ€åçš„è¾“å‡ºä¸åŒã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> nd</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pool2d</span><span class="params">(X, pool_size, mode=<span class="string">'max'</span>)</span>:</span></span><br><span class="line">    p_h, p_w = pool_size</span><br><span class="line">    Y = nd.zeros((X.shape[<span class="number">0</span>] - p_h + <span class="number">1</span>, X.shape[<span class="number">1</span>] - p_w + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(Y.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(Y.shape[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> mode == <span class="string">'max'</span>:</span><br><span class="line">                Y[i, j] = X[i: i + p_h, j: j + p_w].max()</span><br><span class="line">            <span class="keyword">elif</span> mode == <span class="string">'avg'</span>:</span><br><span class="line">                Y[i, j] = X[i: i + p_h, j: j + p_w].mean()       </span><br><span class="line">    <span class="keyword">return</span> Y</span><br></pre></td></tr></table></figure>

<h4 id="5-4-2-å¡«å……å’Œæ­¥å¹…"><a href="#5-4-2-å¡«å……å’Œæ­¥å¹…" class="headerlink" title="5.4.2 å¡«å……å’Œæ­¥å¹…"></a>5.4.2 å¡«å……å’Œæ­¥å¹…</h4><p>å·¥ä½œåŸç†åŒå·ç§¯å±‚ä¸€æ ·ï¼Œæ”¹å˜å¡«å……å’Œæ­¥å¹…æ¥æ”¹å˜è¾“å‡ºå½¢çŠ¶ã€‚<br>å¯ä»¥ç”¨nnæ¨¡å—é‡Œçš„äºŒç»´æœ€å¤§æ± åŒ–MaxPool2Dæ¥æ¼”ç¤º<br>so easy</p>
<h4 id="5-4-3-å¤šé€šé“"><a href="#5-4-3-å¤šé€šé“" class="headerlink" title="5.4.3 å¤šé€šé“"></a>5.4.3 å¤šé€šé“</h4><p>ä¸å·ç§¯å±‚ä¸åŒï¼Œæ± åŒ–å±‚å¯¹æ¯ä¸ªè¾“å…¥é€šé“åˆ†åˆ«æ± åŒ–ï¼Œè€Œä¸æ˜¯å‘å·ç§¯å±‚é‚£æ ·æŒ‰ç…§é€šé“ç›¸åŠ ã€‚æ„å‘³ç€æ± åŒ–å±‚çš„è¾“å‡ºé€šé“æ•°ä¸è¾“å…¥é€šé“æ•°ç›¸ç­‰ã€‚<br>easy</p>
<h3 id="5-5-å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰"><a href="#5-5-å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰" class="headerlink" title="5.5 å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰"></a>5.5 å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰</h3><p>ä¹‹å‰æˆ‘ä»¬æ„é€ ä¸€ä¸ªå•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºæ¥å¯¹Fashion-MNISTæ•°æ®é›†ä¸­çš„å›¾åƒè¿›è¡Œåˆ†ç±»ã€‚æ¯å¼ å®½é«˜å‡æ˜¯28åƒç´ ã€‚æˆ‘ä»¬å°†å›¾åƒä¸­çš„åƒç´ é€è¡Œå±•å¼€ï¼Œå¾—åˆ°é•¿åº¦ä¸º784çš„å‘é‡ï¼Œå¹¶è¾“å…¥è¿›å…¨è¿æ¥å±‚ä¸­ã€‚<br>å±€é™æ€§ï¼š</p>
<ul>
<li>å›¾åƒåœ¨åŒä¸€åˆ—é‚»è¿‘çš„çš„åƒç´ åœ¨è¿™ä¸ªå‘é‡ä¸­å¯èƒ½ç›¸è·è¾ƒè¿œï¼Œä»–ä»¬æ„æˆçš„æ¨¡å¼å¯èƒ½éš¾ä»¥è¢«æ¨¡å‹è¯†åˆ«ã€‚ï¼ˆæœ‰äº›ç‰¹å¾ä¸èƒ½è¢«è¯†åˆ«ï¼‰</li>
<li>å¯¹äºå¤§å°ºå¯¸çš„è¾“å…¥å›¾åƒï¼Œä½¿ç”¨å…¨è¿æ¥å±‚å®¹æ˜“å¯¼è‡´æ¨¡å‹è¿‡å¤§ã€‚</li>
</ul>
<p>å·ç§¯å±‚å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¸€æ–¹é¢ï¼Œå·ç§¯å±‚å°ä¿ç•™è¾“å…¥å½¢çŠ¶ï¼Œä½¿å›¾åƒçš„åƒç´ åœ¨é«˜å’Œå®½ä¸¤ä¸ªæ–¹å‘çš„ç›¸å…³æ€§å‡å¯èƒ½è¢«æœ‰æ•ˆè¯†åˆ«</li>
<li>å¦ä¸€æ–¹é¢ï¼Œå·ç§¯å±‚é€šè¿‡æ»‘åŠ¨çª—å£å°†åŒä¸€å·ç§¯æ ¸ä¸ä¸åŒä½ç½®çš„è¾“å…¥é‡å¤è®¡ç®—ï¼Œä»è€Œé¿å…å°ºå¯¸è¿‡å¤§ã€‚<br>å·ç§¯ç¥ç»ç½‘ç»œå°±æ˜¯å«å·ç§¯å±‚çš„ç½‘ç»œã€‚<h4 id="5-5-1-LeNetæ¨¡å‹"><a href="#5-5-1-LeNetæ¨¡å‹" class="headerlink" title="5.5.1 LeNetæ¨¡å‹"></a>5.5.1 LeNetæ¨¡å‹</h4><blockquote>
<p>LeNetåˆ†ä¸ºå·ç§¯å±‚å—å’Œå…¨è¿æ¥å±‚å—ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p>
</blockquote>
</li>
</ul>
<p>å·ç§¯å±‚å—å’Œå…¨è¿æ¥å±‚å—éƒ½æœ‰ç‰¹ç‚¹ï¼Œso cool<br>ä¹¦ä¸Šè´¼è¯¦ç»† è¿˜æœ‰ä»£ç  ä¸å¤åˆ¶ç²˜è´´å¤ªå¤š<br>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å·ç§¯å±‚ä¸­è¾“å…¥çš„é«˜å’Œå®½åœ¨é€å±‚å‡å°ã€‚å·ç§¯å±‚ç”±äºä½¿ç”¨é«˜å’Œå®½å‡ä¸º5çš„å·ç§¯æ ¸ï¼Œä»è€Œå°†é«˜å’Œå®½åˆ†åˆ«å‡å°4ï¼Œè€Œæ± åŒ–å±‚å°†é«˜å’Œå®½å‡åŠï¼Œä½†é€šé“æ•°åˆ™ä»1å¢åŠ åˆ°16ã€‚å…¨è¿æ¥å±‚åˆ™é€å±‚å‡å°‘è¾“å‡ºä¸ªæ•°ï¼Œç›´åˆ°å˜æˆå›¾åƒçš„ç±»åˆ«æ•°10</p>
<h4 id="5-5-2-è®­ç»ƒæ¨¡å‹"><a href="#5-5-2-è®­ç»ƒæ¨¡å‹" class="headerlink" title="5.5.2 è®­ç»ƒæ¨¡å‹"></a>5.5.2 è®­ç»ƒæ¨¡å‹</h4><h3 id="5-6-æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼ˆAlexNetï¼‰"><a href="#5-6-æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼ˆAlexNetï¼‰" class="headerlink" title="5.6 æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼ˆAlexNetï¼‰"></a>5.6 æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼ˆAlexNetï¼‰</h3><p>å…ˆä»‹ç»ä¸€äº›å†å² ç¿»è¯‘çš„å¥½å·®çœ‹ä¸æ‡‚ï¼Œ å¥½åƒæ˜¯å½“åˆæ•°æ®é›†å’Œç¡¬ä»¶ä¸å¤Ÿï¼Œæ·±åº¦å­¦ä¹ å¾ˆå›°éš¾ï¼Œæœºå™¨å­¦ä¹ å¼€å§‹çƒ­é—¨ï¼Œæœºå™¨å­¦ä¹ ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•ç”¨å·²æœ‰çš„ç‰¹å¾æå–å‡½æ•°ç”Ÿæˆå›¾åƒçš„ç‰¹å¾ï¼Œå†åˆ©ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹å¯¹å›¾åƒçš„ç‰¹å¾åˆ†ç±»ï¼ˆé€šè¿‡å‹¤åŠ³ä¸åªä¼šè®¾è®¡å¹¶ç”Ÿæˆçš„æ‰‹å·¥ç‰¹å¾ï¼‰ï¼Œä½†æ˜¯å…¶å®æœ¬è´¨ä¸Šé‚£äº›ç‰¹å¾ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡æ·±åº¦å­¦ä¹ å‡ºæ¥çš„ã€‚ç”¨è¾ƒå¹²å‡€çš„æ•°æ®é›†å’Œè¾ƒæœ‰æ•ˆçš„ç‰¹å¾å»å­¦ä¹ æ›´å¥½ã€‚</p>
<h4 id="5-6-1-å­¦ä¹ ç‰¹å¾è¡¨ç¤º"><a href="#5-6-1-å­¦ä¹ ç‰¹å¾è¡¨ç¤º" class="headerlink" title="5.6.1 å­¦ä¹ ç‰¹å¾è¡¨ç¤º"></a>5.6.1 å­¦ä¹ ç‰¹å¾è¡¨ç¤º</h4><ol>
<li>ç¼ºå¤±è¦ç´ ä¸€ï¼š æ•°æ®</li>
<li>ç¼ºå¤±è¦ç´ äºŒï¼š ç¡¬ä»¶<h4 id="5-6-2-AlexNet"><a href="#5-6-2-AlexNet" class="headerlink" title="5.6.2 AlexNet"></a>5.6.2 AlexNet</h4>AlexNetä¸LeNetçš„è®¾è®¡ç†å¿µéå¸¸ç±»ä¼¼ï¼Œä½†åˆæœ‰æ˜¾è‘—åŒºåˆ«ï¼š</li>
<li>AlexNetä¸è¾ƒå°çš„LeNetç›¸æ¯”ï¼ŒAlexNetåŒ…å«8å±‚å˜æ¢ï¼Œå…¶ä¸­æœ‰5å±‚å·ç§¯å’Œ2å±‚å…¨è¿æ¥éšè—å±‚ï¼Œä»¥åŠ1ä¸ªå…¨è¿æ¥è¾“å‡ºå±‚ã€‚</li>
<li>AlexNetå°†sigmoidæ¿€æ´»å‡½æ•°æ”¹æˆäº†æ›´ç®€å•çš„ReLUæ¿€æ´»å‡½æ•°ï¼ˆå¥½å¤„ä¹¦ä¸Šæœ‰ï¼‰ã€‚</li>
<li>AlexNeté€šè¿‡ä¸¢å¼ƒæ³•æ¥æ§åˆ¶å…¨è¿æ¥å±‚çš„æ¨¡å‹å¤æ‚åº¦ã€‚è€ŒLeNetå¹¶æ²¡æœ‰ä½¿ç”¨ä¸¢å¼ƒæ³•ã€‚</li>
<li>AlexNetå¼•å…¥äº†å¤§é‡çš„å›¾åƒå¢å¹¿ï¼Œå¦‚ç¿»è½¬ã€è£å‰ªå’Œé¢œè‰²å˜åŒ–ï¼Œä»è€Œè¿›ä¸€æ­¥æ‰©å¤§æ•°æ®é›†æ¥ç¼“è§£è¿‡æ‹Ÿåˆã€‚</li>
</ol>
<p>æ¨¡å‹ä¹¦ä¸Šä»‹ç»å¾ˆè¯¦ç»† å¾ˆé…·</p>
<h4 id="5-6-3-è¯»å–æ•°æ®é›†"><a href="#5-6-3-è¯»å–æ•°æ®é›†" class="headerlink" title="5.6.3 è¯»å–æ•°æ®é›†"></a>5.6.3 è¯»å–æ•°æ®é›†</h4><p>ImageNetæ•°æ®é›†è®­ç»ƒæ—¶é—´è¾ƒé•¿ï¼Œä»ç„¶ä½¿ç”¨Fashion-MINSTæ•°æ®é›†æ¥æ¼”ç¤ºAlexNetã€‚è¦æŠŠæ•°æ®é›†Resizeæˆ224.</p>
<h4 id="5-6-4-è®­ç»ƒæ¨¡å‹"><a href="#5-6-4-è®­ç»ƒæ¨¡å‹" class="headerlink" title="5.6.4 è®­ç»ƒæ¨¡å‹"></a>5.6.4 è®­ç»ƒæ¨¡å‹</h4><p>å­¦ä¹ ç‡å‡å°ï¼Œå…¶ä»–å·®ä¸å¤š</p>
<h3 id="5-7-ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰"><a href="#5-7-ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰" class="headerlink" title="5.7 ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰"></a>5.7 ä½¿ç”¨é‡å¤å…ƒç´ çš„ç½‘ç»œï¼ˆVGGï¼‰</h3><p>AlexNetåœ¨LeNetçš„åŸºç¡€ä¸Šå¢åŠ äº†3ä¸ªå·ç§¯å±‚ã€‚ä½†AlexNetä½œè€…å¯¹å®ƒä»¬çš„å·ç§¯çª—å£ã€è¾“å‡ºé€šé“æ•°å’Œæ„é€ é¡ºåºå‡åšäº†å¤§é‡çš„è°ƒæ•´ã€‚è™½ç„¶AlexNetæŒ‡æ˜äº†æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œå¯ä»¥å–å¾—å‡ºè‰²çš„ç»“æœï¼Œä½†å¹¶æ²¡æœ‰æä¾›ç®€å•çš„è§„åˆ™æ¥æŒ‡å¯¼åæ¥çš„ç ”ç©¶è€…å¦‚ä½•è®¾è®¡æ–°çš„ç½‘ç»œã€‚æˆ‘ä»¬åœ¨æœ¬ç« çš„åç»­å‡ èŠ‚ä»‹ç»ä¸åŒçš„æ·±åº¦ç½‘ç»œè®¾è®¡æ€è·¯<br>æœ¬èŠ‚ä»‹ç»äº†VGGï¼Œå®ƒæå‡ºäº†å¯ä»¥é€šè¿‡é‡å¤ä½¿ç”¨ç®€å•çš„åŸºç¡€å—æ¥æ„å»ºæ·±åº¦æ¨¡å‹çš„æ€è·¯</p>
<h4 id="5-7-1-VGGå—"><a href="#5-7-1-VGGå—" class="headerlink" title="5.7.1 VGGå—"></a>5.7.1 VGGå—</h4><p>è¿ç»­ä½¿ç”¨æ•°ä¸ªç›¸åŒçš„å¡«å……ä¸º1ï¼Œçª—å£å½¢çŠ¶ä¸º3x3çš„å·ç§¯å±‚åæ¥ä¸Šä¸€ä¸ªæ­¥å¹…ä¸º2ã€çª—å£å½¢çŠ¶ä¸º2x2çš„æœ€å¤§æ± åŒ–å±‚ã€‚å·ç§¯å±‚ä¿æŒè¾“å…¥çš„é«˜å’Œå®½ä¸å˜ï¼Œè€Œæ± åŒ–å±‚åˆ™å¯¹å…¶å‡åŠã€‚</p>
<h4 id="5-7-2-VGGç½‘ç»œ"><a href="#5-7-2-VGGç½‘ç»œ" class="headerlink" title="5.7.2 VGGç½‘ç»œ"></a>5.7.2 VGGç½‘ç»œ</h4><p>å’ŒAlexNetå’ŒLeNetä¸€æ ·ï¼ŒVGGç½‘ç»œç”±å·ç§¯å±‚æ¨¡å—åæ¥å…¨è¿æ¥å±‚æ¨¡å—æ„æˆã€‚å®šä¹‰conv_archæ¥æŒ‡å®šå¤šä¸ªå·ç§¯å—çš„å¤§å°ï¼Œæ± åŒ–å±‚æ¯æ¬¡å°†è¾“å…¥çš„é«˜å’Œå®½å‡åŠï¼ŒåŒæ—¶æ¯æ¬¡æŠŠè¾“å‡ºé€šé“æ•°ç¿»å€ã€‚å› ä¸ºæ¯ä¸ªå·ç§¯å±‚çš„çª—å£å¤§å°ä¸€æ ·ï¼Œæ‰€ä»¥å¤šæ•°å·ç§¯å±‚éƒ½æœ‰ç›¸åŒçš„æ¨¡å‹å‚æ•°å°ºå¯¸å’Œè®¡ç®—å¤æ‚åº¦ã€‚<br>ä¸åŒå°±æ˜¯å·ç§¯å±‚éƒ½æ˜¯é‡å¤çš„ã€‚</p>
<h4 id="5-7-3-è®­ç»ƒæ¨¡å‹"><a href="#5-7-3-è®­ç»ƒæ¨¡å‹" class="headerlink" title="5.7.3 è®­ç»ƒæ¨¡å‹"></a>5.7.3 è®­ç»ƒæ¨¡å‹</h4><h3 id="5-8-ç½‘ç»œä¸­çš„ç½‘ç»œï¼ˆNiNï¼‰"><a href="#5-8-ç½‘ç»œä¸­çš„ç½‘ç»œï¼ˆNiNï¼‰" class="headerlink" title="5.8 ç½‘ç»œä¸­çš„ç½‘ç»œï¼ˆNiNï¼‰"></a>5.8 ç½‘ç»œä¸­çš„ç½‘ç»œï¼ˆNiNï¼‰</h3><p>ä¹‹å‰VGGå’ŒAlexNetåœ¨è®¾è®¡ä¸Šå¯¹LeNetçš„æ”¹è¿›ä¸»è¦æ˜¯åœ¨äºå¦‚ä½•å¯¹è¿™ä¸¤ä¸ªï¼ˆå·ç§¯å±‚å—å’Œå…¨è¿æ¥å±‚å—ï¼‰è¿›è¡ŒåŠ å®½ï¼ˆå¢åŠ é€šé“æ•°ï¼‰å’ŒåŠ æ·±ã€‚æœ¬èŠ‚ä»‹ç»NiNã€‚å®ƒæå‡ºå¦å¤–ä¸€ä¸ªæ€è·¯ï¼Œå³ä¸²è”å¤šä¸ªç”±å·ç§¯å±‚å’Œâ€œå…¨è¿æ¥â€å±‚æ„æˆå°ç½‘ç»œæ¥æ„å»ºä¸€ä¸ªæ·±å±‚ç½‘ç»œã€‚</p>
<h4 id="5-8-1-NiNå—"><a href="#5-8-1-NiNå—" class="headerlink" title="5.8.1 NiNå—"></a>5.8.1 NiNå—</h4><p>å·ç§¯å±‚çš„è¾“å…¥å’Œè¾“å‡ºä¸€èˆ¬æ˜¯å››ç»´æ•°ç»„ï¼ˆæ ·æœ¬ï¼Œé€šé“ï¼Œé«˜ï¼Œå®½ï¼‰ï¼Œè€Œå…¨è¿æ¥å±‚çš„è¾“å…¥å’Œè¾“å‡ºé€šå¸¸æ˜¯äºŒç»´æ•°ç»„ï¼ˆæ ·æœ¬ï¼Œç‰¹å¾ï¼‰ã€‚å¦‚æœæƒ³å†å…¨è¿æ¥å±‚åå†æ¥ä¸Šå·ç§¯å±‚ï¼Œåˆ™éœ€è¦å°†å…¨è¿æ¥å±‚è¾“å‡ºå˜ä¸ºå››ç»´ã€‚ä¹‹å‰è¯´çš„1x1å·ç§¯å±‚å¯ä»¥æ›¿ä»£å…¨è¿æ¥å±‚è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>NiNå—æ˜¯NiNä¸­çš„åŸºç¡€å—ï¼Œå®ƒç”±ä¸€ä¸ªå·ç§¯å±‚åŠ ä¸Šä¸¤ä¸ªå……å½“å…¨è¿æ¥å±‚çš„1x1å·ç§¯å±‚ä¸²è”è€Œæˆï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„è¶…å‚æ•°å¯ä»¥è‡ªè¡Œè®¾ç½®ï¼Œè€Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå·ç§¯å±‚çš„è¶…å‚æ•°ä¸€èˆ¬æ˜¯å›ºå®šçš„ã€‚</p>
<h4 id="5-8-2-NiNæ¨¡å‹"><a href="#5-8-2-NiNæ¨¡å‹" class="headerlink" title="5.8.2 NiNæ¨¡å‹"></a>5.8.2 NiNæ¨¡å‹</h4><p>NiNå’ŒAlexNetæœ‰å¾ˆå¤šç›¸ä¼¼çš„åœ°æ–¹ã€‚NiNä½¿ç”¨å·ç§¯çª—å£å½¢çŠ¶åˆ†åˆ«ä¸º11x11, 5x5å’Œ3x3çš„å·ç§¯å±‚ï¼Œç›¸åº”çš„è¾“å‡ºé€šé“æ•°ä¹Ÿä¸AlexNetä¸­çš„ä¸€è‡´ã€‚æ¯ä¸ªNiNå—åæ¥ä¸€ä¸ªæ­¥å¹…ä¸º2ã€çª—å£å½¢çŠ¶ä¸º3x3çš„æœ€å¤§æ± åŒ–å±‚ã€‚<br>æœ‰ä¸AlexNetæ˜¾è‘—ä¸åŒï¼š<br>NiNå»æ‰äº†æœ€åçš„3ä¸ªå…¨è¿æ¥å±‚ï¼Œå–è€Œä»£ä¹‹åœ°ï¼ŒNiNä½¿ç”¨äº†è¾“å‡ºé€šé“æ•°ç­‰äºæ ‡ç­¾ç±»åˆ«æ•°çš„NiNå—ï¼Œç„¶åä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–å±‚ï¼ˆçª—å£å½¢çŠ¶ç­‰äºè¾“å…¥ç©ºé—´ç»´å½¢çŠ¶çš„å¹³å‡æ± åŒ–å±‚ï¼‰å¯¹æ¯ä¸ªé€šé“ä¸­æ‰€æœ‰å…ƒç´ æ±‚å¹³å‡å¹¶ç›´æ¥ç”¨äºåˆ†ç±»ã€‚NiNçš„è¿™ä¸ªè®¾è®¡çš„å¥½å¤„æ˜¯å¯ä»¥æ˜¾è‘—å‡å°æ¨¡å‹å‚æ•°å°ºå¯¸è€Œç¼“è§£è¿‡æ‹Ÿåˆã€‚ä½†æ˜¯ä¼šå¢åŠ è®­ç»ƒæ—¶é—´ã€‚</p>
<h4 id="5-8-3-è®­ç»ƒæ¨¡å‹"><a href="#5-8-3-è®­ç»ƒæ¨¡å‹" class="headerlink" title="5.8.3 è®­ç»ƒæ¨¡å‹"></a>5.8.3 è®­ç»ƒæ¨¡å‹</h4><p>ç›¸ä¼¼ å­¦ä¹ ç‡æ›´å¤§</p>
<h3 id="5-9-å«å¹¶è¡Œè¿ç»“çš„ç½‘ç»œï¼ˆGoogLeNetï¼‰"><a href="#5-9-å«å¹¶è¡Œè¿ç»“çš„ç½‘ç»œï¼ˆGoogLeNetï¼‰" class="headerlink" title="5.9 å«å¹¶è¡Œè¿ç»“çš„ç½‘ç»œï¼ˆGoogLeNetï¼‰"></a>5.9 å«å¹¶è¡Œè¿ç»“çš„ç½‘ç»œï¼ˆGoogLeNetï¼‰</h3><p>GoogLeNetå¸æ”¶äº†NiNä¸­ç½‘ç»œä¸²è”ç½‘ç»œçš„æ€æƒ³ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¶³äº†å¾ˆå¤§æ”¹è¿›ã€‚</p>
<h4 id="5-9-1-Inceptionå—"><a href="#5-9-1-Inceptionå—" class="headerlink" title="5.9.1 Inceptionå—"></a>5.9.1 Inceptionå—</h4><p>åŸºç¡€å·ç§¯å—å«åšInceptionå—ï¼Œç»“æ„æ›´å¤æ‚ã€‚<br>æœ‰4æ¡å¹¶è¡Œçš„çº¿è·¯ã€‚å‰3æ¡1x1ï¼Œ3x3ï¼Œ5x5çš„å·ç§¯å±‚æ¥æŠ½å–ä¸åŒç©ºé—´å°ºå¯¸ä¸‹çš„ä¿¡æ¯ã€‚ç¬¬4æ¡æœ€å¤§æ± åŒ–å±‚ã€‚<br>Inceptionå—ä¸­è‡ªå®šä¹‰çš„è¶…å‚æ•°æ˜¯æ¯ä¸ªå±‚çš„è¾“å‡ºé€šé“æ•°ï¼Œæˆ‘ä»¬ä»¥æ­¤æ¥æ§åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚</p>
<h4 id="5-9-2-GoogLeNetæ¨¡å‹"><a href="#5-9-2-GoogLeNetæ¨¡å‹" class="headerlink" title="5.9.2 GoogLeNetæ¨¡å‹"></a>5.9.2 GoogLeNetæ¨¡å‹</h4><p>æˆ‘å»æ¨¡å‹æœ‰5ä¸ªæ¨¡å—è´¼å¤æ‚ï¼Œè‡ªå·±çœ‹æ‡‚è‚¯å®šæ²¡é—®é¢˜ï¼Œä¼šæ·±å…¥ç ”ç©¶å°±ä¸ä¸€å®šäº†ã€‚è‡ªå·±çœ‹ã€‚</p>
<h4 id="5-9-3-è®­ç»ƒæ¨¡å‹"><a href="#5-9-3-è®­ç»ƒæ¨¡å‹" class="headerlink" title="5.9.3 è®­ç»ƒæ¨¡å‹"></a>5.9.3 è®­ç»ƒæ¨¡å‹</h4><h3 id="5-10-æ‰¹é‡å½’ä¸€åŒ–"><a href="#5-10-æ‰¹é‡å½’ä¸€åŒ–" class="headerlink" title="5.10 æ‰¹é‡å½’ä¸€åŒ–"></a>5.10 æ‰¹é‡å½’ä¸€åŒ–</h3><p>ä¹‹å‰æˆ‘ä»¬æ˜¯å¯¹æ•°æ®æ ‡å‡†åŒ–é¢„å¤„ç†ã€‚å¯¹æµ…å±‚å°±å¤Ÿäº†ï¼Œéšç€æ¨¡å‹è®­ç»ƒçš„æƒŠé†’ï¼Œå½“æ¯å±‚ä¸­å‚æ•°æ›´æ–°æ—¶ï¼Œé è¿‘è¾“å‡ºå±‚çš„è¾“å‡ºè¾ƒéš¾å‡ºç°å‰§çƒˆå˜åŒ–ã€‚ä½†å¯¹æ·±å±‚ç¥ç»ç½‘ç»œæ¥è¯´ï¼Œå³ä½¿è¾“å…¥æ•°æ®å·²ç»æ ‡å‡†åŒ–ï¼Œè®­ç»ƒæ±‡æ€»æ¨¡å‹å‚æ•°çš„æ›´è¡Œä¾ç„¶å¾ˆå®¹æ˜“é€ æˆé è¿‘è¾“å‡ºå±‚è¾“å‡ºå‰§çƒˆå˜åŒ–ã€‚è®¡ç®—æ•°å€¼ä¸ç¨³å®šå¾ˆéš¾è®­ç»ƒå‡ºæœ‰æ•ˆçš„æ·±åº¦æ¨¡å‹ã€‚<br>æ‰¹é‡å½’ä¸€åŒ–çš„æå‡ºæ­£å¼ä¸ºäº†åº”å¯¹æ·±åº¦æ¨¡å‹è®­ç»ƒçš„æŒ‘æˆ˜ã€‚æ‰¹é‡å½’ä¸€åŒ–åˆ©ç”¨<strong>å°æ‰¹é‡</strong>ä¸Šçš„å‡å€¼å’Œæ ‡å‡†å·®ï¼Œä¸æ–­è°ƒæ•´ç¥ç»ç½‘ç»œä¸­é—´è¾“å‡ºï¼Œä»è€Œä½¿æ•´ä¸ªç¥ç»ç½‘ç»œåœ¨åœ¨å„å±‚çš„ä¸­é—´è¾“å‡ºæ•°å€¼æ›´ç¨³å®šã€‚<strong>æœ‰ä¸¤ç§æ–¹æ³•æ‰¹é‡å½’ä¸€åŒ–å’Œæ®‹å·®ç½‘ç»œã€‚</strong></p>
<h4 id="5-10-1-æ‰¹é‡å½’ä¸€åŒ–å±‚"><a href="#5-10-1-æ‰¹é‡å½’ä¸€åŒ–å±‚" class="headerlink" title="5.10.1 æ‰¹é‡å½’ä¸€åŒ–å±‚"></a>5.10.1 æ‰¹é‡å½’ä¸€åŒ–å±‚</h4><p>å¯¹å…¨è¿æ¥å±‚å’Œå·ç§¯å±‚åšæ‰¹é‡å½’ä¸€åŒ–ä¼šæœ‰ä¸åŒã€‚</p>
<ol>
<li>å¯¹å…¨è¿æ¥å±‚åšæ‰¹é‡å½’ä¸€åŒ–<br> å¯¹å…¨è¿æ¥å±‚åšæ‰¹é‡å½’ä¸€åŒ–ï¼Œä¸€èˆ¬å°†æ‰¹é‡å½’ä¸€åŒ–ç½®äºä»¿å°„å˜æ¢å’Œæ¿€æ´»å‡½æ•°ä¹‹é—´ã€‚éœ€è¦å¯¹å°æ‰¹é‡æ±‚å‡å€¼å’Œæ–¹å·®ã€‚å¯ä»¥å­¦ä¹ æ‹‰ä¼¸å‚æ•°å’Œåç§»å‚æ•°ï¼Œä½†æ˜¯å¦‚æœæ‰¹é‡å½’ä¸€åŒ–æ— ç›Šå­¦å‡ºæ¥çš„æ¨¡å‹å¯ä»¥ä¸ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–ã€‚</li>
<li>å¯¹å·ç§¯å±‚åšæ‰¹é‡å½’ä¸€åŒ–<br> å¯¹å·ç§¯å±‚æ¥è¯´ï¼Œæ‰¹é‡å½’ä¸€åŒ–å‘ç”Ÿåœ¨å·ç§¯è¿ç®—ä¹‹åã€åº”ç”¨æ¿€æ´»å‡½æ•°ä¹‹å‰ã€‚å¦‚æœå·ç§¯å±‚æœ‰å¤šä¸ªé€šé“ï¼Œå°±å¯¹æ¯ä¸ªé€šé“åšç‹¬ç«‹çš„æ‰¹é‡å½’ä¸€åŒ–æ‹¥æœ‰ç‹¬ç«‹çš„æ‹‰ä¼¸å’Œåç§»å‚æ•°ï¼Œå‡ä¸ºæ ‡é‡ã€‚å•é€šé“å°±éœ€è¦å¯¹æ‰€æœ‰mxpxqå…ƒç´ ç”¨ä¸€ä¸ªå‡å€¼å’Œæ–¹å·®ï¼Œå³è¯¥é€šé“ä¸­mxpxqä¸ªå…ƒç´ çš„å‡å€¼æ–¹å·®ã€‚</li>
<li>é¢„æµ‹æ—¶çš„æ‰¹é‡å½’ä¸€åŒ–<br> åŒºåˆ†è®­ç»ƒå’Œé¢„æµ‹ã€‚è®­ç»ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†æ‰¹é‡å¤§å°è®¾ç½®å¤§ä¸€äº›ï¼Œä»è€Œä½¿æ‰¹é‡å†…æ ·æœ¬çš„å‡å€¼å’Œæ–¹å·®çš„è®¡ç®—éƒ½è¾ƒä¸ºå‡†ç¡®ã€‚é¢„æµ‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹å¯¹ä»»æ„è¾“å…¥æœ‰ç¡®å®šçš„è¾“å‡ºï¼Œå•ä¸ªæ ·æœ¬çš„è¾“å‡ºä¸åº”å–å†³äºæ‰¹é‡å½’ä¸€åŒ–æ‰€éœ€è¦çš„éšæœºå°æ‰¹é‡ä¸­çš„å‡å€¼å’Œæ–¹å·®ã€‚<br> è§£å†³æ–¹æ³•ï¼š<ul>
<li>é€šè¿‡ç§»åŠ¨å¹³å‡ä¼°ç®—æ•´ä¸ªè®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬å‡å€¼å’Œæ–¹å·®ï¼Œå¹¶åœ¨é¢„æµ‹æ—¶ä½¿ç”¨å®ƒä»¬å¾—åˆ°ç¡®å®šçš„è¾“å‡ºã€‚å’Œä¸¢å¼ƒæ³•ä¸€æ ·ï¼Œæ‰¹é‡å½’ä¸€åŒ–åœ¨è®­ç»ƒæ¨¡å¼å’Œé¢„æµ‹æ¨¡å¼ä¸‹çš„è®¡ç®—ç»“æœä¸ä¸€æ ·ã€‚<h4 id="5-10-2-ä»é›¶å¼€å§‹å®ç°"><a href="#5-10-2-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="5.10.2 ä»é›¶å¼€å§‹å®ç°"></a>5.10.2 ä»é›¶å¼€å§‹å®ç°</h4>é€šè¿‡NDArrayæ¥å®ç°æ‰¹é‡å½’ä¸€åŒ–å±‚<br>å®šä¹‰batch_normå‡½æ•°ï¼šè®¡ç®—å‡å€¼æ–¹å·®åšå½’ä¸€åŒ–æ“ä½œ<br>å®šä¹‰BatchNormå±‚ï¼šä¿å­˜å‚ä¸æ±‚æ¢¯åº¦å’Œè¿­ä»£çš„æ‹‰ä¼¸å‚æ•°å’Œåç§»å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿç»´æŠ¤ç§»åŠ¨å¹³å‡å¾—åˆ°çš„å‡å€¼å’Œæ–¹å·®ï¼Œæ–¹ä¾¿åœ¨é¢„æµ‹çš„æ—¶å€™è¢«ä½¿ç”¨ã€‚æŒ‡å®šçš„num_featureså‚æ•°å¯¹äºå…¨è¿æ¥å±‚æ¥è¯´åº”ä¸ºè¾“å‡ºä¸ªæ•°ï¼Œå¯¹äºå·ç§¯å±‚æ¥è¯´åˆ™ä¸ºè¾“å‡ºé€šé“æ•°ã€‚è¯¥å®ä¾‹æ‰€éœ€æŒ‡å®šçš„num_dimså‚æ•°å¯¹å…¨è¿æ¥å±‚å’Œå·ç§¯å±‚æ¥è¯´åˆ†åˆ«ä¸º2å’Œ4ã€‚<h4 id="5-10-3-ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚çš„çš„LeNet"><a href="#5-10-3-ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚çš„çš„LeNet" class="headerlink" title="5.10.3 ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚çš„çš„LeNet"></a>5.10.3 ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–å±‚çš„çš„LeNet</h4>åœ¨æ‰€æœ‰çš„å·ç§¯å±‚æˆ–å…¨è¿æ¥å±‚ã€æ¿€æ´»å±‚ä¹‹å‰åŠ å…¥æ‰¹é‡å½’ä¸€åŒ–å±‚ã€‚<h4 id="5-10-4-ç®€æ´å®ç°"><a href="#5-10-4-ç®€æ´å®ç°" class="headerlink" title="5.10.4 ç®€æ´å®ç°"></a>5.10.4 ç®€æ´å®ç°</h4>ç®€æ´å®ç°ä¸éœ€è¦æŒ‡å®šnum_featureså’Œnum_dimsã€‚è¿™äº›å‚æ•°éƒ½å°†é€šè¿‡å»¶ååˆå§‹åŒ–è€Œè‡ªåŠ¨è·å–ã€‚</li>
</ul>
</li>
</ol>
<h3 id="5-11-æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰"><a href="#5-11-æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰" class="headerlink" title="5.11 æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰"></a>5.11 æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰</h3><p>å¯¹ç¥ç»ç½‘ç»œæ¨¡å‹æ·»åŠ æ–°çš„å±‚ï¼Œå……åˆ†è®­ç»ƒåç†è®ºä¸Šæœ‰å¯èƒ½æ›´å®¹æ˜“é™ä½è®­ç»ƒè¯¯å·®ï¼Œç„¶è€Œåœ¨æ—¶é—´ä¸­ï¼Œæ·»åŠ è¿‡å¤šçš„å±‚åè®­ç»ƒè¯¯å·®å¾€å¾€ä¸é™åå‡ã€‚å³ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–å¸¦æ¥æ•°å€¼çš„ç¨³å®šä»ç„¶ä¸è¡Œã€‚</p>
<h4 id="5-11-1-æ®‹å·®å—"><a href="#5-11-1-æ®‹å·®å—" class="headerlink" title="5.11.1 æ®‹å·®å—"></a>5.11.1 æ®‹å·®å—</h4><p>å•¥æ®‹å·®æ˜ å°„f(x)-xã€‚å³å›¾è™šçº¿æ¡†ä¸­çš„éƒ¨åˆ†åˆ™éœ€è¦æ‹Ÿåˆå‡ºæœ‰å…³æ’ç­‰æ˜ å°„çš„æ®‹å·®æ˜ å°„f(x)-xã€‚æ®‹å·®æ˜ å°„åœ¨å®é™…ä¸­å¾€å¾€æ›´å®¹æ˜“ä¼˜åŒ–ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å­¦ä¹ æˆç†æƒ³ç†æƒ³æ˜ å°„ï¼Œå½“ç†æƒ³æ˜ å°„f(x)ææ¥è¿‘äºæ’ç­‰æ˜ å°„æ—¶ï¼Œæ®‹å·®æ˜ å°„ä¹Ÿæ˜“äºæ•æ‰æ’ç­‰æ˜ å°„çš„ç»†å¾®æ³¢åŠ¨ã€‚è¿™ä¸ªå°±æ˜¯æ®‹å·®å—ï¼Œåœ¨æ®‹å·®å—ä¸­ï¼Œè¾“å…¥å¯é€šè¿‡è·¨å±‚çš„æ•°æ®çº¿è·¯æ›´å¿«åœ°å‘å‰ä¼ æ’­ã€‚<br><strong><em>è®¾è¾“å…¥ä¸ºxã€‚å‡è®¾å›¾ä¸­æœ€ä¸Šæ–¹æ¿€æ´»å‡½æ•°è¾“å…¥çš„ç†æƒ³æ˜ å°„ä¸ºf(x)ã€‚å·¦å›¾è™šçº¿æ¡†ä¸­çš„éƒ¨åˆ†éœ€è¦ç›´æ¥æ‹Ÿåˆå‡ºè¯¥æ˜ å°„f(x)ï¼Œè€Œå³å›¾è™šçº¿æ¡†ä¸­çš„éƒ¨åˆ†éœ€è¦æ‹Ÿåˆå‡ºæœ‰å…³æ’ç­‰æ˜ å°„çš„æ®‹å·®æ˜ å°„f(x)-x</em></strong><br>æ²¿ç”¨äº†VGGå…¨3x3å·ç§¯å±‚çš„è®¾è®¡ã€‚æ®‹å·®å—é‡Œé¦–å…ˆæœ‰2ä¸ªç›¸åŒè¾“å‡ºé€šé“æ•°çš„3x3å·ç§¯å±‚ã€‚æ¯ä¸ªå·ç§¯å±‚åæ¥ä¸€ä¸ªæ‰¹é‡å½’ä¸€åŒ–å±‚å’ŒReLUæ¿€æ´»å‡½æ•°ã€‚ç„¶åæˆ‘ä»¬å°†è¾“å…¥è·³è¿‡è¿™ä¸¤ä¸ªå·ç§¯è¿ç®—åç›´æ¥åŠ åœ¨æœ€åçš„ReLUæ¿€æ´»å‡½æ•°å‰ã€‚è¿™æ ·è®¾è®¡è¦æ±‚2ä¸ªå·ç§¯å±‚çš„è¾“å‡ºäºè¾“å…¥å½¢çŠ¶ä¸€æ ·ï¼Œä»è€Œå¯ä»¥ç›¸åŠ ã€‚å¦‚æœæƒ³æ”¹å˜é€š`é“æ•°ï¼Œå°±éœ€è¦å¼•å…¥ä¸€ä¸ªé¢å¤–çš„1x1å·ç§¯å±‚æ¥å°†è¾“å…¥å˜æ¢æˆéœ€è¦çš„å½¢çŠ¶åå†åšç›¸åŠ è¿ç®—ã€‚</p>
<h4 id="5-11-2-ResNetæ¨¡å—"><a href="#5-11-2-ResNetæ¨¡å—" class="headerlink" title="5.11.2 ResNetæ¨¡å—"></a>5.11.2 ResNetæ¨¡å—</h4><p>ResNetçš„å‰ä¸¤å±‚è·Ÿä¹‹å‰ä»‹ç»çš„GooLeNetä¸€æ ·ï¼Œåœ¨è¾“å‡ºé€šé“æ•°ä¸º64ï¼Œæ­¥å¹…ä¸º2çš„7x7å·ç§¯å±‚åæ¥æ­¥å¹…ä¸º2çš„3x3çš„æœ€å¤§æ± åŒ–å±‚ã€‚ä¸åŒæŒ‡å‡ºåœ¨äºResNetæ¯ä¸ªå·ç§¯å±‚åç­‰ä»·æ‰¹é‡å½’ä¸€åŒ–å±‚ã€‚<br>åé¢å‡ å±‚ResNetç”¨äº†4ä¸ªç”±æ®‹å·®å—ç»„æˆçš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä½¿ç”¨è‹¥å¹²åŒæ ·è¾“å‡ºé€šé“æ•°çš„æ®‹å·®å—ã€‚ç¬¬ä¸€ä¸ªæ¨¡å—çš„é€šé“æ•°åŒè¾“å…¥é€šé“æ•°ä¸€è‡´ã€‚ç”±äºä»¥å‰ç”¨äº†æ­¥å¹…ä¸º2çš„æœ€å¤§æ± åŒ–å±‚ï¼Œæ— é¡»å‡å°é«˜å’Œå®½ã€‚ä¹‹åæ¯ä¸ªæ¨¡å—åœ¨ç¬¬ä¸€ä¸ªæ®‹å·®å—å°†ä¸Šä¸€ä¸ªæ¨¡å—çš„é€šé“æ•°ç¿»å€ï¼Œå¹¶å°†é«˜å’Œå®½å‡åŠã€‚<br>æœ€ååŠ ä¸Šå…¨å±€å¹³å‡æ± åŒ–å±‚åæ¥ä¸Šå…¨è¿æ¥å±‚è¾“å‡ºã€‚<br>è¿™é‡Œæ¯ä¸ªResæ¨¡å—æœ‰4ä¸ªå·ç§¯å±‚ï¼ˆä¸è®¡1x1å±‚ï¼‰åŠ ä¸Šå¤´å°¾å…±æœ‰18å±‚ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œé…ç½®ã€‚<br>æˆ‘å»ï¼Œè´¼å¤æ‚ï¼Œä½†æ˜¯æ•ˆæœå¥½ã€‚</p>
<h4 id="5-11-3-è®­ç»ƒæ¨¡å‹"><a href="#5-11-3-è®­ç»ƒæ¨¡å‹" class="headerlink" title="5.11.3 è®­ç»ƒæ¨¡å‹"></a>5.11.3 è®­ç»ƒæ¨¡å‹</h4><h3 id="5-12-ç¨ å¯†è¿æ¥ç½‘ç»œï¼ˆDenseNetï¼‰"><a href="#5-12-ç¨ å¯†è¿æ¥ç½‘ç»œï¼ˆDenseNetï¼‰" class="headerlink" title="5.12 ç¨ å¯†è¿æ¥ç½‘ç»œï¼ˆDenseNetï¼‰"></a>5.12 ç¨ å¯†è¿æ¥ç½‘ç»œï¼ˆDenseNetï¼‰</h3><p>ResNetä¸­çš„è·¨å±‚è¿æ¥è®¾è®¡å¼•ç”³å‡ºæ•°ä¸ªåç»­å·¥ä½œã€‚æœ¬èŠ‚ä»‹ç»ä¸€ä¸ªç¨ å¯†è¿æ¥ç½‘ç»œï¼Œä¸»è¦åŒºåˆ«å¦‚å›¾ï¼š<br>åœ¨è·¨å±‚ä¸Šæœ‰ä¸»è¦åŒºåˆ«ï¼šä½¿ç”¨ç›¸åŠ å’Œä½¿ç”¨è¿ç»“ã€‚<br>äºResNetçš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒDenseNeté‡Œæ¨¡å—Bçš„è¾“å‡ºä¸æ˜¯åƒResNeté‚£æ ·å’Œæ¨¡å—Aç›¸åŠ ï¼Œè€Œæ˜¯åœ¨é€šé“ç»´ä¸Šè¿ç»“ã€‚è¿™æ ·æ¨¡å—Açš„è¾“å‡ºå¯ä»¥ç›´æ¥ä¼ å…¥æ¨¡å—Båé¢çš„å±‚ã€‚åœ¨è¿™ä¸ªè®¾è®¡é‡Œï¼Œæ¨¡å—Aç›´æ¥è·Ÿæ¨¡å—Båé¢çš„æ‰€æœ‰å±‚è¿æ¥åœ¨äº†ä¸€èµ·ã€‚<br>DenseNetçš„ä¸»è¦æ„å»ºæ¨¡å—æ˜¯ç¨ å¯†å—å’Œè¿‡åº¦å±‚ã€‚</p>
<ul>
<li>ç¨ å¯†å—ï¼šå®šä¹‰äº†è¾“å…¥å’Œè¾“å‡ºæ˜¯å¦‚ä½•è¿ç»“çš„ã€‚</li>
<li>è¿‡æ¸¡å±‚ï¼šç”¨æ¥æ§åˆ¶é€šé“æ•°ï¼Œä½¿ä¹‹ä¸è¿‡å¤§ã€‚</li>
</ul>
<h4 id="5-12-1-ç¨ å¯†å—"><a href="#5-12-1-ç¨ å¯†å—" class="headerlink" title="5.12.1 ç¨ å¯†å—"></a>5.12.1 ç¨ å¯†å—</h4><p>ä½¿ç”¨äº†ResNetæ”¹è‰¯ç‰ˆçš„â€œæ‰¹é‡å½’ä¸€åŒ–ã€æ¿€æ´»å’Œå·ç§¯â€ç»“æ„ã€‚åœ¨â€œconv_blockâ€å‡½æ•°ä¸­å®ç°è¿™ä¸ªç»“æ„ã€‚ç¨ å¯†å—ç”±å¤šä¸ªconv_blockç»„æˆï¼Œæ¯å—ä½¿ç”¨ç›¸åŒçš„è¾“å‡ºé€šé“æ•°ã€‚ä½†åœ¨å‰å‘è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬å°†æ¯å—çš„è¾“å…¥å’Œè¾“å‡ºåœ¨é€šé“ç»´ä¸Šè¿ç»“ã€‚<br><strong><em>å·ç§¯å—çš„é€šé“æ•°æ§åˆ¶äº†è¾“å‡ºé€šé“æ•°ç›¸å¯¹äºè¾“å…¥é€šé“æ•°çš„å¢é•¿ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºå¢é•¿ç‡</em></strong></p>
<h4 id="5-12-2-è¿‡æ¸¡å±‚"><a href="#5-12-2-è¿‡æ¸¡å±‚" class="headerlink" title="5.12.2 è¿‡æ¸¡å±‚"></a>5.12.2 è¿‡æ¸¡å±‚</h4><p>ç”±äºæ¯ä¸ªç¨ å¯†å—éƒ½ä¼šå¸¦æ¥é€šé“æ•°çš„å¢åŠ ï¼Œä½¿ç”¨è¿‡å¤šåˆ™ä¼šå¸¦æ¥è¿‡äºå¤æ‚çš„æ¨¡å‹ã€‚è¿‡æ¸¡ç”¨æ¥æ§åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚å®ƒé€šè¿‡1x1å·ç§¯å±‚æ¥å‡å°é€šé“æ•°ï¼Œå¹¶ä½¿ç”¨æ­¥å¹…ä¸º2çš„å¹³å‡æ± åŒ–å±‚æ¥å‡åŠé«˜å’Œå®½ï¼Œä»è€Œè¿›ä¸€æ­¥é™ä½æ¨¡å‹å¤æ‚åº¦ã€‚</p>
<h4 id="5-12-3-DenseNetæ¨¡å‹"><a href="#5-12-3-DenseNetæ¨¡å‹" class="headerlink" title="5.12.3 DenseNetæ¨¡å‹"></a>5.12.3 DenseNetæ¨¡å‹</h4><p>è´¼å¤æ‚ å·´æ‹‰å·´æ‹‰</p>
<ul>
<li>é¦–å…ˆä½¿ç”¨åŒResNetä¸€æ ·çš„å•å·ç§¯å±‚å’Œæœ€å¤§æ± åŒ–å±‚ã€‚</li>
<li>ç±»ä¼¼äºResNetæ¥ä¸‹æ¥ä½¿ç”¨çš„4ä¸ªæ®‹å·®å—ï¼ŒDenseNetä½¿ç”¨çš„æ˜¯4ä¸ªç¨ å¯†å—ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®æ¯ä¸ªç¨ å¯†å—æœ‰å¤šå°‘ä¸ªå·ç§¯å±‚ã€‚ç¨ å¯†å—çš„å·ç§¯å±‚é€šé“æ•°ç­‰äºå¢é•¿ç‡ã€‚ï¼ˆResNetä½¿ç”¨4ä¸ªæ®‹å·®å—ï¼‰</li>
<li>æˆ‘ä»¬ä½¿ç”¨è¿‡åº¦å±‚æ¥å‡åŠé«˜å’Œå®½ï¼ˆResNetä½¿ç”¨æ­¥å¹…ä¸º2çš„æ®‹å·®å—åœ¨æ¯ä¸ªæ¨¡å—ä¹‹é—´å‡å°é«˜å’Œå®½ï¼‰</li>
<li>ResNetä¸€æ ·ï¼Œæœ€åä½¿ç”¨å…¨å±€æ± åŒ–å±‚å’Œå…¨è¿æ¥å±‚æ¥è¾“å‡ºã€‚<h4 id="5-12-4-è®­ç»ƒæ¨¡å‹"><a href="#5-12-4-è®­ç»ƒæ¨¡å‹" class="headerlink" title="5.12.4 è®­ç»ƒæ¨¡å‹"></a>5.12.4 è®­ç»ƒæ¨¡å‹</h4>ç»ˆäºåˆ·å®Œå·ç§¯ç¥ç»ç½‘ç»œäº† æˆ‘å» æœ‰äº›å¤æ‚ ä¹‹åä¹Ÿèƒ½çœ‹ã€‚</li>
</ul>
<h2 id="ç¬¬7ç« -ä¼˜åŒ–ç®—æ³•"><a href="#ç¬¬7ç« -ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ç¬¬7ç«  ä¼˜åŒ–ç®—æ³•"></a>ç¬¬7ç«  ä¼˜åŒ–ç®—æ³•</h2><p><img src="/2020/01/22/dive-into-deep-learning/opt.png" alt="ä¼˜åŒ–ç®—æ³•"><br>è®­ç»ƒæ¨¡å‹ï¼Œä½¿ç”¨ä¼˜åŒ–ç®—æ³•ä¸æ–­è¿­ä»£æ¨¡å‹å‚æ•°æ¥é™ä½æ¨¡å‹æŸå¤±å‡½æ•°çš„å€¼ã€‚è¿­ä»£ç»ˆæ­¢ï¼Œæ¨¡å‹çš„è®­ç»ƒéšä¹‹ç»ˆæ­¢ï¼Œæ­¤æ—¶çš„æ¨¡å‹å‚æ•°å°±æ˜¯æ¨¡å‹é€šè¿‡è®­ç»ƒæ‰€å­¦ä¹ åˆ°çš„å‚æ•°ã€‚<br>ä¼˜åŒ–ç®—æ³•ååˆ†é‡è¦ï¼š</p>
<ul>
<li>ä¸€æ–¹é¢ï¼Œè®­ç»ƒä¸€ä¸ªå¤æ‚çš„æ·±åº¦å­¦ä¹ æ¨¡å‹å¯èƒ½éœ€è¦æ•°å°æ—¶ï¼Œæ•°æ—¥ï¼Œç”šè‡³æ•°å‘¨çš„æ—¶é—´ï¼Œè€Œä¼˜åŒ–ç®—æ³•çš„è¡¨ç°ç›´æ¥å½±å“æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡ï¼›</li>
<li>å¦ä¸€æ–¹é¢ï¼Œç†è§£å„ç§ä¼˜åŒ–ç®—æ³•çš„åŸç†ä»¥åŠå…¶ä¸­è¶…å‚æ•°çš„æ„ä¹‰å°†æœ‰åŠ©äºæˆ‘ä»¬æ›´æœ‰é’ˆå¯¹æ€§çš„è°ƒå‚ï¼Œä»è€Œä½¿æ·±åº¦å­¦ä¹ æ¨¡å‹è¡¨ç°æ›´å¥½ã€‚<h3 id="7-1-ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ "><a href="#7-1-ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ " class="headerlink" title="7.1 ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ "></a>7.1 ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ </h3>æ·±åº¦å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé¢„å…ˆå®šä¹‰ä¸€ä¸ªæŸå¤±å‡½æ•°ï¼Œæœ‰äº†æŸå¤±å‡½æ•°ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼˜åŒ–ç®—æ³•è¯•å›¾å°†å…¶æœ€å°åŒ–ã€‚åœ¨ä¼˜åŒ–ä¸­ï¼Œè¿™æ ·çš„<strong>æŸå¤±å‡½æ•°</strong>é€šå¸¸è¢«ç§°ä½œä¼˜åŒ–é—®é¢˜çš„ç›®æ ‡å‡½æ•°ã€‚ä¾æ®æƒ¯ä¾‹ï¼Œä¼˜åŒ–ç®—æ³•é€šå¸¸åªè€ƒè™‘æœ€å°åŒ–ç›®æ ‡å‡½æ•°ã€‚å…¶å®ä»»ä½•æœ€å¤§åŒ–é—®é¢˜éƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬åŒ–ä¸ºæœ€å°åŒ–é—®é¢˜ã€‚<h4 id="7-1-1-ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ çš„å…³ç³»"><a href="#7-1-1-ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ çš„å…³ç³»" class="headerlink" title="7.1.1 ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ çš„å…³ç³»"></a>7.1.1 ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ çš„å…³ç³»</h4>å®é™…ä¸Šä¼˜åŒ–å’Œæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æœ‰åŒºåˆ«ã€‚</li>
<li>ä¼˜åŒ–æ˜¯ä¸ºäº†é™ä½è®­ç»ƒè¯¯å·®</li>
<li>æ·±åº¦å­¦ä¹ æ˜¯ä¸ºäº†é™ä½æ³›åŒ–è¯¯å·®ã€‚<br>ä¸ºäº†é™ä½æ³›åŒ–ä¸ºèŒ¶ï¼Œé™¤äº†ä½¿ç”¨ä¼˜åŒ–ç®—æ³•é™ä½è®­ç»ƒè¯¯å·®ä»¥å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„åº”å¯¹è¿‡æ‹Ÿåˆã€‚<br>æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å€¼å…³æ³¨ä¼˜åŒ–ç®—æ³•åœ¨æœ€å°ç›®æ ‡å‡½æ•°ä¸Šçš„è¡¨ç°ï¼Œè€Œä¸å…³æ³¨æ¨¡å‹çš„æ³›åŒ–è¯¯å·®ã€‚<h4 id="7-1-2-ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜"><a href="#7-1-2-ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜" class="headerlink" title="7.1.2 ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜"></a>7.1.2 ä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜</h4>ä¹‹å‰è¯´ä¼˜åŒ–é—®é¢˜æœ‰è§£æè§£å’Œæ•°å€¼è§£ï¼Œæ·±åº¦å­¦ä¹ ä¸­ç»å¤§å¤šæ•°ç›®æ ‡å‡½æ•°éƒ½å¾ˆå¤æ‚ã€‚å› æ­¤ï¼Œå¾ˆå¤šä¼˜åŒ–é—®é¢˜ä¸å­˜åœ¨è§£æè§£ï¼Œè€Œéœ€è¦åŸºäºæ•°å€¼æ–¹æ³•çš„ä¼˜åŒ–ç®—æ³•æ‰¾åˆ°è¿‘ä¼¼è§£ï¼Œå³æ•°å€¼è§£ã€‚è®¨è®ºçš„ä¼˜åŒ–ç®—æ³•éƒ½æ˜¯è¿™ç±»åŸºäºæ•°å€¼æ–¹æ³•çš„ç®—æ³•ã€‚ä¸ºäº†æ±‚å¾—æœ€å°åŒ–ç›®æ ‡å‡½æ•°çš„æ•°å€¼è§£ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¼˜åŒ–ç®—æ³•æœ‰é™æ¬¡è¿­ä»£æ¨¡å‹å‚æ•°æ¥å°½å¯èƒ½åœ°é™ä½æŸå¤±å‡½æ•°çš„å€¼ã€‚<br>ä¼˜åŒ–ç®—æ³•æœ‰ä¸¤ä¸ªæŒ‘æˆ˜ï¼šå±€éƒ¨æœ€å°å€¼å’Œéç‚¹ã€‚</li>
</ul>
<ol>
<li><p>å±€éƒ¨æœ€å°å€¼<br>å¯¹äºç›®æ ‡å‡½æ•°$f(x)$ï¼Œå¦‚æœ$f(x)$åœ¨$x$ä¸Šçš„å€¼æ¯”åœ¨$x$é‚»è¿‘çš„å…¶ä»–ç‚¹çš„å€¼æ›´å°ï¼Œé‚£ä¹ˆ$f(x)$å¯èƒ½æ˜¯ä¸€ä¸ªå±€éƒ¨æœ€å°å€¼ï¼ˆlocal minimumï¼‰ã€‚å¦‚æœ$f(x)$åœ¨$x$ä¸Šçš„å€¼æ˜¯ç›®æ ‡å‡½æ•°åœ¨æ•´ä¸ªå®šä¹‰åŸŸä¸Šçš„æœ€å°å€¼ï¼Œé‚£ä¹ˆ$f(x)$æ˜¯å…¨å±€æœ€å°å€¼ï¼ˆglobal minimumï¼‰ã€‚<br>æ·±åº¦å­¦ä¹ æ¨¡å‹çš„ç›®æ ‡å‡½æ•°å¯èƒ½æœ‰è‹¥å¹²å±€éƒ¨æœ€ä¼˜è§£ã€‚å½“ä¸€ä¸ªä¼˜åŒ–é—®é¢˜çš„æ•°å€¼è§£åœ¨å±€éƒ¨æœ€æœ‰è§£é™„è¿‘æ—¶ï¼Œå‘¨å›´æ¢¯åº¦è¿‘ä¼¼ä¸º0ï¼Œæœ€ç»ˆè¿­ä»£æ±‚å¾—çš„æ•°å€¼è§£å¯èƒ½ä»¤ç›®æ ‡å‡½æ•°å±€éƒ¨æœ€å°åŒ–è€Œéå…¨å±€æœ€å°åŒ–ã€‚</p>
</li>
<li><p>éç‚¹<br>æ¢¯åº¦æ¥è¿‘æˆ–å˜æˆ0å¯èƒ½æ—¶ç”±äºå½“å‰è§£åœ¨å±€éƒ¨æœ€ä¼˜è§£é™„è¿‘é€ æˆçš„ã€‚äº‹å®ä¸Šï¼Œå¦ä¸€ç§å¯èƒ½æ€§æ—¶å½“å‰è§£åœ¨éç‚¹é™„è¿‘ã€‚<br>f(x)=x3å’Œf(x,y)=x2-y2æˆ‘ä»¬å¯ä»¥æ‰¾å‡ºå‡½æ•°çš„éç‚¹ä½ç½®ã€‚<br>åœ¨å›¾f(x,y)=x2-y2çš„éç‚¹ä½ç½®ï¼Œç›®æ ‡å‡½æ•°åœ¨xè½´æ–¹å‘ä¸Šæ—¶å±€éƒ¨æœ€å°å€¼ï¼Œä½†åœ¨yè½´æ–¹å‘ä¸Šæ—¶å±€éƒ¨æœ€å¤§å€¼ã€‚</p>
<blockquote>
<p>å‡è®¾ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ä¸ºkç»´å‘é‡ï¼Œè¾“å‡ºä¸ºæ ‡é‡ï¼Œé‚£ä¹ˆå®ƒçš„æµ·æ£®çŸ©é˜µæœ‰kä¸ªç‰¹å¾å€¼ã€‚è¯¥å‡½æ•°åœ¨æ¢¯åº¦ä¸º0çš„ä½ç½®ä¸Šå¯èƒ½æ—¶å±€éƒ¨æœ€å°å€¼ã€å±€éƒ¨æœ€å¤§å€¼æˆ–è€…éç‚¹ã€‚</p>
</blockquote>
</li>
</ol>
<ul>
<li>å½“å‡½æ•°çš„æµ·æ£®çŸ©é˜µåœ¨æ¢¯åº¦ä¸º0çš„ä½ç½®ä¸Šçš„ç‰¹å¾å€¼å…¨ä¸ºæ­£æ—¶ï¼Œè¯¥å‡½æ•°å¾—åˆ°å±€éƒ¨æœ€å°å€¼ã€‚</li>
<li>å½“å‡½æ•°çš„æµ·æ£®çŸ©é˜µåœ¨æ¢¯åº¦ä¸º0çš„ä½ç½®ä¸Šçš„ç‰¹å¾å€¼å…¨ä¸ºè´Ÿæ—¶ï¼Œè¯¥å‡½æ•°å¾—åˆ°å±€éƒ¨æœ€å¤§å€¼ã€‚</li>
<li>å½“å‡½æ•°çš„æµ·æ£®çŸ©é˜µåœ¨æ¢¯åº¦ä¸º0çš„ä½ç½®ä¸Šçš„ç‰¹å¾å€¼æœ‰æ­£æœ‰è´Ÿæ—¶ï¼Œè¯¥å‡½æ•°å¾—åˆ°éç‚¹ã€‚</li>
</ul>
<p>ç”±éšæœºçŸ©é˜µç†è®ºï¼Œç”±äºæ·±åº¦å­¦ä¹ æ¨¡å‹å‚æ•°å‚æ•°é€šå¸¸éƒ½æ˜¯é«˜ç»´çš„ï¼ˆkå¾ˆå¤§ï¼‰ï¼Œ<strong>ç›®æ ‡å‡½æ•°çš„éç‚¹é€šå¸¸æ¯”å±€éƒ¨æœ€å°å€¼æ›´å¸¸è§ã€‚</strong></p>
<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œè™½ç„¶æ‰¾åˆ°ç›®æ ‡å‡½æ•°çš„å…¨å±€æœ€ä¼˜è§£å¾ˆéš¾ï¼Œä½†è¿™<strong>å¹¶éå¿…è¦</strong>ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« æ¥ä¸‹æ¥çš„å‡ èŠ‚ä¸­é€ä¸€ä»‹ç»å¸¸ç”¨ä¼˜åŒ–ç®—æ³•ï¼Œåœ¨å¾ˆå¤šå®é™…é—®é¢˜ä¸­éƒ½èƒ½è®­ç»ƒå‡ºååˆ†æœ‰æ•ˆçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</p>
<h3 id="7-2-æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™"><a href="#7-2-æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™" class="headerlink" title="7.2 æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™"></a>7.2 æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™</h3><p>éšæœºæ¢¯åº¦å¾ˆå°‘ä½¿ç”¨ï¼Œä½†æ˜¯ç†è§£æ¢¯åº¦çš„æ„ä¹‰ä»¥åŠæ²¿ç€æ¢¯åº¦åæ–¹å‘æ›´æ–°è‡ªå˜é‡å¯èƒ½é™ä½ç›®æ ‡å‡½æ•°å€¼çš„åŸå› æ˜¯å­¦ä¹ åç»­ä¼˜åŒ–ç®—æ³•çš„åŸºç¡€ï¼Œéšåå¼•å‡ºéšæœºæ¢¯åº¦ä¸‹é™ã€‚</p>
<h4 id="7-2-1-ä¸€ç»´æ¢¯åº¦ä¸‹é™"><a href="#7-2-1-ä¸€ç»´æ¢¯åº¦ä¸‹é™" class="headerlink" title="7.2.1 ä¸€ç»´æ¢¯åº¦ä¸‹é™"></a>7.2.1 ä¸€ç»´æ¢¯åº¦ä¸‹é™</h4><p>ä»¥ç®€å•çš„ä»¥ä¸ºæ¢¯åº¦ä¸‹é™ï¼Œè§£é‡Šæ¢¯åº¦ä¸‹é™ç®—æ³•å¯èƒ½é™ä½ç›®æ ‡å‡½æ•°å€¼çš„åŸå› ã€‚ï¼ˆæ•°å­¦ç†è®ºeasy æ•°å­¦è´¼å·®ğŸ˜‚ï¼‰<br><img src="/2020/01/22/dive-into-deep-learning/gd1.png" alt="å·ç§¯ç¥ç»ç½‘ç»œ"><br>è§‚å¯Ÿf(x)=x2çš„ä¸€ç»´æ¢¯åº¦ä¸‹é™</p>
<h4 id="7-2-2-å­¦ä¹ ç‡"><a href="#7-2-2-å­¦ä¹ ç‡" class="headerlink" title="7.2.2 å­¦ä¹ ç‡"></a>7.2.2 å­¦ä¹ ç‡</h4><p>ç”¨å®é™…ä¾‹å­è§‚å¯Ÿå­¦ä¹ ç‡çš„å½±å“ï¼š<br><img src="/2020/01/22/dive-into-deep-learning/gd2.png" alt="å·ç§¯ç¥ç»ç½‘ç»œ"><br><img src="/2020/01/22/dive-into-deep-learning/gd3.png" alt="å·ç§¯ç¥ç»ç½‘ç»œ"></p>
<ul>
<li><p>å­¦ä¹ ç‡è¿‡å°å¯¼è‡´xæ›´æ–°ç¼“æ…¢ä»è€Œéœ€è¦æ›´å¤šçš„è¿­ä»£æ‰èƒ½å¾—åˆ°è¾ƒå¥½çš„è§£ã€‚</p>
</li>
<li><p>å­¦ä¹ ç‡è¿‡å¤§ï¿½ï¿½ï¿½|nfâ€™(x)|å¯èƒ½ä¼šè¿‡å¤§ä»è€Œä½¿å‰é¢æåˆ°çš„ä¸€é˜¶æ³°å‹’å±•å¼€å¼ä¸å†æˆç«‹ï¼šè¿™æ—¶æˆ‘ä»¬æ— æ³•ä¿è¯è¿­ä»£xä¼šé™ä½fï¼ˆxï¼‰çš„å€¼ã€‚</p>
<h4 id="7-2-3-å¤šç»´æ¢¯åº¦ä¸‹é™"><a href="#7-2-3-å¤šç»´æ¢¯åº¦ä¸‹é™" class="headerlink" title="7.2.3 å¤šç»´æ¢¯åº¦ä¸‹é™"></a>7.2.3 å¤šç»´æ¢¯åº¦ä¸‹é™</h4><p>å‰é¢æ˜¯ä¸€ç»´æ¢¯åº¦ä¸‹é™ï¼Œè€ƒè™‘æ›´å¹¿å¤§çš„æƒ…å†µï¼šç›®æ ‡å‡½æ•°çš„è¾“å…¥ä¸ºå‘é‡ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªdç»´å‘é‡ã€‚ç›®æ ‡å‡½æ•°f(x)æœ‰å…³xçš„æ¢¯åº¦æ˜¯ä¸€ä¸ªç”±dä¸ªåå¯¼æ•°ç»„æˆçš„å‘é‡ã€‚<br>å®šä¹‰å­¦ä¹ ç‡ï¼Œè‡ªå˜é‡ï¼Œè‡ªå˜é‡çŠ¶æ€çœ‹ä»£ç å¾ˆå®¹æ˜“è‡ªå·±ç†è§£ã€‚<br><img src="/2020/01/22/dive-into-deep-learning/nd.png" alt="nd"></p>
<h4 id="7-2-4-éšæœºæ¢¯åº¦ä¸‹é™"><a href="#7-2-4-éšæœºæ¢¯åº¦ä¸‹é™" class="headerlink" title="7.2.4 éšæœºæ¢¯åº¦ä¸‹é™"></a>7.2.4 éšæœºæ¢¯åº¦ä¸‹é™</h4><p>æ·±åº¦å­¦ä¹ ï¼Œç›®æ ‡å‡½æ•°é€šå¸¸æ˜¯è®­ç»ƒæ•°æ®é›†ä¸­æœ‰å…³å„ä¸ªæ ·æœ¬çš„æŸå¤±å‡½æ•°çš„å¹³å‡ã€‚è®¾fi(x)æ˜¯æœ‰å…³ç´¢å¼•ä¸ºiçš„è®­ç»ƒæ•°æ®çš„æŸå¤±å‡½æ•°ï¼Œnæ˜¯è®­ç»ƒæ•°æ®æ ·æœ¬æ•°ï¼Œxæ˜¯æ¨¡å‹çš„å‚æ•°å‘é‡ã€‚<br>å¦‚æœä½¿ç”¨æ¢¯åº¦ä¸‹é™ï¼Œæ¯æ¬¡è‡ªå˜é‡è¿­ä»£çš„è®¡ç®—å¼€é”€ä¸ºO(n),å®ƒéšç€nçº¿æ€§å¢é•¿ã€‚å› æ­¤ï¼Œå½“è®­ç»ƒæ•°æ®æ ·æœ¬æ•°å¾ˆå¤§æ—¶ï¼Œæ¢¯åº¦ä¸‹é™æ¯æ¬¡è¿­ä»£çš„è®¡ç®—å¼€é”€å¾ˆé«˜ã€‚<br>å“¦å“¦æ™“å¾—äº†ï¼Œä¹‹å‰æ˜¯æŠŠæ‰€æœ‰çš„æ ·æœ¬æ±‚é‡‡æ ·æ¥åšè¿­ä»£ï¼Œsgdå°±æ˜¯éšæœºå‡åŒ€é‡‡æ ·ä¸€ä¸ªæ ·æœ¬ç´¢å¼•ï¼Œå¹¶è®¡ç®—æ¢¯åº¦æ¥è¿­ä»£xã€‚æ¯æ¬¡è¿­ä»£çš„è®¡ç®—å¼€é”€ä»æ¢¯åº¦ä¸‹é™çš„O(n)é™åˆ°äº†å¸¸æ•°O(1)ã€‚éšæœºæ¢¯åº¦æ˜¯å¯¹æ¢¯åº¦çš„æ— åä¼°è®¡ï¼Œè¿™æ„å‘³ç€ï¼Œå¹³å‡æ¥è¯´ï¼Œéšæœºæ¢¯åº¦æ˜¯å¯¹æ¢¯åº¦çš„å¾ˆå¥½ä¸€ä¸ªè‰¯å¥½çš„ä¼°è®¡ã€‚</p>
<h3 id="7-3-å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™"><a href="#7-3-å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™" class="headerlink" title="7.3 å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™"></a>7.3 å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™</h3></li>
<li><p>batch-size: ä¹‹å‰è¯´çš„batchï¼Œä½ çœ‹ä¸‹é¢ï¼Œå°æ‰¹é‡æ˜¯ç”¨æ¥åˆ†æ¬¡è¿­ä»£çš„ï¼ˆæœ€åä¼šæŠŠæ‰€æœ‰æ ·æœ¬è¿­ä»£å®Œï¼‰ï¼Œæ¯æ¬¡ä¼šè®°å½•è¿™æ¬¡æ‰¹é‡çš„æŸå¤±ï¼Œç„¶åè¿›è¡Œæ¢¯åº¦ä¸‹é™ä¼˜åŒ–æ¨¡å‹ï¼Œå°±ç›¸å½“äºä¸€æ¬¡æ¬¡åˆ©ç”¨å°çš„batchæ¥ä¼˜åŒ–ï¼Œepochå°±æ˜¯é‡å¤å®ç°å¤šæ¬¡ï¼ˆä¿ç•™æŸå¤±å‡½æ•°å’Œæ¨¡å‹å‚æ•°ï¼ˆ[w, b]ï¼‰ï¼Œå†…å­˜ä¸æ¶ˆå°±ä¸ä¼šæ¶ˆå¤±ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">lr = <span class="number">0.03</span></span><br><span class="line">num_epochs = <span class="number">3</span></span><br><span class="line">net = linreg</span><br><span class="line">loss = squared_loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(num_epochs):  <span class="comment"># è®­ç»ƒæ¨¡å‹ä¸€å…±éœ€è¦num_epochsä¸ªè¿­ä»£å‘¨æœŸ</span></span><br><span class="line">    <span class="comment"># åœ¨æ¯ä¸€ä¸ªè¿­ä»£å‘¨æœŸä¸­ï¼Œä¼šä½¿ç”¨è®­ç»ƒæ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬ä¸€æ¬¡ï¼ˆå‡è®¾æ ·æœ¬æ•°èƒ½å¤Ÿè¢«æ‰¹é‡å¤§å°æ•´é™¤ï¼‰ã€‚X</span></span><br><span class="line">    <span class="comment"># å’Œyåˆ†åˆ«æ˜¯å°æ‰¹é‡æ ·æœ¬çš„ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter(batch_size, features, labels):</span><br><span class="line">        <span class="keyword">with</span> autograd.record(): <span class="comment">#æ‰“å¼€è®°å½•æ¢¯åº¦</span></span><br><span class="line">            l = loss(net(X, w, b), y)  <span class="comment"># læ˜¯æœ‰å…³å°æ‰¹é‡Xå’Œyçš„æŸå¤±</span></span><br><span class="line">        l.backward()  <span class="comment"># å°æ‰¹é‡çš„æŸå¤±å¯¹æ¨¡å‹å‚æ•°æ±‚æ¢¯åº¦</span></span><br><span class="line">        sgd([w, b], lr, batch_size)  <span class="comment"># ä½¿ç”¨å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™è¿­ä»£æ¨¡å‹å‚æ•°</span></span><br><span class="line">    train_l = loss(net(features, w, b), labels)   <span class="comment">#è®°å½•æŸå¤±</span></span><br><span class="line">    print(<span class="string">'epoch %d, loss %f'</span> % (epoch + <span class="number">1</span>, train_l.mean().asnumpy()))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sgd</span><span class="params">(params, lr, batch_size)</span>:</span>  <span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">        param[:] = param - lr * param.grad / batch_size   <span class="comment">#çœ‹è§æ²¡æœ‰ è¿™é‡Œparam.gradå°±æ˜¯åˆ©ç”¨æ¢¯åº¦åšä¼˜åŒ–</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼šæ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæ¢¯åº¦ä¸‹é™ä½¿ç”¨æ•´ä¸ªè®­ç»ƒæ•°æ®é›†æ¥è®¡ç®—æ¢¯åº¦</p>
</li>
<li><p>éšæœºæ¢¯åº¦ä¸‹é™ï¼šåœ¨æ¯æ¬¡è¿­ä»£ä¸­åªéšæœºé‡‡æ ·ä¸€ä¸ªæ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ã€‚</p>
</li>
<li><p>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼šæˆ‘ä»¬å¯ä»¥åœ¨æ¯è½®è¿­ä»£ä¸­éšæœºå‡åŒ€é‡‡æ ·å¤šä¸ªæ ·æœ¬æ¥ç»„æˆä¸€ä¸ªå°æ‰¹é‡</p>
</li>
</ul>
<p>æè¿°å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼š<br>ï¼Ÿï¼Ÿæ—¶é—´æ­¥ï¼Ÿï¼Ÿ<br>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™éšæœºå‡åŒ€é‡‡æ ·ä¸€ä¸ªç”±è®­ç»ƒæ•°æ®æ ·æœ¬ç´¢å¼•ç»„æˆçš„å°æ‰¹é‡Biï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å¤é‡‡æ ·ï¼ˆå…è®¸åŒä¸€ä¸ªå°æ‰¹é‡å‡ºç°é‡å¤çš„æ ·æœ¬ï¼‰æˆ–è€…ä¸é‡å¤é‡‡æ ·å¾—åˆ°ä¸€ä¸ªå°æ‰¹é‡ä¸­çš„å„ä¸ªæ ·æœ¬ã€‚è®¡ç®—æ—¶é—´æ­¥tçš„å°æ‰¹é‡Biä¸Šç›®æ ‡å‡½æ•°ä½äºxt-1å¤„çš„æ¢¯åº¦ã€‚ï½œBï½œä»£è¡¨æ‰¹é‡å¤§å°ï¼Œå°æ‰¹é‡ä¸­çš„æ ·æœ¬ä¸ªæ•°ï¼Œæ˜¯ä¸€ä¸ªè¶…å‚æ•°ã€‚åŒéšæœºæ¢¯åº¦ä¸€æ ·ä¹Ÿæ˜¯æ— åä¼°è®¡ã€‚ç»™å®šå­¦ä¹ ç‡ntï¼ˆå–æ­£æ•°ï¼‰ï¼Œæœ‰å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™å¯¹è‡ªå˜é‡çš„è¿­ä»£ã€‚<br>åŸºäºéšæœºé‡‡æ ·å¾—åˆ°çš„æ¢¯åº¦çš„æ–¹å·®åœ¨è¿­ä»£è¿‡ç¨‹ä¸­æ— æ³•å‡å°ï¼ˆéšæœºé‡‡æ ·çš„éƒ½ä¸€æ ·ï¼‰ï¼Œå› æ­¤ä¼šä¸æ–­è¡°å‡å­¦ä¹ ç‡ï¼Œè¿™æ ·å­¦ä¹ ç‡å’Œéšæœºæ¢¯åº¦ä¹˜ç§¯çš„æ–¹å·®ä¼šä¸æ–­å‡å°ã€‚è€Œæ¢¯åº¦ä¸‹é™åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸€ç›´ä½¿ç”¨ç›®æ ‡å‡½æ•°çš„çœŸå®æ¢¯åº¦ï¼Œæ— é¡»è‡ªæˆ‘è¡°å‡å­¦ä¹ ç‡ã€‚<br>æ‰¹é‡å¤§å°ä¹Ÿå¯¹æ•ˆç‡æœ‰å½±å“ï¼Œè®¡ç®—å¼€é”€ä¸ºO(B)ã€‚å½“æ‰¹é‡å¤§å°ä¸º1æ—¶ä¸ºéšæœºæ¢¯åº¦ä¸‹é™ï¼Œå½“æ‰¹é‡å¤§å°ç­‰äºè®­ç»ƒæ ·æœ¬æ—¶ï¼Œä¸ºæ¢¯åº¦ä¸‹é™ã€‚å½“æ‰¹é‡å°ï¼Œå¹¶è¡Œå†…å­˜æ•ˆç‡ä½ï¼Œè¿­ä»£æ—¶é—´é•¿ã€‚å½“æ‰¹é‡å¤§ï¼Œæ¯ä¸ªå°æ‰¹é‡æ¢¯åº¦é‡Œé¢å¯èƒ½å«æœ‰æ›´å¤šçš„å†—ä½™ä¿¡æ¯ã€‚ä¸ºäº†å¾—åˆ°æ›´å¥½çš„è§£ï¼Œæ‰¹é‡è¾ƒå¤§æ—¶æ¯”æ‰¹é‡è¾ƒå°æ—¶éœ€è¦è®¡ç®—çš„æ ·æœ¬æ•°ç›®å¯èƒ½æ›´å¤šï¼Œä¾‹å¦‚å¢å¤§è¿­ä»£å‘¨æœŸæ•°ã€‚</p>
<h4 id="7-3-1-è¯»å–æ•°æ®é›†"><a href="#7-3-1-è¯»å–æ•°æ®é›†" class="headerlink" title="7.3.1 è¯»å–æ•°æ®é›†"></a>7.3.1 è¯»å–æ•°æ®é›†</h4><p>ç®€å•ï¼Œå°±æ˜¯è¯»å–æ–°çš„NASAçš„æ•°æ®é›†ï¼Œä½¿ç”¨å‰1500ä¸ªæ ·æœ¬å’Œ5ä¸ªç‰¹å¾ï¼Œå¹¶ç”¨æ ‡å‡†åŒ–å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚</p>
<h4 id="7-3-2-ä»é›¶å¼€å§‹å®ç°"><a href="#7-3-2-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="7.3.2 ä»é›¶å¼€å§‹å®ç°"></a>7.3.2 ä»é›¶å¼€å§‹å®ç°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sgd</span><span class="params">(params, states, hyperparams)</span>:</span>     <span class="comment">#hyperparamsè¶…å‚æ•°çš„æ„æ€  çŠ¶æ€è¾“å…¥stateså¯èƒ½ä»¥åç”¨ è®­ç»ƒæ¨¡å¼å’Œé¢„æµ‹æ¨¡å¼sgdä¸ä¸€æ ·</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> params:</span><br><span class="line">        p[:] -= hyperparams[<span class="string">'lr'</span>] * p.grad</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_ch7</span><span class="params">(trainer_fn, states, hyperparams, features, labels,</span></span></span><br><span class="line"><span class="function"><span class="params">              batch_size=<span class="number">10</span>, num_epochs=<span class="number">2</span>)</span>:</span></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class="line">    net, loss = d2l.linreg, d2l.squared_loss</span><br><span class="line">    w = nd.random.normal(scale=<span class="number">0.01</span>, shape=(features.shape[<span class="number">1</span>], <span class="number">1</span>))</span><br><span class="line">    b = nd.zeros(<span class="number">1</span>)</span><br><span class="line">    w.attach_grad()</span><br><span class="line">    b.attach_grad()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eval_loss</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> loss(net(features, w, b), labels).mean().asscalar()</span><br><span class="line"></span><br><span class="line">    ls = [eval_loss()]</span><br><span class="line">    data_iter = gdata.DataLoader(</span><br><span class="line">        gdata.ArrayDataset(features, labels), batch_size, shuffle=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_epochs):</span><br><span class="line">        start = time.time()</span><br><span class="line">        <span class="keyword">for</span> batch_i, (X, y) <span class="keyword">in</span> enumerate(data_iter):</span><br><span class="line">            <span class="keyword">with</span> autograd.record():</span><br><span class="line">                l = loss(net(X, w, b), y).mean()  <span class="comment"># ä½¿ç”¨å¹³å‡æŸå¤± è¿™é‡Œæ˜¯.meanå¹³å‡ï¼Œç„¶åsgdä¸éœ€è¦é™¤ä»¥batch_sizeï¼Œä¹‹å‰æ˜¯å åŠ </span></span><br><span class="line">            l.backward()</span><br><span class="line">            trainer_fn([w, b], states, hyperparams)  <span class="comment"># è¿­ä»£æ¨¡å‹å‚æ•°statesæ²¡æœ‰ç”¨</span></span><br><span class="line">            <span class="keyword">if</span> (batch_i + <span class="number">1</span>) * batch_size % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">                ls.append(eval_loss())  <span class="comment"># æ¯100ä¸ªæ ·æœ¬è®°å½•ä¸‹å½“å‰è®­ç»ƒè¯¯å·®</span></span><br><span class="line">    <span class="comment"># æ‰“å°ç»“æœå’Œä½œå›¾</span></span><br><span class="line">    print(<span class="string">'loss: %f, %f sec per epoch'</span> % (ls[<span class="number">-1</span>], time.time() - start))</span><br><span class="line">    d2l.set_figsize()</span><br><span class="line">    d2l.plt.plot(np.linspace(<span class="number">0</span>, num_epochs, len(ls)), ls)</span><br><span class="line">    d2l.plt.xlabel(<span class="string">'epoch'</span>)</span><br><span class="line">    d2l.plt.ylabel(<span class="string">'loss'</span>)</span><br></pre></td></tr></table></figure>

<p>å†æµ‹è¯•ä¸‰ç§ä¸åŒå¤§å°batch_size(å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™çš„å°æ‰¹é‡)ä¸‹çš„è®­ç»ƒæ•ˆæœã€‚</p>
<h4 id="7-3-3-ç®€æ´å®ç°"><a href="#7-3-3-ç®€æ´å®ç°" class="headerlink" title="7.3.3 ç®€æ´å®ç°"></a>7.3.3 ç®€æ´å®ç°</h4><h3 id="7-4-åŠ¨é‡æ³•"><a href="#7-4-åŠ¨é‡æ³•" class="headerlink" title="7.4 åŠ¨é‡æ³•"></a>7.4 åŠ¨é‡æ³•</h3><p>ä¹‹å‰æˆ‘ä»¬çš„æ¢¯åº¦ä¸‹é™ï¼Œç›®æ ‡å‡½æ•°æœ‰å…³è‡ªå˜é‡çš„æ¢¯åº¦ä»£è¡¨äº†ç›®æ ‡å‡½æ•°åœ¨è‡ªå˜é‡å½“å‰ä½ç½®ä¸‹é™æœ€å¿«çš„æ–¹å‘ã€‚å› æ­¤ï¼Œæ¢¯åº¦ä¸‹é™ä¹Ÿå«åšæœ€é™¡ä¸‹é™ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ¢¯åº¦ä¸‹é™æ ¹æ®è‡ªå˜é‡å½“å‰ä½ç½®ï¼Œæ²¿ç€å½“å‰ä½ç½®çš„æ¢¯åº¦æ›´æ–°è‡ªå˜é‡ï¼Œä½†æ˜¯å¦‚æœä»…ä»…åªæ ¹æ®å½“å‰ä½ç½®æ›´æ–°ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼ˆé—®é¢˜å¦‚ä¸‹ï¼‰ï¼š</p>
<h4 id="7-4-1-æ¢¯åº¦ä¸‹é™çš„é—®é¢˜"><a href="#7-4-1-æ¢¯åº¦ä¸‹é™çš„é—®é¢˜" class="headerlink" title="7.4.1 æ¢¯åº¦ä¸‹é™çš„é—®é¢˜"></a>7.4.1 æ¢¯åº¦ä¸‹é™çš„é—®é¢˜</h4><p>ç»™äº†å®é™…ä¾‹å­äºŒç»´è¾“å…¥äºŒç»´è¾“å‡ºï¼Œç›®æ ‡å‡½æ•°f(x)=0.1x12+2x22ï¼Œç”¨å­¦ä¹ ç‡0.1è¾ƒå°å¯ä»¥é¿å…è‡ªå˜é‡åœ¨æ•°å€¼æ–¹å‘ä¸Šä¹é¼“ç›®æ ‡å‡½æ•°æœ€ä¼˜è§£ï¼Œç„¶è€Œä¼šé€ æˆè‡ªå˜é‡åœ¨æ°´å¹³æ–¹å‘ä¸Šæœæœ€ä¼˜è§£ç§»åŠ¨å˜æ…¢ã€‚å½“å­¦ä¹ ç‡0.6è¾ƒå¤§ï¼Œæ­¤æ—¶è‡ªå˜é‡åœ¨ç«–ç›´æ–¹å‘ä¸æ–­è¶Šè¿‡æœ€ä¼˜è§£å¹¶é€æ¸å˜å‘æ•£ã€‚é—®é¢˜ï¼ï¼ï¼ï¼</p>
<h4 id="7-4-2-åŠ¨é‡æ³•"><a href="#7-4-2-åŠ¨é‡æ³•" class="headerlink" title="7.4.2 åŠ¨é‡æ³•"></a>7.4.2 åŠ¨é‡æ³•</h4><p>ç”¨åŠ¨é‡æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ”¹å˜è¿­ä»£è¿­ä»£çš„æ–¹å¼ï¼š<br>åŸæ¥ï¼š<br>$$\boldsymbol{x}<em>t \leftarrow \boldsymbol{x}</em>{t-1} - \eta_t \boldsymbol{g}<em>t.$$<br>ç°åœ¨ï¼š<br>$$<br>\begin{aligned}<br>\boldsymbol{v}_t &amp;\leftarrow \gamma \boldsymbol{v}</em>{t-1} + \eta_t \boldsymbol{g}<em>t, \<br>\boldsymbol{x}_t &amp;\leftarrow \boldsymbol{x}</em>{t-1} - \boldsymbol{v}_t,<br>\end{aligned}<br>$$<br>å½“gammaç­‰äº0.5å°±æ”¶è·æ¯”è¾ƒå¥½çš„æ•ˆæœï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡<br>è¦ä»æ•°å­¦ä¸Šç†è§£åŠ¨é‡æ³•ï¼Œå°±è¦å…ˆç†è§£æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ã€‚<br>å“ï¼Œæ•°å­¦èœçš„ä¸€æ‰¹ï¼Œç»“è®ºå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š<br>åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å°†ytçœ‹ä½œæ˜¯å¯¹æœ€è¿‘1/(1-gamma)ä¸ªæ—¶é—´æ­¥çš„xtå€¼çš„åŠ æƒå¹³å‡ã€‚è€Œä¸”ï¼Œç¦»å½“å‰æ—¶é—´æ­¥tè¶Šè¿‘çš„xtå€¼è·å¾—çš„æƒé‡è¶Šå¤§ï¼ˆè¶Šæ¥è¿‘1ï¼‰</li>
<li>ç”±æŒ‡æ•°åŠ æƒå¹³å‡ç†è§£åŠ¨é‡æ³•<br>å¯¹åŠ¨é‡æ³•çš„é€Ÿåº¦å˜é‡åšå˜å½¢ã€‚ç”±æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡çš„å½¢å¼å¯ä»¥å¾—ï¼Œé€Ÿåº¦å˜é‡vtå®é™…ä¸Šæ˜¯å¯¹åºåˆ—åšäº†æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ã€‚</li>
</ol>
<p><strong>æ¢å¥è¯è¯´ï¼Œç›¸æ¯”äºå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼ŒåŠ¨é‡æ³•åœ¨æ¯ä¸ªæ—¶é—´æ­¥çš„è‡ªå˜é‡æ›´æ–°é‡è¿‘ä¼¼äºå°†å‰è€…å¯¹åº”çš„1/(1-y)ä¸ªæ—¶é—´æ­¥çš„æ›´æ–°é‡åšäº†æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡åå†é™¤ä»¥1-yã€‚æ‰€ä»¥ï¼Œåœ¨åŠ¨é‡æ³•ä¸­ï¼Œè‡ªå˜é‡åœ¨å„ä¸ªæ–¹å‘ä¸Šçš„ç§»åŠ¨å¹…åº¦ä¸ä»…å–å†³äºå½“å‰æ¢¯åº¦ï¼Œè¿˜å–å†³äºè¿‡å»çš„å„ä¸ªæ¢¯åº¦åœ¨å„ä¸ªæ–¹å‘ä¸Šæ˜¯å¦ä¸€è‡´ã€‚ä¹‹å‰çš„é—®é¢˜éƒ½æ˜¯æ‰€æœ‰æ¢¯åº¦åœ¨æ°´å¹³æ–¹å‘ä¸Šä¸ºæ­£ï¼ˆå‘å³ï¼‰ï¼Œç«–ç›´å‘é‚£ä¸ªç›¸çˆ±èƒ½å¤Ÿä¸Šæ—¶æ­£æ—¶è´Ÿï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡ï¼Œä»è€Œä½¿è‡ªå˜é‡å‘æœ€æœ‰è§£æ›´å¿«ç§»åŠ¨ã€‚</strong></p>
<h4 id="7-4-3-ä»é›¶å¼€å§‹å®ç°"><a href="#7-4-3-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="7.4.3 ä»é›¶å¼€å§‹å®ç°"></a>7.4.3 ä»é›¶å¼€å§‹å®ç°</h4><p>å®ç°å°±æ˜¯æ›´æ”¹ä»¥ä¸‹ä¼˜åŒ–ç®—æ³•çš„å®ç°ï¼ŒåŠ å…¥åŠ¨é‡ï¼š<br>åŠ¨é‡æ³•éœ€è¦å¯¹æ¯ä¸€ä¸ªè‡ªå˜é‡ç»´æŠ¤ä¸€ä¸ªåŒå®ƒä¸€æ ·å½¢çŠ¶çš„é€Ÿåº¦å˜é‡ï¼Œä¸”è¶…å‚æ•°é‡Œå¤šäº†åŠ¨é‡è¶…å‚æ•°ã€‚å®ç°ä¸­ï¼Œæˆ‘ä»¬å°†é€Ÿåº¦å˜é‡ç”¨æ›´å¹¿ä¹‰çš„çŠ¶æ€å˜é‡statesè¡¨ç¤ºã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_momentum_states</span><span class="params">()</span>:</span></span><br><span class="line">    v_w = nd.zeros((features.shape[<span class="number">1</span>], <span class="number">1</span>))</span><br><span class="line">    v_b = nd.zeros(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (v_w, v_b)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sgd_momentum</span><span class="params">(params, states, hyperparams)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> p, v <span class="keyword">in</span> zip(params, states):</span><br><span class="line">        v[:] = hyperparams[<span class="string">'momentum'</span>] * v + hyperparams[<span class="string">'lr'</span>] * p.grad</span><br><span class="line">        p[:] -= v</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯æ ¹æ®æ•°å­¦åˆ†æå®ç°ï¼Œeasyã€‚åº”ç”¨æ³¨æ„ï¼š</p>
<ul>
<li>å…ˆå°†è¶…å‚æ•°momentumè®¾ä¸º0.5ï¼Œè¿™æ—¶å¯ä»¥çœ‹æˆæ˜¯ç‰¹æ®Šçš„å°æ‰¹é‡éšæœºæ¢¯åº¦ï¼šå…¶å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸ºæœ€è¿‘2ä¸ªæ—¶é—´æ­¥çš„2å€å°æ‰¹é‡æ¢¯åº¦çš„åŠ æƒå¹³å‡ã€‚<br><img src="/2020/01/22/dive-into-deep-learning/mom1.png" alt="åŠ¨é‡æ³•"></li>
<li>å°†è¶…å‚æ•°momentumå¢å¤§åˆ°0.9ï¼Œè¿™æ—¶ä¾ç„¶å¯ä»¥çœ‹æˆæ˜¯ç‰¹æ®Šçš„å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼Œå…¶å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸ºæœ€è¿‘10ä¸ªæ—¶é—´æ­¥çš„10å€å°æ‰¹é‡æ¢¯åº¦çš„åŠ æƒå¹³å‡ã€‚å…ˆä¿æŒå­¦ä¹ ç‡ä¸å˜<br><img src="/2020/01/22/dive-into-deep-learning/mom2.png" alt="åŠ¨é‡æ³•"></li>
<li>å¯ä»¥çœ‹åˆ°ç›®æ ‡å‡½æ•°åæœŸè¿­ä»£è¿‡ç¨‹ä¸å¤Ÿå¹³æ»‘ã€‚ç›´è§‰ä¸Šï¼Œ10å€å°æ‰¹é‡æ¢¯åº¦æ¯”2å€å°æ‰¹é‡æ¢¯åº¦æ‰“äº†5å€ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å°†å­¦ä¹ æ—…å‡å°åˆ°åŸæ¥çš„1/5ï¼Œæ­¤æ—¶ç›®æ ‡å‡½æ•°å€¼åœ¨ä¸‹é™äº†ä¸€æ®µæ—¶é—´åå˜åŒ–æ›´åŠ å¹³æ»‘ã€‚<br><img src="/2020/01/22/dive-into-deep-learning/mom3.png" alt="åŠ¨é‡æ³•"><h4 id="7-4-4-ç®€æ´å®ç°"><a href="#7-4-4-ç®€æ´å®ç°" class="headerlink" title="7.4.4 ç®€æ´å®ç°"></a>7.4.4 ç®€æ´å®ç°</h4>ç®€æ´å®ç°åˆä¸€ä¸ªmomentumçš„å‚æ•°ï¼Œç›´æ¥èµ‹å€¼å°±å¯ä»¥äº†ï¼Œsoç®€æ´ï¼<h3 id="7-5-AdaGradç®—æ³•"><a href="#7-5-AdaGradç®—æ³•" class="headerlink" title="7.5 AdaGradç®—æ³•"></a>7.5 AdaGradç®—æ³•</h3>ä¹‹å‰ä»‹ç»çš„ä¼˜åŒ–ç®—æ³•ï¼Œç›®æ ‡å‡½æ•°è‡ªå˜é‡åœ¨æ¯ä¸€ä¸ªå…ƒç´ ç›¸åŒæ­¥é—´éƒ½æ˜¯ç”¨åŒä¸€ä¸ªå­¦ä¹ ç‡æ¥è‡ªæˆ‘è¿­ä»£ã€‚<br>$$<br>x_1 \leftarrow x_1 - \eta \frac{\partial{f}}{\partial{x_1}}, \quad<br>x_2 \leftarrow x_2 - \eta \frac{\partial{f}}{\partial{x_2}}.<br>$$<br>ä½†æ˜¯å‰é¢çœ‹åˆ°ï¼Œå½“x1å’Œx2çš„æ¢¯åº¦å€¼æœ‰è¾ƒå¤§å·®åˆ«æ—¶ï¼Œéœ€è¦é€‰æ‹©è¶³å¤Ÿå°çš„å­¦ä¹ ç‡åœ¨æ¢¯åº¦å€¼è¾ƒå¤§çš„ç»´åº¦ä¸Šä¸å‘æ•£ã€‚ä½†è¿™æ ·ä¼šå¯¼è‡´è‡ªå˜é‡åœ¨æ¢¯åº¦è¾ƒå°çš„ç»´åº¦ä¸Šè¿­ä»£è¿‡æ…¢ï¼ŒåŠ¨é‡æ³•ä¾èµ–æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ä½¿å¾—è‡ªå˜é‡çš„æ›´æ–°æ–¹å‘æ›´åŠ ä¸€è‡´ï¼Œä»è€Œé™ä½å‘æ•£çš„å¯èƒ½ã€‚<br>æœ¬èŠ‚ä»‹ç»AdaGradç®—æ³•ï¼Œå®ƒæ ¹æ®è‡ªå˜é‡åœ¨æ¯ä¸ªç»´åº¦çš„æ¢¯åº¦å€¼çš„å¤§å°æè‰¾è°ƒæ•´å„ä¸ªç»´åº¦ä¸Šçš„å­¦ä¹ ç‡ï¼Œä»è€Œé¿å…ç»Ÿä¸€çš„å­¦ä¹ ç‡éš¾ä»¥é€‚åº”æ‰€æœ‰çš„ç»´åº¦ã€‚<h4 id="7-5-1-ç®—æ³•"><a href="#7-5-1-ç®—æ³•" class="headerlink" title="7.5.1 ç®—æ³•"></a>7.5.1 ç®—æ³•</h4>åœ¨æ—¶é—´æ­¥0ï¼ŒAdaGradå°†s0ä¸­æ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º0ã€‚åœ¨æ—¶é—´æ­¥tï¼Œé¦–å…ˆå°†å°æ‰¹é‡éšæœºæ¢¯åº¦gtæŒ‰å…ƒç´ å¹³æ–¹åç´¯åŠ åˆ°å˜é‡st<br>$$\boldsymbol{s}<em>t \leftarrow \boldsymbol{s}</em>{t-1} + \boldsymbol{g}<em>t \odot \boldsymbol{g}_t,$$<br>å…¶ä¸­$\odot$æ˜¯æŒ‰å…ƒç´ ç›¸ä¹˜ï¼Œæ¥ç€ï¼Œæˆ‘ä»¬å°†ç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡é€šè¿‡æŒ‰å…ƒç´ è¿ç®—é‡æ–°è°ƒæ•´ã€‚<br>$$\boldsymbol{x}_t \leftarrow \boldsymbol{x}</em>{t-1} - \frac{\eta}{\sqrt{\boldsymbol{s}_t + \epsilon}} \odot \boldsymbol{g}_t,$$</li>
</ul>
<p>å…¶ä¸­$\eta$æ˜¯å­¦ä¹ ç‡ï¼Œ$\epsilon$æ˜¯ä¸ºäº†ç»´æŒæ•°å€¼ç¨³å®šæ€§è€Œæ·»åŠ çš„å¸¸æ•°ï¼Œå¦‚$10^{-6}$ã€‚è¿™é‡Œå¼€æ–¹ã€é™¤æ³•å’Œä¹˜æ³•çš„è¿ç®—éƒ½æ˜¯æŒ‰å…ƒç´ è¿ç®—çš„ã€‚è¿™äº›æŒ‰å…ƒç´ è¿ç®—ä½¿å¾—ç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ éƒ½åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å­¦ä¹ ç‡ã€‚</p>
<h4 id="7-5-2-ç‰¹ç‚¹"><a href="#7-5-2-ç‰¹ç‚¹" class="headerlink" title="7.5.2 ç‰¹ç‚¹"></a>7.5.2 ç‰¹ç‚¹</h4><ol>
<li>å°æ‰¹é‡éšæœºæ¢¯åº¦æŒ‰å…ƒç´ å¹³æ–¹çš„ç´¯åŠ å˜é‡stå‡ºç°åœ¨å­¦ä¹ ç‡çš„åˆ†æ¯é¡¹ä¸­ã€‚ -&gt;  å¦‚æœç›®æ ‡å‡½æ•°æœ‰å…³è‡ªå˜é‡ä¸­æŸä¸ªå…ƒç´ çš„åå¯¼æ•°ä¸€ç›´è¾ƒå°ï¼Œé‚£ä¹ˆè¯¥å…ƒç´ çš„å­¦ä¹ ç‡ä¸‹é™è¾ƒæ…¢ï¼Œ</li>
<li>ç”±äºstä¸€ç›´åœ¨ç´¯åŠ æŒ‰å…ƒç´ å¹³æ–¹çš„æ¢¯åº¦ï¼Œè‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸€ç›´åœ¨é™ä½ï¼ˆæˆ–ä¸å˜ï¼‰ -&gt;   å½“å­¦ä¹ ç‡åœ¨è¿­ä»£æ—©æœŸä¸‹é™è¾ƒå¿«ä¸”å½“å‰è§£ä¾ç„¶ä¸ä½³æ—¶ï¼ŒAdaGradç®—æ³•åœ¨å¾—å¸¦åæœŸç”±äºå­¦ä¹ ç‡è¾ƒå°ï¼Œå¾ˆéš¾æ‰¾åˆ°æœ‰ç”¨è§£ã€‚<h4 id="7-5-3-ä»é›¶å¼€å§‹å®ç°"><a href="#7-5-3-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="7.5.3 ä»é›¶å¼€å§‹å®ç°"></a>7.5.3 ä»é›¶å¼€å§‹å®ç°</h4>easyï¼ŒAdaGradç®—æ³•éœ€è¦å¯¹æ¯ä¸ªè‡ªå˜é‡ç»´æŠ¤å®ƒä¸€æ ·å½¢çŠ¶çš„çŠ¶æ€å˜é‡ã€‚æˆ‘ä»¬æ ¹æ®AdaGradç®—æ³•ä¸­çš„å…¬å¼å®ç°è¯¥ç®—æ³•ã€‚<br>è®­ç»ƒç”¨æ›´å¤§çš„å­¦ä¹ ç‡æ¥è®­ç»ƒæ¨¡å‹ã€‚<h4 id="7-5-4-ç®€æ´å®ç°"><a href="#7-5-4-ç®€æ´å®ç°" class="headerlink" title="7.5.4 ç®€æ´å®ç°"></a>7.5.4 ç®€æ´å®ç°</h4>Trainerå®ä¾‹ä¸­æœ‰â€™adagradâ€™å…³é”®å­—<h3 id="7-6-RMSPropç®—æ³•"><a href="#7-6-RMSPropç®—æ³•" class="headerlink" title="7.6 RMSPropç®—æ³•"></a>7.6 RMSPropç®—æ³•</h3>ä¹‹å‰æåˆ°ï¼ŒAdaGradç®—æ³•ï¼Œå½“å­¦ä¹ ç‡åœ¨è¿­ä»£æ—©æœŸé™å¾—è¾ƒå¿«ä¸”å½“å‰è§£ä¾ç„¶ä¸ä½³æ—¶ï¼ŒAdaGradç®—æ³•åœ¨è¿­ä»£åæœŸç”±äºå­¦ä¹ ç‡è¿‡å°ï¼Œå¯èƒ½è¾ƒéš¾æ‰¾åˆ°ä¸€ä¸ªæœ‰ç”¨çš„è§£ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜RMSPropç®—æ³•å¯¹AdaGradç®—æ³•åšäº†ä¸€ç‚¹å°å°çš„ä¿®æ”¹ã€‚<h4 id="7-6-1-ç®—æ³•"><a href="#7-6-1-ç®—æ³•" class="headerlink" title="7.6.1 ç®—æ³•"></a>7.6.1 ç®—æ³•</h4>ä¹‹å‰è¯´è¿‡æŒ‡æ•°åŠ æƒå¹³å‡ã€‚ä¸åŒäºAdaGradç®—æ³•é‡Œå°†å˜é‡stæ˜¯æˆªè‡³æ—¶é—´æ­¥tæ‰€æœ‰å°æ‰¹é‡éšæœºæ¢¯åº¦gtæŒ‰å…ƒç´ å¹³æ–¹å’Œï¼ŒRMSPropç®—æ³•å°†è¿™äº›æ¢¯åº¦æŒ‰å…ƒç´ å¹³æ–¹åšæŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ã€‚å…·ä½“æ¥è¯´ï¼Œç»™å®šè¶…å‚æ•°0&lt;=y&lt;1ï¼ŒRMSPropåœ¨æ—¶é—´æ­¥&gt;0è®¡ç®—ï¼š<br>$$\boldsymbol{s}<em>t \leftarrow \gamma \boldsymbol{s}</em>{t-1} + (1 - \gamma) \boldsymbol{g}_t \odot \boldsymbol{g}_t. $$<br>xçš„è¿­ä»£ä¸€æ ·ã€‚<br>å› ä¸ºRMSPropç®—æ³•çš„çŠ¶æ€å˜é‡æ˜¯å¯¹å¹³æ–¹é¡¹$\boldsymbol{g}_t \odot \boldsymbol{g}_t$çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä½œæœ€è¿‘1/(1-y)ä¸ªæ—¶é—´æ­¥çš„å°æ‰¹é‡éšæœºæ¢¯åº¦å¹³æ–¹é¡¹çš„åŠ æƒå¹³å‡ã€‚å¦‚æ­¤ä»¥æ¥ï¼Œè‡ªå˜é‡æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å°±ä¸ä¸€ç›´é™ä½ï¼ˆæˆ–ä¸å˜ï¼‰ã€‚ï¼ˆçœ‹ä¸æ‡‚ï¼‰<h4 id="7-6-2-ä»é›¶å¼€å§‹å®ç°"><a href="#7-6-2-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="7.6.2 ä»é›¶å¼€å§‹å®ç°"></a>7.6.2 ä»é›¶å¼€å§‹å®ç°</h4>easy<h4 id="7-6-3-ç®€æ´å®ç°"><a href="#7-6-3-ç®€æ´å®ç°" class="headerlink" title="7,6,3 ç®€æ´å®ç°"></a>7,6,3 ç®€æ´å®ç°</h4>å‚æ•°â€™rmspropâ€™ï¼Œè¶…å‚æ•°å¤šäº†gammal: 0.9ã€‚<h3 id="7-7-AdaDeltaç®—æ³•"><a href="#7-7-AdaDeltaç®—æ³•" class="headerlink" title="7.7 AdaDeltaç®—æ³•"></a>7.7 AdaDeltaç®—æ³•</h3>é™¤äº†RMSPropç®—æ³•ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªå¸¸ç”¨ä¼˜åŒ–ç®—æ³•AdaDeltaç®—æ³•ä¹Ÿé’ˆå¯¹AdaGradç®—æ³•åœ¨è¿­ä»£åæœŸå¯èƒ½è¾ƒéš¾æ‰¾åˆ°æœ‰ç”¨è§£çš„é—®é¢˜åšäº†æ”¹è¿›ã€‚ç‰¹åˆ«çš„æ˜¯ï¼ŒAdaDeltaç®—æ³•æ²¡æœ‰å­¦ä¹ ç‡è¿™ä¸€è¶…å‚æ•°ã€‚<h4 id="7-7-1-ç®—æ³•"><a href="#7-7-1-ç®—æ³•" class="headerlink" title="7.7.1 ç®—æ³•"></a>7.7.1 ç®—æ³•</h4>ç¬¬ä¸€æ­¥å’ŒRMSPropç®—æ³•ä¸€æ ·ï¼Œä½¿ç”¨äº†å°æ‰¹é‡éšæœºæ¢¯åº¦gtæŒ‰å…ƒç´ å¹³æ–¹çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å˜é‡stã€‚åœ¨æ—¶é—´æ­¥0.ï¼Œå®ƒçš„æ‰€æœ‰å…ƒç´ è¢«åˆå§‹åŒ–ä¸º0ã€‚ä¸€æ¯›ä¸€æ ·ï¼Œä¸åŒçš„æ•°ï¼ŒAdaDeltaç®—æ³•è¿˜ç»´æŠ¤ä¸€ä¸ªé¢å¤–çš„çŠ¶æ€å˜é‡$\Delta\boldsymbol{x}<em>t$ã€‚<br>å¯ä»¥çœ‹åˆ°å¦‚æœä¸è€ƒè™‘ç¨³å®šå¸¸æ•°ï¼ŒAdaDeltaç®—æ³•ä¸RMSPropç®—æ³•çš„ä¸åŒä¹‹å¤„åœ¨äºä½¿ç”¨äº†$\sqrt{\Delta\boldsymbol{x}</em>{t-1}}$æ¥æ›¿ä»£è¶…å‚æ•°n,<em>æ²¡æœ‰å­¦ä¹ ç‡ï¼ï¼ï¼è¿™ä¸ªå‚æ•°</em>ã€‚<h4 id="7-7-2-ä»é›¶å¼€å§‹å®ç°"><a href="#7-7-2-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="7.7.2 ä»é›¶å¼€å§‹å®ç°"></a>7.7.2 ä»é›¶å¼€å§‹å®ç°</h4>AdaDeltaç®—æ³•éœ€è¦å¯¹æ¯ä¸ªè‡ªå˜é‡ç»´æŠ¤ä¸¤ä¸ªçŠ¶æ€å˜é‡ï¼Œå³stå’Œ$\Delta\boldsymbol{x}_t$ã€‚æŒ‰å…¬å¼å®ç°ç®—æ³•ã€‚<h4 id="7-7-3-ç®€æ´å®ç°"><a href="#7-7-3-ç®€æ´å®ç°" class="headerlink" title="7.7.3 ç®€æ´å®ç°"></a>7.7.3 ç®€æ´å®ç°</h4>åç§°ä¸ºâ€™adadeltaâ€™çš„Trainerå®ä¾‹ï¼Œè¶…å‚æ•°ç”±â€™rhoâ€™æŒ‡å®šã€‚<h3 id="7-8-Adamç®—æ³•"><a href="#7-8-Adamç®—æ³•" class="headerlink" title="7.8 Adamç®—æ³•"></a>7.8 Adamç®—æ³•</h3><h4 id="7-8-1-ç®—æ³•"><a href="#7-8-1-ç®—æ³•" class="headerlink" title="7.8.1 ç®—æ³•"></a>7.8.1 ç®—æ³•</h4>ï¼ˆåº”è¯¥æœ€å…ˆè¿›çš„å§ï¼‰<br>Adamç®—æ³•ä½¿ç”¨äº†åŠ¨é‡å˜é‡vtå’ŒRMSPropç®—æ³•ä¸­å°æ‰¹é‡éšæœºæ¢¯åº¦æŒ‰å…ƒç´ å¹³æ–¹çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å˜é‡stï¼ˆä¸¤ä¸ªéƒ½åšæŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼‰ã€‚<br>ç”±äºæˆ‘ä»¬å°†v0å’Œs0ä¸­çš„å…ƒç´ ä¸­çš„å…ƒç´ éƒ½åˆå§‹åŒ–ä¸ºé›¶ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“tè¾ƒå°æ—¶ï¼Œè¿‡å»å„æ—¶é—´æ­¥å°æ‰¹é‡éšæœºæ¢¯åº¦æƒå€¼åªå’Œä¼šè¾ƒå°ã€‚åˆ©ç”¨åå·®ä¿®æ­£ã€‚<br>æ¥ä¸‹æ¥Adamç®—æ³•ä½¿ç”¨åå·®ä¿®æ­£ä¹‹åçš„å˜é‡å°†æ¨¡å‹å‚æ•°ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡é€šè¿‡æŒ‰å…ƒç´ é‡æ–°è°ƒæ•´ã€‚<br>æœ€åä½¿ç”¨gtâ€˜è¿­ä»£è‡ªå˜é‡ã€‚<h4 id="7-8-2-ä»é›¶å¼€å§‹å®ç°"><a href="#7-8-2-ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="7.8.2 ä»é›¶å¼€å§‹å®ç°"></a>7.8.2 ä»é›¶å¼€å§‹å®ç°</h4></li>
</ol>
<h2 id="ç¬¬8ç« -è®¡ç®—æ€§èƒ½"><a href="#ç¬¬8ç« -è®¡ç®—æ€§èƒ½" class="headerlink" title="ç¬¬8ç«  è®¡ç®—æ€§èƒ½"></a>ç¬¬8ç«  è®¡ç®—æ€§èƒ½</h2><h3 id="8-1-å‘½ä»¤å¼å’Œç¬¦å·å¼æ··åˆç¼–ç¨‹"><a href="#8-1-å‘½ä»¤å¼å’Œç¬¦å·å¼æ··åˆç¼–ç¨‹" class="headerlink" title="8.1 å‘½ä»¤å¼å’Œç¬¦å·å¼æ··åˆç¼–ç¨‹"></a>8.1 å‘½ä»¤å¼å’Œç¬¦å·å¼æ··åˆç¼–ç¨‹</h3><p>å‘½ä»¤å¼ç¼–ç¨‹å¾ˆæ–¹ä¾¿ï¼Œä½†å®ƒçš„è¿è¡Œå¯èƒ½å¾ˆæ…¢ã€‚<br>ä¸å‘½ä»¤å¼ç¼–ç¨‹ä¸åŒï¼Œç¬¦å·å¼ç¼–ç¨‹é€šå¸¸åœ¨è®¡ç®—æœºæµç¨‹å®Œå…¨å®šä¹‰å¥½åæ‰è¢«æ‰§è¡Œã€‚å¤šä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå¦‚Theanoå’ŒTensorFlowï¼Œéƒ½ä½¿ç”¨äº†ç¬¦å·å¼ç¼–ç¨‹ã€‚é€šå¸¸ï¼Œç¬¦å·å¼ç¼–ç¨‹çš„ç¨‹åºéœ€è¦ä¸‹é¢3ä¸ªæ­¥éª¤ã€‚</p>
<ol>
<li>å®šä¹‰è®¡ç®—æµç¨‹</li>
<li>æŠŠè®¡ç®—æµç¨‹ç¼–è¯‘æˆå¯æ‰§è¡Œçš„ç¨‹åº</li>
<li>ç»™å®šè¾“å…¥ï¼Œè°ƒç”¨ç¼–è¯‘å¥½çš„ç¨‹åºæ‰§è¡Œã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_str</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'''</span></span><br><span class="line"><span class="string">def add(a, b):</span></span><br><span class="line"><span class="string">    return a + b</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fancy_func_str</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'''</span></span><br><span class="line"><span class="string">def fancy_func(a, b, c, d):</span></span><br><span class="line"><span class="string">    e = add(a, b)</span></span><br><span class="line"><span class="string">    f = add(c, d)</span></span><br><span class="line"><span class="string">    g = add(e, f)</span></span><br><span class="line"><span class="string">    return g</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evoke_str</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> add_str() + fancy_func_str() + <span class="string">'''</span></span><br><span class="line"><span class="string">print(fancy_func(1, 2, 3, 4))</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">prog = evoke_str()</span><br><span class="line">print(prog)</span><br><span class="line">y = compile(prog, <span class="string">''</span>, <span class="string">'exec'</span>)</span><br><span class="line">exec(y)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ä»¥ä¸Šå®šä¹‰çš„3ä¸ªå‡½æ•°éƒ½ä»…ä»¥<strong>å­—ç¬¦ä¸²</strong>çš„å½¢å¼è¿”å›è®¡ç®—æµç¨‹ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡compileå‡½æ•°ç¼–è¯‘å®Œæ•´åœ°è·å–æ•´ä¸ªç¨‹åºï¼Œå› æ­¤æœ‰æ›´å¤šç©ºé—´ä¼˜åŒ–è®¡ç®—ï¼Œä¾‹å¦‚ï¼Œç¼–è¯‘çš„æ—¶å€™å¯ä»¥å°†ç¨‹åºæ”¹å†™æˆprint((1+2)+(3+4))ç”šè‡³æ”¹æˆprint(10)ï¼Œè¿™æ ·ä¸ä»…å‡å°‘äº†å‡½æ•°è°ƒç”¨ï¼Œè¿˜èŠ‚çœäº†å†…å­˜ã€‚<br>å¯¹æ¯”ä¸¤ç§ç¼–ç¨‹æ–¹å¼ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š</p>
<ol>
<li>å‘½ä»¤å¼ç¼–ç¨‹æ›´æ–¹ä¾¿ã€‚å½“æˆ‘ä»¬åœ¨Pythoné‡Œä½¿ç”¨å‘½ä»¤å¼ç¼–ç¨‹æ—¶ï¼Œå¤§éƒ¨åˆ†ä»£ç å¾ˆç›´è§‚ã€‚åŒæ—¶ï¼Œå‘½ä»¤å¼ç¼–ç¨‹æ›´å®¹æ˜“è°ƒè¯•ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è·å–å¹¶æ‰“å°æ‰€æœ‰çš„ä¸­é—´å˜é‡å€¼ï¼Œæˆ–è€…ä½¿ç”¨Pythonçš„è°ƒè¯•å·¥å…·ã€‚</li>
<li>ç¬¦å·å¼ç¼–ç¨‹æ›´é«˜æ•ˆå¹¶æ›´å®¹æ˜“ç§»æ¤ã€‚ä¸€æ–¹é¢ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ç³»ç»Ÿå¾ˆå®¹æ˜“åšæ›´å¤šä¼˜åŒ–ï¼›å¦ä¸€æ–¹é¢ï¼Œç¬¦å·å¼ç¼–ç¨‹å¯ä»¥å°†ç¨‹åºç¼–ç¨‹ä¸€ä¸ªä¸Pythonæ— å…³çš„æ ¼å¼ï¼Œä»è€Œå¯ä»¥ä½¿ç¨‹åºåœ¨éPythonç¯å¢ƒä¸‹è¿è¡Œï¼Œä»¥é¿å¼€Pythonè§£é‡Šå™¨çš„æ€§èƒ½é—®é¢˜ã€‚<h4 id="8-1-1-æ··åˆå¼ç¼–ç¨‹å–ä¸¤è€…ä¹‹é•¿"><a href="#8-1-1-æ··åˆå¼ç¼–ç¨‹å–ä¸¤è€…ä¹‹é•¿" class="headerlink" title="8.1.1 æ··åˆå¼ç¼–ç¨‹å–ä¸¤è€…ä¹‹é•¿"></a>8.1.1 æ··åˆå¼ç¼–ç¨‹å–ä¸¤è€…ä¹‹é•¿</h4>Theanoå’Œå—å…¶å¯å‘çš„åæ¥è€…TensorFlowä½¿ç”¨äº†ç¬¦å·å¼ç¼–ç¨‹ï¼ŒChainerå’Œå®ƒçš„è¿½éšè€…PyTorchä½¿ç”¨äº†å‘½ä»¤å¼ç¼–ç¨‹ã€‚<br>Gluonè€ƒè™‘ä½¿ç”¨æ··åˆç¼–ç¨‹ï¼ŒåŒæ—¶å¾—åˆ°ä¸¤è€…å¥½å¤„ã€‚ç”¨ç”¨åº”è¯¥ä½¿ç”¨çº¯å‘½ä»¤å¼è¿›è¡Œå¼€å‘å’Œè°ƒè¯•ï¼›å½“éœ€è¦äº§å“çº§åˆ«çš„è®¡ç®—æ€§èƒ½å’Œéƒ¨ç½²æ—¶ï¼Œç”¨æˆ·å¯ä»¥å°†å¤§éƒ¨åˆ†å‘½ä»¤æ—¶ç¨‹åºè½¬æ¢æˆç¬¦å·å¼ç¨‹åºæ¥è¿è¡Œã€‚Gluoné€šè¿‡æä¾›æ··åˆå¼ç¼–ç¨‹æ–¹å¼åšåˆ°è¿™ä¸€ç‚¹ã€‚<br>åœ¨æ··åˆå¼ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨HybridBlockç±»æˆ–è€…HybridSequentialç±»æ„å»ºæ¨¡å‹ã€‚é»˜è®¤ä»–ä»¬å’ŒBlockç±»å’ŒSequentialç±»ä¸€æ ·ç…§å‘½ä»¤å¼ç¼–ç¨‹çš„æ–¹å¼æ‰§è¡Œï¼Œä½†æ˜¯å½“è°ƒç”¨hybridizeå‡½æ•°åï¼ŒGluonä¼šè½¬æ¢æˆä¾æ®ç¬¦å·å¼ç¼–ç¨‹çš„æ–¹å¼æ‰§è¡Œã€‚<h4 id="8-1-2-ä½¿ç”¨HybridSequentialç±»æ„é€ æ¨¡å‹"><a href="#8-1-2-ä½¿ç”¨HybridSequentialç±»æ„é€ æ¨¡å‹" class="headerlink" title="8.1.2 ä½¿ç”¨HybridSequentialç±»æ„é€ æ¨¡å‹"></a>8.1.2 ä½¿ç”¨HybridSequentialç±»æ„é€ æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> nd, sym</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_net</span><span class="params">()</span>:</span></span><br><span class="line">    net = nn.HybridSequential()  <span class="comment"># è¿™é‡Œåˆ›å»ºHybridSequentialå®ä¾‹</span></span><br><span class="line">    net.add(nn.Dense(<span class="number">256</span>, activation=<span class="string">'relu'</span>),</span><br><span class="line">            nn.Dense(<span class="number">128</span>, activation=<span class="string">'relu'</span>),</span><br><span class="line">            nn.Dense(<span class="number">2</span>))</span><br><span class="line">    net.initialize()</span><br><span class="line">    <span class="keyword">return</span> net</span><br><span class="line"></span><br><span class="line">x = nd.random.normal(shape=(<span class="number">1</span>, <span class="number">512</span>))</span><br><span class="line">net = get_net()</span><br><span class="line">net(x)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>å°±æ˜¯æ›¿ä»£äº†ä»¥å‰çš„Sequentialå®ä¾‹ï¼Œ<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨hybridizeå‡½æ•°æ¥ç¼–è¯‘å’Œä¼˜åŒ–HbridSequentialå®ä¾‹ä¸­ä¸²è”çš„å±‚çš„è®¡ç®—ã€‚<br><strong>æ³¨æ„åªæœ‰ç»§æ‰¿HybridBlockç±»çš„å±‚æ‰ä¼šè¢«ä¼˜åŒ–è®¡ç®—ã€‚ä¾‹å¦‚HybridSequentialç±»å’ŒGluonæä¾›çš„Denseç±»éƒ½æ˜¯HybrudBlockç±»çš„å­ç±»ï¼Œä»–ä»¬ä¼šè¢«ä¼˜åŒ–è®¡ç®—ã€‚å¦‚æœä¸€ä¸ªå±‚åªæ˜¯ç»§æ‰¿è‡ªBlockç±»è€Œä¸æ˜¯HybridBlockç±»ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ä¼šè¢«ä¼˜åŒ–</strong></p>
<ol>
<li>è®¡ç®—æ€§èƒ½<br>è°ƒç”¨net.hybridize()ä¹‹åæ—¶é—´å‡å°</li>
<li>è·å–ç¬¦å·å¼ç¨‹åº<br><code>net.export(&#39;my_mlp&#39;)</code>ä¼šç”Ÿæˆ.jsonå’Œ.paramsæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºç¬¦å·å¼ç¨‹åºå’Œæ¨¡å‹å‚æ•°ã€‚å¯ä»¥è¢«Pythonæˆ–mxnetæ”¯æŒçš„å…¶ä»–å‰ç«¯è¯­è¨€è·å–ï¼Œå¦‚C++,R,Scala,Perlå’Œå…¶ä»–è¯­è¨€ã€‚è¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨å…¶ä»–å‰ç«¯è¯­è¨€æˆ–è€…å…¶ä»–è®¾å¤‡ä¸Šéƒ¨ç½²è®­ç»ƒå¥½çš„æ¨¡å‹ã€‚åŒæ—¶ï¼Œç”±äºéƒ¨ç½²æ—¶ä½¿ç”¨çš„æ˜¯ç¬¦å·å¼ç¼–ç¨‹ï¼Œè®¡ç®—æ€§èƒ½å¾€å¾€æ¯”å‘½ä»¤å¼ç¨‹åºçš„æ€§èƒ½æ›´å¥½ã€‚</li>
</ol>
<p><strong>åœ¨MXNetç±»ä¸­ï¼Œç¬¦å·å¼ç¨‹åºæŒ‡çš„å¼åŸºäºSymbolç±»å‹çš„ç¨‹åºã€‚</strong><br>æˆ‘ä»¬çŸ¥é“ï¼Œå½“ç»™netæä¾›NDArrayç±»å‹çš„è¾“å…¥xåï¼Œnet(x)ä¼šæ ¹æ®xç›´æ¥è®¡ç®—æ¨¡å‹è¾“å‡ºå¹¶è¿”å›ç»“æœã€‚å¯¹äºè°ƒç”¨è¿‡hybridizeå‡½æ•°åçš„æ¨¡å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»™å®ƒè¾“å…¥ä¸€ä¸ªSymbolç±»å‹çš„å˜é‡ï¼Œnet(x)ä¼šè¿”å›Symbolç±»å‹çš„ç»“æœ</p>
<h4 id="8-1-3-ä½¿ç”¨HybridBlockç±»æ„é€ æ¨¡å‹"><a href="#8-1-3-ä½¿ç”¨HybridBlockç±»æ„é€ æ¨¡å‹" class="headerlink" title="8.1.3 ä½¿ç”¨HybridBlockç±»æ„é€ æ¨¡å‹"></a>8.1.3 ä½¿ç”¨HybridBlockç±»æ„é€ æ¨¡å‹</h4><p>å’ŒSequentialç±»ä¸Blockç±»ä¹‹é—´çš„å…³ç³»ä¸€æ ·ï¼ŒHybridSequentialç±»ç»§æ‰¿è‡ªHybridBlockç±»ã€‚ä¸Blockå®ç°forwardå‡½æ•°ä¸å¤ªä¸€æ ·ï¼Œå¯¹äºHybridBlockå®ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å®ç°hybrid_forwardå‡½æ•°ã€‚<br>è°ƒç”¨hybridizeå‡½æ•°åçš„æ¨¡å‹è®¡ç®—æ€§èƒ½å’Œå¯ç§»æ¤æ€§ã€‚ä½†æ˜¯è°ƒç”¨hybridizeå‡½æ•°åçš„æ¨¡å‹ä¼šå½±å“çµæ´»æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HybridNet</span><span class="params">(nn.HybridBlock)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        super(HybridNet, self).__init__(**kwargs)</span><br><span class="line">        self.hidden = nn.Dense(<span class="number">10</span>)</span><br><span class="line">        self.output = nn.Dense(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hybrid_forward</span><span class="params">(self, F, x)</span>:</span></span><br><span class="line">        print(<span class="string">'F: '</span>, F)</span><br><span class="line">        print(<span class="string">'x: '</span>, x)</span><br><span class="line">        x = F.relu(self.hidden(x))</span><br><span class="line">        print(<span class="string">'hidden: '</span>, x)</span><br><span class="line">        <span class="keyword">return</span> self.output(x)</span><br></pre></td></tr></table></figure>

<p>åœ¨hybrid_forwardå‡½æ•°ä¸­è¿™é‡Œæœ‰ä¸ªFï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒMXNetæ—¢æœ‰åŸºäºå‘½ä»¤å¼ç¼–ç¨‹çš„NDArrayç±»ï¼Œåˆæœ‰åŸºäºç¬¦å·å¼ç¼–ç¨‹çš„symbolç±»ã€‚ç”±äºè¿™ä¸ªä¸¤ä¸ªç±»çš„å‡½æ•°åŸºæœ¬ä¸€è‡´ï¼ŒMXNetä¼šæ ¹æ®è¾“å…¥æ¥å†³å®šFä½¿ç”¨NDArrayè¿˜æ˜¯Symbolã€‚<br>ä¹‹ååšå®éªŒå‘ç°ï¼Œå¯¹äºNDArrayæ‰§è¡Œä¸€æ¬¡å’Œè¿›è¡Œä¸€æ¬¡å‰å‘è®¡ç®—ç»“æœä¸å˜ï¼Œä½†æ˜¯è°ƒç”¨net.hybridize()åï¼Œæ ‡å¿—ç¼–ç¨‹symbolå¹¶ä¸”ï¼Œè¿›è¡Œä¸€æ¬¡å‰å‘è®¡ç®—æ— æ‰“å°ç»“æœï¼ŒåŸå› æ˜¯ï¼šä¸Šä¸€æ¬¡è°ƒç”¨hybridizeå‡½æ•°åè¿è¡Œnet(x)çš„æ—¶å€™ï¼Œç¬¦å·å¼ç¨‹åºå·²ç»å¾—åˆ°ã€‚ä¹‹åå†è¿è¡Œnet(x)çš„æ—¶å€™MXNetå°†ä¸å†è®¿é—®Pythonä»£ç ï¼Œè€Œæ˜¯ç›´æ¥åœ¨C++åç«¯æ‰§è¡Œç¬¦å·å¼ç¨‹åºã€‚è¿™ä¹Ÿæ˜¯è°ƒç”¨äº†hybridizeå‡½æ•°åæ¨¡å‹è®¡ç®—æ€§èƒ½ä¼šæå‡çš„ä¸€ä¸ªåŸå› ã€‚<br>ä½†ä¼šå—æŸå¤±çµæ´»æ€§ï¼š</p>
<ul>
<li>åƒè¿™ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨3æ¡æ‰“å°è¯­å¥è°ƒè¯•ä»£ç ï¼Œæ‰§è¡Œç¬¦å·å¼ç¼–ç¨‹æ— æ³•æ‰“å°ã€‚</li>
<li>å¯¹äºasnumpyè¿™æ ·Symbolæ‰€ä¸æ”¯æŒçš„å‡½æ•°ï¼Œä»¥åŠåƒa +=bå’Œa[:] = a + bï¼ˆéœ€æ”¹å†™ä¸ºa= a + bï¼‰è¿™æ ·çš„åŸåœ°ï¼ˆin-placeï¼‰æ“ä½œï¼Œæˆ‘ä»¬æ— æ³•åœ¨hybrid_forwardå‡½æ•°ä¸­ä½¿ç”¨å¹¶åœ¨è°ƒç”¨hybridizeå‡½æ•°åè¿›è¡Œå‰å‘è®¡ç®—ã€‚<h3 id="8-2-å¼‚æ­¥è®¡ç®—"><a href="#8-2-å¼‚æ­¥è®¡ç®—" class="headerlink" title="8.2 å¼‚æ­¥è®¡ç®—"></a>8.2 å¼‚æ­¥è®¡ç®—</h3>MXNetä½¿ç”¨å¼‚æ­¥è®¡ç®—æ¥æå‡è®¡ç®—æ€§èƒ½ã€‚ç†è§£å®ƒçš„å·¥ä½œåŸç†æ—¢æœ‰åŠ©äºå¼€å‘æ›´é«˜æ•ˆçš„ç¨‹åºï¼Œåˆæœ‰åŠ©äºå†…å­˜èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ä¸»åŠ¨é™ä½è®¡ç®—æ€§èƒ½ä»è€Œå‡å°å†…å­˜å¼€é”€ã€‚<h4 id="8-2-1-MXNetä¸­çš„å¼‚æ­¥è®¡ç®—"><a href="#8-2-1-MXNetä¸­çš„å¼‚æ­¥è®¡ç®—" class="headerlink" title="8.2.1 MXNetä¸­çš„å¼‚æ­¥è®¡ç®—"></a>8.2.1 MXNetä¸­çš„å¼‚æ­¥è®¡ç®—</h4>å¹¿ä¹‰ä¸Šæ¥è®²ï¼ŒMXNetåŒ…æ‹¬ï¼š</li>
<li>ç”¨æˆ·ç›´æ¥ç”¨æ¥äº¤äº’çš„å‰ç«¯</li>
<li>ç³»ç»Ÿç”¨æ¥æ‰§è¡Œè®¡ç®—çš„åç«¯<br>ç”¨æˆ·å†™å¥½çš„å‰ç«¯MXNetç¨‹åºä¼šä¼ ç»™åç«¯æ‰§è¡Œè®¡ç®—ã€‚åç«¯æœ‰è‡ªå·±çš„çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­ä¸æ–­æ”¶é›†ä»»åŠ¡å¹¶æ‰§è¡Œå®ƒä»¬ã€‚<br>MXNeté€šè¿‡å‰ç«¯çº¿ç¨‹å’Œåç«¯çº¿ç¨‹çš„äº¤äº’å®ç°å¼‚æ­¥è®¡ç®—ã€‚å¼‚æ­¥è®¡ç®—æ˜¯æŒ‡ï¼Œå‰ç«¯çº¿ç¨‹æ— é¡»ç­‰å¾…å½“å‰æŒ‡ä»¤ä»åç«¯çº¿ç¨‹è¿”å›ç»“æœå°±ç»§ç»­æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚<br>å¾ˆå¤šç®€å•ä¾‹å­<br><img src="/2020/01/22/dive-into-deep-learning/ac.png" alt="ac"><br>é™¤éæˆ‘ä»¬éœ€è¦æ‰“å°æˆ–ä¿å­˜è®¡ç®—ç»“æœï¼Œå¦åˆ™æˆ‘ä»¬æ— é¡»å…³å¿ƒç›®å‰ç»“æœåœ¨å†…å­˜ä¸­æ˜¯å¦å·²ç»è®¡ç®—å¥½äº†ã€‚åªè¦æ•°æ®æ˜¯ä¿å­˜åœ¨NDArrayé‡Œå¹¶ä½¿ç”¨MXNetæä¾›çš„è¿ç®—ç¬¦ï¼ŒMXNetå°†é»˜è®¤ä½¿ç”¨å¼‚æ­¥è®¡ç®—æ¥è·å–é«˜æ€§èƒ½ã€‚<h4 id="8-2-2-ç”¨åŒæ­¥å‡½æ•°è®©å‰ç«¯ç­‰å¾…è®¡ç®—ç»“æœ"><a href="#8-2-2-ç”¨åŒæ­¥å‡½æ•°è®©å‰ç«¯ç­‰å¾…è®¡ç®—ç»“æœ" class="headerlink" title="8.2.2 ç”¨åŒæ­¥å‡½æ•°è®©å‰ç«¯ç­‰å¾…è®¡ç®—ç»“æœ"></a>8.2.2 ç”¨åŒæ­¥å‡½æ•°è®©å‰ç«¯ç­‰å¾…è®¡ç®—ç»“æœ</h4>æœ‰è®¸å¤šæ–¹æ³•è®©å‰ç«¯çº¿ç¨‹ç­‰å¾…åç«¯è®¡ç®—ç»“æœå®Œæˆï¼š</li>
<li>printå‡½æ•°</li>
<li>ä½¿ç”¨wait_to_readå‡½æ•°è®©å‰ç«¯ç­‰å¾…æŸä¸ªçš„NDArrayçš„è®¡ç®—ç»“æœå®Œæˆï¼Œå†æ‰§è¡Œåé¢çš„è¯­å¥</li>
<li>ç”¨waitallå‡½æ•°é›¶å‰ç«¯å‰é¢æ‰€æœ‰è®¡ç®—ç»“æœå®Œæˆï¼Œè¿™æ˜¯æ€§èƒ½æµ‹è¯•ä¸­å¸¸ç”¨çš„æ–¹æ³•<br>ä¸€çœ‹å°±ä¼š<br><img src="/2020/01/22/dive-into-deep-learning/wait.png" alt="wait"><br>æ­¤å¤–ï¼Œä»»ä½•å°†NDArrayè½¬æ¢æˆå…¶ä»–ä¸æ”¯æŒå¼‚æ­¥è®¡ç®—çš„æ•°æ®ç»“æ„çš„æ“ä½œéƒ½ä¼šè®©å‰ç«¯ç­‰å¾…è®¡ç®—ç»“æœã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è°ƒç”¨asnumpyå‡½æ•°å’Œasscalarå‡½æ•°æ—¶ã€‚</li>
</ul>
<p><strong>ä¸Šé¢ä»‹ç»çš„wait_to_readå‡½æ•°ã€waitallå‡½æ•°ã€asnumpyå‡½æ•°ã€asscalarå‡½æ•°å’Œprintå‡½æ•°ä¼šè§¦å‘è®©å‰ç«¯ç­‰å¾…åç«¯è®¡ç®—ç»“æœçš„è¡Œä¸ºã€‚è¿™ç±»å‡½æ•°é€šå¸¸ç§°ä¸ºåŒæ­¥å‡½æ•°ã€‚</strong></p>
<h4 id="8-2-3-ä½¿ç”¨å¼‚æ­¥è®¡ç®—æå‡è®¡ç®—æ€§èƒ½"><a href="#8-2-3-ä½¿ç”¨å¼‚æ­¥è®¡ç®—æå‡è®¡ç®—æ€§èƒ½" class="headerlink" title="8.2.3 ä½¿ç”¨å¼‚æ­¥è®¡ç®—æå‡è®¡ç®—æ€§èƒ½"></a>8.2.3 ä½¿ç”¨å¼‚æ­¥è®¡ç®—æå‡è®¡ç®—æ€§èƒ½</h4><p>åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨forå¾ªç¯ä¸æ–­å¯¹å˜é‡yèµ‹å€¼ã€‚å½“åœ¨forå¾ªç¯å†…ä½¿ç”¨åŒæ­¥å‡½æ•°wait_to_readæ—¶ï¼Œæ¯æ¬¡èµ‹å€¼ä¸ä½¿ç”¨å¼‚æ­¥è®¡ç®—ï¼›å½“åœ¨forå¾ªç¯å¤–ä½¿ç”¨åŒæ­¥å‡½æ•°waitallæ—¶ï¼Œåˆ™ä½¿ç”¨å¼‚æ­¥è®¡ç®—ã€‚<br>ä½¿ç”¨å¼‚æ­¥è®¡ç®—èƒ½æå‡ä¸€å®šçš„è®¡ç®—æ€§èƒ½ã€‚<br>æˆ‘ä»¬å°†è¿™3ä¸ªé˜¶æ®µçš„è€—æ—¶åˆ†åˆ«è®¾ä¸º t1,t2,t3 ã€‚å¦‚æœä¸ä½¿ç”¨å¼‚æ­¥è®¡ç®—ï¼Œæ‰§è¡Œ1000æ¬¡è®¡ç®—çš„æ€»è€—æ—¶å¤§çº¦ä¸º 1000(t1+t2+t3) ï¼›å¦‚æœä½¿ç”¨å¼‚æ­¥è®¡ç®—ï¼Œç”±äºæ¯æ¬¡å¾ªç¯ä¸­å‰ç«¯éƒ½æ— é¡»ç­‰å¾…åç«¯è¿”å›è®¡ç®—ç»“æœï¼Œæ‰§è¡Œ1000æ¬¡è®¡ç®—çš„æ€»è€—æ—¶å¯ä»¥é™ä¸º t1+1000t2+t3 ï¼ˆå‡è®¾ 1000t2&gt;999t1ï¼Œå¯èƒ½æˆ‘çš„macä¸æ»¡è¶³ ï¼‰ã€‚</p>
<h4 id="8-2-4-å¼‚æ­¥è®¡ç®—å¯¹å†…å­˜çš„å½±å“"><a href="#8-2-4-å¼‚æ­¥è®¡ç®—å¯¹å†…å­˜çš„å½±å“" class="headerlink" title="8.2.4 å¼‚æ­¥è®¡ç®—å¯¹å†…å­˜çš„å½±å“"></a>8.2.4 å¼‚æ­¥è®¡ç®—å¯¹å†…å­˜çš„å½±å“</h4><p>66666:<br>ä¹‹å‰æˆ‘ä»¬è®­ç»ƒæ¨¡å‹æ˜¯åœ¨æ¯ä¸ªå°æ‰¹é‡ä¸Šè®­ç»ƒä¹‹åï¼Œè¯„æµ‹ä»¥ä¸‹æ¨¡å‹ï¼Œå¦‚æ¨¡å‹çš„æŸå¤±æˆ–å‡†ç¡®ç‡ï¼Œé€šå¸¸ä¼šä½¿ç”¨åŒæ­¥å‡½æ•°ï¼Œå¦‚asscalarå‡½æ•°æˆ–è€…asnumpyå‡½æ•°ã€‚å¦‚æœå»æ‰è¿™äº›åŒæ­¥å‡½æ•°ï¼Œå‰ç«¯ä¼šå°†å¤§é‡çš„å°æ‰¹é‡è®¡ç®—ä»»åŠ¡åœ¨æçŸ­çš„æ—¶é—´ä¸¢ç»™åç«¯ï¼Œä»è€Œå¯èƒ½å¯¼è‡´å ç”¨æ›´å¤šå†…å­˜ã€‚å½“æˆ‘ä»¬åœ¨æ¯ä¸ªå°æ‰¹é‡ä¸Šä½¿ç”¨åŒæ­¥å‡½æ•°æ—¶ï¼Œå‰ç«¯æ¯æ¬¡åœ¨è¿­ä»£æ—¶ä»…ä¼šè®²ä¸€ä¸ªå°æ‰¹é‡çš„ä»»åŠ¡ä¸¢ç»™åç«¯æ‰§è¡Œè®¡ç®—ï¼Œå¹¶é€šå¸¸ä¼šå‡å°å†…å­˜å ç”¨ã€‚<br>å†…å­˜èµ„æºæœ‰é™ï¼Œå»ºè®®å¤§å®¶åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œå¯¹æ¯ä¸ªå°æ‰¹é‡ä½¿ç”¨åŒæ­¥å‡½æ•°ã€‚é¢„æµ‹ä¹Ÿåœ¨æ¯ä¸ªå°æ‰¹é‡ç”¨åŒæ­¥å‡½æ•°ã€‚<br>ä¾‹å­ä¸­å‘ç°ï¼Œä½¿ç”¨åŒæ­¥å‡½æ•°ï¼Œæ—¶é—´ä¼šå˜é•¿ï¼Œä½†å†…å­˜å ç”¨å˜å°‘ã€‚</p>
<h3 id="8-3-è‡ªåŠ¨å¹¶è¡Œè®¡ç®—"><a href="#8-3-è‡ªåŠ¨å¹¶è¡Œè®¡ç®—" class="headerlink" title="8.3 è‡ªåŠ¨å¹¶è¡Œè®¡ç®—"></a>8.3 è‡ªåŠ¨å¹¶è¡Œè®¡ç®—</h3><h4 id="8-3-1-CPUå’ŒGPUçš„å¹¶è¡Œè®¡ç®—"><a href="#8-3-1-CPUå’ŒGPUçš„å¹¶è¡Œè®¡ç®—" class="headerlink" title="8.3.1 CPUå’ŒGPUçš„å¹¶è¡Œè®¡ç®—"></a>8.3.1 CPUå’ŒGPUçš„å¹¶è¡Œè®¡ç®—</h4><h4 id="8-3-2-è®¡ç®—å’Œé€šä¿¡çš„å¹¶è¡Œè®¡ç®—"><a href="#8-3-2-è®¡ç®—å’Œé€šä¿¡çš„å¹¶è¡Œè®¡ç®—" class="headerlink" title="8.3.2 è®¡ç®—å’Œé€šä¿¡çš„å¹¶è¡Œè®¡ç®—"></a>8.3.2 è®¡ç®—å’Œé€šä¿¡çš„å¹¶è¡Œè®¡ç®—</h4><h3 id="8-4-å¤šGPUè®¡ç®—"><a href="#8-4-å¤šGPUè®¡ç®—" class="headerlink" title="8.4 å¤šGPUè®¡ç®—"></a>8.4 å¤šGPUè®¡ç®—</h3><h4 id="8-4-1-æ•°æ®å¹¶è¡Œ"><a href="#8-4-1-æ•°æ®å¹¶è¡Œ" class="headerlink" title="8.4.1 æ•°æ®å¹¶è¡Œ"></a>8.4.1 æ•°æ®å¹¶è¡Œ</h4><h4 id="8-4-2-å®šä¹‰æ¨¡å‹"><a href="#8-4-2-å®šä¹‰æ¨¡å‹" class="headerlink" title="8.4.2 å®šä¹‰æ¨¡å‹"></a>8.4.2 å®šä¹‰æ¨¡å‹</h4><h4 id="8-4-3-å¤šGPUä¹‹é—´åŒæ­¥æ•°æ®"><a href="#8-4-3-å¤šGPUä¹‹é—´åŒæ­¥æ•°æ®" class="headerlink" title="8.4.3 å¤šGPUä¹‹é—´åŒæ­¥æ•°æ®"></a>8.4.3 å¤šGPUä¹‹é—´åŒæ­¥æ•°æ®</h4><h4 id="8-4-4-å•ä¸ªå°æ‰¹é‡ä¸Šçš„å¤šGPUè®­ç»ƒ"><a href="#8-4-4-å•ä¸ªå°æ‰¹é‡ä¸Šçš„å¤šGPUè®­ç»ƒ" class="headerlink" title="8.4.4 å•ä¸ªå°æ‰¹é‡ä¸Šçš„å¤šGPUè®­ç»ƒ"></a>8.4.4 å•ä¸ªå°æ‰¹é‡ä¸Šçš„å¤šGPUè®­ç»ƒ</h4><h4 id="8-4-5-å®šä¹‰è®­ç»ƒå‡½æ•°"><a href="#8-4-5-å®šä¹‰è®­ç»ƒå‡½æ•°" class="headerlink" title="8.4.5 å®šä¹‰è®­ç»ƒå‡½æ•°"></a>8.4.5 å®šä¹‰è®­ç»ƒå‡½æ•°</h4><h4 id="8-4-6-å¤šGPUè®­ç»ƒå®éªŒ"><a href="#8-4-6-å¤šGPUè®­ç»ƒå®éªŒ" class="headerlink" title="8.4.6 å¤šGPUè®­ç»ƒå®éªŒ"></a>8.4.6 å¤šGPUè®­ç»ƒå®éªŒ</h4><h3 id="8-5-å¤šGPUè®¡ç®—çš„ç®€æ´å®ç°"><a href="#8-5-å¤šGPUè®¡ç®—çš„ç®€æ´å®ç°" class="headerlink" title="8.5 å¤šGPUè®¡ç®—çš„ç®€æ´å®ç°"></a>8.5 å¤šGPUè®¡ç®—çš„ç®€æ´å®ç°</h3><h4 id="8-5-1-å¤šGPUä¸Šåˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#8-5-1-å¤šGPUä¸Šåˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="8.5.1 å¤šGPUä¸Šåˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>8.5.1 å¤šGPUä¸Šåˆå§‹åŒ–æ¨¡å‹å‚æ•°</h4><h4 id="8-5-2-å¤šGPUè®­ç»ƒæ¨¡å‹"><a href="#8-5-2-å¤šGPUè®­ç»ƒæ¨¡å‹" class="headerlink" title="8.5.2 å¤šGPUè®­ç»ƒæ¨¡å‹"></a>8.5.2 å¤šGPUè®­ç»ƒæ¨¡å‹</h4><h2 id="ç¬¬9ç« -è®¡ç®—æœºè§†è§‰"><a href="#ç¬¬9ç« -è®¡ç®—æœºè§†è§‰" class="headerlink" title="ç¬¬9ç«  è®¡ç®—æœºè§†è§‰"></a>ç¬¬9ç«  è®¡ç®—æœºè§†è§‰</h2><p><img src="/2020/01/22/dive-into-deep-learning/cv.png" alt="wait"><br>å‰é¢å·²ç»å®è·µäº†ç®€å•å›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚</p>
<ol>
<li>å…ˆä»‹ç»ä¸¤ç§æœ‰åŠ©äºæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›çš„æ–¹æ³•ã€‚å³å›¾åƒå¢å¹¿å’Œå¾®è°ƒï¼Œå¹¶å°†å®ƒä»¬ç”¨äºå›¾åƒåˆ†ç±»ã€‚ï¼ˆç”±äºæ·±åº¦ç¥ç»ç½‘ç»œèƒ½å¤Ÿå¯¹å›¾åƒé€çº§æœ‰æ•ˆåœ°è¿›è¡Œè¡¨å¾ï¼Œè¿™ä¸€ç‰¹æ€§è¢«å¹¿æ³›åº”ç”¨åœ¨ç›®æ ‡æ£€æµ‹ï¼Œè¯­ä¹‰åˆ†å‰²å’Œæ ·å¼è¿ç§»è¿™äº›ä¸»æµè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­ï¼Œå¹¶å–å¾—äº†æˆåŠŸï¼‰</li>
<li>å›´ç»•è¿™ä¸€æ€æƒ³ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å°†æè¿°ç›®æ ‡æ£€æµ‹çš„å·¥ä½œæµç¨‹ä¸å„ç±»æ–¹æ³•ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†æ¢ç©¶å¦‚ä½•ä½¿ç”¨å…¨å·ç§¯ç½‘ç»œå¯¹å›¾åƒåšè¯­ä¹‰åˆ†å‰²ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†è§£é‡Šå¦‚ä½•ä½¿ç”¨æ ·å¼è¿ç§»æŠ€æœ¯ç”Ÿæˆåƒä¹¦æœ¬æ˜é¢ä¸€æ ·çš„å›¾åƒ</li>
<li>æœ€åï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¸ªè®¡ç®—æœºè§†è§‰çš„é‡è¦æ•°æ®é›†ä¸Šå®è·µæœ¬ç« å’Œå‰å‡ ç« çš„çŸ¥è¯†ã€‚</li>
</ol>
<h3 id="9-1-å›¾åƒå¢å¹¿"><a href="#9-1-å›¾åƒå¢å¹¿" class="headerlink" title="9.1 å›¾åƒå¢å¹¿"></a>9.1 å›¾åƒå¢å¹¿</h3><p>æ•°æ®è¶Šå¤š,æ·±åº¦ç¥ç»ç½‘ç»œè¶ŠæˆåŠŸã€‚</p>
<ul>
<li>å›¾åƒå¢å¹¿æŠ€æœ¯é€šè¿‡å¯¹è®­ç»ƒå›¾åƒåšä¸€äº›åˆ—éšæœºæ”¹å˜ï¼Œæ¥äº§ç”Ÿç›¸ä¼¼ä½†ä¸åŒçš„æ ·æœ¬ï¼Œæ‰©å¤§äº†æ•°æ®é›†çš„è§„æ¨¡ã€‚</li>
<li>å¦å¤–ï¼Œå›¾åƒå¢å¹¿ï¼Œéšæœºæ”¹å˜æ ·æœ¬å¯é™ä½æ¨¡å‹å¯¹æŸäº›å…ƒç´ çš„ä»¥æ¥ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥å¯¹å›¾åƒè¿›è¡Œä¸åŒæ–¹å¼çš„è£å‰ªï¼Œä½¿æ„Ÿå…´è¶£çš„ç‰©ä½“åœ¨ä¸åŒä½ç½®ï¼Œå‡å°å¯¹ä½ç½®çš„ä¾èµ–æ€§ï¼Œä¹Ÿå¯ä»¥è°ƒæ•´äº®åº¦ã€è‰²å½©ç­‰å› ç´ æ¥é™ä½å¯¹è‰²å½©çš„æ•æ„Ÿåº¦ã€‚ï¼‰<h4 id="9-1-1-å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•"><a href="#9-1-1-å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•" class="headerlink" title="9.1.1 å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•"></a>9.1.1 å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_images</span><span class="params">(imgs, num_rows, num_cols, scale=<span class="number">2</span>)</span>:</span> <span class="comment"># å®šä¹‰ç»˜å›¾å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">apply</span><span class="params">(img, aug, num_rows=<span class="number">2</span>, num_cols=<span class="number">4</span>, scale=<span class="number">1.5</span>)</span>:</span>  <span class="comment"># å¤§éƒ¨åˆ†å›¾åƒå¢å¹¿çš„æ–¹æ³•å…·æœ‰ä¸€å®šçš„éšæœºæ€§ã€‚ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿå›¾åƒå¢å¹¿çš„æ•ˆæœï¼Œç”¨ä¸€ä¸ªè¾…åŠ©å‡½æ•°applyã€‚å¯¹è¾“å…¥å›¾åƒimgå¤šæ¬¡è¿è¡Œå›¾åƒå¢å¹¿æ–¹æ³•augå¹¶å±•ç¤ºæ‰€æœ‰çš„ç»“æœã€‚</span></span><br><span class="line">    Y = [aug(img) <span class="keyword">for</span> _ <span class="keyword">in</span> range(num_rows * num_cols)]</span><br><span class="line">    show_images(Y, num_rows, num_cols, scale)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>ç¿»è½¬å’Œè£å‰ª</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éšæœºç¿»è½¬å·¦å³ ä¸€åŠçš„æ¦‚ç‡</span></span><br><span class="line">apply(img, gdata.vision.transforms.RandomFlipLeftRight())   </span><br><span class="line"><span class="comment">#éšæœºç¿»è½¬ä¸Šä¸‹</span></span><br><span class="line">apply(img, gdata.vision.transforms.RandomFlipTopBottom())    </span><br><span class="line"></span><br><span class="line"><span class="comment">#éšæœºè£å‰ªæ¯æ¬¡éšæœºè£å‰ªå‡ºä¸€å—é¢ç§¯ä¸ºåŸé¢ç§¯ 10%âˆ¼100% çš„åŒºåŸŸï¼Œä¸”è¯¥åŒºåŸŸçš„å®½å’Œé«˜ä¹‹æ¯”éšæœºå–è‡ª 0.5âˆ¼2 ï¼Œç„¶åå†å°†è¯¥åŒºåŸŸçš„å®½å’Œé«˜åˆ†åˆ«ç¼©æ”¾åˆ°200åƒç´ </span></span><br><span class="line">shape_aug = gdata.vision.transforms.RandomResizedCrop(</span><br><span class="line">    (<span class="number">200</span>, <span class="number">200</span>), scale=(<span class="number">0.1</span>, <span class="number">1</span>), ratio=(<span class="number">0.5</span>, <span class="number">2</span>))    </span><br><span class="line">apply(img, shape_aug)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å˜åŒ–é¢œè‰²</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å›¾åƒçš„äº®åº¦éšæœºå˜åŒ–ä¸ºåŸå›¾äº®åº¦çš„ 50% ï¼ˆå³ 1âˆ’0.5 ï¼‰ âˆ¼150% ï¼ˆå³ 1+0.5 ï¼‰ã€‚</span></span><br><span class="line">apply(img, gdata.vision.transforms.RandomBrightness(<span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#éšæœºå˜åŒ–å›¾åƒçš„è‰²è°ƒã€‚</span></span><br><span class="line">apply(img, gdata.vision.transforms.RandomHue(<span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºRandomColorJitterå®ä¾‹å¹¶åŒæ—¶è®¾ç½®å¦‚ä½•éšæœºå˜åŒ–å›¾åƒçš„äº®åº¦ï¼ˆbrightnessï¼‰ã€å¯¹æ¯”åº¦ï¼ˆcontrastï¼‰ã€é¥±å’Œåº¦ï¼ˆsaturationï¼‰å’Œè‰²è°ƒï¼ˆhueï¼‰ã€‚</span></span><br><span class="line">color_aug = gdata.vision.transforms.RandomColorJitter(</span><br><span class="line">    brightness=<span class="number">0.5</span>, contrast=<span class="number">0.5</span>, saturation=<span class="number">0.5</span>, hue=<span class="number">0.5</span>)</span><br><span class="line">apply(img, color_aug)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å åŠ å¤šä¸ªå›¾åƒå¢å¹¿æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å¤šä¸ªå›¾åƒå¢å¹¿æ–¹æ³•å åŠ ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Composeå®ä¾‹å°†ä¸Šé¢å®šä¹‰çš„å¤šä¸ªå›¾åƒå¢å¹¿æ–¹æ³•å åŠ èµ·æ¥ï¼Œå†åº”ç”¨åˆ°æ¯å¼ å›¾åƒä¹‹ä¸Šã€‚</span></span><br><span class="line">augs = gdata.vision.transforms.Compose([</span><br><span class="line">    gdata.vision.transforms.RandomFlipLeftRight(), color_aug, shape_aug])</span><br><span class="line">apply(img, augs)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="9-1-2-ä½¿ç”¨å›¾åƒå¢å¹¿è®­ç»ƒæ¨¡å‹"><a href="#9-1-2-ä½¿ç”¨å›¾åƒå¢å¹¿è®­ç»ƒæ¨¡å‹" class="headerlink" title="9.1.2 ä½¿ç”¨å›¾åƒå¢å¹¿è®­ç»ƒæ¨¡å‹"></a>9.1.2 ä½¿ç”¨å›¾åƒå¢å¹¿è®­ç»ƒæ¨¡å‹</h4><p>å¦ˆçš„è®­ç»ƒé›†ä¸‹è½½åŠå¤©ã€‚<br>æˆ‘ä»¬ä½¿ç”¨CIFAR-10æ•°æ®é›†ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„Fashion-MNISTã€‚å› ä¸ºFashion-MNISTæ•°æ®é›†ä¸­ç‰©ä½“çš„ä½ç½®å’Œå°ºå¯¸å·²ç»ç»è¿‡å½’ä¸€åŒ–å¤„ç†ï¼Œè€ŒCIFAR-10æ•°æ®é›†æ±‡æ€»ç‰©ä½“çš„é¢œè‰²å’Œå¤§å°åŒºåˆ«æ›´åŠ æ˜¾è‘—ã€‚<br>ä¸ºäº†åœ¨é¢„æµ‹å¾—åˆ°ç¡®å®šçš„ç»“æœï¼Œæˆ‘ä»¬åªåœ¨è®­ç»ƒçš„æ—¶å€™åº”ç”¨å«å›¾åƒæ“ä½œçš„å›¾åƒå¢å¹¿ï¼Œç®€å•çš„éšæœºå·¦å³ç¿»è½¬ã€‚æ­¤å¤–ä½¿ç”¨Totensorå®ä¾‹å°†å°æ‰¹é‡å›¾åƒè½¬æˆMXNetéœ€è¦çš„æ ¼å¼ï¼Œå³å½¢çŠ¶ä¸º<br>ï¼ˆæ‰¹é‡å¤§å°ï¼Œé€šé“æ•°ï¼Œé«˜ï¼Œå®½ï¼‰ã€å€¼åŸŸåœ¨0åˆ°1ä¹‹é—´ä¸”ç±»å‹ä¸º32ä¸ºæµ®ç‚¹æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flip_aug = gdata.vision.transforms.Compose([</span><br><span class="line">    gdata.vision.transforms.RandomFlipLeftRight(), <span class="comment">#éšæœºç¿»è½¬ è®­ç»ƒä½¿ç”¨</span></span><br><span class="line">    gdata.vision.transforms.ToTensor()])</span><br><span class="line"></span><br><span class="line">no_aug = gdata.vision.transforms.Compose([ <span class="comment">#é¢„æµ‹ä½¿ç”¨</span></span><br><span class="line">    gdata.vision.transforms.ToTensor()])</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰evlauate_accuracyå‡½æ•°è¯„ä»·æ¨¡å‹çš„åˆ†ç±»å‡†ç¡®ç‡ï¼Œæ›´åŠ é€šç”¨ã€‚</p>
<h3 id="9-2-å¾®è°ƒ"><a href="#9-2-å¾®è°ƒ" class="headerlink" title="9.2 å¾®è°ƒ"></a>9.2 å¾®è°ƒ</h3><p>å¥½åƒæ˜¯<strong><em>è¿ç§»å­¦ä¹ </em></strong>ï¼Œæˆ‘å»ã€‚<br>å‰é¢çš„Fashion-MNISTè®­ç»ƒæ•°æ®é›†ä¸Šè®­ç»ƒæ¨¡å‹åªæœ‰6ä¸‡å¼ å›¾åƒï¼Œæœ€å¹¿æ³›çš„å¤§è§„æ¨¡å›¾åƒæ•°æ®é›†ImageNetæœ‰è¶…è¿‡1000ä¸‡çš„å›¾åƒå’Œ1000ç±»çš„ç‰©ä½“ï¼Œå¹³å¸¸æˆ‘ä»¬ç”¨åˆ°çš„æ•°æ®é›†åœ¨ä¸¤è€…ä¹‹é—´ã€‚<br>å¦‚æœæˆ‘ä»¬è®­ç»ƒä¸åŒçš„æ¤…å­ï¼Œè‡ªå·±æ‹ç…§ç‰‡å¯èƒ½æ•°æ®é›†ä¸å¤Ÿï¼Œæœ€åç²¾ç¡®åº¦ä¸å¤Ÿï¼ŒåŒæ—¶é€‚ç”¨äºImageNetæ•°æ®é›†çš„å¤æ‚æ¨¡å‹åœ¨è¿™ä¸ªæ¤…å­æ•°æ®é›†ä¸Šè¿‡æ‹Ÿåˆã€‚<br>ä¸ºäº†åº”å¯¹é—®é¢˜ï¼Œé™ä½æˆæœ¬ã€‚æ–¹æ³•æ˜¯åº”ç”¨è¿ç§»å­¦ä¹ ï¼Œå°†ä»æºæ•°æ®é›†å­¦åˆ°çš„åªæ˜¯è¿ç§»åˆ°ç›®æ ‡æ•°æ®é›†ä¸Šã€‚ä¾‹å¦‚ï¼Œè™½ç„¶ImageNetæ•°æ®é›†çš„å›¾åƒå¤§å¤šä¸æ¤…å­æ— å…³ï¼Œä½†åœ¨è¯¥æ•°æ®é›†ä¸Šè®­ç»ƒçš„æ¨¡å‹å¯ä»¥æŠ½è±¡è¾ƒé€šç”¨çš„å›¾åƒç‰¹å¾ã€‚ä»è€Œèƒ½å¸®åŠ©è¯†åˆ«è¾¹ç¼˜ã€çº¹ç†ã€å½¢çŠ¶å’Œç‰©ä½“ç»„æˆç­‰ç­‰ã€‚è¿™äº›ç‰¹å¾å¯¹è¯†åˆ«æ¤…å­åŒæ ·æœ‰æ•ˆã€‚<br>åº”ç”¨æŠ€æœ¯â€”â€”å¾®è°ƒï¼Œå¾®è°ƒç”±4æ­¥ç»„æˆï¼š</p>
<ol>
<li>åœ¨æºæ•°æ®é›†ä¸Šé¢„ç»šç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œå³æºæ¨¡å‹ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œå³ç›®æ ‡æ¨¡å‹ï¼Œå¤åˆ¶äº†æºæ¨¡å‹é™¤äº†è¾“å‡ºå±‚ä»¥å¤–çš„æ‰€æœ‰æ¨¡å‹è®¾è®¡åŠå…¶å‚æ•°ã€‚</li>
<li>ä¸ºç›®æ ‡æ¨¡å‹æ·»åŠ ä¸€ä¸ªè¾“å‡ºå¤§å°ä¸ºç›®æ ‡æ•°æ®é›†ç±»åˆ«ä¸ªæ•°çš„è¾“å‡ºå±‚ï¼Œå¹¶éšæœºåˆå§‹åŒ–è¯¥å±‚çš„æ¨¡å‹å‚æ•°ã€‚</li>
<li>åœ¨ç›®æ ‡æ•°æ®é›†ï¼ˆå¦‚æ¤…å­æ•°æ®é›†ï¼‰ä¸Šè®­ç»ƒç›®æ ‡æ¨¡å‹ã€‚æˆ‘ä»¬å°†ä»å¤´è®­ç»ƒè¾“å‡ºå±‚ï¼Œå…¶ä½™å±‚çš„å‚æ•°éƒ½æ˜¯æºæ¨¡å‹çš„å‚æ•°å¾®è°ƒå¾—åˆ°ã€‚</li>
</ol>
<p>å½“ç›®æ ‡æ•°æ®é›†è¿œå°äºæºæ•°æ®é›†æ—¶ï¼Œå¾®è°ƒæœ‰åŠ©äºæå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<h4 id="çƒ­ç‹—è¯†åˆ«"><a href="#çƒ­ç‹—è¯†åˆ«" class="headerlink" title="çƒ­ç‹—è¯†åˆ«"></a>çƒ­ç‹—è¯†åˆ«</h4><ol>
<li><p>è·å–æ•°æ®é›†<br>ä¸‹è½½å¥½äº†ï¼Œè´¼å¤§<br>åœ¨è®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬å…ˆä»å›¾åƒä¸­è£å‰ªå¤„éšæœºå¤§å°å’Œéšæœºé«˜å®½æ¯”çš„éšæœºåŒºåŸŸï¼Œç„¶åå°†è¯¥åŒºåŸŸä½œä¸ºé«˜å’Œå®½å‡ä¸º224çš„è¾“å…¥ã€‚æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å°†å›¾åƒçš„é«˜å’Œå®½å‡ç¼©æ”¾ä¸º256ï¼Œç„¶åä»ä¸­è£å‰ªå¤„é«˜å®½å‡ä¸º224åƒç´ çš„ä¸­å¿ƒåŒºåŸŸä½œä¸ºè¾“å…¥ï¼Œæ­¤å¤–å¯¹RGBæ˜¯ä¸‰ä¸ªé¢œè‰²é€šé“çš„æ•°å€¼åšæ ‡å‡†åŒ–ï¼šæ¯ä¸ªæ•°å€¼å‡å»è¯¥é€šé“æ‰€æœ‰æ•°å€¼çš„å¹³å‡å€¼ï¼Œå†é™¤ä»¥è¯¥é€šé“æ•°å€¼çš„æ ‡å‡†å·®ä½œä¸ºè¾“å‡ºï¼ˆæ•°æ®é¢„å¤„ç†ï¼‰ã€‚</p>
</li>
<li><p>å®šä¹‰å’Œåˆå§‹åŒ–æ¨¡å‹<br>ä½¿ç”¨ImageNetæ•°æ®é›†ä¸Šé¢„è®­ç»ƒçš„ResNet-18ä½œä¸ºæºæ¨¡å‹ï¼ŒæŒ‡å®š<code>pretrained=True</code>æ¥è‡ªåŠ¨ä¸‹è½½å¹¶å®¶åœ¨é¢„è®­ç»ƒçš„æ¨¡å‹å‚æ•°ï¼Œè¦è”ç½‘ä¸‹è½½ã€‚<br>é¢„è®­ç»ƒçš„æºæ¨¡å‹å®ä¾‹åŒ…å«ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œå³featureså’Œoutputï¼Œæˆ‘å»å¤ªé…·äº†ï¼ï¼ã€‚å‰è€…åŒ…å«æ¨¡å‹é™¤è¾“å‡ºå±‚ä»¥å¤–çš„æ‰€æœ‰å±‚ï¼Œåè€…ä¸ºæ¨¡å‹çš„è¾“å‡ºå±‚ã€‚è¿™æ ·åˆ’åˆ†ä¸»è¦ä¸ºäº†æ–¹ä¾¿å¾®è°ƒå‡ºè¾“å‡ºå±‚ä»¥å¤–çš„æ‰€æœ‰å±‚çš„æ¨¡å‹å‚æ•°ã€‚å¯¹è¾“å‡ºå±‚ï¼Œæ˜¯ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œå®ƒå°†ResNetæœ€ç»ˆçš„å…¨å±€å¹³å‡æ± åŒ–å±‚è¾“å‡ºå˜æ¢æˆImageNetæ•°æ®é›†ä¸Š1000ç±»çš„è¾“å‡º<br>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç¥ç»ç½‘ç»œä½œä¸ºç›®æ ‡æ¨¡å‹ï¼Œå®ƒçš„å®šä¹‰ä¸ä¸è®­ç»ƒçš„æºæ¨¡å‹ï¼Œä¸€æ ·ä½†æœ€åclass=2.åœ¨ä¸‹é¢ä»£ç ä¸­ï¼Œç›®æ ‡æ¨¡å‹å®ä¾‹å‚æ•°è¢«åˆå§‹åŒ–ä¸ºæºæ¨¡å‹ç›¸åº”å±‚çš„æ¨¡å‹å‚æ•°ã€‚ç”±äºfeaturesä¸­çš„æ¨¡å‹å‚æ•°æ˜¯ImageNetæ•°æ®é›†ä¸Šé¢„è®­ç»ƒå¾—åˆ°çš„ï¼Œå·²ç»è¶³å¤Ÿå¥½ï¼Œå› æ­¤ä¸€èˆ¬åªä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡ï¼Œoutputä¸€èˆ¬ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">finetune_net = model_zoo.vision.resnet18_v2(classes=<span class="number">2</span>)</span><br><span class="line">finetune_net.features = pretrained_net.features</span><br><span class="line">finetune_net.output.initialize(init.Xavier())</span><br><span class="line"><span class="comment"># outputä¸­çš„æ¨¡å‹å‚æ•°å°†åœ¨è¿­ä»£ä¸­ä½¿ç”¨10å€å¤§çš„å­¦ä¹ ç‡</span></span><br><span class="line">finetune_net.output.collect_params().setattr(<span class="string">'lr_mult'</span>, <span class="number">10</span>)  <span class="comment">#learning rate * 10</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¾®è°ƒæ¨¡å‹</p>
</li>
</ol>
<h3 id="9-3-ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†"><a href="#9-3-ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†" class="headerlink" title="9.3 ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†"></a>9.3 ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†</h3><p>å‰é¢ç« èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥è®­ç»ƒä¸€ä¸ªå›¾ç‰‡ï¼Œæ¥å®Œæˆåˆ†ç±»ä»»åŠ¡ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬ä¸ä»…æƒ³çŸ¥é“ç±»åˆ«ï¼Œè¿˜æƒ³çŸ¥é“å®ƒåœ¨å›¾åƒä¸­çš„å…·ä½“ä½ç½®ï¼Œè¿™ç±»ä»»åŠ¡æ˜¯ç›®æ ‡æ£€æµ‹æˆ–ç‰©ä½“æ£€æµ‹ã€‚<br><strong>ç›®æ ‡æ£€æµ‹</strong><br>ç›®æ ‡ä½ç½®æ¦‚å¿µ<br><strong>è¾¹ç•Œæ¡†</strong><br>åœ¨ç›®æ ‡æ£€æµ‹é‡Œï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨è¾¹ç•Œæ¡†æ¥æè¿°ç›®æ ‡ä½ç½®ã€‚è¾¹ç•Œæ¡†æ˜¯ä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œå¯ä»¥ç”¨çŸ©å½¢çš„å·¦ä¸Šè§’çš„xå’Œyå’ŒçŸ©å½¢çš„å³ä¸‹è§’çš„xå’Œyåæ ‡ç¡®å®šã€‚å›¾ä¸­çš„åæ ‡åŸç‚¹åœ¨å›¾åƒçš„å·¦ä¸Šè§’ï¼ŒåŸç‚¹å¾€å³å’Œå¾€ä¸‹åˆ†åˆ«ä¸ºxè½´çš„æ­£æ–¹å‘å’Œyè½´çš„æ­£æ–¹å‘ã€‚</p>
<h3 id="9-4-é”šæ¡†"><a href="#9-4-é”šæ¡†" class="headerlink" title="9.4 é”šæ¡†"></a>9.4 é”šæ¡†</h3><p>ç›®æ ‡æ£€æµ‹æ¦‚å¿µäº†è§£äº†ï¼Œå¯¹äºå…·ä½“å®ç°ã€‚<br>ç›®æ ‡æ£€æµ‹ç®—æ³•é€šå¸¸ä¼šåœ¨è¾“å…¥å›¾åƒä¸­é‡‡æ ·å¤§é‡çš„åŒºåŸŸï¼Œç„¶ååˆ¤æ–­è¿™äº›åŒºåŸŸä¸­æ˜¯å¦åŒ…å«æ„Ÿå…´è¶£æ„Ÿç›®æ ‡ï¼Œå¹¶è°ƒæ•´åŒºåŸŸè¾¹ç¼˜ä»è€Œæ›´å‡†ç¡®åœ°é¢„æµ‹ç›®æ ‡å‡½æ•°çš„çœŸå®è¾¹ç•Œæ¡†ã€‚ä¸åŒçš„æ¨¡å‹ä½¿ç”¨çš„åŒºåŸŸé‡‡æ ·æ–¹æ³•ä¸åŒï¼Œè¿™é‡Œä»‹ç»ä¸€ç§ï¼š<br>ä»¥æ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒç”Ÿæˆå¤šä¸ªå¤§å°å’Œå®½é«˜æ¯”ä¸åŒçš„è¾¹ç•Œæ¡†ã€‚è¿™äº›è¾¹ç•Œæ¡†è¢«ç§°ä¸ºé”šæ¡†ã€‚</p>
<h4 id="9-4-1-ç”Ÿæˆå¤šä¸ªé”šæ¡†"><a href="#9-4-1-ç”Ÿæˆå¤šä¸ªé”šæ¡†" class="headerlink" title="9.4.1 ç”Ÿæˆå¤šä¸ªé”šæ¡†"></a>9.4.1 ç”Ÿæˆå¤šä¸ªé”šæ¡†</h4><p>å‡è®¾è¾“å…¥å›¾åƒé«˜ä¸ºhï¼Œå®½ä¸ºwã€‚æˆ‘ä»¬åˆ†åˆ«ä»¥å›¾åƒçš„æ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒç”Ÿæˆä¸åŒå½¢çŠ¶çš„anchorã€‚å‚æ•°ä¸ºså’Œrï¼ŒåŠ ä¸Šè¾“å…¥å›¾åƒå®½wé«˜hã€‚</p>
<ul>
<li>å¤§å°ä¸ºs(0&lt;s&lt;=1)</li>
<li>å®½é«˜æ¯”r(r&gt;0)</li>
</ul>
<p>æ‰€å¾—é”šæ¡†çš„å®½å’Œé«˜åˆ†åˆ«ä¸ºwsæ ¹å·rå’Œhs/æ ¹å·rã€‚<br>ç„¶åæˆ‘ä»¬åˆ†åˆ«å®šä¹‰å¥½ä¸€ç»„å¤§å°s1,â€¦,snå’Œä¸€ç»„å®½é«˜æ¯”r1,â€¦,rmã€‚å¦‚æœä»¥æ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒä½¿ç”¨æ‰€æœ‰çš„å¤§å°ä¸å®½é«˜æ¯”çš„ç»„åˆï¼Œä¸€å…±æœ‰whnmä¸ªé”šæ¡†ï¼Œè™½ç„¶å¯èƒ½è¦†ç›–çœŸå®è¾¹ç•Œæ¡†ï¼Œä½†æ˜¯è®¡ç®—å¤æ‚åº¦å¤ªé«˜ã€‚å› æ­¤ï¼Œé€šå¸¸æˆ‘ä»¬åªå¯¹åŒ…å«s1æˆ–r1å¤§å°ä¸å®½é«˜æ¯”çš„ç»„åˆæ„Ÿå…´è¶£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ç›¸åŒåƒç´ ä¸ºä¸­å¿ƒçš„é”šæ¡†çš„æ•°é‡ä¸ºn+m-1ã€‚å¯¹äºæ•´ä¸ªè¾“å…¥å›¾åƒï¼Œæˆ‘ä»¬å°†ä¸€å…±ç”Ÿæˆwh(n+m-1)ä¸ªé”šæ¡†ã€‚<br><strong>å…·ä½“å®ç°ï¼š</strong></p>
<ol>
<li>ç”Ÿæˆé”šæ¡†å˜é‡çš„æ–¹æ³•å·²å®ç°åœ¨MultiBoxPriorå‡½æ•°ä¸­ã€‚æŒ‡å®šè¾“å…¥ã€ä¸€ç»„å¤§å°å’Œä¸€ç»„å®½é«˜æ¯”ï¼Œè¯¥å‡½æ•°å°†è¿”å›è¾“å…¥çš„æ‰€æœ‰é”šæ¡†ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">img = image.imread(<span class="string">'../img/catdog.jpg'</span>).asnumpy()</span><br><span class="line">h, w = img.shape[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">print(h, w)</span><br><span class="line">X = nd.random.uniform(shape=(<span class="number">1</span>, <span class="number">3</span>, h, w))  <span class="comment"># æ„é€ è¾“å…¥æ•°æ®</span></span><br><span class="line">Y = contrib.nd.MultiBoxPrior(X, sizes=[<span class="number">0.75</span>, <span class="number">0.5</span>, <span class="number">0.25</span>], ratios=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">0.5</span>])</span><br><span class="line">Y.shape</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>è¿”å›å½¢çŠ¶ä¸ºï¼ˆæ‰¹é‡å¤§å°ï¼Œé”šæ¡†ä¸ªæ•°ï¼Œ4ï¼‰</p>
<ol start="2">
<li>åˆ©ç”¨reshapeå°†é”šæ¡†å˜é‡yçš„æƒ³å“¦é—¨æˆ·ä¹‹è§çˆ±æ¼«ç”»å¼„å•Šç¾å‘³å“¦ï¼ˆå›¾åƒé«˜ï¼Œå›¾åƒå®½ï¼Œä»¥ç›¸åŒåƒç´ ä¸ºä¸­å¿ƒçš„é”šæ¡†ä¸ªæ•°ï¼Œ4ï¼‰åï¼Œå°±å¯ä»¥é€šè¿‡æŒ‡å®šåƒç´ ä½ç½®æ¥è·å–æ‰€æœ‰è¯¥é¡¹åƒç´ ä¸ºä¸­å¿ƒçš„é”šæ¡†äº†ã€‚<br>å˜é‡boxesä¸­xå’Œyè½´çš„åæ ‡å€¼åˆ†åˆ«å·²é™¤ä»¥å›¾åƒçš„å®½å’Œé«˜ã€‚åœ¨ç»˜å›¾æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å›å¤é”šæ¡†çš„åŸå§‹åæ ‡å€¼ï¼ˆbbox_scaleï¼‰ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boxes = Y.reshape((h, w, <span class="number">5</span>, <span class="number">4</span>))</span><br><span class="line">boxes[<span class="number">250</span>, <span class="number">250</span>, <span class="number">0</span>, :]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong><em>å°±æ˜¯ä¸æ™“å¾—è§„åˆ™æ˜¯ä»€ä¹ˆ ä¸ºä»€ä¹ˆï¼Ÿ ä¸ºå•¥å®šäº†5 å°±æ˜¯è¿™äº”ä¸ª ä¸æ˜¯æœ‰å„3å„å‚æ•°å—ï¼Ÿ åº”è¯¥9ä¸ªï¼Ÿ</em></strong></p>
<h4 id="9-4-2-äº¤å¹¶æ¯”"><a href="#9-4-2-äº¤å¹¶æ¯”" class="headerlink" title="9.4.2 äº¤å¹¶æ¯”"></a>9.4.2 äº¤å¹¶æ¯”</h4><p>ä¸ºäº†ä¼˜åŒ–å¿…é¡»é‡åŒ–â€œè¾ƒå¥½â€ï¼Œä¸€ç§ç›´è§‚çš„æ–¹æ³•æ˜¯è¡¡é‡é”šæ¡†å’ŒçœŸå®è¾¹ç•Œä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚jaccardç³»æ•°å¯ä»¥è¡¡é‡ä¸¤ä¸ªé›†åˆçš„ç›¸ä¼¼åº¦ã€‚ç»™å®šé›†åˆAå’ŒBï¼Œä»–ä»¬çš„jaccardç³»æ•°å³äºŒè€…äº¤é›†å¤§å°é™¤ä»¥äºŒè€…å¹¶é›†å¤§å°ã€‚<br>å¯ä»¥ç”¨è¾¹ç•Œæ¡†æ›¿ä»£æ•´ä¸ªåƒç´ é¢ï¼Œæœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨äº¤å¹¶æ¯”æ¥è¡¡é‡é”šæ¡†ä¸çœŸå®è¾¹ç•Œæ¡†ä»¥åŠé”šæ¡†ä¸é”šæ¡†ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚</p>
<h4 id="9-4-3-æ ‡æ³¨è®­ç»ƒé›†çš„é”šæ¡†"><a href="#9-4-3-æ ‡æ³¨è®­ç»ƒé›†çš„é”šæ¡†" class="headerlink" title="9.4.3 æ ‡æ³¨è®­ç»ƒé›†çš„é”šæ¡†"></a>9.4.3 æ ‡æ³¨è®­ç»ƒé›†çš„é”šæ¡†</h4><p>labelImage wocçœŸå¤æ‚ è¿˜å¥½èªæ˜çš„æˆ‘çœ‹æ‡‚äº†<br>ä¸ºäº†è®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªè¾¹æ¡†æ ‡æ³¨ä¸¤ç±»æ ‡ç­¾ï¼š</p>
<ul>
<li>é”šæ¡†æ‰€å«ç›®æ ‡çš„ç±»åˆ«ï¼Œç®€ç§°ç±»åˆ«</li>
<li>çœŸå®è¾¹ç•Œæ¡†ç›¸å¯¹é”šæ¡†çš„åç§»é‡ï¼Œç®€ç§°åç§»é‡<br>ç›®æ ‡æ£€æµ‹æ—¶ï¼Œå…ˆç”Ÿæˆå¤šä¸ªé”šæ¡†ï¼Œç„¶åä¸ºå¤šä¸ªé”šæ¡†é¢„æµ‹ç±»åˆ«å’Œåç§»é‡ï¼Œæ¥ç€æ ¹æ®é¢„æµ‹çš„åç§»é‡è°ƒæ•´é”šæ¡†ä½ç½®ä»è€Œå¾—åˆ°é¢„æµ‹è¾¹ç•Œæ¡†ï¼Œæœ€åç­›é€‰éœ€è¦è¾“å‡ºçš„é¢„æµ‹è¾¹ç•Œæ¡†ã€‚<br>å¦‚ä½•ä¸ºé”šæ¡†åˆ†é…ä¸å…¶ç›¸ä¼¼çš„çœŸå®è¾¹ç•Œæ¡†å‘¢ï¼Ÿï¼ˆç‹—çš„æ¡†æ€ä¹ˆåˆ†é…å°±æ˜¯ç‹—çš„æ¡†è€Œä¸æ˜¯çŒ«çš„æ¡†ï¼‰<br>å¯ä»¥æ ¹æ®é”šæ¡†ç´¢å¼•å’ŒçœŸå®è¾¹ç•Œæ¡†ç´¢å¼•å·´æ‹‰å·´æ‹‰ä¸€å¤§å †ï¼Œçœ‹è¿™ä¸ªå›¾ç»“åˆä¹¦èƒ½ç†è§£ï¼š<br><img src="/2020/01/22/dive-into-deep-learning/anchor.png" alt="anchor"><br>åˆ†é…å¥½çœŸå®è¾¹æ¡†å°±å¯ä»¥æ ‡æ³¨é”šæ¡†çš„ç±»åˆ«å’Œåç§»é‡ã€‚</li>
<li>åç§»é‡ï¼š<br>$$\left( \frac{ \frac{x_b - x_a}{w_a} - \mu_x }{\sigma_x},<br>\frac{ \frac{y_b - y_a}{h_a} - \mu_y }{\sigma_y},<br>\frac{ \log \frac{w_b}{w_a} - \mu_w }{\sigma_w},<br>\frac{ \log \frac{h_b}{h_a} - \mu_h }{\sigma_h}\right),$$<br>è´¼å¤æ‚ï¼Œå…¶ä¸­å¸¸æ•°çš„é»˜è®¤å€¼ä¸º$\mu_x = \mu_y = \mu_w = \mu_h = 0, \sigma_x=\sigma_y=0.1, \sigma_w=\sigma_h=0.2$ã€‚</li>
<li>ç±»åˆ«ï¼šå¦‚æœä¸€ä¸ªé”šæ¡†æ²¡æœ‰è¢«åˆ†é…çœŸå®è¾¹ç•Œæ¡†ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯¥é”šæ¡†çš„ç±»åˆ«è®¾ç½®ä¸ºèƒŒæ™¯ã€‚<ul>
<li>ç±»åˆ«ä¸ºèƒŒæ™¯çš„é”šæ¡†é€šå¸¸è¢«ç§°ä¸ºè´Ÿç±»é”šæ¡†</li>
<li>å…¶ä½™è¢«ç§°ä¸ºæ­£ç±»é”šæ¡†</li>
</ul>
</li>
</ul>
<p><img src="/2020/01/22/dive-into-deep-learning/dog.png" alt="dog"><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡contrib.nbæ¨¡å—ä¸­çš„MultiBoxTargetå‡½æ•°æ¥ä¸ºé”šæ¡†æ ‡æ³¨ç±»åˆ«å’Œåç§»é‡ã€‚<br><img src="/2020/01/22/dive-into-deep-learning/multi.png" alt="dog"><br>æˆ‘ä»¬æ ¹æ®é”šæ¡†ä¸çœŸå®è¾¹ç•Œæ¡†åœ¨å›¾åƒä¸­çš„ä½ç½®æ¥åˆ†æè¿™äº›æ ‡æ³¨çš„ç±»å‹ï¼ˆæ–¹æ³•å¤šçš„è¦æ­»ï¼Œè‡ªå·±çœ‹ä¹¦èƒ½æ‡‚ï¼‰ã€‚<br>è¿”å›å€¼çš„ä¸‰é¡¹å«ä¹‰ï¼š</p>
<ul>
<li>è¿”å›çš„ç¬¬ä¸€é¡¹æ˜¯æ¯ä¸ªé”šæ¡†æ ‡æ³¨çš„4ä¸ªåç§»é‡ï¼Œå…¶ä¸­è´Ÿç±»é”šæ¡†çš„åç§»é‡æ ‡æ³¨ä¸º0</li>
<li>è¿”å›çš„ç¬¬äºŒé¡¹ä¸ºæ©ç å˜é‡ï¼Œå½¢çŠ¶ä¸ºï¼ˆæ‰¹é‡å¤§å°ï¼Œé”šæ¡†ä¸ªæ•°çš„4å€ï¼‰ã€‚æ©ç å˜é‡ä¸­çš„å…ƒç´ ä¸æ¯ä¸ªé”šæ¡†çš„4ä¸ªåç§»é‡ä¸€ä¸€å¯¹åº”ï¼Œç”±äºæˆ‘ä»¬ä¸å…³å¿ƒå¯¹èƒŒæ™¯çš„æ£€æµ‹ï¼Œæœ‰å…³è´Ÿç±»çš„åç§»é‡ä¸åº”å½±å“ç›®æ ‡å‡½æ•°ã€‚<br>æ©ç å˜é‡çš„ä½œç”¨ï¼š<br>é€šè¿‡å…ƒç´ æƒ©ç½šï¼Œæ©ç å˜é‡ä¸­çš„0å¯ä»¥è®¡ç®—ç›®æ ‡å‡½æ•°ä¹‹å‰è¿‡æ»¤æ‰è´Ÿç±»çš„åç§»é‡</li>
<li>è¿”å›çš„ç»“æœæœ‰3é¡¹ï¼Œå‡ä¸ºNDArrayã€‚ç¬¬ä¸‰é¡¹è¡¨ç¤ºä¸ºé”šæ¡†æ ‡æ³¨çš„å®ä¾‹<h4 id="9-4-4-è¾“å‡ºé¢„æµ‹è¾¹ç•Œæ¡†"><a href="#9-4-4-è¾“å‡ºé¢„æµ‹è¾¹ç•Œæ¡†" class="headerlink" title="9.4.4 è¾“å‡ºé¢„æµ‹è¾¹ç•Œæ¡†"></a>9.4.4 è¾“å‡ºé¢„æµ‹è¾¹ç•Œæ¡†</h4>åœ¨æ¨¡å‹é¢„æµ‹é˜¶æ®µï¼Œç”Ÿæˆå¤šä¸ªé”šæ¡†ï¼Œä½†é”šæ¡†æ•°ç›®è¾ƒå¤šæ—¶ï¼ŒåŒä¸€ä¸ªç›®æ ‡ä¸Šå¯èƒ½è¾“å‡ºè¾ƒå¤šç›¸ä¼¼çš„é¢„æµ‹è¾¹æ¡†ä¹‹ï¼Œä¸ºäº†è®©ç»“æœæ›´åŠ ç®€æ´ï¼Œå¯ä»¥ç§»é™¤ç›¸ä¼¼çš„é¢„æµ‹è¾¹ç•Œæ¡†ï¼Œå¸¸ç”¨çš„æ–¹æ³•å«åšéæå¤§å€¼æŠ‘åˆ¶ã€‚</li>
</ul>
<p><strong>éæå¤§æŠ‘åˆ¶ï¼ˆNMSï¼‰ å·¥ä½œåŸç†ï¼š</strong><br>æœ€å¤§çš„é¢„æµ‹æ¦‚ç‡pï¼šè¯¥é¢„æµ‹æ¦‚ç‡æ‰€å¯¹åº”çš„ç±»åˆ«å³Bçš„é¢„æµ‹ç±»åˆ«ã€‚æˆ‘ä»¬å°†pç§°ä¸ºé¢„æµ‹è¾¹ç•Œæ¡†çš„ç½®ä¿¡åº¦ã€‚åœ¨åŒä¸€å›¾åƒä¸Šï¼Œæˆ‘ä»¬å°†é¢„æµ‹ç±»åˆ«éèƒŒæ™¯çš„é¢„æµ‹è¾¹ç•Œæ¡†æŒ‰ç½®ä¿¡åº¦ä»é«˜åˆ°åº•æ’åºï¼Œå¾—åˆ°åˆ—è¡¨Lã€‚<br>ç„¶åå…ˆé€‰æœ€é«˜çš„ç½®ä¿¡åº¦çš„ç„¶åæ±‚åˆ«çš„å’Œä»–çš„äº¤å¹¶æ¯”ï¼Œäº¤å¹¶æ¯”å¤§äºä¸€ä¸ªè¶…å‚æ•°é˜ˆå€¼å°±åˆ æ‰ï¼Œç„¶åç¬¬äºŒï¼Œç¬¬ä¸‰ï¼Œso easy è¯´çš„å“äººã€‚<br>å¯ä»¥ä½¿ç”¨contrib.ndæ¨¡å—çš„MultiBoxDetectionå‡½æ•°æ¥æ‰§è¡Œéæå¤§å€¼ä¸€ç›´å¹¶è®¾é˜ˆå€¼ä¸º0.5ã€‚ä¸ºNDArrayè¾“å…¥éƒ½å¢åŠ äº†æ ·æœ¬ç»´ï¼Œç¬¬ä¸€ä¸ªå€¼æ˜¯ç±»åˆ«ï¼ˆ-1è¡¨ç¤ºèƒŒæ™¯åè€…NMSä¸­è¢«åˆ é™¤ï¼‰ï¼Œç¬¬äºŒè¡¨ç¤ºç½®ä¿¡åº¦ï¼Œåé¢å››ä¸ªè¡¨ç¤ºæ ·æœ¬è¾¹æ¡†å·¦ä¸Šè§’å³ä¸‹è§’åæ ‡ã€‚<br>å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠç½®ä¿¡åº¦è¾ƒä½çš„åˆ é™¤å‡å°è®¡ç®—é‡ã€‚è¿˜å¯ä»¥å¯¹NMDSçš„è¾“å‡ºç­›é€‰ï¼Œä¾‹å¦‚åªä¿ç•™å…¶ä¸­ç½®ä¿¡åº¦è¾ƒé«˜çš„ç»“æœä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚</p>
<h3 id="9-5-å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹"><a href="#9-5-å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹" class="headerlink" title="9.5 å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹"></a>9.5 å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹</h3><p>åœ¨9.4èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨å®éªŒä¸­ä»¥è¾“å…¥å›¾åƒçš„æ¯ä¸ªåƒç´ çš„ä¸­å¿ƒç”Ÿæˆå¤šä¸ªé”šæ¡†ã€‚è¿™äº›é”šæ¡†æ˜¯å¯¹è¾“å…¥å›¾åƒä¸åŒåŒºåŸŸçš„é‡‡æ ·ã€‚ç„¶è€Œï¼Œå¦‚æœä»¥å›¾åƒæ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒï¼Œå¾ˆå®¹æ˜“è®¡ç®—é‡è¿‡å¤§ã€‚<br>å‡å°‘é”šæ¡†ä¸ªæ•°å¹¶ä¸éš¾ï¼Œä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯åœ¨è¾“å…¥å›¾åƒä¸­å‡åŒ€é‡‡æ ·ä¸€å°éƒ¨åˆ†é‡‡æ ·ï¼Œå¹¶ä»¥é‡‡æ ·çš„åƒç´ ä¸ºä¸­å¿ƒç”Ÿæˆé”šæ¡†ã€‚<br>ä¸åŒå°ºåº¦ä¸‹ï¼Œå¯ä»¥ç”Ÿæˆä¸åŒæ•°é‡å’Œä¸åŒå¤§å°çš„é”šæ¡†ã€‚é”šæ¡†ç›®æ ‡è¾ƒå°åˆ™å‡ºç°ä½ç½®å¢å¤šã€‚<br>5.1èŠ‚æåˆ°å·ç§¯ç¥ç»ç½‘ç»œçš„ç‰¹å¾å›¾ï¼š</p>
<ul>
<li>ç‰¹å¾å›¾ï¼šå°±æ˜¯äºŒç»´å·ç§¯å±‚è¾“å‡ºçš„äºŒç»´æ•°ç»„ï¼ˆå¯ä»¥çœ‹ä½œè¾“å…¥åœ¨ç©ºé—´ç»´åº¦ï¼ˆå®½å’Œé«˜ï¼‰ä¸ŠæŸä¸€çº§çš„è¡¨å¾ï¼‰<br>å¯ä»¥é€šè¿‡å®šä¹‰ç‰¹å¾å›¾çš„å½¢çŠ¶æ¥ç¡®å®šä»»ä¸€å›¾åƒä¸Šå‡åŒ€é‡‡æ ·çš„é”šæ¡†ä¸­å¿ƒã€‚ï¼ˆä½ çš„ç‰¹å¾å›¾å¤§å°±å‡åŒ€é‡‡æ ·æŒ¤çš„é‡‡æ ·ä½ç½®å°‘ï¼‰</li>
<li>æˆ‘ä»¬åœ¨ç‰¹å¾å›¾fmapä¸Šä»¥æ¯ä¸ªå•å…ƒï¼ˆåƒç´ ï¼‰ä¸ºä¸­å¿ƒç”Ÿæˆé”šæ¡†anchorsã€‚ï¼ˆå‡åŒ€é‡‡æ ·ï¼‰</li>
<li>å› ä¸ºé”šæ¡†anchorsä¸­xè½´å’Œyè½´çš„åæ ‡å€¼åˆ†åˆ«å·²é™¤ä»¥ç‰¹å¾å›¾fmapçš„å®½å’Œé«˜ï¼Œè¿™äº›å€¼åŸŸåœ¨0å’Œ1ä¹‹é—´çš„å€¼è¡¨è¾¾äº†é”šæ¡†åœ¨ç‰¹å¾å›¾ä¸­çš„ç›¸å¯¹ä½ç½®ã€‚</li>
<li>å› ä¸ºé”šæ¡†anchorsçš„ä¸­å¿ƒéå¸ƒç‰¹å¾å›¾fmapä¸Šçš„æ‰€æœ‰å•å…ƒï¼Œanchorsçš„ä¸­å¿ƒåœ¨ä»»ä¸€å›¾åƒçš„ç©ºé—´ç›¸å¯¹ä½ç½®ä¸€å®šæ˜¯å‡åŒ€åˆ†å¸ƒçš„ã€‚ï¼ˆå‡åŒ€é‡‡æ ·å°±æŒ¤æ¥æŒ¤å»ï¼‰</li>
<li>å…·ä½“æ¥è¯´ï¼Œå½“ç‰¹å¾å›¾çš„å®½å’Œé«˜åˆ†åˆ«è®¾ä¸ºfmap_wå’Œfmap_hæ—¶ï¼Œè¯¥å‡½æ•°å°†åœ¨ä»»ä¸€å›¾åƒä¸Šå‡åŒ€é‡‡æ ·fmap_hè¡Œfmap_wåˆ—ä¸ªåƒç´ ï¼Œåˆ†åˆ«ä»¥ä»–ä»¬ä¸ºä¸­å¿ƒç”Ÿæˆå¤§å°ä¸ºsï¼ˆå‡è®¾åˆ—è¡¨é•¿åº¦ä¸º1ï¼‰çš„ä¸åŒå®½é«˜æ¯”çš„é”šæ¡†ã€‚</li>
</ul>
<p>æˆ‘ä»¬å·²ç»åœ¨å¤šä¸ªå°ºåº¦ä¸Šç”Ÿæˆäº†ä¸åŒå¤§å°çš„é”šæ¡†ï¼Œç›¸åº”åœ°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸åŒå°ºåº¦ä¸‹æ£€æµ‹ä¸åŒå¤§å°çš„ç›®æ ‡ã€‚<br>ï¼ˆå·ç§¯ç¥ç»ç½‘ç»œçš„æ–¹æ³•ï¼‰<br>æŸä¸ªå°ºåº¦ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬ä¾æ®ciå¼ å½¢çŠ¶ä¸ºhxwçš„ç‰¹å¾å›¾ç”Ÿæˆhxwç»„ä¸åŒä¸­å¿ƒçš„é”šæ¡†ï¼Œä¸”é­…æ—çš„é”šæ¡†ä¸ªæ•°ä¸ºaã€‚æ¥ä¸‹æ¥ä¾æ®çœŸå®è¾¹ç•Œæ¡†çš„ç±»åˆ«å’Œä½ç½®ï¼Œæ¯ä¸ªé”šæ¡†å°†è¢«æ ‡æ³¨ç±»åˆ«å’Œåç§»é‡ã€‚åœ¨å½“å‰çš„å°ºåº¦ä¸‹ï¼Œç›®æ ‡æ£€æµ‹æ¨¡å‹éœ€è¦æ ¹æ®è¾“å…¥å›¾åƒé¢„æµ‹hxwç»„ä¸åŒä¸­å¿ƒçš„é”šæ¡†çš„ç±»åˆ«å’Œåç§»é‡ï¼ˆè®­ç»ƒï¼‰ã€‚<br>è‰<br>æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬ç”¨è¾“å…¥å›¾åƒåœ¨æŸä¸ªæ„Ÿå—é‡åŒºåŸŸå†…çš„ä¿¡æ¯æ¥é¢„æµ‹è¾“å…¥å›¾åƒä¸Šä¸è¯¥åŒºåŸŸä½ç½®ç›¸è¿‘çš„é”šæ¡†çš„ç±»åˆ«å’Œåç§»é‡ã€‚<br>å¦ˆçš„çœ‹ä¸æ‡‚ã€‚<br>å½“ä¸åŒå±‚çš„ç‰¹å¾å›¾åœ¨è¾“å…¥å›¾åƒä¸Šåˆ†åˆ«æ‹¥æœ‰ä¸åŒå¤§å°çš„æ„Ÿå—é‡æ—¶ï¼Œå®ƒä»¬å°†åˆ†åˆ«ç”¨æ¥æ£€æµ‹ä¸åŒå¤§å°çš„ç›®æ ‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾è®¡ç½‘ç»œï¼Œä»¤è¾ƒè¿‘è¾“å‡ºå±‚çš„ç‰¹å¾å›¾ä¸­æ¯ä¸ªå•å…ƒæ‹¥æœ‰æ›´å¹¿é˜”çš„æ„Ÿå—é‡ï¼Œä»è€Œæ£€æµ‹è¾“å…¥å›¾åƒä¸­æ›´å¤§å°ºå¯¸çš„ç›®æ ‡ã€‚</p>
<h3 id="9-6-ç›®æ ‡æ£€æµ‹æ•°æ®é›†ï¼ˆçš®å¡ä¸˜ï¼‰"><a href="#9-6-ç›®æ ‡æ£€æµ‹æ•°æ®é›†ï¼ˆçš®å¡ä¸˜ï¼‰" class="headerlink" title="9.6 ç›®æ ‡æ£€æµ‹æ•°æ®é›†ï¼ˆçš®å¡ä¸˜ï¼‰"></a>9.6 ç›®æ ‡æ£€æµ‹æ•°æ®é›†ï¼ˆçš®å¡ä¸˜ï¼‰</h3><p>ç›®æ ‡æ£€æµ‹é¢†åŸŸå¹¶æ²¡æœ‰ç±»ä¼¼MNISTæˆ–Fashion-MNISTé‚£æ ·çš„å°æ•°æ®é›†ã€‚åˆæˆä¸€ä¸ªçš®å¡ä¸˜çš„æ•°æ®é›†ï¼Œä½¿ç”¨äº†MXNetæä¾›çš„im2recå·¥å…·å°†å›¾åƒè½¬æ¢æˆäºŒè¿›åˆ¶çš„RecordIOæ ¼å¼ã€‚è¯¥æ ¼å¼å¯ä»¥é™ä½æ•°æ®é›†åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨å¼€é”€ï¼Œåˆèƒ½æé«˜è¯»å–æ•ˆç‡ã€‚è‡ªå·±çœ‹GluonCVçš„åŒ…ï¼Œåšå¹¿å‘Šæˆ‘å»ã€‚</p>
<h4 id="9-6-1-è·å–æ•°æ®é›†"><a href="#9-6-1-è·å–æ•°æ®é›†" class="headerlink" title="9.6.1 è·å–æ•°æ®é›†"></a>9.6.1 è·å–æ•°æ®é›†</h4><p>è‡ªå·±ä¸‹è½½</p>
<h4 id="9-6-2-è¯»å–æ•°æ®é›†"><a href="#9-6-2-è¯»å–æ•°æ®é›†" class="headerlink" title="9.6.2 è¯»å–æ•°æ®é›†"></a>9.6.2 è¯»å–æ•°æ®é›†</h4><p>é€šè¿‡åˆ›å»ºImageDetIterå®ä¾‹æ¥è¯»å–ç›®æ ‡æ£€æµ‹æ•°æ®é›†ã€‚</p>
<ul>
<li>å¯¹è®­ç»ƒæ•°æ®é›†ï¼š<ul>
<li>éšæœºè¯»å–ã€‚ç”±äºæ•°æ®é›†çš„æ ¼å¼ä¸ºRecordIOï¼Œæˆ‘ä»¬éœ€è¦æä¾›å›¾åƒç´¢å¼•æ–‡ä»¶train.idxä»¥éšæœºè¯»å–å°æ‰¹é‡ã€‚</li>
<li>æ­¤å¤–ï¼Œå¯¹äºè®­ç»ƒé›†ä¸­çš„æ¯å¼ å›¾åƒï¼Œæˆ‘ä»¬é‡‡ç”¨éšæœºè£å‰ªï¼Œå¹¶è¦æ±‚è£å‰ªå‡ºçš„å›¾åƒè‡³å°‘è¦†ç›–æ¯ä¸ªç›®æ ‡95%ï¼Œç”±äºè£å‰ªéšæœºï¼Œæœ€å¤šå°è¯•200æ¬¡ï¼Œä¸æ»¡è¶³æ¡ä»¶ä¸è£å‰ªã€‚</li>
</ul>
</li>
<li>å¯¹æµ‹è¯•æ•°æ®é›†ï¼š<ul>
<li>ä¸éšæœºè£å‰ªæµ‹è¯•æ•°æ®é›†</li>
<li>æ— é¡»æŒ‰éšæœºé¡ºåºè¯»å–æµ‹è¯•æ•°æ®é›†<br>è¯»å–ä¸€ä¸ªå°æ‰¹é‡æ‰“å°å›¾åƒå’Œæ ‡ç­¾çš„å½¢çŠ¶ã€‚</li>
</ul>
</li>
<li>å›¾åƒå½¢çŠ¶ï¼šï¼ˆæ‰¹é‡å¤§å°ï¼Œé€šé“æ•°ï¼Œé«˜ï¼Œå®½ï¼‰</li>
<li>æ ‡ç­¾ï¼›ï¼ˆæ‰¹é‡å¤§å°ï¼Œmï¼Œ5ï¼‰</li>
</ul>
<p>mç­‰äºæ•°æ®é›†ä¸­å•ä¸ªå›¾åƒæœ€å¤šå«æœ‰çš„è¾¹ç•Œæ¡†ä¸ªæ•°ã€‚å°æ‰¹é‡è®¡ç®—è™½ç„¶é«˜æ•ˆï¼Œä½†å®ƒè¦æ±‚æ¯å¼ å›¾åƒå«æœ‰ç›¸åŒæ•°é‡çš„è¾¹ç•Œæ¡†ä¸€è¾¹æ”¾åœ¨åŒä¸€ä¸ªæ‰¹é‡ä¸­ã€‚<br>ç”±äºæ¯å¼ å›¾åƒå«æœ‰çš„è¾¹ç•Œæ¡†ä¸ªæ•°å¯èƒ½ä¸åŒï¼Œæˆ‘ä»¬ä¸ºè¾¹ç•Œæ¡†ä¸ªæ•°å°äºmçš„å›¾åƒå¡«å……éæ³•è¾¹ç•Œæ¡†ï¼Œç›´åˆ°æ¯å¼ å›¾åƒå‡å«æœ‰mä¸ªè¾¹ç•Œæ¡†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¯æ¬¡è¯»å–å°æ‰¹é‡çš„å›¾åƒã€‚<br>å›¾åƒä¸­æ¯ä¸ªè¾¹æ¡†çš„æ ‡ç­¾ç”±é•¿åº¦ä¸º5çš„æ•°ç»„è¡¨ç¤ºã€‚æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªä¸ºè¾¹ç•Œæ¡†æ‰€å«ç›®æ ‡çš„ç±»åˆ«ï¼Œå½“å€¼ä¸º-1æ—¶ï¼Œè¯¥è¾¹ç•Œæ¡†ä¸ºå¡«å……ç”¨çš„éæ³•è¾¹ç•Œæ¡†</p>
<h4 id="9-6-3-å›¾ç¤ºæ•°æ®"><a href="#9-6-3-å›¾ç¤ºæ•°æ®" class="headerlink" title="9.6.3 å›¾ç¤ºæ•°æ®"></a>9.6.3 å›¾ç¤ºæ•°æ®</h4><p>ç”»å‡ºæ˜¯ä¸ªï¼Œè§’åº¦å¤§å°å’Œä½ç½®æ¯å¼ å›¾ä¸ä¸€æ ·</p>
<h3 id="9-7-å•å‘å¤šæ¡†æ£€æµ‹ï¼ˆSSDï¼‰"><a href="#9-7-å•å‘å¤šæ¡†æ£€æµ‹ï¼ˆSSDï¼‰" class="headerlink" title="9.7 å•å‘å¤šæ¡†æ£€æµ‹ï¼ˆSSDï¼‰"></a>9.7 å•å‘å¤šæ¡†æ£€æµ‹ï¼ˆSSDï¼‰</h3><p>å‰é¢åè¡€èˆ¬å­¦äº†è¾¹ç•Œæ¡†ã€é”šæ¡†ã€å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹å’Œæ•°æ®é›†ï¼ˆæœ‰äº›è¿˜æ²¡çœ‹æ‡‚ï¼‰ï¼Œç°åœ¨åŸºäºè¿™äº›èƒŒæ™¯åªæ˜¯æ¥ç‹—ä»”ä¸€ä¸ªç›®æ ‡æ£€æµ‹æ¨¡å‹â€”â€”SSDå•å‘å¤šæ¡†æ£€æµ‹ã€‚</p>
<h4 id="9-7-1-å®šä¹‰æ¨¡å‹"><a href="#9-7-1-å®šä¹‰æ¨¡å‹" class="headerlink" title="9.7.1 å®šä¹‰æ¨¡å‹"></a>9.7.1 å®šä¹‰æ¨¡å‹</h4><p>æ¦‚å¿µå¤§æ¦‚å¦‚ä¸‹ï¼Œç”±åŸºç¡€ç½‘ç»œå¿«å’Œè‹¥å¹²ä¸ªå¤šå°ºåº¦ç‰¹å¾å—ä¸²è”ç»„æˆã€‚</p>
<ul>
<li>åŸºç¡€ç½‘ç»œå—ï¼šç”¨æ¥ä»åŸå§‹å›¾åƒä¸­æŠ½å–ç‰¹å¾ï¼Œä¸€èˆ¬é‡‡ç”¨æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œã€‚<br>ï¼ˆæ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œä¸­ï¼‰SSDä¸­é€‰ç”¨äº†åœ¨åˆ†ç±»å±‚ä¹‹é—´æˆªæ–­çš„VGGï¼Œç°åœ¨å¸¸ç”¨ResNetæ›¿ä»£ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡åŸºç¡€ç½‘ç»œï¼Œä½¿å®ƒçš„å®½å’Œé«˜è¾ƒå¤§ï¼ŒåŸºäºç‰¹å¾å›¾ç”Ÿæˆçš„é”šæ¡†æ•°é‡å¤šæ£€æµ‹å°ºå¯¸è¾ƒå°ç›®æ ‡ã€‚</li>
<li>å¤šå°ºåº¦ç‰¹å¾å—ï¼šå°†ä¸Šä¸€å±‚é«˜å®½ç¼©å°ï¼Œä½¿ç‰¹å¾å›¾ä¸­æ¯ä¸ªå•å…ƒåœ¨è¾“å…¥å›¾åƒä¸Šçš„æ„Ÿå—é‡å˜å®½ï¼Œç”¨æ¥æ£€æµ‹å°ºå¯¸å¤§ç›®æ ‡ã€‚<br>å› æ­¤SSDæ˜¯ä¸€ä¸ªå¤šå°ºåº¦çš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ã€‚<br><img src="/2020/01/22/dive-into-deep-learning/ssd.png" alt="dog"></li>
</ul>
<ol>
<li>ç±»åˆ«é¢„æµ‹å±‚<br>è®¾ç›®æ ‡ç±»åˆ«ä¸ªæ•°ä¸ºqã€‚æ¯ä¸ªé”šæ¡†ç±»åˆ«ä¸ªæ•°ä¸ºq+1ï¼ˆèƒŒæ™¯0ï¼‰ã€‚æŸä¸ªå°ºåº¦ä¸‹ï¼Œè®¾ç‰¹å¾å›¾çš„é«˜å’Œå®½åˆ†åˆ«ä¸ºhå’Œwï¼Œå¦‚æœä»¥å…¶ä¸­æ¯ä¸ªå•å…ƒä¸ºä¸­å¿ƒç”Ÿæˆaä¸ªé”šæ¡†ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¯¹hwaä¸ªé”šæ¡†åˆ†ç±»ï¼Œå…¨è¿æ¥å±‚å¾ˆå®¹æ˜“å‚æ•°è¿‡å¤šï¼Œä½¿ç”¨5.8èŠ‚NiNçš„æ–¹æ³•ï¼Œä½¿ç”¨å·ç§¯å±‚çš„é€šé“æ¥è¾“å‡ºç±»åˆ«é¢„æµ‹çš„æ–¹æ³•ï¼Œé™ä½æ¨¡å‹å¤æ‚åº¦ã€‚</li>
</ol>
<p><strong>å…·ä½“å®ç°ï¼š</strong><br>ç±»åˆ«é¢„æµ‹å±‚ä½¿ç”¨ä¸€ä¸ªä¿æŒè¾“å…¥é«˜å’Œå®½çš„å·ç§¯å±‚ã€‚è¿™æ ·ï¼Œè¾“å‡ºå’Œè¾“å…¥åœ¨ç‰¹å¾å›¾å®½å’Œé«˜çš„ç©ºé—´åæ ‡ä¸€ä¸€å¯¹åº”ã€‚<br>è€ƒè™‘è¾“å‡ºå’Œè¾“å…¥åŒä¸€ç©ºé—´åæ ‡(x, y)ï¼šè¾“å‡ºç‰¹å¾ä¸Šä¹Ÿè¾“å‡º(x, y)ï¼Œè¾“å‡ºé€šé“æ•°ä¸ºa(q+1)ï¼ˆaä¸ªé”šæ¡†ï¼‰ï¼Œå…¶ä¸­ç´¢å¼•ä¸ºi(q+q)+jçš„é€šé“ä»£è¡¨äº†ç´¢å¼•ä¸ºiçš„é”šæ¡†æœ‰å…³ç±»åˆ«ç´¢å¼•jçš„é¢„æµ‹ã€‚</p>
<ol start="2">
<li>è¾¹ç•Œæ¡†é¢„æµ‹å±‚<br>ä¸ç±»åˆ«é¢„æµ‹å±‚å·®ä¸å¤šï¼ŒæŠŠq+1ä¸ªç±»åˆ«æ¢æˆ4ä¸ªã€‚</li>
<li>è¿ç»“å¤šå°ºåº¦çš„é¢„æµ‹<br>SSDæ ¹æ®å¤šä¸ªå°ºåº¦ä¸‹çš„ç‰¹å¾å›¾ç”Ÿæˆé”šæ¡†å¹¶é¢„æµ‹ç±»åˆ«å’Œåç§»é‡ã€‚ç”±äºæ¯ä¸ªå°ºåº¦ä¸Šç‰¹å¾å›¾çš„å½¢çŠ¶æˆ–ä»¥åŒä¸€å•å…ƒä¸ºä¸­å¿ƒç”Ÿæˆçš„é”šæ¡†ä¸ªæ•°éƒ½å¯èƒ½ä¸åŒï¼Œå› æ­¤ä¸åŒå°ºåº¦çš„é¢„æµ‹è¾“å‡ºå½¢çŠ¶å¯èƒ½ä¸åŒã€‚<br>è¿™äº›å½¢çŠ¶ä¸åŒä¸è¿è´¯ã€‚<br>æˆ‘ä»¬å¯¹åŒä¸€æ‰¹é‡æ•°æ®æ„é€ ä¸¤ä¸ªä¸åŒå°ºåº¦ä¸‹çš„ç‰¹å¾å›¾Y1å’ŒY2ï¼Œå…¶ä¸­Y2ç›¸å¯¹äºY1æ¥æ•°é«˜å’Œå®½åˆ†åˆ«å‡åŠï¼Œé”šæ¡†ä¸ªæ•°ä¸åŒï¼Œé™¤äº†æ‰¹é‡å¤§å°ä¸€æ ·ï¼Œå…¶ä»–ç»´åº¦éƒ½ä¸ä¸€æ ·ã€‚æˆ‘ä»¬éœ€è¦å°†å®ƒä»¬å˜å½¢å±‚ç»Ÿä¸€çš„æ ¼å¼å¹¶å°†å¤šå°ºåº¦çš„é¢„æµ‹è¿ç»“ï¼Œä»è€Œè®©åç»­è®¡ç®—æ›´ç®€å•ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flatten_pred</span><span class="params">(pred)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> pred.transpose((<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>)).flatten()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">concat_preds</span><span class="params">(preds)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> nd.concat(*[flatten_pred(p) <span class="keyword">for</span> p <span class="keyword">in</span> preds], dim=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>é€šé“ç»´åŒ…å«ä¸­å¿ƒç›¸åŒçš„é”šæ¡†çš„é¢„æµ‹ç»“æœã€‚é¦–å…ˆå°†é€šé“ç»´ç§»åˆ°æœ€åä¸€ç»´ã€‚å› ä¸ºä¸åŒå°ºåº¦ä¸‹æ‰¹é‡å¤§å°ä»ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†é¢„æµ‹ç»“æœè½¬æˆäºŒç»´çš„ï¼ˆæ‰¹é‡å¤§å°ï¼Œé«˜xå®½xé€šé“æ•°ï¼‰çš„æ ¼å¼ï¼Œæ–¹ä¾¿ç»´åº¦1ä¸Šçš„è¿ç»“ã€‚</p>
<ol start="4">
<li>é«˜å’Œå®½å‡åŠå—<br>ä¸²è”äº†</li>
</ol>
<ul>
<li>å¡«å……ä¸º1çš„3x3å·ç§¯å±‚ ï¼ˆä¸æ”¹å˜ç‰¹å¾å›¾çš„å½¢çŠ¶ï¼‰</li>
<li>å¡«å……ä¸º1å’Œæ­¥å¹…ä¸º2çš„2x2æœ€å¤§æ± åŒ–å±‚ ï¼ˆç›´æ¥å°†ç‰¹å¾å›¾çš„é«˜å’Œå®½å‡åŠï¼Œå¢å¤§æ„Ÿå—é‡æ›´å®½é˜”ï¼‰</li>
</ul>
<ol start="5">
<li>åŸºç¡€ç½‘ç»œå—<br>åŸºç¡€ç½‘ç»œå—ç”¨æ¥ä»<strong>åŸå§‹å›¾åƒä¸­æŠ½å–ç‰¹å¾</strong>ã€‚ä¸ºäº†è®¡ç®—ç®€æ´ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ„é€ ä¸€ä¸ªå°çš„åŸºç¡€ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¸²è”3ä¸ªé«˜å’Œå®½å‡åŠå—ï¼Œå¹¶é€æ­¥å°†é€šé“æ•°ç¿»å€</li>
<li>å®Œæ•´çš„æ¨¡å‹<br>SSDæ¨¡å‹ä¸€å…±åŒ…å«5ä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è¾“å‡ºçš„ç‰¹å¾å›¾æ—¢åŒæ¥ç”Ÿæˆé”šæ¡†ï¼Œåˆç”¨æ¥é¢„æµ‹è¿™äº›é”šæ¡†çš„ç±»åˆ«å’Œåç§»é‡ã€‚ç¬¬ä¸€æ¨¡å—ä¸ºåŸºç¡€ç½‘ç»œå—ï¼Œç¬¬äºŒæ¨¡å—è‡³åœ°å››æ¨¡å—ä¸ºé«˜å’Œå®½å‡åŠå—ï¼Œç¬¬äº”æ¨¡å—ä½¿ç”¨å…¨å±€æœ€å¤§æ± åŒ–å±‚å°†é«˜å’Œå®½é™åˆ°1ã€‚ç¬¬äºŒæ¨¡å—è‡³ç¬¬äº”æ¨¡å—å‡ä¸ºå¤šå°ºåº¦ç‰¹å¾å—ã€‚<br>å®šä¹‰å‰å‘è®¡ç®—ï¼š<br>ä¸ä»…è¿”å›å·ç§¯è®¡ç®—è¾“å‡ºçš„ç‰¹å¾å›¾Yï¼Œè¿˜è¿”å›æ ¹æ®Yç”Ÿæˆçš„å½“å‰å°ºåº¦çš„é”šæ¡†ï¼Œä»¥åŠåŸºäºYé¢„æµ‹çš„é”šæ¡†ç±»åˆ«å’Œåç§»é‡ã€‚<br>æˆ‘ä»¬æåˆ°ï¼Œå›¾ä¸­è¾ƒé è¿‘é¡¶éƒ¨çš„å¤šå°ºåº¦ç‰¹å¾å—ç”¨æ¥æ£€æµ‹å°ºå¯¸è¾ƒå¤§çš„ç›®æ ‡ï¼Œå› æ­¤è¦ç¡®å®šä¸åŒå°ºåº¦ä¸‹é”šæ¡†å¤§å°çš„è¾ƒå°å€¼ï¼Œå†æ¥ç¡®å®šä¸åŒå°ºåº¦ä¸‹é”šæ¡†çš„è¾ƒå¤§å€¼ã€‚<br>æœ€åå®šä¹‰å®Œæ•´çš„æ¨¡å‹TinySSD<h4 id="9-7-2-è®­ç»ƒæ¨¡å‹"><a href="#9-7-2-è®­ç»ƒæ¨¡å‹" class="headerlink" title="9.7.2 è®­ç»ƒæ¨¡å‹"></a>9.7.2 è®­ç»ƒæ¨¡å‹</h4></li>
<li>è¯»å–æ•°æ®é›†å’Œåˆå§‹åŒ–<br>å‰é¢çš„çš®å¡ä¸˜æ•°æ®é›†ï¼Œå¹¶åˆå§‹åŒ–æ¨¡å‹å‚æ•°å¹¶å®šä¹‰ä¼˜åŒ–ç®—æ³•ã€‚</li>
<li>å®šä¹‰æŸå¤±å‡½æ•°å’Œè¯„ä»·å‡½æ•°<br>ä¸¤ä¸ªæŸå¤±ï¼š</li>
</ol>
<ul>
<li>æœ‰å…³ç±»åˆ«çš„æŸå¤±ï¼Œé‡ç”¨ä¹‹å‰å›¾åƒåˆ†ç±»é—®é¢˜é‡Œä¸€ç›´ä½¿ç”¨çš„äº¤å‰ç†µæŸå¤±å‡½æ•°</li>
<li>æœ‰å…³è¯ç±»é”šæ¡†åç§»é‡çš„æŸå¤±ã€‚é¢„æµ‹åç§»é‡æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ï¼Œä½†ä¸ä½¿ç”¨3.1èŠ‚çš„å¹³æ–¹æŸå¤±ï¼Œè€Œä½¿ç”¨L1èŒƒæ•°æŸå¤±ï¼Œå³é¢„æµ‹å€¼ä¸çœŸå®å€¼ä¹‹é—´å·®çš„ç»å¯¹å€¼ï¼Œæ©ç å˜é‡bbox_masksä»¤è´Ÿç±»é”šæ¡†å’Œå¡«å……é”šæ¡†ä¸å‚ä¸æŸå¤±è®¡ç®—ã€‚</li>
</ul>
<ol start="3">
<li>è®­ç»ƒæ¨¡å‹<br>è·Ÿä»¥å¾€ç›¸åŒï¼Œè®¡ç®—é¢„æµ‹ç±»åˆ«å’Œåç§»é‡å†ä¸çœŸå®è®¡ç®—æŸå¤±ï¼Œå†è¿­ä»£ã€‚<h4 id="9-7-3-é¢„æµ‹ç›®æ ‡"><a href="#9-7-3-é¢„æµ‹ç›®æ ‡" class="headerlink" title="9.7.3 é¢„æµ‹ç›®æ ‡"></a>9.7.3 é¢„æµ‹ç›®æ ‡</h4>ä¹Ÿéœ€è¦è‡ªå·±å®šä¹‰å‡½æ•°ï¼š</li>
<li>è¯»å–æµ‹è¯•å›¾åƒï¼Œå°†å…¶å˜æ¢å°ºå¯¸ï¼Œç„¶åè½¬æˆå·ç§¯å±‚éœ€è¦çš„å››ç»´æ ¼å¼ã€‚</li>
<li>é€šè¿‡MultiBoxDetectionå‡½æ•°æ ¹æ®é”šæ¡†åŠå…¶é¢„æµ‹åç§»é‡å¾—åˆ°é¢„æµ‹è¾¹ç•Œæ¡†ï¼Œå¹¶é€šè¿‡éæå¤§å€¼æŠ‘åˆ¶ç§»é™¤ç›¸ä¼¼çš„é¢„æµ‹è¾¹ç•Œæ¡†</li>
<li>æœ€åå°†ç½®ä¿¡åº¦ä¸ä½äº0.3çš„è¾¹ç•Œæ¡†é€‰ä¸ºæœ€ç»ˆè¾“å‡ºå¹¶ç”¨ä»¥å±•ç¤ºã€‚</li>
</ol>
<h3 id="9-8-åŒºåŸŸå·ç§¯ç¥ç»ç½‘ç»œï¼ˆR-CNNï¼‰ç³»åˆ—"><a href="#9-8-åŒºåŸŸå·ç§¯ç¥ç»ç½‘ç»œï¼ˆR-CNNï¼‰ç³»åˆ—" class="headerlink" title="9.8 åŒºåŸŸå·ç§¯ç¥ç»ç½‘ç»œï¼ˆR-CNNï¼‰ç³»åˆ—"></a>9.8 åŒºåŸŸå·ç§¯ç¥ç»ç½‘ç»œï¼ˆR-CNNï¼‰ç³»åˆ—</h3><p>åŒºåŸŸå·ç§¯ç¥ç»ç½‘ç»œæ˜¯å°†æ·±åº¦æ¨¡å‹åº”ç”¨ä¸ç›®æ ‡æ£€æµ‹çš„å¼€åˆ›æ€§å·¥ä½œä¹‹ä¸€ã€‚<br>ä»‹ç»R-CNNå’Œå®ƒçš„ä¸€ç³»åˆ—æ”¹è¿›æ–¹æ³•ï¼š</p>
<ul>
<li>R-CNN</li>
<li>Fast R-CNN</li>
<li>Faster R-CNN</li>
<li>Mask R-CNN<h4 id="9-8-1-R-CNN"><a href="#9-8-1-R-CNN" class="headerlink" title="9.8.1 R-CNN"></a>9.8.1 R-CNN</h4>R-CNNé¦–å…ˆå¯¹å›¾åƒé€‰å–è‹¥å¹²æè®®åŒºåŸŸå¹¶ç½©ä½ä»–ä»¬çš„ç±»åˆ«å’Œè¾¹ç•Œæ¡†ï¼ˆå¦‚åç§»é‡ï¼‰ã€‚ç„¶åç”¨å·ç§¯ç¥ç»ç½‘ç»œå¯¹æ¯ä¸ªæè®®åŒºåŸŸåšå‰å‘è®¡ç®—æŠ½å–ç‰¹å¾ã€‚ä¹‹åå¯¹æ¯ä¸ªæè®®åŒºåŸŸçš„ç‰¹å¾é¢„æµ‹ç±»åˆ«å’Œè¾¹ç•Œæ¡†ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</li>
</ul>
<ol>
<li>å¯¹è¾“å…¥å›¾åƒä½¿ç”¨é€‰æ‹©æ€§æœç´¢æ¥é€‰å–å¤šä¸ªé«˜è´¨é‡çš„æè®®åŒºåŸŸã€‚è¿™äº›æè®®åŒºåŸŸé€šå¸¸æ˜¯å¤šä¸ªå°ºåº¦ä¸‹é€‰å–çš„ï¼Œå¹¶å…·æœ‰ä¸åŒçš„å½¢çŠ¶å’Œå¤§å°å¹¶è¢«æ ‡æ³¨ç±»åˆ«å’ŒçœŸå®è¾¹ç•Œæ¡†ã€‚</li>
<li>é€‰å–ä¸€ä¸ªä¸è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œï¼Œå¹¶å°†å…¶åœ¨è¾“å‡ºå±‚ä¹‹å‰æˆªæ–­ã€‚å°†æ¯ä¸ªæè®®åŒºåŸŸå˜å½¢ä¸ºç½‘ç»œéœ€è¦çš„è¾“å…¥å°ºå¯¸ï¼Œå¹¶é€šè¿‡å‰å‘è®¡ç®—è¾“å‡ºæŠ½å–çš„æè®®åŒºåŸŸç‰¹å¾ã€‚ï¼ˆè·å–ç‰¹å¾å†è½¬æ¥åˆ°ä¸‹é¢å»ï¼‰</li>
<li>å°†æ¯ä¸ªæè®®åŒºåŸŸçš„ç‰¹å¾è¿åŒå…¶æ ‡æ³¨æ ‡æ³¨çš„ç±»åˆ«ä½œä¸ºä¸€ä¸ªæ ·æœ¬ï¼Œè®­ç»ƒå¤šä¸ªæ”¯æŒå‘é‡æœºå¯¹ç›®æ ‡åˆ†ç±»ã€‚å…¶ä¸­æ¯ä¸ªæ”¯æŒå‘é‡æœºç”¨æ¥åˆ¤æ–­æ ·æœ¬æ˜¯å¦å±äºæŸä¸€ä¸ªç±»åˆ«ã€‚</li>
<li>å°†æ¯ä¸ªæè®®åŒºåŸŸçš„ç‰¹å¾è¿åŒå…¶æ ‡æ³¨çš„è¾¹ç•Œæ¡†ä½œä¸ºä¸€ä¸ªæ ·æœ¬ï¼Œè®­ç»ƒçº¿æ€§å›å½’æ¨¡å‹æ¥é¢„æµ‹çœŸå®è¾¹ç•Œæ¡†ã€‚<br>æ€è·¯å¾ˆå¥½é€šè¿‡é¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œæœ‰æ•ˆæå–äº†å›¾åƒç‰¹å¾ï¼Œä½†ä¸»è¦ç‰¹ç‚¹æ˜¯é€Ÿåº¦æ…¢ã€‚å¯èƒ½æè®®åŒºåŸŸéå¸¸å¤šã€‚<h4 id="9-8-2-Fast-R-CNN"><a href="#9-8-2-Fast-R-CNN" class="headerlink" title="9.8.2 Fast R-CNN"></a>9.8.2 Fast R-CNN</h4>R-CNNçš„ä¸»è¦é—®é¢˜æ˜¯æ¯ä¸ªæè®®åŒºç‹¬ç«‹æŠ½å–ç‰¹å¾ï¼Œç”±äºè¿™äº›åŒºåŸŸé€šå¸¸æœ‰å¤§é‡é‡å ï¼Œç‹¬ç«‹çš„ç‰¹å¾æŠ½å–å¯¼è‡´å¤§é‡çš„é‡å¤è®¡ç®—ã€‚Fast R-CNNå’ŒR-CNNçš„ä¸€ä¸ªä¸»è¦æ”¹è¿›åœ¨äºåªå¯¹æ•´ä¸ªå›¾åƒåšå·ç§¯ç¥ç»ç½‘ç»œçš„å‰å‘è®¡ç®—ã€‚ï¼ˆå»æ‰äº†æè®®åŒºåŸŸï¼Œä½†æœ‰æ¯›ç—…åé¢è¿˜æ˜¯æœ‰æè®®åŒºåŸŸè¿˜æ˜¯æ…¢ğŸ˜‚ï¼‰<br>éƒ½æ˜¯åŠªåŠ›å­¦ä¹ ç‰¹å¾æœ€åç”¨äºåˆ†ç±»é¢„æµ‹ã€‚<br>è®¡ç®—æ­¥éª¤å¦‚ä¸‹ï¼š</li>
<li>ç”¨æ¥æå–ç‰¹å¾çš„å·ç§¯ç¥ç»ç½‘ç»œçš„è¾“å…¥æ˜¯æ•´ä¸ªå›¾åƒï¼Œè€Œä¸æ˜¯å„ä¸ªæè®®åŒºåŸŸï¼Œè€Œä¸”ï¼Œè¿™ä¸ªç½‘ç»œé€šå¸¸ä¼šå‚ä¸è®­ç»ƒï¼Œå³æ›´æ–°æ¨¡å‹å‚æ•°ã€‚è®¾è¾“å…¥ä¸€å¼ ä½“é¦™ï¼Œå·ç§¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºå½¢çŠ¶ç»“å°¾1xcxh1xw1</li>
<li>å‡è®¾é€‰æ‹©æ€§æœç´¢ç”Ÿæˆnä¸ªæè®®åŒºåŸŸã€‚å½¢çŠ¶å„å¼‚çš„æè®®åŒºåŸŸåœ¨å·ç§¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºä¸Šåˆ†åˆ«æ ‡å‡ºå½¢çŠ¶å„å¼‚çš„å…´è¶£åŒºåŸŸã€‚è¿™äº›å…´è¶£åŒºåŸŸéœ€è¦æŠ½å‡ºå½¢çŠ¶å½¢åŒçš„ç‰¹å¾ï¼ˆå‡è®¾é«˜å’Œå®½å‡åˆ†åˆ«åˆ†åˆ«æŒ‡å®šä¸ºh2å’Œw2ï¼‰ä¾¿äºè¿ç»“åè¾“å‡ºã€‚å¼•å…¥ä¸ªè´µå¤æ‚è¦æ­»RoIæ± åŒ–å±‚ï¼Œæœ€åå°†å·ç§¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºå’Œæè®®åŒºåŸŸè¾“å…¥ï¼Œè¾“å‡ºè¿ç»“åçš„å„ä¸ªæè®®åŒºåŸŸæ ‡å‡ºçš„å…´è¶£åŒºåŸŸæ‰€æŠ½å–çš„ç‰¹å¾ï¼Œå½¢çŠ¶ä¸ºnxcxh2xw2ã€‚</li>
<li>é€šè¿‡å…¨è¿æ¥å±‚å°†è¾“å‡ºå½¢çŠ¶å˜ä¸ºnxdï¼Œå…¶ä¸­è¶…å‚æ•°då–å†³äºæ¨¡å‹è®¾è®¡ã€‚</li>
<li>é¢„æµ‹ç±»åˆ«æ—¶ï¼Œå°†å…¨è¿æ¥å±‚çš„è¾“å‡ºå½¢çŠ¶å†å˜æ¢ä¸ºnxqå¹¶ä½¿ç”¨softmaxå›å½’ã€‚é¢„æµ‹è¾¹ç•Œæ¡†æ—¶ï¼Œå°†å…¨è¿æ¥å±‚çš„è¾“å‡ºçš„å½¢çŠ¶å˜æ¢ä¸ºnx4ã€‚</li>
</ol>
<p>RoIæ± åŒ–å±‚å’Œä¹‹å‰ä»‹ç»çš„æ± åŒ–å±‚ä¸åŒã€‚<br>åŸæ¥æ± åŒ–å±‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®æ± åŒ–çª—å£ã€å¡«å……å’Œæ­¥å¹…æ¥æ§åˆ¶è¾“å‡ºå½¢çŠ¶ã€‚è€ŒRoIï¼ˆå…´è¶£åŒºåŸŸæ± åŒ–å±‚ï¼‰å¯¹æ¯ä¸ªåŒºåŸŸçš„è¾“å‡ºå½¢çŠ¶æ˜¯å¯ä»¥ç›´æ¥æŒ‡å®šçš„ï¼ˆå°±æ˜¯ä¸éœ€è¦æ”¹å˜é‚£äº›å‚æ•°æ¥æ§åˆ¶è¾“å‡ºï¼‰ï¼Œä¾‹å¦‚ï¼ŒæŒ‡å®šæ¯ä¸ªåŒºåŸŸè¾“å‡ºçš„é«˜å’Œå®½åˆ†åˆ«ä¸ºh2å’Œw2ï¼Œå‡è®¾æŸä¸€RoIçª—å£çš„é«˜å’Œå®½åˆ†åˆ«ä¸ºhå’Œwï¼Œè¯¥çª—å£è¢«åˆ’åˆ†ä¸ºå½¢çŠ¶ä¸ºh2xw2çš„å­çª—å£ç½‘æ ¼ï¼Œä¸”æ¯ä¸ªå­çª—å£çš„å¤§å°å¤§çº¦ä¸º(h/h2)x(w/w2)ã€‚ä»»ä¸€å­çª—å£çš„é«˜å’Œå®½è¦å–æ•´ï¼Œå…¶ä¸­çš„æœ€å¤§å…ƒç´ ä½œä¸ºè¯¥å­çª—å£çš„è¾“å‡ºã€‚<br>å› æ­¤ï¼Œå…´è¶£åŒºåŸŸæ± åŒ–å±‚å¯ä»¥ä»å½¢çŠ¶å„å¼‚çš„å…´è¶£åŒºåŸŸä¸­å‡æŠ½å–å‡ºå½¢çŠ¶ç›¸åŒçš„ç‰¹å¾ã€‚<br>çœ‹ä¾‹å­ï¼Œä¸€çœ‹å°±ä¼šã€‚</p>
<h4 id="9-8-3-Faster-R-CNN"><a href="#9-8-3-Faster-R-CNN" class="headerlink" title="9.8.3 Faster R-CNN"></a>9.8.3 Faster R-CNN</h4><p>Fast R-CNNéœ€è¦é€‰æ‹©æ€§æœç´¢ä¸­ç”Ÿæˆè¾ƒå¤šçš„æè®®åŒºåŸŸï¼Œä»¥è·å–è¾ƒç²¾ç¡®çš„ç›®æ ‡æ£€æµ‹ç»“æœã€‚Faster R-CNNæå‡ºå°†é€‰æ‹©æ€§æœç´¢æ›¿æ¢æˆ<strong>åŒºåŸŸå»ºè®®ç½‘ç»œ</strong>ï¼Œä»è€Œå‡å°‘æè®®åŒºåŸŸçš„ç”Ÿæˆæ•°é‡ï¼Œå¹¶ä¿è¯ç›®æ ‡æ£€æµ‹çš„ç²¾åº¦ã€‚<br><strong>åŒºåŸŸæè®®ç½‘ç»œ</strong>çš„è®¡ç®—æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä½¿ç”¨å¡«å……ä¸º1çš„3x3å·ç§¯å±‚å˜æ¢å·ç§¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼Œå¹¶å°†è¾“å‡ºé€šé“æ•°è®°ä¸ºcã€‚è¿™æ ·ï¼Œå·ç§¯ç¥ç»ç½‘ç»œä¸ºå›¾åƒæŠ½å–çš„ç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªå•å…ƒå‡å¾—åˆ°ä¸€ä¸ªé•¿åº¦ä¸ºcçš„æ–°ç‰¹å¾ã€‚</li>
<li>ä»¥ç‰¹å¾å›¾æ¯ä¸ªå›¾åƒä¸ºä¸­å¿ƒï¼Œç”Ÿæˆå¤šä¸ªä¸åŒå¤§å°çš„ç‹‚é«˜æ¯”çš„é”šæ¡†å¹¶æ ‡æ³¨å®ƒä»¬ã€‚</li>
<li>ç”¨é”šæ¡†ä¸­å¿ƒå•å…ƒé•¿åº¦ä¸ºcçš„ç‰¹å¾åˆ†åˆ«é¢„æµ‹è¯¥é”šæ¡†çš„äºŒå…ƒç±»åˆ«ï¼ˆå«ç›®æ ‡è¿˜æ˜¯èƒŒæ™¯ï¼‰å’Œè¾¹ç•Œæ¡†ã€‚</li>
<li>ä½¿ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼Œä»é¢„æµ‹ç±»åˆ«ä¸ºç›®æ ‡çš„é¢„æµ‹è¾¹ç•Œæ¡†ä¸­ç§»é™¤ç›¸ä¼¼çš„ç»“æœã€‚æœ€ç»ˆè¾“å‡ºçš„é¢„æµ‹è¾¹ç•Œæ¡†å³å…´è¶£åŒºåŸŸæ± åŒ–å±‚æ‰€éœ€è¦çš„æè®®åŒºåŸŸã€‚</li>
</ol>
<p>ç‰¹åˆ«çš„æ˜¯ï¼ŒåŒºåŸŸæè®®ç½‘ç»œä½œä¸ºFaster R-CNNçš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å’Œæ•´ä¸ªæ¨¡å‹ä¸€èµ·è®­ç»ƒå¾—åˆ°çš„ï¼Œä¹Ÿæ˜¯æ¨¡å‹å‚æ•°ã€‚ä¹Ÿå°±æ˜¯Faster R-CNNçš„ç›®æ ‡å‡½æ•°æ—¢åŒ…æ‹¬ç›®æ ‡æ£€æµ‹ä¸­çš„ç±»åˆ«å’Œè¾¹ç•Œæ¡†æ£€æµ‹ï¼ŒåˆåŒ…æ‹¬åŒºåŸŸæè®®ç½‘ç»œä¸­é”šæ¡†çš„çƒ­æºç±»åˆ«å’Œè¾¹ç•Œæ¡†é¢„æµ‹ã€‚æœ€åèƒ½å­¦ä¹ åˆ°ç”Ÿæˆé«˜è´¨é‡çš„æè®®åŒºåŸŸï¼Œä¿è¯åœ¨å‡å°‘æè®®åŒºåŸŸæ•°é‡ä¹Ÿèƒ½ä¿è¯ç²¾åº¦ã€‚</p>
<h4 id="9-8-4-Mask-R-CNN"><a href="#9-8-4-Mask-R-CNN" class="headerlink" title="9.8.4 Mask R-CNN"></a>9.8.4 Mask R-CNN</h4><p>å¦‚æœè®­ç»ƒæ•°æ®è¿˜æ ‡æ³¨äº†æ¯ä¸ªç›®æ ‡åœ¨å›¾åƒä¸Šçš„åƒç´ çº§ä½ç½®ï¼Œé‚£ä¹ˆMask R-CNNèƒ½æœ‰æ•ˆåˆ©ç”¨è¿™äº›è¯¦å°½çš„æ ‡æ³¨ä¿¡æ¯è¿›ä¸€æ­¥æå‡ç›®æ ‡æ£€æµ‹çš„ç²¾åº¦ã€‚<br>Mask R-CNNå°†å…´è¶£åŒºåŸŸæ± åŒ–å±‚æ›¿æ¢æˆäº†å…´è¶£åŒºåŸŸå¯¹é½å±‚ï¼Œå³é€šè¿‡åŒçº¿æ€§æ’å€¼æ¥ä¿ç•™ç‰¹å¾å›¾ä¸Šçš„ç©ºé—´ä¿¡æ¯ï¼Œä»è€Œæ›´é€‚ç”¨äºåƒç´ çº§é¢„æµ‹ã€‚å…´è¶£åŒºåŸŸå¯¹é½å±‚çš„è¾“å‡º<strong>åŒ…å«äº†æ‰€æœ‰å…´è¶£åŒºåŸŸçš„å½¢çŠ¶ç›¸åŒçš„ç‰¹å¾å›¾</strong>ã€‚å®ƒä»¬æ—¢ç”¨æ¥é¢„æµ‹å…´è¶£åŒºåŸŸçš„ç±»åˆ«å’Œè¾¹ç•Œæ¡†ï¼Œåˆé€šè¿‡é¢å¤–çš„å…¨å·ç§¯ç½‘ç»œé¢„æµ‹ç›®æ ‡çš„<strong>åƒç´ çº§ä½ç½®ï¼ˆå…¨å·ç§¯ç½‘ç»œä»‹ç»ï¼‰</strong>ã€‚</p>
<h3 id="9-9-è¯­ä¹‰åˆ†å‰²å’Œæ•°æ®é›†"><a href="#9-9-è¯­ä¹‰åˆ†å‰²å’Œæ•°æ®é›†" class="headerlink" title="9.9 è¯­ä¹‰åˆ†å‰²å’Œæ•°æ®é›†"></a>9.9 è¯­ä¹‰åˆ†å‰²å’Œæ•°æ®é›†</h3><p>ä»»åŠ¡ä¸ä¸€æ ·ã€‚å‰é¢ä¸€ç›´ç”¨æ–¹å½¢è¾¹ç•Œæ¡†æ¥æ ‡æ³¨å’Œé¢„æµ‹å›¾åƒä¸­çš„ç›®æ ‡ã€‚æœ¬èŠ‚æ¢è®¨è¯­ä¹‰åˆ†å‰²ï¼Œå®ƒå…³æ³¨å¦‚ä½•å°†å›¾åƒåˆ†å‰²æˆå±äºä¸åŒè¯­ä¹‰ç±»åˆ«çš„åŒºåŸŸã€‚å€¼å¾—ä¸€ä½“çš„æ˜¯ï¼Œè¿™äº›æ˜¯åƒç´ çº§çš„ã€‚è¾¹æ¡†æ›´åŠ ç»†è‡´ã€‚</p>
<h4 id="9-9-1-å›¾åƒåˆ†å‰²å’Œå®ä¾‹åˆ†å‰²"><a href="#9-9-1-å›¾åƒåˆ†å‰²å’Œå®ä¾‹åˆ†å‰²" class="headerlink" title="9.9.1 å›¾åƒåˆ†å‰²å’Œå®ä¾‹åˆ†å‰²"></a>9.9.1 å›¾åƒåˆ†å‰²å’Œå®ä¾‹åˆ†å‰²</h4><p>ä¸¤ä¸ªä¸è¯­ä¹‰åˆ†å‰²ç›¸ä¼¼çš„é‡è¦é—®é¢˜ï¼š</p>
<ul>
<li>å›¾åƒåˆ†å‰²ï¼šå°†å›¾åƒåˆ†å‰²æˆè‹¥å¹²ç»„æˆåŒºåŸŸï¼Œé€šå¸¸åˆ©ç”¨å›¾åƒä¸­åƒç´ ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œä½†æ˜¯åœ¨è®­ç»ƒæ—¶ä¸éœ€è¦æœ‰å…³å›¾åƒåƒç´ çš„æ ‡ç­¾ä¿¡æ¯ï¼Œåœ¨é¢„æµ‹æ—¶ä¹Ÿæ— æ³•ä¿è¯åˆ†å‰²å‡ºçš„åŒºåŸŸå…·æœ‰æˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„è¯­ä¹‰ã€‚å¯èƒ½æŠŠä¸€ä¸ªç‹—åˆ†æˆä¸¤éƒ¨åˆ†ğŸ˜‚ã€‚</li>
<li>å®ä¾‹åˆ†å‰²åˆå«åŒæ—¶æ£€æµ‹å¹¶åˆ†å‰²ã€‚å®ƒç ”ç©¶å¦‚ä½•è¯†åˆ«å›¾åƒä¸­å„ä¸ªç›®æ ‡å®ä¾‹çš„åƒç´ çº§åŒºåŸŸã€‚ä¸è¯­ä¹‰åˆ†å‰²æœ‰æ‰€ä¸åŒï¼Œå®ä¾‹åˆ†å‰²ä¸ä»…éœ€è¦åŒºåˆ†è¯­ä¹‰ï¼Œè¿˜è¦åŒºåˆ†ä¸åŒçš„ç›®æ ‡å®ä¾‹ï¼ˆæ›´éš¾ä¸€äº›ï¼‰ã€‚æ¯”å¦‚å›¾åƒä¸­æœ‰ä¸¤åªç‹—ï¼Œå®ä¾‹åˆ†å‰²è¿˜éœ€è¦åŒºåˆ†åƒç´ å±äºé‚£ä¸€åªç‹—ï¼Œè°æ˜¯è°ã€‚<h4 id="9-9-2-Pascal-VOC2012è¯­ä¹‰åˆ†å‰²æ•°æ®é›†"><a href="#9-9-2-Pascal-VOC2012è¯­ä¹‰åˆ†å‰²æ•°æ®é›†" class="headerlink" title="9.9.2 Pascal VOC2012è¯­ä¹‰åˆ†å‰²æ•°æ®é›†"></a>9.9.2 Pascal VOC2012è¯­ä¹‰åˆ†å‰²æ•°æ®é›†</h4>wocï¼Œ2GBçš„è®­ç»ƒé›†<br>æ•°æ®é›†ç‰¹ç‚¹ï¼š</li>
<li>ImageSets/Segmentationè·¯å¾„åŒ…å«äº†æŒ‡å®šè®­ç»ƒå’Œæµ‹è¯•æ ·æœ¬çš„æ–‡æœ¬æ–‡ä»¶</li>
<li>è€ŒJPEGImageså’ŒSegmentationlassè·¯å¾„ä¸‹åˆ†åˆ«åŒ…å«äº†æ ·æœ¬çš„è¾“å…¥å›¾åƒå’Œæ ‡ç­¾<br>è¿™é‡Œçš„æ ‡ç­¾ä¹Ÿæ˜¯<strong>å›¾åƒæ ¼å¼</strong>ï¼Œå…¶å°ºå¯¸å’Œå®ƒæ‰€æ ‡æ³¨çš„è¾“å…¥å›¾åƒçš„å°ºå¯¸ç›¸åŒã€‚æ ‡ç­¾ä¸­é¢œè‰²ç›¸åŒçš„åƒç´ å±äºåŒä¸€ä¸ªè¯­ä¹‰ç±»åˆ«ã€‚ ç”¨é¢œè‰²å—å—åŒºåˆ†åšæ ‡ç­¾ã€‚<br>ä¸åŒçš„é¢œè‰²ä»£è¡¨ä¸åŒçš„ç±»åˆ«ã€‚</li>
</ul>
<ol>
<li>é¢„å¤„ç†æ•°æ®<br>ä¹‹å‰é€šè¿‡ç¼©æ”¾ä»å›¾åƒä½¿ç¬¦åˆæ¨¡å‹çš„è¾“å…¥å½¢çŠ¶ï¼Œç„¶è€Œåœ¨è¯­ä¹‰åˆ†å‰²é‡Œé¢ï¼Œè¿™æ ·åšéœ€è¦å°†é¢„æµ‹çš„åƒç´ ç±»åˆ«é‡æ–°æ˜ å°„å›åŸå§‹å°ºå¯¸çš„è¾“å…¥å›¾åƒã€‚è¿™æ ·çš„æ˜ å°„éš¾ä»¥åšåˆ°å‡†ç¡®ï¼Œå°¤å…¶åœ¨ä¸åŒè¯­ä¹‰çš„åˆ†å‰²åŒºåŸŸã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå°†å›¾åƒè£å‰ªæˆå›ºå®šå°ºå¯¸è€Œä¸æ˜¯ç¼©æ”¾ï¼Œä½¿ç”¨å›¾åƒå¢å¹¿çš„éšæœºè£å‰ªï¼Œè£å‰ªå‡ºç›¸åŒåŒºåŸŸã€‚</li>
<li>è‡ªå®šä¹‰è¯­ä¹‰åˆ†å‰²æ•°æ®é›†ç±»<br>ç»§æ‰¿Gluonçš„Datasetç±»è‡ªå®šä¹‰äº†ä¸€ä¸ªè¯­ä¹‰åˆ†å‰²æ•°æ®é›†ç±»VOCSegDataseté€šè¿‡å®ç°<strong>getitem</strong>å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä»»ä¸€è®¿é—®æ•°æ®é›†ä¸­ç´¢å¼•ä¸ºidxçš„è¾“å…¥å›¾åƒåŠå…¶æ¯ä¸ªåƒç´ çš„ç±»åˆ«ç´¢å¼•ã€‚è¿˜å¯¹RGBä¸‰ä¸ªé€šé“å€¼åˆ†åˆ«åšæ ‡å‡†åŒ–ã€‚</li>
<li>è¯»å–æ•°æ®é›†<br>æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰çš„VOCSegDatasetç±»æ¥åˆ†åˆ«åˆ›å»ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„å®ä¾‹ã€‚å‡è®¾æˆ‘ä»¬æŒ‡å®šéšæœºè£å‰ªçš„è¾“å‡ºå›¾åƒè¡Œå’‹æ··è¿‡ä¸º320x480ã€‚ä¸‹é¢æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ‰€ä¿ç•™çš„æ ·æœ¬ä¸ªæ•°ã€‚ï¼Ÿ<br>æœªå®Œï¼Œä¸‹é¢ä¸€èŠ‚è·Ÿç€è®­ç»ƒç½‘ç»œã€‚</li>
</ol>
<h3 id="9-10-å…¨å·ç§¯ç½‘ç»œï¼ˆFCNï¼‰"><a href="#9-10-å…¨å·ç§¯ç½‘ç»œï¼ˆFCNï¼‰" class="headerlink" title="9.10 å…¨å·ç§¯ç½‘ç»œï¼ˆFCNï¼‰"></a>9.10 å…¨å·ç§¯ç½‘ç»œï¼ˆFCNï¼‰</h3><p>ä¸Šä¸€èŠ‚ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºè¯­ä¹‰å†¯æ©å¯¹å›¾åƒä¸­æ¯ä¸ªåƒç´ è¿›è¡Œé¢„æµ‹ã€‚å…¨å·ç§¯ç½‘ç»œé‡‡ç”¨å·ç§¯ç¥ç»ç½‘ç»œå®ç°äº†å›¾åƒä»åƒç´ åˆ°åƒç´ ç±»åˆ«çš„å˜æ¢ã€‚<br>ä¸ä¹‹å‰ä»‹ç»çš„å·ç§¯ç¥ç»ç½‘ç»œä¸åŒï¼Œå…¨å·ç§¯ç¥ç»ç½‘ç»œé€šè¿‡è½¬ç½®å·ç§¯å±‚å°†ä¸­é—´å±‚ç‰¹å¾å›¾çš„é«˜å’Œå®½å˜æ¢å›è¾“å…¥å›¾åƒçš„å°ºå¯¸ï¼Œä»è€Œä»¤é¢„æµ‹ç»“æœä¸è¾“å…¥å›¾åƒåœ¨ç©ºé—´ç»´ï¼ˆé«˜å’Œå®½ï¼‰ä¸Šä¸€ä¸€å¯¹åº”ï¼šç»™å®šç©ºé—´ç»´ä¸Šçš„ä½ç½®ï¼Œé€šé“ç»´çš„è¾“å‡ºå³è¯¥ä½ç½®å¯¹åº”åƒç´ çš„ç±»åˆ«é¢„æµ‹ã€‚ï¼ˆå¤§å°ç›¸åŒï¼‰</p>
<h4 id="9-10-1-è½¬ç½®å·ç§¯å±‚"><a href="#9-10-1-è½¬ç½®å·ç§¯å±‚" class="headerlink" title="9.10.1 è½¬ç½®å·ç§¯å±‚"></a>9.10.1 è½¬ç½®å·ç§¯å±‚</h4><p>é¡¾åæ€ä¹‰ï¼Œä¸“ç½®å·ç§¯å±‚å¾—åäºçŸ©é˜µçš„è½¬ç½®æ“ä½œã€‚äº‹å®ä¸Šï¼Œå·ç§¯è¿ç®—è¿˜å¯ä»¥é€šè¿‡çŸ©é˜µä¹˜æ³•æ¥å®ç°ï¼ˆä¹‹å‰æ˜¯äº’ç›¸å…³è¿ç®—è¿‘ä¼¼å·ç§¯è¿ç®—ï¼‰ã€‚<br>ä¾‹å­å¯ä»¥çœ‹åˆ°å·ç§¯è¿ç®—ä¸ä¹˜æ³•è¿ç®—ç»“æœä¸€æ ·ï¼Œè¯´æ˜å¯ä»¥ç”¨ä¹˜æ³•æ›¿ä»£ã€‚<br>ä»çŸ©é˜µä¹˜æ³•çš„è§’åº¦æ¥æè¿°å·ç§¯è¿ç®—ã€‚è®¾è¾“å…¥å‘é‡ä¸ºxï¼Œæƒé‡çŸ©é˜µä¸ºWï¼Œå·ç§¯çš„å‰å‘è®¡ç®—å‡½æ•°çš„å®ç°å¯ä»¥çœ‹ä½œå°†å‡½æ•°è¾“å…¥ä¹˜ä»¥æƒé‡çŸ©é˜µï¼Œå¹¶è¾“å‡ºå‘é‡y=WXã€‚æˆ‘ä»¬ç›´åˆ°ï¼Œåå‘ä¼ æ’­éœ€è¦ä¾æ®é“¾å¼æ³•åˆ™ï¼Œå·ç§¯çš„çƒ¦å¿ƒå•Šä¸ªä¼ æ’­å‡½æ•°çš„å®ç°å¯ä»¥çœ‹ä½œå°†å‡½æ•°è¾“å…¥ä¹˜ä»¥è½¬ç½®åçš„æƒé‡çŸ©é˜µWTã€‚è€Œè½¬ç½®å·ç§¯å±‚æ­£å¥½äº¤æ¢äº†å·ç§¯å±‚çš„å‰å‘è®¡ç®—å‡½æ•°ä¸åå‘ä¼ æ’­å‡½æ•°ï¼šè¿™ä¸¤æ¶æå‡½æ•°å¯ä»¥çœ‹ä½œå°†å‡½æ•°è¾“å…¥å‘é‡åˆ†åˆ«ä¹˜ä»¥WTå’ŒWã€‚<br>ä¸éš¾æƒ³è±¡ï¼Œè½¬ç½®å·ç§¯å±‚å¯ä»¥ç”¨æ¥äº¤æ¢å·ç§¯å±‚è¾“å…¥å’Œè¾“å‡ºçš„å½¢çŠ¶ã€‚<br><strong>æ¨¡å‹è®¾è®¡ä¸­ï¼Œè½¬ç½®å·ç§¯å±‚å¸¸ç”¨äºå°†è¾ƒå°çš„ç‰¹å¾å›¾å˜æ¢ä¸ºæ›´å¤§çš„ç‰¹å¾å›¾ã€‚åœ¨å…¨å·ç§¯ç½‘ç»œä¸­ï¼Œå½“è¾“å…¥æ˜¯é«˜å’Œå®½è¾ƒå°çš„ç‰¹å¾å›¾æ—¶ï¼Œè½¬ç½®å·ç§¯å±‚å¯ä»¥ç”¨æ¥å°†é«˜å’Œå®½æ”¾å¤§åˆ°è¾“å…¥å›¾åƒçš„å°ºå¯¸ã€‚</strong><br>å°±åƒç›¸åæ“ä½œã€‚<br>æœ‰äº›æ–‡çŒ®ï¼Œè½¬ç½®å·ç§¯ä¹Ÿè¢«ç§°ä¸ºåˆ†æ•°æ­¥é•¿å·ç§¯ã€‚</p>
<h4 id="9-10-2-æ„é€ æ¨¡å‹"><a href="#9-10-2-æ„é€ æ¨¡å‹" class="headerlink" title="9.10.2 æ„é€ æ¨¡å‹"></a>9.10.2 æ„é€ æ¨¡å‹</h4><p>æˆ‘å»666ï¼Œå…ˆç”¨å·ç§¯å±‚æå–ç‰¹å¾ï¼Œå­¦ä¼šäº†ä¹‹åå†ç”¨è½¬ç½®å·ç§¯å±‚å˜å›åŸæ¥çš„å¤§å°ï¼Œè¾“å‡ºç±»åˆ«é¢„æµ‹ã€‚<br><img src="/2020/01/22/dive-into-deep-learning/fcn.png" alt="fcn"><br>å…¨å·ç§¯ç½‘ç»œå…ˆè¯•ç”¨å·ç§¯ç¥ç»ç½‘ç»œæŠ½å–å›¾åƒç‰¹å¾ï¼Œç„¶åé€šè¿‡1x1å·ç§¯å±‚å°†é€šé“æ•°å˜æ¢ä¸ºç±»åˆ«ä¸ªæ•°ï¼Œæœ€åé€šè¿‡è½¬ç½®å·ç§¯å±‚å°†ç‰¹å¾å›¾çš„é«˜å’Œå®½å˜æ¢ä¸ºè¾“å…¥å›¾åƒçš„å°ºå¯¸ã€‚æ¨¡å‹è¾“å‡ºä¸è¾“å…¥å›¾åƒçš„é«˜å’Œå®½ç›¸åŒï¼Œå¹¶åœ¨ç©ºé—´ä½ç½®ä¸Šä¸€ä¸€å¯¹åº”ã€‚<br>åé¢å†è¯´ï¼Œæˆ‘å»è¦çœ‹ä¹Ÿçœ‹å¾—æ‡‚ã€‚</p>
<h4 id="9-10-3-åˆå§‹åŒ–è½¬ç½®å·ç§¯å±‚"><a href="#9-10-3-åˆå§‹åŒ–è½¬ç½®å·ç§¯å±‚" class="headerlink" title="9.10.3 åˆå§‹åŒ–è½¬ç½®å·ç§¯å±‚"></a>9.10.3 åˆå§‹åŒ–è½¬ç½®å·ç§¯å±‚</h4><h4 id="9-10-4-è¯»å–æ•°æ®é›†"><a href="#9-10-4-è¯»å–æ•°æ®é›†" class="headerlink" title="9.10.4 è¯»å–æ•°æ®é›†"></a>9.10.4 è¯»å–æ•°æ®é›†</h4><h4 id="9-10-5-è®­ç»ƒæ¨¡å‹"><a href="#9-10-5-è®­ç»ƒæ¨¡å‹" class="headerlink" title="9.10.5 è®­ç»ƒæ¨¡å‹"></a>9.10.5 è®­ç»ƒæ¨¡å‹</h4><h4 id="9-10-6-é¢„æµ‹åƒç´ ç±»å‹"><a href="#9-10-6-é¢„æµ‹åƒç´ ç±»å‹" class="headerlink" title="9.10.6 é¢„æµ‹åƒç´ ç±»å‹"></a>9.10.6 é¢„æµ‹åƒç´ ç±»å‹</h4><h3 id="9-11-æ ·å¼è¿ç§»"><a href="#9-11-æ ·å¼è¿ç§»" class="headerlink" title="9.11 æ ·å¼è¿ç§»"></a>9.11 æ ·å¼è¿ç§»</h3><p>æ ·å¼è¿ç§»ï¼Œè´¼é…· å¥¥åˆ©ç»™ï¼ï¼ï¼<br>å­˜åœ¨æ»¤é•œï¼Œä»–èƒ½æ”¹å˜ç…§ç‰‡çš„é¢œè‰²æ ·å¼ï¼Œè¦å®ç°å¥½çš„æ•ˆæœéœ€è¦å¤§é‡çš„å°è¯•ä¸åŒçš„ç»„åˆï¼Œå¤æ‚ç¨‹åº¦ä¸äºšäºæ¨¡å‹è°ƒå‚ã€‚<br>æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œå°†æŸå›¾åƒä¸­çš„æ ·å¼åº”ç”¨è¿‡åœ¨å¦ä¸€å¼ å›¾åƒä¹‹ä¸Šï¼Œå³æ ·å¼è¿ç§»ã€‚æˆ‘ä»¬è¾“å…¥ä¸¤å¼ è¾“å…¥å›¾åƒï¼Œä¸€å¼ æ˜¯å†…å®¹å›¾åƒï¼Œå¦ä¸€å¼ æ˜¯æ ·å¼å›¾åƒã€‚åˆ©ç”¨ç¥ç»ç½‘ç»œä¿®æ”¹å›¾åƒå†…å®¹ä½¿å…¶åœ¨æ ·å¼ä¸Šæ›´æ¥è¿‘ã€‚</p>
<h4 id="9-11-1-æ–¹æ³•"><a href="#9-11-1-æ–¹æ³•" class="headerlink" title="9.11.1 æ–¹æ³•"></a>9.11.1 æ–¹æ³•</h4><h4 id="9-11-2-è¯»å–å†…å®¹å›¾åƒå’Œæ ·å¼å›¾åƒ"><a href="#9-11-2-è¯»å–å†…å®¹å›¾åƒå’Œæ ·å¼å›¾åƒ" class="headerlink" title="9.11.2 è¯»å–å†…å®¹å›¾åƒå’Œæ ·å¼å›¾åƒ"></a>9.11.2 è¯»å–å†…å®¹å›¾åƒå’Œæ ·å¼å›¾åƒ</h4><h4 id="9-11-3-é¢„å¤„ç†å’Œåå¤„ç†å›¾åƒ"><a href="#9-11-3-é¢„å¤„ç†å’Œåå¤„ç†å›¾åƒ" class="headerlink" title="9.11.3 é¢„å¤„ç†å’Œåå¤„ç†å›¾åƒ"></a>9.11.3 é¢„å¤„ç†å’Œåå¤„ç†å›¾åƒ</h4><h4 id="9-11-4-æŠ½å–ç‰¹å¾"><a href="#9-11-4-æŠ½å–ç‰¹å¾" class="headerlink" title="9.11.4 æŠ½å–ç‰¹å¾"></a>9.11.4 æŠ½å–ç‰¹å¾</h4><h4 id="9-11-5-å®šä¹‰æŸå¤±å‡½æ•°"><a href="#9-11-5-å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="9.11.5 å®šä¹‰æŸå¤±å‡½æ•°"></a>9.11.5 å®šä¹‰æŸå¤±å‡½æ•°</h4><ol>
<li>å†…å®¹æŸå¤±</li>
<li>æ ·å¼æŸå¤±</li>
<li>æ€»å˜å·®æŸå¤±</li>
<li>æŸå¤±å‡½æ•°<h4 id="9-11-6-åˆ›å»ºå’Œåˆå§‹åŒ–åˆæˆå›¾åƒ"><a href="#9-11-6-åˆ›å»ºå’Œåˆå§‹åŒ–åˆæˆå›¾åƒ" class="headerlink" title="9.11.6 åˆ›å»ºå’Œåˆå§‹åŒ–åˆæˆå›¾åƒ"></a>9.11.6 åˆ›å»ºå’Œåˆå§‹åŒ–åˆæˆå›¾åƒ</h4><h4 id="9-11-7-è®­ç»ƒæ¨¡å‹"><a href="#9-11-7-è®­ç»ƒæ¨¡å‹" class="headerlink" title="9.11.7 è®­ç»ƒæ¨¡å‹"></a>9.11.7 è®­ç»ƒæ¨¡å‹</h4></li>
</ol>
<p>9.12 å®æˆ˜Kaggleæ¯”èµ›ï¼šå›¾åƒåˆ†ç±»ï¼ˆCIFAR-10ï¼‰<br>9.12.1 è¯»å–å’Œæ•´ç†æ•°æ®é›†</p>
<ol>
<li>ä¸‹è½½æ•°æ®é›†</li>
<li>è§£å‹æ•°æ®é›†</li>
<li>æ•´ç†æ•°æ®é›†</li>
<li>12.2 å›¾åƒå¢å¹¿</li>
<li>12.3 è¯»å–æ•°æ®é›†</li>
<li>12.4 å®šä¹‰æ¨¡å‹</li>
<li>12.5 å®šä¹‰è®­ç»ƒå‡½æ•°</li>
<li>12.6 è®­ç»ƒæ¨¡å‹</li>
<li>12.7 å¯¹æµ‹è¯•é›†åˆ†ç±»å¹¶åœ¨Kaggleæäº¤ç»“æœ</li>
<li>13 å®æˆ˜Kaggleæ¯”èµ›ï¼šç‹—çš„å“ç§è¯†åˆ«ï¼ˆImageNet Dogsï¼‰</li>
<li>13.1 è¯»å–å’Œæ•´ç†æ•°æ®é›†</li>
<li>ä¸‹è½½æ•°æ®é›†</li>
<li>æ•´ç†æ•°æ®é›†</li>
<li>13.2 å›¾åƒå¢å¹¿</li>
<li>13.3 è¯»å–æ•°æ®é›†</li>
<li>13.4 å®šä¹‰æ¨¡å‹</li>
<li>13.5 å®šä¹‰è®­ç»ƒå‡½æ•°</li>
<li>13.6  è®­ç»ƒå‡½æ•°</li>
<li>13.7 å¯¹æµ‹è¯•é›†åˆ†ç±»å¹¶åœ¨kaggleæäº¤ç»“æœ</li>
</ol>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/06/å‰ç«¯å¼€å‘æ€»ç»“/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="æœ›æ˜Ÿçš„å¤ªé˜³èŠ±">
      <meta itemprop="description" content="You are my JavaSript in my HTML.">
      <meta itemprop="image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570163730249&di=dcd36b04d1066a90ddb1f132ae3a6bcc&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Ffe60497fd762440686b6d5702c2c9f19df71fb9911009-LVWEJj_fw658">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/12/06/å‰ç«¯å¼€å‘æ€»ç»“/" class="post-title-link" itemprop="url">å‰ç«¯å¼€å‘æ€»ç»“</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-12-06 20:34:28" itemprop="dateCreated datePublished" datetime="2019-12-06T20:34:28+08:00">2019-12-06</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-02-11 12:03:53" itemprop="dateModified" datetime="2020-02-11T12:03:53+08:00">2020-02-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å„ç§å‰ç«¯å„ç§å°å¿ƒå¾—"><a href="#å„ç§å‰ç«¯å„ç§å°å¿ƒå¾—" class="headerlink" title="å„ç§å‰ç«¯å„ç§å°å¿ƒå¾—"></a>å„ç§å‰ç«¯å„ç§å°å¿ƒå¾—</h1><blockquote>
<p>è¿™å­¦æœŸç®—æ˜¯æ–°æ‰‹æ¥å¼€å‘ä¸€ä¸ªå¤§é¡¹ç›®ï¼ŒæœŸé—´é‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œè™½ç„¶å¾ˆå¤šé—®é¢˜å¤§å®¶ä¼šçœ‹æ¥æ˜¯å°é—®é¢˜ï¼Œä½†å¯¹æˆ‘èŠ±è´¹æŒºå¤šæ—¶é—´è§£å†³çš„ï¼Œè¿™é‡Œæ€»ç»“å¦‚ä¸‹ï¼Œèƒ½ä¸ºä¹‹åå¤§å®¶å¼€å‘æä¾›å¸®åŠ©ä¹Ÿèƒ½è®°å½•è‡ªå·±çš„é—®é¢˜ã€‚</p>
</blockquote>
<h2 id="this-setStateæ›´æ–°æ˜¯å¼‚æ­¥çš„"><a href="#this-setStateæ›´æ–°æ˜¯å¼‚æ­¥çš„" class="headerlink" title="this.setStateæ›´æ–°æ˜¯å¼‚æ­¥çš„"></a>this.setStateæ›´æ–°æ˜¯å¼‚æ­¥çš„</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">onPullDownRefresh() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      comments: [],</span><br><span class="line">      sum: <span class="number">0</span>,</span><br><span class="line">      lastId: <span class="number">0</span></span><br><span class="line">    &#125;,()=&gt;&#123;</span><br><span class="line">      Taro.showNavigationBarLoading()</span><br><span class="line">      <span class="keyword">this</span>.getComments()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;<span class="comment">//ä¸‹æ‹‰äº‹ä»¶</span></span><br></pre></td></tr></table></figure>

<p>åœ¨åšä¸Šæ‹‰åˆ·æ–°çš„æ—¶å€™ï¼Œéœ€è¦å°†æ‰€æœ‰æ•°æ®æ¸…ç©ºï¼Œä½†æ˜¯å¦‚æœä¸ä½¿ç”¨ä¸Šè¿°è°ƒç”¨setstateå›è°ƒå‡½æ•°çš„æ–¹æ³•this.setStateä¼šå¤±æ•ˆï¼Œç”¨ä¸Šé¢æ–¹æ³•åœ¨æ›´æ–°stateåèƒ½å®Œç¾åˆ·æ–°æ•°æ®ã€‚å½“æ—¶å¡äº†å¾ˆä¹…ï¼Œåˆ°ç½‘ä¸Šæœäº†å¾ˆå¤šthis.setStateå¤±æ•ˆåŸå› æ‰çŸ¥é“ã€‚</p>
<h2 id="ä¸Šæ‹‰åˆ·æ–°ï¼Œä¸‹æ‹‰åŠ è½½"><a href="#ä¸Šæ‹‰åˆ·æ–°ï¼Œä¸‹æ‹‰åŠ è½½" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°ï¼Œä¸‹æ‹‰åŠ è½½"></a>ä¸Šæ‹‰åˆ·æ–°ï¼Œä¸‹æ‹‰åŠ è½½</h2><p>æˆ‘ä¹‹å‰æ²¡æœ‰åšè¿‡minprojectï¼Œæ‰€ä»¥èŠ±äº†å¾ˆå¤šæ—¶é—´å¼„æ‡‚æ€ä¹ˆä¸Šæ‹‰åˆ·æ–°ä¸‹æ‹‰åŠ è½½ï¼Œä½†è¿™æ¬¡çš„ä¸Šæ‹‰åˆ·æ–°ç”±äºå›ºå®šäº†ä¸ªç»„ä»¶ï¼Œæäº†åŠå¤©ï¼ŒåŸæœ¬ä»¥ä¸ºtaroçš„æ–¹æ³•è‡ªå¸¦ä¸‹æ‹‰åˆ·æ–°å…¼å®¹æ€§ä¸æ˜“æ›´æ”¹ï¼Œå’Œå¼ æ–‡é”¦è¯´äº†åŠå¤©ã€‚å…¶å®æŒºç®€å•ï¼Œè¿™é‡Œæ€»ç»“ä¸‹æ¥ï¼Œé¿å…å¤§å®¶å†åƒæˆ‘ä¸€æ ·å‚»ä¹ä¹èµ°å¼¯è·¯ã€‚è€Œä¸”ç½‘ä¸Šå…³äºtaroçš„æ–¹æ³•æ¯”è¾ƒæ—¶ã€‚</p>
<h3 id="å›ºå®šä¸ä¼šç§»åŠ¨çš„ç»„ä»¶"><a href="#å›ºå®šä¸ä¼šç§»åŠ¨çš„ç»„ä»¶" class="headerlink" title="å›ºå®šä¸ä¼šç§»åŠ¨çš„ç»„ä»¶"></a>å›ºå®šä¸ä¼šç§»åŠ¨çš„ç»„ä»¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;View className=<span class="string">'chooseBox'</span>&gt;</span><br><span class="line">&lt;View className=<span class="string">'chooseInput'</span> onClick=&#123;<span class="keyword">this</span>.ChangeTosearch.bind(<span class="keyword">this</span>)&#125;&gt;</span><br><span class="line">&lt;MxInput&gt;&lt;/MxInput&gt;</span><br><span class="line">&lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">&lt;View className='chooseAdd' onClick=&#123;this.ChangeTopost.bind(this)&#125;&gt;</span></span><br><span class="line"><span class="regexp">&lt;MxIcon type='add'  width='40p2' width='40p2'&gt;&lt;/</span>MxIcon&gt;</span><br><span class="line">&lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>View&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.chooseBox</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>rpx;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">98</span>rpx;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">    <span class="attribute">background</span>:<span class="built_in">rgba</span>(255,255,255,1);</span><br><span class="line">    <span class="attribute">box-shadow</span>:<span class="number">0</span>rpx <span class="number">4</span>rpx <span class="number">7</span>rpx <span class="built_in">rgba</span>(0,0,0,0.16);</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸€å®šæ³¨æ„è¿™é‡Œtop: 0rpx; position:fixed åªè¦è¿™æ ·è®¾ç½®å°±ä¸ä¼šè¢«taroè‡ªå¸¦çš„åˆ·æ–°åŠ¨ç”»è¦†ç›–å°±ä¼šå›ºå®šå½“åˆèŠ±äº†å¾ˆä¹…æƒ³å’‹å¼„</strong><br>åŒæ—¶è¿˜æœ‰è®¾ç½®pageçš„é¢œè‰²æ¥é€‚é…</p>
<h3 id="è®¾ç½®scroll-view"><a href="#è®¾ç½®scroll-view" class="headerlink" title="è®¾ç½®scroll-view"></a>è®¾ç½®scroll-view</h3><p>å› ä¸ºè®¾ç½®äº†å†…å®¹fixed ä½ çš„scroll-viewå°±éœ€è¦éœ²å‡ºæ¥ä¸€éƒ¨åˆ†ï¼Œè®¾ç½®padding-top<br><img src="/2019/12/06/å‰ç«¯å¼€å‘æ€»ç»“/2.png" alt="img"><br><img src="/2019/12/06/å‰ç«¯å¼€å‘æ€»ç»“/1.png" alt="css"></p>
<h3 id="é¡µé¢è½½å…¥é€»è¾‘"><a href="#é¡µé¢è½½å…¥é€»è¾‘" class="headerlink" title="é¡µé¢è½½å…¥é€»è¾‘"></a>é¡µé¢è½½å…¥é€»è¾‘</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentWillMount() &#123;</span><br><span class="line">  <span class="keyword">this</span>.getComments();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è½½å…¥é¡µé¢åˆ·æ–°æ•°æ®</p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°é€»è¾‘"><a href="#ä¸Šæ‹‰åˆ·æ–°é€»è¾‘" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°é€»è¾‘"></a>ä¸Šæ‹‰åˆ·æ–°é€»è¾‘</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">onPullDownRefresh() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      comments: [],</span><br><span class="line">      sum: <span class="number">0</span>,</span><br><span class="line">      lastId: <span class="number">0</span></span><br><span class="line">    &#125;,()=&gt;&#123;</span><br><span class="line">      Taro.showNavigationBarLoading()</span><br><span class="line">      <span class="keyword">this</span>.getComments()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;<span class="comment">//ä¸‹æ‹‰äº‹ä»¶</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šæ‹‰åˆ·æ–°çš„æ—¶å€™ æ¸…ç©ºæ•°æ®å†åˆ·æ–°ï¼Œæ³¨æ„setState</p>
<h3 id="ä¸‹æ‹‰åŠ è½½é€»è¾‘"><a href="#ä¸‹æ‹‰åŠ è½½é€»è¾‘" class="headerlink" title="ä¸‹æ‹‰åŠ è½½é€»è¾‘"></a>ä¸‹æ‹‰åŠ è½½é€»è¾‘</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onReachBottom() &#123;</span><br><span class="line">  Taro.showNavigationBarLoading()</span><br><span class="line">  <span class="keyword">this</span>.getComments();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>easyï¼è¦æ³¨æ„æ»‘åˆ°åº•æç¤ºç”¨æˆ·æ²¡æœ‰æ›´å¤šæ•°æ®ã€‚</p>
<p>è¦æ³¨æ„è¿˜æœ‰æ˜¯ç°å®åŠ è½½å›¾æ ‡çš„å…³é—­ï¼Œåœ¨getComments()æ–¹æ³•è°ƒç”¨æˆåŠŸåä½¿ç”¨å…³é—­åŠ è½½å›¾æ¡ˆ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">getComments() &#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">let</span> newComments = <span class="keyword">this</span>.state.comments</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.state.lastId!=<span class="number">1</span>)&#123;</span><br><span class="line">    Fetch(</span><br><span class="line">      <span class="string">'api/v1/evaluation'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">      limit: <span class="number">3</span>,</span><br><span class="line">      last_id: <span class="keyword">this</span>.state.lastId</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'GET'</span></span><br><span class="line">    ).then(<span class="function"><span class="params">data</span> =&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(data)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        newComments=newComments.concat(data.data.list)</span><br><span class="line">        Taro.stopPullDownRefresh()    <span class="comment">//åœæ­¢åˆ·æ–°</span></span><br><span class="line">        Taro.hideNavigationBarLoading()     <span class="comment">//å…³é—­åŠ è½½å›¾æ¡ˆ</span></span><br><span class="line">        that.setState(&#123;</span><br><span class="line">          comments: newComments,</span><br><span class="line">          sum: data.data.sum,</span><br><span class="line">          lastId: data.data.list[data.data.sum<span class="number">-1</span>].id</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Taro.showToast(&#123;</span><br><span class="line">        title: <span class="string">'åˆ°åº•å•¦ï¼'</span>,            <span class="comment">//æç¤ºç”¨æˆ·æ²¡æœ‰æ›´å¤šæ•°æ®</span></span><br><span class="line">        duration: <span class="number">2000</span></span><br><span class="line">      &#125;)</span><br><span class="line">      Taro.stopPullDownRefresh()        <span class="comment">//åœæ­¢åˆ·æ–°</span></span><br><span class="line">      Taro.hideNavigationBarLoading()        <span class="comment">//å…³é—­åŠ è½½å›¾æ¡ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶åˆ©ç”¨æ¡ä»¶æ¸²æŸ“ï¼Œåº•éƒ¨å¢åŠ ä¸€æ æç¤ºç”¨æˆ·æ²¡æœ‰æ›´å¤šä¿¡æ¯ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;!bottomFlag &amp;&amp; &lt;View className='bottomBox'&gt;åˆ°åº•å•¦ï¼&lt;/View&gt;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é¡µé¢è¿”å›é€»è¾‘"><a href="#é¡µé¢è¿”å›é€»è¾‘" class="headerlink" title="é¡µé¢è¿”å›é€»è¾‘"></a>é¡µé¢è¿”å›é€»è¾‘</h3><blockquote>
<p>ç”¨æˆ·éœ€è¦ç‚¹å‡»åˆ°åˆ«çš„é¡µé¢ è¿”å›åˆ°è¯„è¯¾é¡µé¢æ—¶å€™åˆ·æ–°ä¸€éï¼Œæ¯”å¦‚è¯„å®Œè¯¾é©¬ä¸Šèƒ½åœ¨ä¸»é¡µçœ‹åˆ°è‡ªå·±è¯„è®ºçš„è¯¾<br>ç½‘ä¸Šæœç´¢çš„çš„æ˜¯å¾®ä¿¡å°ç¨‹åºä¸­onShowçš„é‡æ–°è·å–æ•°æ®ï¼Œåœ¨è¿›å…¥é¡µé¢æ—¶é‡æ–°è·å–åˆ·æ–°ã€‚ç„¶åæ‰¾åˆ°ä¸€ä¸ªè¡¨ï¼Œå¯¹åº”åœ¨taroçš„ä½¿ç”¨ï¼š</p>
</blockquote>
<p><img src="/2019/12/06/å‰ç«¯å¼€å‘æ€»ç»“/3.png" alt="img"></p>
<p>äºæ˜¯åœ¨compoentDidShow()æ–¹æ³•é‡Œè°ƒç”¨ä¾¿å¯å®ç°è¿”å›é¡µé¢åˆ·æ–°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">componentDidShow() &#123;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    comments: [],</span><br><span class="line">    sum: <span class="number">0</span>,</span><br><span class="line">    lastId: <span class="number">0</span></span><br><span class="line">  &#125;,()=&gt;&#123;</span><br><span class="line">    Taro.showNavigationBarLoading()</span><br><span class="line">    <span class="keyword">this</span>.getComments()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªä¸ªè·å–åˆ—è¡¨åˆ·æ–°åˆ—è¡¨çš„é€»è¾‘æ–¹æ³•ï¼ŒæŒºç®€å•çš„ï¼Œä½†ä¹ŸèŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œè¯»äº†å¾ˆå¤šåšå®¢æ‰ä¼š</em></strong></p>
<h2 id="æ—¶é—´æˆ³"><a href="#æ—¶é—´æˆ³" class="headerlink" title="æ—¶é—´æˆ³"></a>æ—¶é—´æˆ³</h2><p>å°†æ•°æ®åº“ä¸­çš„æ—¶é—´æ•°å­—è½¬æ¢æˆç”¨æˆ·æ˜¾ç¤ºçš„æ—¶é—´æˆ³ï¼Œç”¨jså‡½æ•°å®ç°ï¼š<br>è¿™é‡Œå¾ˆæƒ³æŠŠç»„å‘˜çš„ä»£ç è´´å‡ºæ¥ï¼Œä½†æ²¡è¯¢é—®ï¼Œä¸å¤ªå¥½ã€‚ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•æŠ€å·§ï¼Œå¾ˆæ•¬ä½©ï¼Œ</p>
<h2 id="è·¯ç”±è·³è½¬ä¼ å‚"><a href="#è·¯ç”±è·³è½¬ä¼ å‚" class="headerlink" title="è·¯ç”±è·³è½¬ä¼ å‚"></a>è·¯ç”±è·³è½¬ä¼ å‚</h2><blockquote>
<p>ä¸ºäº†å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œä¼šæœ‰ç”¨æˆ·ç‚¹å‡»ä¸€æ¡è¯„è®ºè·³åˆ°è¯„è®ºè¯¦æƒ…çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è·³è½¬çš„æ—¶å€™ç»™ä¸‹ä¸€ä¸ªé¡µé¢æ¸²æŸ“æä¾›idï¼Œå°±æœ‰è·¯ç”±ä¼ å‚çš„æ–¹æ³•ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ChangeTosearch() &#123;</span><br><span class="line">   Taro.navigateTo(&#123;</span><br><span class="line">     url: <span class="string">'/pages/search/index?searchInfo='</span> + <span class="keyword">this</span>.state.search</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚åœ¨ç‚¹å‡»äº‹ä»¶ä¸Šä¼ é€’æ•°æ®ï¼Œå°±æŠŠurlå†™æˆç±»ä¼¼ï¼š<br><code>/pages/search/index?id=1&name=yapeng<code><br>çš„å½¢å¼ï¼Œç„¶ååœ¨è·³è½¬è‡³çš„é¡µé¢</code></code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentWillMount () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.$router.params)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ ¼å¼ paramså°±ä¼šè·å¾—ä¸Šä¸ªé¡µé¢ä¼ é€’æ¥çš„æ•°æ®ï¼Œç„¶åè¿›è¡Œæ‹‰å–æ•°æ®æ¸²æŸ“ç‰¹å®šé¡µé¢ã€‚<br><img src="/2019/12/06/å‰ç«¯å¼€å‘æ€»ç»“/4.png" alt="img"><br><img src="/2019/12/06/å‰ç«¯å¼€å‘æ€»ç»“/5.png" alt="img"></p>
<p><strong><em>æ€»ç»“å®Œæ¯•ï¼Œè™½ç„¶åœ¨å¤§å®¶çœ¼é‡Œå¯èƒ½è§‰å¾—è¿™éƒ½æ˜¯äº›å¾ˆç®€å•çš„åŸºç¡€ï¼Œä½†æˆ‘å´èŠ±è´¹äº†å¤§é‡ç²¾åŠ›æŸ¥æ‰¾èµ„æ–™ï¼Œå­¦ä¹ æ€»ç»“ï¼Œä¹Ÿæ˜¯ååˆ†å¿…è¦çš„æ€»ç»“ï¼Œå¸Œæœ›æ›´åŠ åŠªåŠ›ã€‚</em></strong></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/28/ç›®æ ‡æ£€æµ‹å­¦ä¹ ç¬”è®°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="æœ›æ˜Ÿçš„å¤ªé˜³èŠ±">
      <meta itemprop="description" content="You are my JavaSript in my HTML.">
      <meta itemprop="image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570163730249&di=dcd36b04d1066a90ddb1f132ae3a6bcc&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Ffe60497fd762440686b6d5702c2c9f19df71fb9911009-LVWEJj_fw658">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2019/11/28/ç›®æ ‡æ£€æµ‹å­¦ä¹ ç¬”è®°/" class="post-title-link" itemprop="url">ç›®æ ‡æ£€æµ‹å­¦ä¹ ç¬”è®°</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-11-28 17:02:44" itemprop="dateCreated datePublished" datetime="2019-11-28T17:02:44+08:00">2019-11-28</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-02-11 12:07:17" itemprop="dateModified" datetime="2020-02-11T12:07:17+08:00">2020-02-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep-Learning</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="YOLO-å­¦ä¹ ç¬”è®°"><a href="#YOLO-å­¦ä¹ ç¬”è®°" class="headerlink" title="YOLO å­¦ä¹ ç¬”è®°"></a>YOLO å­¦ä¹ ç¬”è®°</h2><h3 id="YOLO-v1æ·±å…¥ç†è§£"><a href="#YOLO-v1æ·±å…¥ç†è§£" class="headerlink" title="YOLO v1æ·±å…¥ç†è§£"></a>YOLO v1æ·±å…¥ç†è§£</h3><p>yolo1 448<em>448</em>3 è¾“å…¥ä¹‹å‰åšresize åˆ†æˆ7<em>7ç½‘æ ¼ å¦‚æœç›®æ ‡ä¸­å¿ƒåœ¨ç½‘æ ¼é‡Œå°±è¿›è¡Œé¢„æµ‹<br>ç½‘æ ¼ç§°å‘¼cell  æ¯ä¸€ä¸ªcell è´Ÿè´£é¢„æµ‹ä¸¤ä¸ª boundingbox é€‰æ‹©å…¶ä¸­ä¸€ä¸ª iouæœ€å¤§çš„è¿›è¡Œé¢„æµ‹<br>è¾“å‡ºæ˜¯7</em>7*10 tensor</p>
<p>æ¯ä¸€ä¸ªç½‘æ ¼äº§ç”Ÿ 30ä¸ªé€šé“çš„ä¿¡æ¯<br>2ä¸ªbounding box  ä¼šæœ‰è¾¹æ¡†ä¿¡æ¯ ï¼ˆä¸­å¿ƒç‚¹åæ ‡å’Œå®½é«˜ï¼‰ ï¼ˆæ¯ä¸€ä¸ªboundingbox çš„ç‰©ä½“æ‰§è¡Œåº¦ï¼‰ å‰10ä¸ª<br>åˆ†ç±»ä¿¡æ¯ yolov1 ä¼šæœ‰20ä¸ªåˆ†ç±»ç›®æ ‡ æ‰€ä»¥æ€»çš„æœ‰30</p>
<p>ç›®æ ‡æ£€æµ‹ï¼š ä½ç½®ä¿¡æ¯ä¸åˆ†ç±»  åŒ…å«å›å½’å’Œåˆ†ç±» </p>
<p>fast rcnn ä¼šæœ‰<br>yolo3 416* 416 608*608</p>
<p>bounding boxçš„ç½®ä¿¡åº¦ = è¯¥boudnig box å†…å­˜åœ¨å¯¹è±¡çš„æ¦‚ç‡* è¯¥boudingboxä¸è¯¥å¯¹è±¡å®é™…boundingboxçš„iouäº¤å¹¶æ¯”</p>
<p>YOLOæ ‡ç­¾ä¸ä»¥å¾€ä¸ä¸€æ ·<br>æ˜¯åœ¨è®­ç»ƒæ‰ä¼šå‡ºç° ç½®ä¿¡åº¦çš„æ ‡ç­¾ ä¾èµ–äºæ ‡ç­¾çš„è£±æ¡† </p>
<p>äº¤é›†é™¤ä»¥å¹¶é›† å€¼è¶Šå¤§ é‡åˆçš„æ¦‚ç‡è¶Šå¤§</p>
<p>7*7çš„ç½‘æ ¼å¯ä»¥è®­ç»ƒ2ä¸ªbounding box<br>v3é‡Œé¢ æ¯ä¸ªgridé‡Œé¢ æœ‰3ä¸ªancorå¤šä¸ª </p>
<p>è®­ç»ƒæ ·æœ¬æ ‡æ³¨ä¹‹å ä¼šæœ‰è¾¹æ¡† </p>
<p>æŸå¤±æ˜¯å»æ‰¾æŸå¤±çš„ä¸­å¿ƒç‚¹<br>ä¸­å¿ƒç‚¹åœ¨é‚£ä¸ªä½ç½® è¿™ä¸ªcellæ¥è´Ÿè´£é¢„æµ‹ç‹—å¯¹è±¡ å¦‚ä½•è´Ÿè´£çœ‹è®¡ç®—<br>20ä¸ªå¯¹è±¡çš„æ¦‚ç‡ </p>
<p>å¯¹ä¸€ä¸ªæ¡† æ˜¯ç‹—çš„æ¡† è‹¥æ˜¯ç‹—åˆ™æ˜¯1 å…¶ä»–çš„éƒ½æ˜¯0 </p>
<p>bounding boxæ€ä¹ˆè¾“å‡º<br>ä¸€ä¸ªcelé‡Œé¢æœ‰cell å’Œ ancor<br>æŒ‘é€‰ä¸€ä¸ªæ¯”è¾ƒç¬¦åˆçš„  </p>
<p>è¿™ä¸ªæ ·æœ¬æ ‡ç­¾ bouding box1å¡«ä»€ä¹ˆæ˜¯ä¾èµ–äº è®­ç»ƒè¿‡ç¨‹ä¸­å¾—åˆ°çš„iou</p>
<p>æŸå¤±ï¼š<br>ä¸­å¿ƒç‚¹çš„æŸå¤±+å®½é«˜çš„æŸå¤± æœ‰ç›®æ ‡åœ¨æ‰æœ‰</p>
<p>é™æ€ç›®æ ‡å’ŒåŠ¨æ€ç›®æ ‡çš„æ•ˆæœä¸ä¸€æ ·<br>ç½®ä¿¡åº¦çš„æŸå¤± æœ‰ç›®æ ‡çš„æŸå¤±å‚è€ƒå€¼æ˜¯ä¸€ æ²¡æœ‰çš„ç›®æ ‡çš„æŸå¤±å‚è€ƒå€¼æ˜¯0</p>
<p>é¢„æµ‹é˜¶æ®µ è¾“å‡ºå°±æ˜¯ç½®ä¿¡åº¦  å¯ä»¥æ ¹æ®ç½®ä¿¡åº¦æ¥åšé¢„æµ‹</p>
<p>éæå¤§å€¼æŠ‘åˆ¶</p>
<p>æ‰¾ç½®ä¿¡åº¦æœ€é«˜çš„ æ ¹æ®é¢„å€¼ è®¡ç®—iou å¤§äºé¢„å€¼ å°±åˆ é™¤ å¾—åˆ°ä¸¤ä¸ªæ¡† ä¸€æ ·çš„æµç¨‹</p>
<h2 id="Faster-RCNN"><a href="#Faster-RCNN" class="headerlink" title="Faster RCNN"></a>Faster RCNN</h2><blockquote>
<p>ç›®æ ‡æ£€æµ‹ å‘å±•è¿…é€Ÿ  yolo anglefree yolo v3å€ŸåŠ© ssdçš„æ€æƒ³ ç»™äº† angleå»ºè®®</p>
</blockquote>
<p>faster rcnn ä¸ rcnnçš„åŒºåˆ«</p>
<p>æ˜¯ Region Proposal Network å’Œ Rol pooling </p>
<p>æ—©æœŸçš„åˆ†ç±»å™¨ æ‰¾åˆ°åŒºåŸŸ å†æŠŠåŒºåŸŸæ‹¿å‡ºå»åšåˆ†ç±»  è®¡ç®—å¤æ‚åº¦å¾ˆé«˜ </p>
<p>faster rcnn æ˜¯æŠŠå¤šæ¬¡çš„ç‰¹å¾æå–åªåšä¸€æ¬¡</p>
<p>å›¾ç‰‡ç»è¿‡å·ç§¯å±‚ ä¼šå¾—åˆ°ç‰¹å¾æ˜ å°„ å¾—åˆ°å»ºè®®çš„åŒºåŸŸ box å†æ ¹æ®åŸæ¥feature maps åšä¸€ä¸ªèåˆ æ‰¾åˆ°<br>proposalsçš„å»ºè®®ç‰¹å¾<br>å†åšä¸€ä¸ª rol pooling<br>classier åœ¨åšåˆ†ç±»ç‰¹å¾ åŒæ—¶åšbounding boxçš„å›å½’</p>
<p>1ã€ç¬¬ä¸€æ­¥ç‰¹å¾æå– å·ç§¯ç¥ç»ç½‘ç»œ<br>2ã€region proposal networks åŒ…å«ä¸¤ä¸ªæ“ä½œ ä¸€ä¸ªæ˜¯åˆ†ç±»å™¨ softmax åˆ¤æ–­å‡å®šçš„ anchorsæ˜¯ å‰æ™¯è¿˜æ˜¯èƒŒæ™¯ è¿‡æ»¤ä¸€äº›ancor rpnç½‘ç»œ ç»™å¾ˆå¤šbox å®é™…ä¸Šåš rlpooling åªæ˜¯ä¸€ä¸ªéƒ¨åˆ†   å¦ä¸€ä¸ª åšbounding å›å½’<br>3ã€åˆ›é€ æ€§çš„ roi pooling  ç»™å®šå»ºè®®åŒºåŸŸ ç”±äºå½¢çŠ¶å¤§å°ä¸ä¸€è‡´ ä½†æ˜¯åˆ†ç±»èµ·è¦æ±‚è¾“å…¥å¤§å°å½¢çŠ¶ç›¸åŒ å¯¹ ä¸åŒå½¢çŠ¶çš„box åšä¸€ä¸ªpooling å‚æ•°ä¸ä¸€æ · ä½†æ˜¯æœ€åpoolingçš„ç»“æœæ˜¯ä¸€æ ·çš„<br>4ã€åˆ†ç±»å±‚ ä¸¤ä¸ªä»»åŠ¡ï¼šç›®æ ‡çš„åˆ†ç±» å’Œ bounding box å›å½’</p>
<p>æ ¸å¿ƒ<br>å…·ä½“ç»†èŠ‚ä¸è®²</p>
<p>é‡ç‚¹çœ‹ anchor</p>
<p><strong>anchor</strong></p>
<p>anchor åªæœ‰å®½åº¦å’Œé«˜ ä½ç½®ç”±ä¸­å¿ƒç‚¹ ç¡®å®š  ä»¥ä¸€ä¸ªç‚¹ç”Ÿæˆ kä¸ª æ¡† ä¸€ä¸ªæ¡†4ä¸ªåæ ‡  å…±4kä¸ªåæ ‡ï¼ˆæ ¹æ®åŸå§‹å›¾ç‰‡çš„bboxåšå›å½’ï¼‰ï¼ˆåˆ°åŸå§‹å›¾ç‰‡ä¸Šï¼‰åšæ£€æµ‹     2k scores softmax äºŒåˆ†ç±» åˆ¤æ–­å‰æ™¯è¿˜æ˜¯èƒŒæ™¯</p>
<p>ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p>
<p>anchor ä¸‹é‡‡æ · åšå›å½’å’Œè€Œåˆ†ç±»</p>
<p>è¿˜å¯ä»¥æ”¹å˜ é‡‡æ ·çš„å¤§å° </p>
<p>å›å½’æ“ä½œ æ˜¯é¢„æµ‹å€¼å°½å¯èƒ½æ¥è¿‘å‚è€ƒå€¼ </p>
<p>roi pooling<br>éœ€è¦å°ºå¯¸ä¸€æ ·<br>è¦ä¹ˆåˆ‡å‰² è¦ä¹ˆæ˜¯è½¬å‘ç›¸åŒçš„å°ºå¯¸ </p>
<p>å°±å¯ä»¥ç»™ä¸åŒçš„poolingçš„å‚æ•° </p>
<p>è™½ç„¶ ancorå°ºå¯¸ä¸ä¸€æ · ä½†æ˜¯ç»“æœä¸€æ ·  æ ¹æ®ä¹‹å‰çš„å‚æ•°æ¥åˆ¤æ–­</p>
<p>æœ€åæŠŠ roi poolingç»™ç½‘ç»œ ä¸€ä¸ªåšå›å½’ ä¸€ä¸ªåšç›®æ ‡åˆ†ç±»      </p>
<h2 id="training-yolov3"><a href="#training-yolov3" class="headerlink" title="training yolov3"></a>training yolov3</h2>
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570163730249&di=dcd36b04d1066a90ddb1f132ae3a6bcc&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Ffe60497fd762440686b6d5702c2c9f19df71fb9911009-LVWEJj_fw658"
      alt="æœ›æ˜Ÿçš„å¤ªé˜³èŠ±">
  <p class="site-author-name" itemprop="name">æœ›æ˜Ÿçš„å¤ªé˜³èŠ±</p>
  <div class="site-description" itemprop="description">You are my JavaSript in my HTML.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
        </a>
      </div>
    
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æœ›æ˜Ÿçš„å¤ªé˜³èŠ±</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.4.1</div>

        












        
      </div>
    </footer>
  </div>

  
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

</body>
</html>
