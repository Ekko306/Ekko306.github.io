<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="PyTorchæ€»ç»“é¦–å…ˆæ˜ç™½Pytorchæ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œåƒã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ä¸­ä½¿ç”¨çš„MXNetä¹Ÿæ˜¯ä¸€ç§æ¡†æ¶ï¼Œæ¡†æ¶ä¸åŒï¼Œä½†æ˜¯æ·±åº¦å­¦ä¹ çš„å†…å®¹ä½“ç³»æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ä¸åŒçš„æ¡†æ¶æœ‰è‡ªå·±å®ç°æŸä¸ªç½‘ç»œæˆ–è€…æ–¹æ³•çš„ä¸åŒæ–¹æ³•ã€‚ åº”è¯¥æŒæ¡å¥½æ·±åº¦å­¦ä¹ ç†è®ºçŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œå°½å¯èƒ½å»ç†Ÿæ‚‰å¤šç§æ¡†æ¶çš„ç‰¹ç‚¹å¯¹ã€Šæ·±åº¦å­¦ä¹ å…¥é—¨ä¹‹PyTorchã€‹å¯¹PyTorchä¸»è¦ï¼š PytorchåŸºç¡€Tensorï¼ˆå¼ é‡ï¼‰ PyTorché‡Œé¢å¤„ç†çš„æœ€åŸºæœ¬çš„">
<meta property="og:type" content="article">
<meta property="og:title" content="Summary of Pytorch and OpenCV">
<meta property="og:url" content="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="PyTorchæ€»ç»“é¦–å…ˆæ˜ç™½Pytorchæ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œåƒã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ä¸­ä½¿ç”¨çš„MXNetä¹Ÿæ˜¯ä¸€ç§æ¡†æ¶ï¼Œæ¡†æ¶ä¸åŒï¼Œä½†æ˜¯æ·±åº¦å­¦ä¹ çš„å†…å®¹ä½“ç³»æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ä¸åŒçš„æ¡†æ¶æœ‰è‡ªå·±å®ç°æŸä¸ªç½‘ç»œæˆ–è€…æ–¹æ³•çš„ä¸åŒæ–¹æ³•ã€‚ åº”è¯¥æŒæ¡å¥½æ·±åº¦å­¦ä¹ ç†è®ºçŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œå°½å¯èƒ½å»ç†Ÿæ‚‰å¤šç§æ¡†æ¶çš„ç‰¹ç‚¹å¯¹ã€Šæ·±åº¦å­¦ä¹ å…¥é—¨ä¹‹PyTorchã€‹å¯¹PyTorchä¸»è¦ï¼š PytorchåŸºç¡€Tensorï¼ˆå¼ é‡ï¼‰ PyTorché‡Œé¢å¤„ç†çš„æœ€åŸºæœ¬çš„">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/%E6%A1%86%E6%9E%B6.png">
<meta property="og:image" content="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/PyTorch.jpg">
<meta property="og:image" content="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/MXNet.jpg">
<meta property="og:image" content="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/book.png">
<meta property="og:updated_time" content="2020-02-11T04:07:23.003Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Summary of Pytorch and OpenCV">
<meta name="twitter:description" content="PyTorchæ€»ç»“é¦–å…ˆæ˜ç™½Pytorchæ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œåƒã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ä¸­ä½¿ç”¨çš„MXNetä¹Ÿæ˜¯ä¸€ç§æ¡†æ¶ï¼Œæ¡†æ¶ä¸åŒï¼Œä½†æ˜¯æ·±åº¦å­¦ä¹ çš„å†…å®¹ä½“ç³»æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ä¸åŒçš„æ¡†æ¶æœ‰è‡ªå·±å®ç°æŸä¸ªç½‘ç»œæˆ–è€…æ–¹æ³•çš„ä¸åŒæ–¹æ³•ã€‚ åº”è¯¥æŒæ¡å¥½æ·±åº¦å­¦ä¹ ç†è®ºçŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œå°½å¯èƒ½å»ç†Ÿæ‚‰å¤šç§æ¡†æ¶çš„ç‰¹ç‚¹å¯¹ã€Šæ·±åº¦å­¦ä¹ å…¥é—¨ä¹‹PyTorchã€‹å¯¹PyTorchä¸»è¦ï¼š PytorchåŸºç¡€Tensorï¼ˆå¼ é‡ï¼‰ PyTorché‡Œé¢å¤„ç†çš„æœ€åŸºæœ¬çš„">
<meta name="twitter:image" content="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/%E6%A1%86%E6%9E%B6.png">
  <link rel="canonical" href="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Summary of Pytorch and OpenCV | Hexo</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/05/Summary-of-Pytorch-and-OpenCV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="æœ›æ˜Ÿçš„å¤ªé˜³èŠ±">
      <meta itemprop="description" content="You are my JavaSript in my HTML.">
      <meta itemprop="image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570163730249&di=dcd36b04d1066a90ddb1f132ae3a6bcc&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Ffe60497fd762440686b6d5702c2c9f19df71fb9911009-LVWEJj_fw658">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Summary of Pytorch and OpenCV

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-02-05 12:07:12" itemprop="dateCreated datePublished" datetime="2020-02-05T12:07:12+08:00">2020-02-05</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-02-11 12:07:23" itemprop="dateModified" datetime="2020-02-11T12:07:23+08:00">2020-02-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep-Learning</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="PyTorchæ€»ç»“"><a href="#PyTorchæ€»ç»“" class="headerlink" title="PyTorchæ€»ç»“"></a>PyTorchæ€»ç»“</h1><p>é¦–å…ˆæ˜ç™½Pytorchæ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œåƒã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ä¸­ä½¿ç”¨çš„MXNetä¹Ÿæ˜¯ä¸€ç§æ¡†æ¶ï¼Œæ¡†æ¶ä¸åŒï¼Œä½†æ˜¯æ·±åº¦å­¦ä¹ çš„å†…å®¹ä½“ç³»æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ä¸åŒçš„æ¡†æ¶æœ‰è‡ªå·±å®ç°æŸä¸ªç½‘ç»œæˆ–è€…æ–¹æ³•çš„ä¸åŒæ–¹æ³•ã€‚<br><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/%E6%A1%86%E6%9E%B6.png" alt="æ¡†æ¶"></p>
<p><strong>åº”è¯¥æŒæ¡å¥½æ·±åº¦å­¦ä¹ ç†è®ºçŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œå°½å¯èƒ½å»ç†Ÿæ‚‰å¤šç§æ¡†æ¶çš„ç‰¹ç‚¹</strong><br>å¯¹ã€Šæ·±åº¦å­¦ä¹ å…¥é—¨ä¹‹PyTorchã€‹å¯¹PyTorchä¸»è¦ï¼š</p>
<h2 id="PytorchåŸºç¡€"><a href="#PytorchåŸºç¡€" class="headerlink" title="PytorchåŸºç¡€"></a>PytorchåŸºç¡€</h2><h3 id="Tensorï¼ˆå¼ é‡ï¼‰"><a href="#Tensorï¼ˆå¼ é‡ï¼‰" class="headerlink" title="Tensorï¼ˆå¼ é‡ï¼‰"></a>Tensorï¼ˆå¼ é‡ï¼‰</h3><blockquote>
<p>PyTorché‡Œé¢å¤„ç†çš„æœ€åŸºæœ¬çš„æ“ä½œå¯¹è±¡æ˜¯Tensorï¼ŒTensoræ˜¯å¼ é‡çš„è‹±æ–‡ã€‚</p>
<ul>
<li>å¼ é‡è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå¤šä½çš„æ•°ç»„ï¼Œå’Œnumpyå¯¹åº”ï¼Œè€Œä¸”PyTorchçš„Tensorå¯ä»¥å’Œnumpyçš„ndarrayç›¸äº’è½¬æ¢ï¼ˆMXNetä¹Ÿå¯ä»¥ç›¸äº’è½¬æ¢ï¼‰ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯PyTorchå¯ä»¥åœ¨GPUä¸Šè¿è¡Œï¼Œè€Œnumpyçš„ndarrayåªèƒ½åœ¨CPUä¸Šè¿è¡Œã€‚</li>
<li>Tensorçš„æ•°æ®ç±»å‹ï¼š<br>  -32ä½æµ®ç‚¹å‹torch.FloatTensor<br>  -64ä½æµ®ç‚¹å‹torch.DoubleTensor<br>  -16ä½æ•´å‹torch.ShortTensor<br>  -32ä½æ•´å‹torch.IntTensor<br>  -64ä½æ•´å‹torch.LongTensor</li>
</ul>
</blockquote>
<p>å®šä¹‰ä½¿ç”¨æ–¹æ³•ä¸€çœ‹å°±ä¼šã€‚<br><strong>æŠŠtensoræ”¾åˆ°GPUä¸Š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    a_cuda = a.cuda()</span><br><span class="line">    print(a_cuda)</span><br></pre></td></tr></table></figure>

<h3 id="Variableï¼ˆå˜é‡ï¼‰"><a href="#Variableï¼ˆå˜é‡ï¼‰" class="headerlink" title="Variableï¼ˆå˜é‡ï¼‰"></a>Variableï¼ˆå˜é‡ï¼‰</h3><p>æ¥ç€è¦å°†çš„æ¦‚å¿µæ˜¯Variableï¼Œåœ¨numpyé‡Œé¢æ²¡æœ‰ï¼Œæ˜¯<strong>ç¥ç»ç½‘ç»œè®¡ç®—å›¾ç‰¹æœ‰çš„</strong>æ¦‚å¿µã€‚</p>
<blockquote>
<p>Variableå’ŒTensoræœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œä¸è¿‡Variableä¼šè¢«æ”¾å…¥ä¸€ä¸ªè®¡ç®—å›¾ä¸­ï¼Œç„¶åè¿›è¡Œå‰å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­ï¼Œè‡ªåŠ¨æ±‚å¯¼ã€‚</p>
<ul>
<li>Variabelæ˜¯åœ¨torch.autograd.Variableä¸­</li>
<li>è®²ä¸€ä¸ªtensorå˜æˆVariableï¼Œåªéœ€è¦Variable(a)å°±å¯ä»¥</li>
<li>Variableå…·æœ‰ä¸‰ä¸ªé‡è¦å±æ€§ï¼šdata,grad,grad_fn<ul>
<li>dataå¯ä»¥å–å‡ºVariableé‡Œé¢tensoræ•°å€¼</li>
<li>grad_fnè¡¨ç¤ºå¾—åˆ°è¿™ä¸ªVariableçš„æ“ä½œï¼ˆå‡½æ•°ï¼‰</li>
<li>gradæ˜¯è¿™ä¸ªVariableçš„åå‘ä¼ æ’­æ¢¯åº¦ã€‚<br>ä¾‹å­ï¼š</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºå˜é‡</span></span><br><span class="line">x = Variable(torch.Tensor([<span class="number">1</span>]), requires_grad=<span class="literal">True</span>)</span><br><span class="line">w = Variable(torch.Tensor([<span class="number">2</span>]), requires_grad=<span class="literal">True</span>)</span><br><span class="line">b = Variable(torch.Tensor([<span class="number">3</span>]), requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#å»ºç«‹è®¡ç®—å›¾</span></span><br><span class="line">y = w * x +b</span><br><span class="line"><span class="comment">#è®¡ç®—æ¢¯åº¦</span></span><br><span class="line">y.backward()    <span class="comment">#å’Œy.backward(torch.FloatTensor([1]))ç›¸åŒ</span></span><br><span class="line">print(x.grad)   <span class="comment">#x.grad = 2  </span></span><br><span class="line">print(w.grad)   <span class="comment">#w.grad = 1</span></span><br><span class="line">print(b.grad)   <span class="comment">#b.grad = 1</span></span><br></pre></td></tr></table></figure>

<p><strong><em>æ³¨æ„ä¸¤ç‚¹ï¼š</em></strong></p>
<ol>
<li>æ„å»ºVariableéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°requires_grad=Trueï¼Œè¡¨ç¤ºæ˜¯å¦å¯¹è¿™ä¸ªå˜é‡æ±‚æ¢¯åº¦ï¼Œé»˜è®¤æ˜¯Flase</li>
<li>y.backward()æ˜¯æ‰€è°“çš„è‡ªåŠ¨æ±‚å¯¼ï¼Œæ‰€æœ‰é‡æ˜¯æ ‡é‡å°±ç­‰ä»·äºy.backward(torch.FloatTensor([1]))çœç•¥çš„ä¸ç”¨è°¢ï¼Œè‡ªåŠ¨æ±‚å¯¼å°±ä¸éœ€è¦å»æ˜ç¡®åœ°å†™æ˜æ˜¯å¯¹é‚£ä¸ªå‡½æ•°æ±‚å¯¼ï¼Œç›´æ¥å¯¹æ‰€æœ‰éœ€è¦çš„æ¢¯åº¦æ±‚å¯¼ï¼Œä½†å¯¹çŸ©é˜µæ¯”å¦‚ä¸‰ç»´å‘é‡ï¼Œè¿™æ—¶å€™yæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå¿…é¡»å£°æ˜y.backward(torch.FloatTensor([1, 1, 1])å¾—åˆ°æ¯ä¸ªåˆ†é‡çš„æ¢¯åº¦)<h3 id="Datasetï¼ˆæ•°æ®é›†ï¼‰"><a href="#Datasetï¼ˆæ•°æ®é›†ï¼‰" class="headerlink" title="Datasetï¼ˆæ•°æ®é›†ï¼‰"></a>Datasetï¼ˆæ•°æ®é›†ï¼‰</h3><blockquote>
<p>ä»»ä½•æœºå™¨å­¦ä¹ é—®é¢˜éƒ½éœ€è¦<strong>æ•°æ®é›†</strong>ï¼ŒPyTorchæä¾›å¾ˆå¤š<strong>å·¥å…·</strong>ï¼Œç”¨æ¥é€šè¿‡è¿­ä»£çš„æ–¹å¼è·å–æ¯ä¸€ä¸ªæ•°æ®:</p>
</blockquote>
</li>
</ol>
<table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>torch.utils.data.Dataset</td>
<td>å®šä¹‰è‡ªå·±çš„æ•°æ®ç±»ç»§æ‰¿å’Œé‡å†™è¿™ä¸ªç±»ï¼Œä½†å¾ˆéš¾å®ç°å–batchï¼Œshuffleæˆ–è€…å¤šçº¿ç¨‹å–è¯»å–æ•°æ®</td>
</tr>
<tr>
<td>torch.utils.data.DataLoader</td>
<td>ç®€å•çš„æ–¹æ³•å®ç°ä¸Šè¿°åŠŸèƒ½</td>
</tr>
<tr>
<td>torchvisionåŒ…çš„ImageFolder</td>
<td>é«˜çº§å…³äºè®¡ç®—æœºè§†è§‰çš„æ•°æ®è¯»å–ç±»ï¼Œä¸»è¦å¤„ç†å›¾ç‰‡</td>
</tr>
<tr>
<td><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è‡ªå®šä¹‰ç»§æ‰¿Dataset:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myDataset</span><span class="params">(Dataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, csv_file, txt_file, root_dir, other_file)</span>:</span></span><br><span class="line">    self.csv_data = pd.read_csv(csv_file)</span><br><span class="line">    <span class="keyword">with</span> open(txt_file, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data_list = f.readlines()</span><br><span class="line">    self.txt_data = data_list</span><br><span class="line">    self.root_dir = root_dir</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.sv_data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        data = (self.csv_data[idx], self.txt_data[idx])</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰å¥½çš„è¿­ä»£å™¨</span></span><br><span class="line">dataiter = DataLoader(myDataset, batch_size = <span class="number">32</span>, shuffle=<span class="literal">True</span>, collate_fn=default_collate)</span><br><span class="line"><span class="comment">#collate_fnè¡¨ç¤ºå¦‚ä½•å–æ ·æœ¬ï¼Œå¯ä»¥å®šä¹‰è‡ªå·±æƒ³è¦çš„å†…å®¹</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¯»å–å›¾ç‰‡æ•°æ®é›†</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">è¦æ±‚å›¾ç‰‡å­˜æ”¾æ ¼å¼</span></span><br><span class="line"><span class="string">root/dog/xxx.png</span></span><br><span class="line"><span class="string">root/cat/123.png</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">deset = ImageFolder(root=<span class="string">'root_path'</span>, transform=<span class="literal">None</span>, loader=defalut_loader)</span><br><span class="line"><span class="comment">#rootæ˜¯éœ€è¦æ ¹ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹æœ‰å‡ ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹è¡¨ç¤ºä¸€ä¸ªç±»åˆ«ï¼Œtransformå’Œtarget_transformæ˜¯å›¾ç‰‡å¢å¼ºï¼Œloaderæ˜¯å›¾ç‰‡è¯»å–çš„æ–¹æ³•ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="nn-Moduleï¼ˆæ¨¡ç»„ï¼‰"><a href="#nn-Moduleï¼ˆæ¨¡ç»„ï¼‰" class="headerlink" title="nn.Moduleï¼ˆæ¨¡ç»„ï¼‰"></a>nn.Moduleï¼ˆæ¨¡ç»„ï¼‰</h3><blockquote>
<p>è¦æ„å»ºç¥ç»ç½‘ç»œï¼Œæ‰€æœ‰çš„å±‚ç»“æ„å’ŒæŸå¤±å‡½æ•°éƒ½éœ€è¦æ¨¡ç»„ï¼Œæ¥è‡ªäºtorch.nnï¼Œæ‰€æœ‰çš„æ¨¡ç‰ˆæ„å»ºä»è¿™ä¸ª<strong>åŸºç±»nn.Moduleç»§æ‰¿</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">net_name</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, other_arguments)</span>:</span></span><br><span class="line">        super(net_name, self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(in_channels, out_channels, kernel_size)</span><br><span class="line">        <span class="comment">#other network layer</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å°±å»ºç«‹äº†ä¸€ä¸ªè®¡ç®—å›¾ï¼Œå¯åå¤ç”¨ï¼Œè°ƒç”¨ä¸€æ¬¡å°±ç›¸å½“äºä¸€æ¬¡å‰å‘ä¼ æ’­ï¼Œå› ä¸ºè‡ªåŠ¨æ±‚å¯¼ä¸ç”¨è‡ªå·±å†™åå‘ä¼ æ’­ã€‚æ‰€æœ‰çš„ç½‘ç»œå±‚éƒ½ç”±nnåŒ…å¾—åˆ°ã€‚<br>nnåŒ…è¿˜å¯ä»¥å®šä¹‰<strong>æŸå¤±å‡½æ•°</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">loss = criterion(output, target)</span><br></pre></td></tr></table></figure>

<h3 id="torch-optimï¼ˆä¼˜åŒ–ï¼‰"><a href="#torch-optimï¼ˆä¼˜åŒ–ï¼‰" class="headerlink" title="torch.optimï¼ˆä¼˜åŒ–ï¼‰"></a>torch.optimï¼ˆä¼˜åŒ–ï¼‰</h3><blockquote>
<p>éœ€è¦é€šè¿‡ä¿®æ”¹å‚æ•°ä½¿å¾—æŸå¤±å‡½æ•°æœ€å°åŒ–ï¼Œä¼˜åŒ–ç®—æ³•å°±æ˜¯ä¸€ç§è°ƒæ•´æ¨¡å‹å‚æ•°æ›´æ–°çš„ç­–ç•¥ã€‚</p>
<ol>
<li>ä¸€é˜¶ä¼˜åŒ–ç®—æ³•<br> ä½¿ç”¨å„ä¸ªå‚æ•°çš„æ¢¯åº¦å€¼æ›´æ–°å‚æ•°ï¼Œæœ€å¸¸è§çš„ä¸€é˜¶ä¼˜åŒ–ç®—æ³•æ˜¯æ¢¯åº¦ä¸‹é™ã€‚æ¢¯åº¦ä¸‹é™å¯»æ‰¾æœ€å°å€¼ï¼Œæ§åˆ¶æ–¹å·®ï¼Œæ›´æ–°æ¨¡å‹å‚æ•°ï¼Œæœ€ç»ˆæ¨¡å‹æ”¶æ•›ã€‚</li>
<li>äºŒé˜¶ä¼˜åŒ–ç®—æ³•<br> ä½¿ç”¨äº†<strong>äºŒé˜¶å¯¼æ•°</strong>æ¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸå¤±å‡½æ•°ã€‚</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=<span class="number">0.01</span>, momentum=<span class="number">0.9</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½"><a href="#æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½" class="headerlink" title="æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½"></a>æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½</h3><blockquote>
<p>torch.saveä¿å­˜æ¨¡å‹çš„ç»“æ„å’Œå‚æ•°</p>
</blockquote>
<p>ä¸¤ç§ä¿å­˜ï¼š</p>
<ol>
<li><p>ä¿å­˜æ•´ä¸ªæ¨¡å‹çš„ç»“æ„ç»†è…»å’Œå‚æ•°ä¿¡æ¯ï¼Œä¿å­˜çš„å¯¹è±¡æ˜¯æ¨¡å‹model</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.save(model, <span class="string">'./model.pth'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿å­˜æ¨¡å‹çš„å‚æ•°ï¼Œä¿å­˜çš„å¯¹è±¡æ˜¯æ¨¡å‹çš„çŠ¶æ€model.state_dict()</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.save(model.state_dict, <span class="string">'./model.pth'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ä¸¤ç§è¯»å–ï¼š</p>
<ol>
<li><code>load_model = torch.load(&#39;model.pth&#39;)</code>åŠ è½½å®Œæ•´çš„æ¨¡å‹ç»“æ„å’Œå‚æ•°ä¿¡æ¯ï¼Œç½‘ç»œå¤§åŠ è½½æ…¢</li>
<li><code>model.load_state_dic(torch.load(&#39;model_state,pth&#39;))</code>éœ€è¦å…ˆå¯¼å…¥æ¨¡å‹ç»“æ„<h2 id="PyTorchå®é™…åº”ç”¨"><a href="#PyTorchå®é™…åº”ç”¨" class="headerlink" title="PyTorchå®é™…åº”ç”¨"></a>PyTorchå®é™…åº”ç”¨</h2>å…¶å®PyTorchåªä¸€ç§æ¡†æ¶ï¼Œä¹¦ä¸­å¤§å¤šæ•°å†…å®¹æ˜¯åœ¨ä»‹ç»æ·±åº¦å­¦ä¹ çŸ¥è¯†ç†è®ºï¼Œåº”è¯¥æ›´å¤šå…³æ³¨PyTorchè¿™ä¸ªæ¡†æ¶çš„ç‰¹åˆ«ä¸åŒçš„ï¼Œå…·æœ‰ç‰¹è‰²çš„åœ°æ–¹ï¼Œä¸‹é¢å¯¹æ¯”PyTorchå’ŒMXNetçš„å·ç§¯ç¥ç»ç½‘ç»œçš„æ¨¡å‹è®­ç»ƒç»“æ„ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨Pytorchè®­ç»ƒMNISTæ•°æ®é›†</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> datasets, transforms</span><br><span class="line">torch.__version__</span><br><span class="line"></span><br><span class="line">BATCH_SIZE=<span class="number">512</span> <span class="comment">#å¤§æ¦‚éœ€è¦2Gçš„æ˜¾å­˜</span></span><br><span class="line">EPOCHS=<span class="number">20</span> <span class="comment"># æ€»å…±è®­ç»ƒæ‰¹æ¬¡</span></span><br><span class="line">DEVICE = torch.device(<span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>) <span class="comment"># è®©torchåˆ¤æ–­æ˜¯å¦ä½¿ç”¨GPUï¼Œå»ºè®®ä½¿ç”¨GPUç¯å¢ƒï¼Œå› ä¸ºä¼šå¿«å¾ˆå¤š</span></span><br><span class="line"></span><br><span class="line">train_loader = torch.utils.data.DataLoader(</span><br><span class="line">        datasets.MNIST(<span class="string">'data'</span>, train=<span class="literal">True</span>, download=<span class="literal">True</span>, </span><br><span class="line">                       transform=transforms.Compose([</span><br><span class="line">                           transforms.ToTensor(),</span><br><span class="line">                           transforms.Normalize((<span class="number">0.1307</span>,), (<span class="number">0.3081</span>,))</span><br><span class="line">                       ])),</span><br><span class="line">        batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">test_loader = torch.utils.data.DataLoader(</span><br><span class="line">        datasets.MNIST(<span class="string">'data'</span>, train=<span class="literal">False</span>, transform=transforms.Compose([</span><br><span class="line">                           transforms.ToTensor(),</span><br><span class="line">                           transforms.Normalize((<span class="number">0.1307</span>,), (<span class="number">0.3081</span>,))</span><br><span class="line">                       ])),</span><br><span class="line">        batch_size=BATCH_SIZE, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConvNet</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        <span class="comment"># 1,28x28</span></span><br><span class="line">        self.conv1=nn.Conv2d(<span class="number">1</span>,<span class="number">10</span>,<span class="number">5</span>) <span class="comment"># 10, 24x24</span></span><br><span class="line">        self.conv2=nn.Conv2d(<span class="number">10</span>,<span class="number">20</span>,<span class="number">3</span>) <span class="comment"># 128, 10x10</span></span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">20</span>*<span class="number">10</span>*<span class="number">10</span>,<span class="number">500</span>)</span><br><span class="line">        self.fc2 = nn.Linear(<span class="number">500</span>,<span class="number">10</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        in_size = x.size(<span class="number">0</span>)</span><br><span class="line">        out = self.conv1(x) <span class="comment">#24</span></span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        out = F.max_pool2d(out, <span class="number">2</span>, <span class="number">2</span>)  <span class="comment">#12</span></span><br><span class="line">        out = self.conv2(out) <span class="comment">#10</span></span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        out = out.view(in_size,<span class="number">-1</span>)</span><br><span class="line">        out = self.fc1(out)</span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        out = self.fc2(out)</span><br><span class="line">        out = F.log_softmax(out,dim=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">model = ConvNet().to(DEVICE)</span><br><span class="line">optimizer = optim.Adam(model.parameters())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(model, device, train_loader, optimizer, epoch)</span>:</span></span><br><span class="line">    model.train()</span><br><span class="line">    <span class="keyword">for</span> batch_idx, (data, target) <span class="keyword">in</span> enumerate(train_loader):</span><br><span class="line">        data, target = data.to(device), target.to(device)</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        output = model(data)</span><br><span class="line">        loss = F.nll_loss(output, target)</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        <span class="keyword">if</span>(batch_idx+<span class="number">1</span>)%<span class="number">30</span> == <span class="number">0</span>: </span><br><span class="line">            print(<span class="string">'Train Epoch: &#123;&#125; [&#123;&#125;/&#123;&#125; (&#123;:.0f&#125;%)]\tLoss: &#123;:.6f&#125;'</span>.format(</span><br><span class="line">                epoch, batch_idx * len(data), len(train_loader.dataset),</span><br><span class="line">                <span class="number">100.</span> * batch_idx / len(train_loader), loss.item()))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(model, device, test_loader)</span>:</span></span><br><span class="line">    model.eval()</span><br><span class="line">    test_loss = <span class="number">0</span></span><br><span class="line">    correct = <span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> data, target <span class="keyword">in</span> test_loader:</span><br><span class="line">            data, target = data.to(device), target.to(device)</span><br><span class="line">            output = model(data)</span><br><span class="line">            test_loss += F.nll_loss(output, target, reduction=<span class="string">'sum'</span>).item() <span class="comment"># å°†ä¸€æ‰¹çš„æŸå¤±ç›¸åŠ </span></span><br><span class="line">            pred = output.max(<span class="number">1</span>, keepdim=<span class="literal">True</span>)[<span class="number">1</span>] <span class="comment"># æ‰¾åˆ°æ¦‚ç‡æœ€å¤§çš„ä¸‹æ ‡</span></span><br><span class="line">            correct += pred.eq(target.view_as(pred)).sum().item()</span><br><span class="line"></span><br><span class="line">    test_loss /= len(test_loader.dataset)</span><br><span class="line">    print(<span class="string">'\nTest set: Average loss: &#123;:.4f&#125;, Accuracy: &#123;&#125;/&#123;&#125; (&#123;:.0f&#125;%)\n'</span>.format(</span><br><span class="line">        test_loss, correct, len(test_loader.dataset),</span><br><span class="line">        <span class="number">100.</span> * correct / len(test_loader.dataset)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">1</span>, EPOCHS + <span class="number">1</span>):</span><br><span class="line">    train(model, DEVICE, train_loader, optimizer, epoch)</span><br><span class="line">    test(model, DEVICE, test_loader)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/PyTorch.jpg" alt="PyTorch"></p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨MXNetè®­ç»ƒFashion-MNISTæ•°æ®é›†</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">".."</span>)</span><br><span class="line"><span class="keyword">import</span> d2lzh <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">import</span> mxnet <span class="keyword">as</span> mx</span><br><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> autograd, gluon, init, nd</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> loss <span class="keyword">as</span> gloss, nn</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Conv2D(channels=<span class="number">6</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.MaxPool2D(pool_size=<span class="number">2</span>, strides=<span class="number">2</span>),</span><br><span class="line">        nn.Conv2D(channels=<span class="number">16</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.MaxPool2D(pool_size=<span class="number">2</span>, strides=<span class="number">2</span>),</span><br><span class="line">        <span class="comment"># Denseä¼šé»˜è®¤å°†(æ‰¹é‡å¤§å°, é€šé“, é«˜, å®½)å½¢çŠ¶çš„è¾“å…¥è½¬æ¢æˆ</span></span><br><span class="line">        <span class="comment"># (æ‰¹é‡å¤§å°, é€šé“ * é«˜ * å®½)å½¢çŠ¶çš„è¾“å…¥</span></span><br><span class="line">        nn.Dense(<span class="number">120</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.Dense(<span class="number">84</span>, activation=<span class="string">'sigmoid'</span>),</span><br><span class="line">        nn.Dense(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">X = nd.random.uniform(shape=(<span class="number">1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>))</span><br><span class="line">net.initialize()</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> net:</span><br><span class="line">    X = layer(X)</span><br><span class="line">    print(layer.name, <span class="string">'output shape:\t'</span>, X.shape)</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">try_gpu</span><span class="params">()</span>:</span>  <span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ctx = mx.gpu()</span><br><span class="line">        _ = nd.zeros((<span class="number">1</span>,), ctx=ctx)</span><br><span class="line">    <span class="keyword">except</span> mx.base.MXNetError:</span><br><span class="line">        ctx = mx.cpu()</span><br><span class="line">    <span class="keyword">return</span> ctx</span><br><span class="line"></span><br><span class="line">ctx = try_gpu()</span><br><span class="line">ctx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨ã€‚è¯¥å‡½æ•°å°†è¢«é€æ­¥æ”¹è¿›ï¼šå®ƒçš„å®Œæ•´å®ç°å°†åœ¨â€œå›¾åƒå¢å¹¿â€ä¸€èŠ‚ä¸­</span></span><br><span class="line"><span class="comment"># æè¿°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_accuracy</span><span class="params">(data_iter, net, ctx)</span>:</span></span><br><span class="line">    acc_sum, n = nd.array([<span class="number">0</span>], ctx=ctx), <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter:</span><br><span class="line">        <span class="comment"># å¦‚æœctxä»£è¡¨GPUåŠç›¸åº”çš„æ˜¾å­˜ï¼Œå°†æ•°æ®å¤åˆ¶åˆ°æ˜¾å­˜ä¸Š</span></span><br><span class="line">        X, y = X.as_in_context(ctx), y.as_in_context(ctx).astype(<span class="string">'float32'</span>)</span><br><span class="line">        acc_sum += (net(X).argmax(axis=<span class="number">1</span>) == y).sum()</span><br><span class="line">        n += y.size</span><br><span class="line">    <span class="keyword">return</span> acc_sum.asscalar() / n</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzhåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_ch5</span><span class="params">(net, train_iter, test_iter, batch_size, trainer, ctx,</span></span></span><br><span class="line"><span class="function"><span class="params">              num_epochs)</span>:</span></span><br><span class="line">    print(<span class="string">'training on'</span>, ctx)</span><br><span class="line">    loss = gloss.SoftmaxCrossEntropyLoss()</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> range(num_epochs):</span><br><span class="line">        train_l_sum, train_acc_sum, n, start = <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0</span>, time.time()</span><br><span class="line">        <span class="keyword">for</span> X, y <span class="keyword">in</span> train_iter:</span><br><span class="line">            X, y = X.as_in_context(ctx), y.as_in_context(ctx)</span><br><span class="line">            <span class="keyword">with</span> autograd.record():</span><br><span class="line">                y_hat = net(X)</span><br><span class="line">                l = loss(y_hat, y).sum()</span><br><span class="line">            l.backward()</span><br><span class="line">            trainer.step(batch_size)</span><br><span class="line">            y = y.astype(<span class="string">'float32'</span>)</span><br><span class="line">            train_l_sum += l.asscalar()</span><br><span class="line">            train_acc_sum += (y_hat.argmax(axis=<span class="number">1</span>) == y).sum().asscalar()</span><br><span class="line">            n += y.size</span><br><span class="line">        test_acc = evaluate_accuracy(test_iter, net, ctx)</span><br><span class="line">        print(<span class="string">'epoch %d, loss %.4f, train acc %.3f, test acc %.3f, '</span></span><br><span class="line">              <span class="string">'time %.1f sec'</span></span><br><span class="line">              % (epoch + <span class="number">1</span>, train_l_sum / n, train_acc_sum / n, test_acc,</span><br><span class="line">                 time.time() - start))</span><br><span class="line"></span><br><span class="line">lr, num_epochs = <span class="number">0.9</span>, <span class="number">5</span></span><br><span class="line">net.initialize(force_reinit=<span class="literal">True</span>, ctx=ctx, init=init.Xavier())</span><br><span class="line">trainer = gluon.Trainer(net.collect_params(), <span class="string">'sgd'</span>, &#123;<span class="string">'learning_rate'</span>: lr&#125;)</span><br><span class="line">train_ch5(net, train_iter, test_iter, batch_size, trainer, ctx, num_epochs)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/MXNet.jpg" alt="MXNet"></p>
<p><strong>å¯ä»¥å¯¹æ¯”å‘ç°ï¼Œä¸¤ç§æ¡†æ¶å…¶å®å¯¹æ·±åº¦å­¦ä¹ æ•´ä¸ªæµç¨‹éƒ½æ˜¯å¤§åŒå°å¼‚ï¼ŒåŒæ—¶æ¡†æ¶ä¹Ÿæœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œå¤šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å°±èƒ½ä½¿ç”¨ç†Ÿç»ƒï¼Œæ›´é‡è¦æ˜¯æŒæ¡æ·±åº¦å­¦ä¹ æ•´ä¸ªæµç¨‹ï¼Œå„ç§æ¨¡å‹ç‰¹ç‚¹ï¼Œè°ƒå‚ç­‰æ–¹æ³•ï¼Œå„ç§ä¼˜åŒ–ç®—æ³•ã€æŸå¤±ç®—æ³•çš„æœ¬è´¨æŒæ¡æ¸…æ¥šæ‰èƒ½æ›´å¥½è®­ç»ƒå‡ºæ¨¡å‹</strong></p>
<h1 id="OpenCVæ€»ç»“"><a href="#OpenCVæ€»ç»“" class="headerlink" title="OpenCVæ€»ç»“"></a>OpenCVæ€»ç»“</h1><h2 id="å…¨ä¹¦ç»“æ„ï¼š"><a href="#å…¨ä¹¦ç»“æ„ï¼š" class="headerlink" title="å…¨ä¹¦ç»“æ„ï¼š"></a>å…¨ä¹¦ç»“æ„ï¼š</h2><p><img src="/2020/02/05/Summary-of-Pytorch-and-OpenCV/book.png" alt="book"></p>
<blockquote>
<p>OpenCVä¸ºOpen Source Computer Visionçš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªå…è´¹çš„è®¡ç®—æœºè§†è§‰åº“ï¼Œå¯é€šè¿‡å¤„ç†å›¾åƒå’Œè§†é¢‘å®Œæˆå„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ‘„åƒå¤´è¾“å…¥çš„ä¿¡å·ä»¥åŠä½¿æœºå™¨äººè¯†åˆ«ç°å®ç”Ÿæ´»ä¸­çš„ç‰©ä½“ã€‚</p>
</blockquote>
<p>å…¶å®OpenCVé‡ç‚¹æ˜¯æŒæ¡æ€ä¹ˆä½¿ç”¨ï¼Œè¿™æœ¬ä¹¦æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»äº†OpenCVä¸­çš„ä¸€äº›æ¥å£çš„åŸç†å’Œåº”ç”¨ï¼Œä½†é‡ç‚¹åº”è¯¥åœ¨ç†Ÿæ‚‰ç†è§£opeCVçš„ä¸€äº›é‡è¦å›¾åƒå¤„ç†çš„æ€æƒ³å’Œåº”ç”¨ã€‚<br><strong>å¯¹è¿™æœ¬ä¹¦çš„å®Œæˆæƒ…å†µï¼š</strong></p>
<ul>
<li>å‰ä¸‰ç« æ˜¯å®Œå…¨è¯»å®Œäº†å¹¶ä¸”æ•²äº†ä»£ç ï¼Œæœ‰ä¸ªå¤§è‡´çš„äº†è§£</li>
<li>ä¹¦ä¸­ç»™çš„Cameoå®é™…ä¾‹å­ï¼Œæ˜¯Pythonå†™çš„ï¼Œç”±äºc++æœ€åæœ‰ä¸€ä¸ªç»¼åˆå®ä¾‹ï¼Œä¸ºäº†ä¸€ä¸¾ä¸¤å¾—ï¼Œæ—¢å­¦ä¹ äº†c++é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ï¼ŒåŒæ—¶æ›´ç†Ÿæ‚‰OpenCVï¼Œæˆ‘æŠŠä¹¦ä¸­çš„Pythonä»£ç æ”¹æˆäº†c++æ ¼å¼å½“ä½œä¸šäº¤äº†ä¸Šå»ğŸ˜‚ï¼Œæœ€åå®ç°äº†ä¸€ä¸ªèƒ½å¤Ÿäººè„¸æ£€æµ‹çš„æ‘„åƒå¤´ã€‚å¯¹ä¸€äº›æ–¹æ³•åˆæœ‰äº†æ›´å®é™…çš„æŒæ¡ã€‚<h2 id="OpenCVè¦ç‚¹æ€»ç»“"><a href="#OpenCVè¦ç‚¹æ€»ç»“" class="headerlink" title="OpenCVè¦ç‚¹æ€»ç»“"></a>OpenCVè¦ç‚¹æ€»ç»“</h2><h3 id="OpenCVçš„åŸºç¡€"><a href="#OpenCVçš„åŸºç¡€" class="headerlink" title="OpenCVçš„åŸºç¡€"></a>OpenCVçš„åŸºç¡€</h3>ä¸»è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨OpenCVå¯¹è¾“å…¥å’Œè¾“å‡ºæµçš„æ§åˆ¶ï¼Œæ–¹æ³•ä¸€çœ‹å°±ä¼šã€‚<h4 id="è¯»-å†™å›¾åƒæ–‡ä»¶"><a href="#è¯»-å†™å›¾åƒæ–‡ä»¶" class="headerlink" title="è¯»/å†™å›¾åƒæ–‡ä»¶"></a>è¯»/å†™å›¾åƒæ–‡ä»¶</h4>OpenCVçš„imreadå‡½æ•°å’Œimwriteå‡½æ•°éƒ½æ”¯æŒå„ç§é™æ€å›¾åƒæ–‡ä»¶æ ¼å¼ã€‚ä¸åŒç³»ç»Ÿæ”¯æŒå›¾åƒæ ¼å¼ä¸åŒï¼Œä½†éƒ½æ”¯æŒBMPæ ¼å¼ï¼Œé€šå¸¸è¿˜æ”¯æŒPNGã€JPEGå’ŒTIFFæ ¼å¼ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">img = numpy.zeros((<span class="number">3</span>,<span class="number">3</span>), dtype=numpy.uint8) <span class="comment">#numpyå›¾åƒå®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è½¬æ¢å›¾åƒæˆBGRæ ¼å¼</span></span><br><span class="line">img = cv2.cvtColor(img, cv2.COLOR_GRAY2BGR)</span><br><span class="line"><span class="comment">#è¯»æ–‡ä»¶</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">å¯é€‰å‚æ•°ï¼š</span></span><br><span class="line"><span class="string">IMREAD_ANYCOLOR\IMREADANYDEPTH\IMREAD_COLOR\IMREAD_GRAYSCALE..</span></span><br><span class="line"><span class="string">image = cv2.imread('MyPic.png', cv2.IMREAD_GRAYSCALE)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">image = cv2.imread(<span class="string">'MyPic.png'</span>)</span><br><span class="line"><span class="comment">#å†™æ–‡ä»¶</span></span><br><span class="line">cv2.imwrite(<span class="string">'MyPic.jpg'</span>, image)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢"><a href="#å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢"></a>å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢</h4><p>ä¸€å¼ å›¾åƒå¯ä»¥çš„æ¯ä¸ªåƒç´ ç‚¹å¯ä»¥ç”¨æ¯ä¸ªé€šé“çš„ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è‹¥ä¸€å›¾åƒæ¯ä¸ªé€šé“8ä¸ºï¼Œå¯è½¬æ¢æˆpython bytearrayæ ¼å¼</span></span><br><span class="line">byteArray = bytearray(image)</span><br><span class="line"><span class="comment">#è‹¥bytearrayæœ‰æ°å½“çš„é¡ºåºå­—èŠ‚ï¼Œå¯ä»¥è½¬æ¢æˆnumpy.arrayçš„å›¾åƒ</span></span><br><span class="line">grayImage = numpy.array(grayByteArray).reshape(height, width)</span><br><span class="line">bgrImage = numpy.array(bgrByteArray).reshape(height, width, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨numpy-arrayè®¿é—®å›¾åƒæ•°æ®"><a href="#ä½¿ç”¨numpy-arrayè®¿é—®å›¾åƒæ•°æ®" class="headerlink" title="ä½¿ç”¨numpy.arrayè®¿é—®å›¾åƒæ•°æ®"></a>ä½¿ç”¨numpy.arrayè®¿é—®å›¾åƒæ•°æ®</h3><p>numpyçš„arrayå¯ä»¥å¾ˆå¥½çš„å¤„ç†OpenCVçš„æ•°ç»„ï¼Œæé«˜æ•ˆç‡ï¼Œä»£ç ç®€æ´</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">img = cv.imread(<span class="string">'MyPic.png'</span>)</span><br><span class="line">img[<span class="number">0</span>, <span class="number">0</span>] = [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>]  <span class="comment">#ç°åº¦</span></span><br><span class="line">img[:, :, <span class="number">1</span>] = <span class="number">0</span>   <span class="comment">#BGRæ ¼å¼</span></span><br><span class="line">img[<span class="number">300</span>:<span class="number">400</span>, <span class="number">300</span>::<span class="number">400</span>] = img[<span class="number">0</span>:<span class="number">100</span>, <span class="number">0</span>:<span class="number">100</span>] <span class="comment">#ç­‰ç­‰</span></span><br></pre></td></tr></table></figure>

<p>å¼ºçƒˆè¦æ±‚åŒæ—¶æŒæ¡numpy.arrayåº“æ˜¯Pythonå¤„ç†å›¾åƒçš„åŸºç¡€ã€‚</p>
<h3 id="è§†é¢‘æ–‡ä»¶çš„è¯»å†™"><a href="#è§†é¢‘æ–‡ä»¶çš„è¯»å†™" class="headerlink" title="è§†é¢‘æ–‡ä»¶çš„è¯»å†™"></a>è§†é¢‘æ–‡ä»¶çš„è¯»å†™</h3><p>æä¾›äº†VideoCaptureç±»ï¼ˆè¯»ï¼‰å’ŒVideoWriterç±»ï¼ˆå†™ï¼‰</p>
<ul>
<li>VideoCaptureé‡Œå¯é€šè¿‡read()å‡½æ•°æ¥è·å–æ–°çš„å¸§ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯åŸºäºBGRæ ¼å¼çš„å›¾åƒ</li>
<li>å¯å°†ä¸€å¹…å›¾åƒä¼ é€’ç»™VideoWriterç±»çš„write()å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå°†è¿™å¹…å›¾åƒåŠ åˆ°VideoWriterç±»æ‰€æŒ‡åƒçš„æ–‡ä»¶ä¸­ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰è§†é¢‘è·å–ç±»</span></span><br><span class="line">videoCapture = cv2.VideoCapture(<span class="string">'MyInputVid.avi'</span>)</span><br><span class="line">fps = videoCapture.get(cv2.CAP_PROP_FPS)  <span class="comment">#FPS</span></span><br><span class="line">size = (int(videoCapture.get(cv2.CAP_PROP_FRAME_WIDTH)),int(videoCapture.get(cv2.CAP_PROP_FRAME_HEIGHT))) <span class="comment">#size</span></span><br><span class="line"><span class="comment">#å®šä¹‰å†™è§†é¢‘ç±»</span></span><br><span class="line">videoWriter = cv2.VideoWriter (<span class="string">'MyOutputvid.avi'</span>,<span class="string">'cv2.VideoWriter_fourcc('</span>I<span class="string">','</span><span class="number">4</span><span class="string">','</span><span class="number">2</span><span class="string">','</span><span class="number">0</span><span class="string">')'</span>, fps, size) </span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†è¯»å–çš„å¸§å†™åˆ°æ–°æ–‡ä»¶ä¸­</span></span><br><span class="line">success, frame = videoCapture.read()</span><br><span class="line"><span class="keyword">while</span> success:</span><br><span class="line">    videoWriter.write(frame)</span><br><span class="line">    success, frame = videoCapture.read()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>å¸§é€Ÿç‡fpsï¼Œå¸§å¤§å°ï¼Œå¸§çš„ç¼–ç æ–¹å¼éƒ½æœ‰ä¸åŒçš„å‚æ•°</strong></p>
<h3 id="æ•è·æ‘„åƒå¤´çš„å¸§"><a href="#æ•è·æ‘„åƒå¤´çš„å¸§" class="headerlink" title="æ•è·æ‘„åƒå¤´çš„å¸§"></a>æ•è·æ‘„åƒå¤´çš„å¸§</h3><p>ç®€å•ï¼Œéœ€è¦ä¼ é€’æ‘„åƒå¤´çš„è®¾å¤‡ç´¢å¼•<strong>device index</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cameraCapture = cv2.VideoCapture(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>ä½†æ˜¯VideoCaptureç±»çš„get()æ–¹æ³•å¯¹ä¸åŒç³»ç»Ÿæœ‰é™åˆ¶ï¼Œæœ‰çš„ä¸æ”¯æŒæŸ¥è¯¢æ€»ä¼šè¿”å›é›¶ã€‚</li>
<li>å¯¹å¸§çš„fpsè¦ä¹ˆä½œå‡ºå‡è®¾è¦ä¹ˆç”¨è®¡æ—¶å™¨æµ‹é‡ï¼Œæ¥åˆ›å»ºåˆé€‚çš„VideoWriterç±»</li>
<li>æ‘„åƒå¤´çš„æ•°é‡å’Œé¡ºåºç”±ç³»ç»Ÿå®šï¼Œä½†OpenCVæ²¡æœ‰æä¾›æ‘„åƒå¤´æŸ¥è¯¢æ–¹æ³•ï¼Œä½¿ç”¨æ— æ•ˆç´¢å¼•ä¼šå¾—ä¸åˆ°ï¼Œå¯ä»¥ç”¨<code>VideoCapture.isOpened</code>åšä¸€ä¸ªåˆ¤æ–­</li>
<li>éœ€è¦åŒæ­¥ä¸€ç»„æ‘„åƒå¤´æˆ–è€…å¤šå¤´æ‘„åƒå¤´ï¼Œread()æ–¹æ³•ä¸é€‚ç”¨ã€‚åº”ç”¨gran()å’Œretrive()æ–¹æ³•ä»£æ›¿ã€‚  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">success0 = cameraCapture0.grab()</span><br><span class="line">success1 = cameraCapture1.grab()</span><br><span class="line"><span class="keyword">if</span> success0 <span class="keyword">and</span> success1:</span><br><span class="line">    frame = cameraCapture0.retrieve()</span><br><span class="line">    frame = cameraCapture1.retrieve()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ"><a href="#åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ" class="headerlink" title="åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ"></a>åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ</h3><p>ç®€å•çš„imshow()æ¥æ˜¾ç¤ºä¸€å¹…å›¾åƒã€‚ä½†ä¼šä¸€ç¬é—´æ¶ˆå¤±ã€‚ç”¨waitKey()å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(<span class="string">'my-image.png'</span>)</span><br><span class="line">cv2.imshow(<span class="string">'my image'</span>, img)</span><br><span class="line">cv2.waitKey()</span><br><span class="line">cv2.destroyAllwindows()</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§"><a href="#åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§" class="headerlink" title="åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§"></a>åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§</h3><p>OpenCVçš„nameedWindow()ã€imshow()å’ŒDestroyWindow()å‡½æ•°å…è®¸æŒ‡å®šçª—å£ååˆ›å»ºã€æ˜¾ç¤ºå’Œé”€æ¯çª—å£ï¼Œå®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">clicked = <span class="literal">False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">onMouse</span><span class="params">(event, x, y, flags, param)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> clicked</span><br><span class="line">    <span class="keyword">if</span> event == cv2.EVENT_LBUTTONUP:</span><br><span class="line">        clicked = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">cameraCapture = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line">cv2.namedWindow(<span class="string">'MyWindow'</span>)</span><br><span class="line">cv2.setMouseCallback(<span class="string">'MyWindow'</span>, onMouse)</span><br><span class="line"></span><br><span class="line">success, frame = cameraCapture.read()</span><br><span class="line"><span class="keyword">while</span> success <span class="keyword">and</span> cv2.waitKey(<span class="number">1</span>) == <span class="number">-1</span> <span class="keyword">and</span> <span class="keyword">not</span> clicked:</span><br><span class="line">    cv2.imshow(<span class="string">'MyWindow'</span>, frame)</span><br><span class="line">    success, frame = cameraCapture.read()</span><br><span class="line"></span><br><span class="line">cv2.destroyWindow(<span class="string">'MyWindow'</span>)</span><br><span class="line">cameraCapture.release()</span><br></pre></td></tr></table></figure>

<h2 id="Cameoé¡¹ç›®"><a href="#Cameoé¡¹ç›®" class="headerlink" title="Cameoé¡¹ç›®"></a>Cameoé¡¹ç›®</h2><p>å¯ä»¥ç”¨OpenCVå®ç°ä¸€ä¸ªå°çš„æ‘„åƒå¤´åº”ç”¨ï¼Œå…³é”®æ˜¯æƒ³å¥½æ‘„åƒå¤´çš„é€»è¾‘ï¼Œå°è£…ä¸€äº›ç±»ä¸å¯¹è±¡ï¼Œçœ‹ä»£ç æ¯”å†™æ€»ç»“æ•ˆç‡é«˜ã€‚<br>ä¹‹åçš„è®¸å¤šå·ç§¯æ¥åšç›®æ ‡æ£€æµ‹ã€äººè„¸æ£€æµ‹è¯¸å¤šç®—æ³•éƒ½æœ‰OpenCVçš„è‡ªå·±å°è£…çš„æ–¹å¼ï¼Œéœ€è¦ç”¨çš„æ—¶å€™å­¦ä¹ ç†è§£èµ·æ¥ä¹Ÿæ¯”è¾ƒå¿«ï¼ŒåŸºæœ¬çš„å›¾åƒå¤„ç†æ¦‚å¿µæŒæ¡åº”ç”¨åˆ°ä¹‹åçš„é¡¹ç›®å®ä¾‹ä¸­ã€‚</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/01/22/dive-into-deep-learning/" rel="next" title="dive into deep learning">
                  <i class="fa fa-chevron-left"></i> dive into deep learning
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2020/02/06/regular-expression/" rel="prev" title="regular expression">
                  regular expression <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PyTorchæ€»ç»“"><span class="nav-number">1.</span> <span class="nav-text">PyTorchæ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PytorchåŸºç¡€"><span class="nav-number">1.1.</span> <span class="nav-text">PytorchåŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tensorï¼ˆå¼ é‡ï¼‰"><span class="nav-number">1.1.1.</span> <span class="nav-text">Tensorï¼ˆå¼ é‡ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Variableï¼ˆå˜é‡ï¼‰"><span class="nav-number">1.1.2.</span> <span class="nav-text">Variableï¼ˆå˜é‡ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Datasetï¼ˆæ•°æ®é›†ï¼‰"><span class="nav-number">1.1.3.</span> <span class="nav-text">Datasetï¼ˆæ•°æ®é›†ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nn-Moduleï¼ˆæ¨¡ç»„ï¼‰"><span class="nav-number">1.1.4.</span> <span class="nav-text">nn.Moduleï¼ˆæ¨¡ç»„ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#torch-optimï¼ˆä¼˜åŒ–ï¼‰"><span class="nav-number">1.1.5.</span> <span class="nav-text">torch.optimï¼ˆä¼˜åŒ–ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½"><span class="nav-number">1.1.6.</span> <span class="nav-text">æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PyTorchå®é™…åº”ç”¨"><span class="nav-number">1.2.</span> <span class="nav-text">PyTorchå®é™…åº”ç”¨</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenCVæ€»ç»“"><span class="nav-number">2.</span> <span class="nav-text">OpenCVæ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å…¨ä¹¦ç»“æ„ï¼š"><span class="nav-number">2.1.</span> <span class="nav-text">å…¨ä¹¦ç»“æ„ï¼š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenCVè¦ç‚¹æ€»ç»“"><span class="nav-number">2.2.</span> <span class="nav-text">OpenCVè¦ç‚¹æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenCVçš„åŸºç¡€"><span class="nav-number">2.2.1.</span> <span class="nav-text">OpenCVçš„åŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯»-å†™å›¾åƒæ–‡ä»¶"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">è¯»/å†™å›¾åƒæ–‡ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">å›¾åƒä¸åŸå§‹å­—èŠ‚ä¹‹é—´çš„è½¬æ¢</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨numpy-arrayè®¿é—®å›¾åƒæ•°æ®"><span class="nav-number">2.2.2.</span> <span class="nav-text">ä½¿ç”¨numpy.arrayè®¿é—®å›¾åƒæ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è§†é¢‘æ–‡ä»¶çš„è¯»å†™"><span class="nav-number">2.2.3.</span> <span class="nav-text">è§†é¢‘æ–‡ä»¶çš„è¯»å†™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ•è·æ‘„åƒå¤´çš„å¸§"><span class="nav-number">2.2.4.</span> <span class="nav-text">æ•è·æ‘„åƒå¤´çš„å¸§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ"><span class="nav-number">2.2.5.</span> <span class="nav-text">åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§"><span class="nav-number">2.2.6.</span> <span class="nav-text">åœ¨çª—å£æ˜¾ç¤ºæ‘„åƒå¤´å¸§</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cameoé¡¹ç›®"><span class="nav-number">2.3.</span> <span class="nav-text">Cameoé¡¹ç›®</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570163730249&di=dcd36b04d1066a90ddb1f132ae3a6bcc&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Ffe60497fd762440686b6d5702c2c9f19df71fb9911009-LVWEJj_fw658"
      alt="æœ›æ˜Ÿçš„å¤ªé˜³èŠ±">
  <p class="site-author-name" itemprop="name">æœ›æ˜Ÿçš„å¤ªé˜³èŠ±</p>
  <div class="site-description" itemprop="description">You are my JavaSript in my HTML.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
        </a>
      </div>
    
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æœ›æ˜Ÿçš„å¤ªé˜³èŠ±</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.4.1</div>

        












        
      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

</body>
</html>
